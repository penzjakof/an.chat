(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23866,e=>{"use strict";e.s(["default",()=>x],23866);var t=e.i(43476),l=e.i(71645),a=e.i(22016),r=e.i(18566),s=e.i(96085),n=e.i(94108),o=e.i(63267);let i={"aoshlatyyy@gmail.com":"aoshlatyyy","aaallonnno44ka03@gmail.com":"aaallonnno44ka03"},d=null,c=null,u=0;function g(){let[e,a]=(0,l.useState)([]),[r,s]=(0,l.useState)({}),[g,m]=(0,l.useState)(!1),[p,f]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=Date.now();if(d&&c&&e-u<3e5){console.log("📋 Using cached profiles"),a(d),s(c),m(Object.values(c).some(e=>"failed"===e.status));return}x()},[]);let x=async()=>{try{if(!(0,o.getSession)())return void console.log("User not logged in, skipping profile authentication");console.log("🔍 Loading user profiles...");let t=await (0,n.apiGet)("/profiles/my");console.log("✅ Loaded profiles:",t.length),a(t);let l={},r=!1,i=t.map(e=>e.id);try{let a=await (0,n.apiPost)("/profiles/session/status/batch",{ids:i});for(let s of t){var e;let t=null==(e=a.results)?void 0:e[s.id];if(!s.profileId){l[s.id]={profileId:s.id,status:"no-session",message:"Профіль не має profileId"};continue}(null==t?void 0:t.authenticated)?l[s.id]={profileId:s.id,status:"authenticated",message:t.message||"Автентифіковано"}:(l[s.id]={profileId:s.id,status:"failed",message:(null==t?void 0:t.message)||"Потрібна автентифікація"},r=!0)}}catch(e){for(let e of t)l[e.id]={profileId:e.id,status:"failed",message:"Помилка перевірки сесії"};r=!0}s(l),d=t,c=l,u=Date.now(),r&&(m(!0),await h(t,l))}catch(e){console.error("Failed to load profiles:",e),e instanceof Error&&console.error("Error details:",e.message)}},h=async(e,t)=>{for(let l of(f(!0),e)){let e=t[l.id];if((null==e?void 0:e.status)==="failed"&&l.credentialLogin){let e=i[l.credentialLogin];e&&await v(l.id,e)}}f(!1)},v=async(e,t)=>{s(t=>({...t,[e]:{...t[e],status:"authenticating",message:"Автентифікація..."}}));try{await (0,n.apiPost)("/profiles/".concat(e,"/authenticate"),{password:t});let l={...r,[e]:{...r[e],status:"authenticated",message:"Успішно автентифіковано"}};s(l),c=l,setTimeout(()=>{Object.values(r).every(e=>"authenticated"===e.status||"no-session"===e.status)&&(m(!1),console.log("✅ Всі профілі автентифіковані"))},1e3)}catch(t){s(t=>({...t,[e]:{...t[e],status:"failed",message:"Помилка автентифікації"}}))}};if(!g)return null;let b=e.filter(e=>{var t,l;return(null==(t=r[e.id])?void 0:t.status)==="failed"||(null==(l=r[e.id])?void 0:l.status)==="authenticating"});return 0===b.length?null:(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Автентифікація профілів"}),p?(0,t.jsx)("p",{className:"text-blue-600 mb-4",children:"🔄 Автоматична автентифікація профілів..."}):(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Для отримання діалогів потрібно автентифікувати профілі TalkyTimes:"}),(0,t.jsx)("div",{className:"space-y-4",children:b.map(e=>{let l=r[e.id];return(0,t.jsxs)("div",{className:"border rounded p-3",children:[(0,t.jsx)("div",{className:"font-medium",children:e.displayName}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.credentialLogin}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Статус: ",(null==l?void 0:l.message)||"Невідомо"]}),(null==l?void 0:l.status)==="failed"&&(0,t.jsx)("div",{className:"mt-2",children:(0,t.jsx)("input",{type:"password",placeholder:"Пароль TalkyTimes",className:"border rounded px-2 py-1 w-full text-sm",onKeyDown:t=>{if("Enter"===t.key){let l=t.target.value;l&&v(e.id,l)}}})}),(null==l?void 0:l.status)==="authenticating"&&(0,t.jsx)("div",{className:"mt-2 text-sm text-blue-600",children:"🔄 Автентифікація..."}),(null==l?void 0:l.status)==="authenticated"&&(0,t.jsx)("div",{className:"mt-2 text-sm text-green-600",children:"✅ Успішно автентифіковано"})]},e.id)})}),(0,t.jsxs)("div",{className:"mt-4 flex gap-2",children:[!p&&(0,t.jsx)("button",{onClick:()=>h(e,r),className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",children:"🔄 Автентифікувати автоматично"}),(0,t.jsx)("button",{onClick:()=>m(!1),className:"px-4 py-2 text-sm text-gray-500 hover:text-gray-700 border rounded",children:"Пропустити"})]})]})})}var m=e.i(43453);let p=e=>{let{value:a,onChange:r,options:s,placeholder:n="Виберіть варіант",className:o="",disabled:i=!1}=e,[d,c]=(0,l.useState)(!1),[u,g]=(0,l.useState)(""),m=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=s.find(e=>e.value===a);g(e?e.label:n)},[a,s,n]),(0,l.useEffect)(()=>{let e=e=>{m.current&&!m.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.jsxs)("div",{ref:m,className:"relative ".concat(o),children:[(0,t.jsxs)("button",{type:"button",onClick:()=>{i||c(!d)},disabled:i,className:"\n          w-full px-3 py-2 text-left bg-white border border-gray-300 rounded-md\n          hover:border-gray-400 focus:border-purple-500 focus:outline-none focus:ring-1 focus:ring-purple-500\n          disabled:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed\n          transition-colors duration-200 flex items-center justify-between\n        ",children:[(0,t.jsx)("span",{className:u===n?"text-gray-500":"text-gray-900",children:u}),(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform duration-200 ".concat(d?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d&&(0,t.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto custom-scroll",children:s.map(e=>(0,t.jsx)("button",{onClick:()=>{r(e.value),c(!1)},className:"\n                w-full px-3 py-2 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none\n                transition-colors duration-150\n                ".concat(e.value===a?"bg-purple-50 text-purple-700 font-medium":"text-gray-900","\n              "),children:e.label},e.value))})]})};var f=e.i(91610);function x(e){let{children:i}=e,d=(0,r.useRouter)(),c=(0,r.usePathname)(),{showToast:u}=(0,f.useToast)(),[x,h]=(0,l.useState)([]),[v,b]=(0,l.useState)({}),[y,w]=(0,l.useState)([]),[j,N]=(0,l.useState)({}),[_,k]=(0,l.useState)(!0),[I,S]=(0,l.useState)(!1),[U,L]=(0,l.useState)(!0),[C,M]=(0,l.useState)(""),[T,E]=(0,l.useState)({status:"unanswered",onlineOnly:!1}),[D,A]=(0,l.useState)(!0),R=(0,l.useRef)(T);(0,l.useEffect)(()=>{R.current=T},[T]),(0,l.useEffect)(()=>{(async()=>{if(!(0,o.getSession)())return d.replace("/login");try{let e=await (0,n.apiGet)("/api/shifts/is-active");(null==e?void 0:e.active)||d.replace("/dashboard")}catch(e){}})()},[d]);let[O,P]=(0,l.useState)(!1),[B,F]=(0,l.useState)(""),[W,G]=(0,l.useState)(""),[z,H]=(0,l.useState)(null),[Z,V]=(0,l.useState)(!1),K=c.includes("/chats/")&&"/chats"!==c?c.split("/chats/")[1]:null,J=async()=>{if(!B||!W)return void alert("Будь ласка, оберіть профіль та введіть ІД клієнта");if(!(0,o.getSession)())return void d.replace("/login");try{V(!0);let e=new URLSearchParams;e.set("profileId",B),e.set("clientId",W);let t=await (0,n.apiGet)("/api/chats/search-dialog?".concat(e.toString()));t&&t.dialog?(H(t.dialog),t.profiles&&b(e=>({...e,...t.profiles}))):(H(null),alert("Діалог не знайдено"))}catch(e){console.error("Failed to search dialog:",e),alert("Помилка при пошуку діалогу"),H(null)}finally{V(!1)}},q=()=>{H(null),F(""),G(""),P(!1)},Q=async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!(0,o.getSession)())return void d.replace("/login");try{var l,a,r;t?(k(!0),h([]),M(""),L(!0)):S(!0);let s=new URLSearchParams;"active"!==e.status&&s.set("status",e.status),e.onlineOnly&&s.set("onlineOnly","true"),!t&&C&&s.set("cursor",C);let o="/api/chats/dialogs".concat(s.toString()?"?"+s.toString():""),i=await (0,n.apiGet)(o);if(console.log("📥 Frontend received response:",{dialogsCount:null==i||null==(l=i.dialogs)?void 0:l.length,cursor:null==i?void 0:i.cursor,hasMore:null==i?void 0:i.hasMore,isInitial:t}),i&&Array.isArray(i.dialogs)){let l=(a=i.dialogs,r=i.profiles,"unanswered"!==e.status?a:a.filter(e=>{if((null==e?void 0:e.isBlocked)===!0||(null==e?void 0:e.is_blocked)===!0)return!1;let t=null==r?void 0:r[e.idInterlocutor];return!t||!0!==t.is_blocked}));if(t)h(l),b(i.profiles||{}),w(i.sourceProfiles||[]),(async()=>{try{let e=i.profiles||{},t=[];for(let a of l){let l=null==a?void 0:a.idInterlocutor,r=null==a?void 0:a.idUser;"number"!=typeof l||"number"!=typeof r||e[l]||t.push({ttProfileId:r,clientId:l})}for(let e of t.slice(0,25)){let t=await ee(e.ttProfileId);t&&await et(t,e.clientId)}}catch(e){}})();else{let e=new Set(x.map(e=>"".concat(e.idUser,"-").concat(e.idInterlocutor))),t=l.filter(t=>!e.has("".concat(t.idUser,"-").concat(t.idInterlocutor)));if(console.log("📄 Dialogs pagination: loaded ".concat(i.dialogs.length," dialogs, ").concat(t.length," new")),console.log("📊 Current dialogs count: ".concat(x.length,", existing IDs sample:"),Array.from(e).slice(0,5)),console.log("📊 New dialogs sample:",t.slice(0,3).map(e=>"".concat(e.idUser,"-").concat(e.idInterlocutor))),0===t.length){console.log("⏹️ No new dialogs after filtering, stopping pagination"),L(!1);return}let a=x.length+t.length;a>500&&(console.log("🛑 Reached maximum dialogs limit (".concat(a,"), stopping pagination")),L(!1)),h(e=>[...e,...t]),b(e=>({...e,...i.profiles||{}})),w(e=>[...e,...i.sourceProfiles||[]])}M(i.cursor||""),L(!!i.hasMore)}else t&&(h([]),b({}),w([]))}catch(e){console.error("Failed to load dialogs:",e),t&&(h([]),b({}),w([]))}finally{t?k(!1):S(!1)}};(0,l.useEffect)(()=>(Q(T),()=>{Y.current&&clearTimeout(Y.current)}),[d,T]),(0,l.useEffect)(()=>{let e=e=>{var t;let l=e.detail;l&&(null==(t=R.current)?void 0:t.status)==="unanswered"&&h(e=>e.filter(e=>{if(e.idUser!==l.profileId||e.idInterlocutor!==l.clientId)return!0;let t=!0===e.__email;return"email"===l.kind?!t:t}))};return window.addEventListener("dialog:sent",e),()=>window.removeEventListener("dialog:sent",e)},[]),(0,l.useEffect)(()=>{if("unanswered"!==T.status)return;let e=setInterval(()=>{Q(T,!0)},6e4);return()=>clearInterval(e)},[T]);let X=async()=>{U&&!I&&!_&&C&&(console.log("🔄 Loading more dialogs with cursor: ".concat(C)),await Q(T,!1))},Y=(0,l.useRef)(null);(0,l.useEffect)(()=>{y.length>0&&er()},[y]),(0,l.useEffect)(()=>{let e=(0,o.getAccessToken)();if(!e)return;let t=window.location.origin,l=(0,s.io)(t,{transports:["polling"],upgrade:!1,path:"/socket.io/",auth:{token:e}});return l.on("user_online_status",e=>{console.log("👤 RTM: User online status changed in dialogs list",e),b(t=>({...t,[e.userId]:t[e.userId]?{...t[e.userId],is_online:e.isOnline}:t[e.userId]}))}),l.on("message_toast",e=>{console.log("🍞 RTM: Message toast in dialogs list",e),h(t=>{var l;let a=(e.dialogId||"").split("-"),r=Number(a[0]),s=Number(a[1]),n=isNaN(r)?e.idUserFrom:r,o=isNaN(s)?e.idUserTo:s;if((null==(l=R.current)?void 0:l.status)==="unanswered"&&"new_email"!==e.type&&e.idUserFrom===n){let e=t.filter(e=>e.idUser!==n||e.idInterlocutor!==o);if(e.length!==t.length)return e}if("new_email"===e.type||e.correspondenceId)return[{idUser:n,idInterlocutor:o,dateUpdated:e.dateCreated,lastMessage:{content:{message:e.title||"Новий лист"}},__email:!0,__emailBadge:!0,__correspondenceId:e.correspondenceId},...t];let i=t.findIndex(e=>e.idUser===n&&e.idInterlocutor===o&&!e.__email);return -1!==i?[{...t[i],dateUpdated:e.dateCreated},...t.filter((e,t)=>t!==i)]:[{idUser:n,idInterlocutor:o,dateUpdated:e.dateCreated,lastMessage:{content:{}}},...t]}),(async()=>{let t=(e.dialogId||"").split("-"),l=Number(t[0]),a=Number(t[1]),r=isNaN(l)?null:await ee(l);r&&r&&!isNaN(a)&&await et(r,a)})()}),l.on("message",e=>{console.log("📨 RTM: New message in dialogs list",e),h(t=>{var l;let a=e.idUserFrom,r=e.idUserTo,s=e=>e.idUser===a&&e.idInterlocutor===r||e.idUser===r&&e.idInterlocutor===a;if((null==(l=R.current)?void 0:l.status)==="unanswered"&&t.some(e=>e.idUser===a&&e.idInterlocutor===r))return t.filter(e=>e.idUser!==a||e.idInterlocutor!==r);let n=t.findIndex(e=>s(e)&&!e.__email);return -1!==n?[{...t[n],lastMessage:{content:e.content},dateUpdated:e.dateCreated},...t.filter((e,t)=>t!==n)]:(t.findIndex(e=>s(e)&&e.__email),[{idUser:a,idInterlocutor:r,dateUpdated:e.dateCreated,lastMessage:{content:e.content}},...t])})}),l.on("shift_ended",e=>{let t=(0,o.getUserId)();t&&(null==e?void 0:e.operatorId)&&t===e.operatorId&&d.replace("/dashboard")}),()=>{l.off("shift_ended"),l.off("message_toast"),l.disconnect()}},[]);let $=e=>y.find(t=>t.profileId===e.toString()),ee=async e=>{let t=(e=>{let t=y.find(t=>t.profileId===String(e));return(null==t?void 0:t.id)||null})(e);if(t)return t;try{let t=await (0,n.apiGet)("/profiles/my"),l=Array.isArray(t)?t.find(t=>t.profileId===String(e)):null;return(null==l?void 0:l.id)||null}catch(e){return null}},et=async(e,t)=>{if(!v[t])try{var l;let a=await (0,n.apiGet)("/profiles/".concat(e,"/client/").concat(t,"/public")),r=null==a||null==(l=a.profile)?void 0:l.personal,s=(null==r?void 0:r.avatar_small)||(null==r?void 0:r.avatar_large)||(null==r?void 0:r.avatar_xl)||"",o=(null==r?void 0:r.avatar_large)||(null==r?void 0:r.avatar_xl)||(null==r?void 0:r.avatar_small)||"",i=(null==r?void 0:r.avatar_xl)||(null==r?void 0:r.avatar_large)||(null==r?void 0:r.avatar_small)||"";if(!s)try{let l=await (0,n.apiPost)("/profiles/".concat(e,"/client/").concat(t,"/photos"),{}),a=(null==l?void 0:l.data)||l,r=[...Array.isArray(null==a?void 0:a.public)?a.public:[],...Array.isArray(null==a?void 0:a.private)?a.private:[]],d=r.find(e=>(null==e?void 0:e.isMain)===1||(null==e?void 0:e.is_main)===1)||r[0];d&&(s=d.url_small||d.url_medium||d.url_large||d.url_xl||d.url_xs||"",o=d.url_large||d.url_xl||d.url_medium||d.url_small||"",i=d.url_xl||d.url_large||d.url_medium||d.url_small||"")}catch(e){}(r||s)&&b(e=>{var l,n;return{...e,[t]:{id:t,id_user:t,name:(null==r?void 0:r.name)?r.name:"Користувач ".concat(t),personal:{avatar_small:s,avatar_large:o,avatar_xl:i,age:"number"==typeof(null==r?void 0:r.age)?r.age:(null==r?void 0:r.age)&&parseInt(String(r.age))||0},is_online:!!(null==a||null==(l=a.profile)?void 0:l.is_online),last_visit:(null==a||null==(n=a.profile)?void 0:n.last_visit)||""}}})}catch(e){}},el=e=>{try{let t=localStorage.getItem("tt_profile_".concat(e));if(t){let l=JSON.parse(t);if(Date.now()-l.timestamp<864e5)return l.profileData;localStorage.removeItem("tt_profile_".concat(e))}}catch(e){console.warn("Error reading profile cache:",e)}return null},ea=(e,t)=>{try{localStorage.setItem("tt_profile_".concat(e),JSON.stringify({profileData:t,timestamp:Date.now()}))}catch(e){console.warn("Error saving profile cache:",e)}},er=async()=>{let e={};for(let r of y){var t,l,a;if(!r.id)continue;let s=el(r.id);if(s&&(null==(t=s.personal)?void 0:t.avatar_large)){e[r.id]=s.personal.avatar_large;continue}try{let t=await (0,n.apiGet)("/profiles/".concat(r.id,"/profile-data"));t.success&&(null==(a=t.profileData)||null==(l=a.personal)?void 0:l.avatar_large)&&(e[r.id]=t.profileData.personal.avatar_large,ea(r.id,t.profileData))}catch(e){console.warn("Failed to load profile data for ".concat(r.id,":"),e)}}N(e)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g,{}),(0,t.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,t.jsxs)("header",{className:"h-12 bg-white border-b border-gray-200 flex items-center px-4 gap-4 flex-shrink-0",children:[(0,t.jsx)("div",{className:"font-bold text-xl text-[#680098] mr-4",children:"AnChat"}),(0,t.jsxs)("button",{onClick:()=>d.push("/dashboard"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100",title:"На дашборд",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-700",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"})}),(0,t.jsx)("span",{className:"text-[14px] text-gray-500",children:"Дашборд"})]}),(0,t.jsxs)("button",{onClick:()=>d.push("/chats"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100 ".concat(c.includes("/chats")?"bg-blue-50 text-blue-700":""),title:"Чати",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 ".concat(c.includes("/chats")?"text-blue-600":"text-gray-700"),children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"})}),(0,t.jsx)("span",{className:"text-[14px] ".concat(c.includes("/chats")?"text-blue-700 font-medium":"text-gray-500"),children:"Чати"})]}),(0,t.jsxs)("button",{onClick:()=>d.push("/settings"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100 ".concat(c.includes("/settings")?"bg-blue-50 text-blue-700":""),title:"Налаштування",children:[(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 ".concat(c.includes("/settings")?"text-blue-600":"text-gray-700"),children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.165.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.108 1.204.165.397.506.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.108 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.939-1.11.939h-1.094c-.55 0-1.019-.397-1.11-.94l-.148-.893c-.071-.425-.383-.763-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.939-.56-.939-1.109v-1.094c0-.55.397-1.019.94-1.11l.894-.149c.424-.07.763-.383.929-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,t.jsx)("span",{className:"text-[14px] ".concat(c.includes("/settings")?"text-blue-700 font-medium":"text-gray-500"),children:"Налаштування"})]}),(0,t.jsxs)("div",{className:"ml-auto flex items-center gap-4",children:[(0,t.jsxs)("button",{onClick:async()=>{try{await (0,n.apiPost)("/api/shifts/end",{}),u({messageId:"",type:"info",message:"Зміну завершено"}),d.replace("/dashboard")}catch(e){u({messageId:"",type:"error",message:"Не вдалося завершити зміну"})}},className:"group flex items-center gap-2 px-3 py-2 rounded hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Завершити зміну",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",strokeWidth:1.5,className:"w-5 h-5 text-gray-700 group-hover:text-red-600 group-hover:fill-red-600 transition-all border border-gray-400 rounded group-hover:border-red-600",fill:"none",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"})}),(0,t.jsx)("span",{className:"text-[14px] text-gray-500 group-hover:text-red-500 transition-colors",children:"Завершити"})]}),(0,t.jsxs)("button",{onClick:()=>{(0,o.clearSession)(),d.replace("/login")},className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100",title:"Вийти",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-700",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})}),(0,t.jsx)("span",{className:"text-[14px] text-gray-500",children:"Вийти"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,t.jsxs)("div",{className:"w-[320px] bg-white border-r border-gray-200 flex flex-col",children:[(0,t.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(p,{value:T.status,onChange:e=>E({...T,status:e}),options:[{value:"active",label:"Активні"},{value:"unanswered",label:"Вхідні"},{value:"bookmarked",label:"Збережені"},{value:"all",label:"Усі діалоги"}],className:"flex-1"}),(0,t.jsx)("button",{onClick:()=>E({...T,onlineOnly:!T.onlineOnly}),className:"w-3 h-3 rounded-full border-2 transition-colors ".concat(T.onlineOnly?"bg-green-500 border-green-500":"bg-gray-200 border-gray-300 hover:border-gray-400"),title:T.onlineOnly?"Показувати всіх":"Тільки онлайн"}),(0,t.jsx)("button",{onClick:()=>{O?q():P(!0)},className:"p-2 rounded-md border transition-colors ".concat(O?"bg-purple-50 border-purple-300 text-purple-600":"bg-gray-50 border-gray-300 text-gray-600 hover:bg-gray-100"),title:O?"Закрити пошук":"Пошук діалогу",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),O&&(0,t.jsx)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("div",{children:(0,t.jsx)(p,{value:B,onChange:e=>F(e),options:[{value:"",label:"ІД профілю"},...y.map(e=>({value:e.profileId||"",label:"".concat(e.displayName||e.profileId," (").concat(e.profileId,")")}))],className:"w-full"})}),(0,t.jsx)("div",{children:(0,t.jsx)("input",{type:"text",value:W,onChange:e=>G(e.target.value),placeholder:"ІД Клієнта",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("button",{onClick:J,disabled:Z,className:"flex-1 px-3 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:Z?"Пошук...":"Знайти діалог"}),z&&(0,t.jsx)("button",{onClick:q,className:"px-3 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Очистити"})]})]})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto custom-scroll",onScroll:z?void 0:e=>{let{scrollTop:t,scrollHeight:l,clientHeight:a}=e.currentTarget;Y.current&&clearTimeout(Y.current),l-t-a<100&&U&&!I&&!_&&C&&(console.log("🔄 Near bottom! Triggering dialogs pagination"),Y.current=setTimeout(()=>{!U||I||_||X()},200))},children:z?(0,t.jsx)("ul",{className:"divide-y divide-gray-100",children:(()=>{var e,l,r;let s="".concat(z.idUser,"-").concat(z.idInterlocutor),n=K===s,o=(e=>{if(!e)return"";let t=new Date(e),l=Math.floor((new Date().getTime()-t.getTime())/6e4);if(l<15)return l<1?"щойно":"".concat(l," хв");let a=t.getDate().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return"".concat(a,".").concat(r," ").concat(s,":").concat(n)})(z.dateUpdated||""),i=v[z.idInterlocutor],d=(null==i?void 0:i.name)||"Користувач ".concat(z.idInterlocutor),c=null==i||null==(e=i.personal)?void 0:e.avatar_small,u=$(z.idUser),g=u?j[u.id]:null;return(0,t.jsx)("li",{children:(0,t.jsx)(a.default,{href:"/chats/".concat(s),className:"block px-4 py-3 hover:bg-gray-50 transition-colors ".concat(n?"bg-purple-50 border-r-2 border-purple-500":""),onClick:()=>{"number"==typeof z.messagesLeft&&localStorage.setItem("messagesLeft_".concat(s),z.messagesLeft.toString())},children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-11 h-11 bg-gray-300 rounded-full overflow-hidden",children:c?(0,t.jsx)("img",{src:c,alt:d,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-500 text-lg font-medium",children:d.charAt(0).toUpperCase()})}),(null==i?void 0:i.is_online)&&(0,t.jsx)("div",{className:"absolute -top-0 -left-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"}),g&&(0,t.jsx)("div",{className:"absolute -bottom-0 -right-0 w-6 h-6 bg-white rounded-full border border-gray-200 overflow-hidden",children:(0,t.jsx)("img",{src:g,alt:"Profile",className:"w-full h-full object-cover"})})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:d}),(0,t.jsx)("div",{className:"text-xs text-gray-500 ml-2 flex-shrink-0",children:o})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1 truncate",children:(null==u?void 0:u.displayName)||"Профіль ".concat(z.idUser)}),(null==(r=z.lastMessage)||null==(l=r.content)?void 0:l.message)&&(0,t.jsx)("div",{className:"text-sm text-gray-600 mt-1 truncate",children:z.lastMessage.content.message})]})]})})},s)})()}):_?(0,t.jsxs)("div",{className:"divide-y divide-gray-100",children:[(0,t.jsx)(m.DialogSkeleton,{}),(0,t.jsx)(m.DialogSkeleton,{}),(0,t.jsx)(m.DialogSkeleton,{}),(0,t.jsx)(m.DialogSkeleton,{}),(0,t.jsx)(m.DialogSkeleton,{}),(0,t.jsx)(m.DialogSkeleton,{})]}):0===x.length?(0,t.jsx)("div",{className:"text-gray-500 text-center py-8 text-sm",children:"Немає діалогів"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("ul",{className:"divide-y divide-gray-100",children:x.map((e,l)=>{var r;let s="".concat(e.idUser,"-").concat(e.idInterlocutor),n=K===s,o=(e=>{if(!e)return"";let t=new Date(e),l=Math.floor((new Date().getTime()-t.getTime())/6e4);if(l<15)return l<1?"щойно":"".concat(l," хв");let a=t.getDate().toString().padStart(2,"0"),r=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return"".concat(a,".").concat(r," ").concat(s,":").concat(n)})(e.dateUpdated||""),i=v[e.idInterlocutor],d=(null==i?void 0:i.name)||"Користувач ".concat(e.idInterlocutor),c=null==i||null==(r=i.personal)?void 0:r.avatar_small,u=$(e.idUser),g=(null==u?void 0:u.displayName)||"Невідомий профіль",m=(null==u?void 0:u.id)?j[u.id]:null;return(0,t.jsx)("li",{children:(0,t.jsx)(a.default,{href:e.__email&&e.__correspondenceId?"/chats/".concat(encodeURIComponent(s),"?openEmailHistory=1&corrId=").concat(encodeURIComponent(String(e.__correspondenceId))):"/chats/".concat(encodeURIComponent(s)),className:"block p-3 transition-colors ".concat(n?"bg-purple-50 border-r-2 border-purple-500":"hover:bg-gray-50"),onClick:()=>{"number"==typeof e.messagesLeft&&localStorage.setItem("messagesLeft_".concat(s),e.messagesLeft.toString())},children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,t.jsxs)("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200",children:[c?(0,t.jsx)("img",{src:c,alt:d,className:"w-full h-full object-cover",onError:e=>{var t;let l=e.target;l.style.display="none",null==(t=l.nextElementSibling)||t.classList.remove("hidden")}}):null,(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-white bg-purple-500 text-sm font-medium ".concat(c?"hidden":""),children:d.charAt(0).toUpperCase()})]}),(null==i?void 0:i.is_online)&&(0,t.jsx)("div",{className:"absolute top-0 left-0 w-3 h-3 bg-green-500 rounded-full border border-white"}),m&&(0,t.jsx)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full overflow-hidden bg-white border border-gray-300",children:(0,t.jsx)("img",{src:m,alt:g,className:"w-full h-full object-cover",onError:e=>{e.target.parentElement.style.display="none"}})})]}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-medium text-sm truncate ".concat(n?"text-purple-900":"text-gray-900"),children:d}),(0,t.jsx)("div",{className:"text-xs truncate mt-0.5 ".concat(n?"text-purple-600":"text-gray-500"),children:g})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end justify-between gap-1 ml-2 flex-shrink-0 min-h-[2rem]",children:[(0,t.jsx)("span",{className:"text-xs ".concat(n?"text-purple-500":"text-gray-400"),children:o}),e.__emailBadge&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-[11px] text-blue-600 font-bold",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Новий лист"]})]})]})})]})})},"".concat(e.idUser,"-").concat(e.idInterlocutor,"-").concat(l))})}),I&&(0,t.jsx)("div",{className:"flex justify-center py-4 border-t border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[(0,t.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-gray-300 border-t-purple-500 rounded-full"}),"Завантаження діалогів..."]})})]})})]}),(0,t.jsx)("div",{className:"flex-1 bg-gray-50 overflow-hidden",children:i})]})]})]})}}]);