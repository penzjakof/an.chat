(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,n)=>{t.exports=e.r(76562)},63267,e=>{"use strict";e.s(["clearSession",()=>r,"getAccessToken",()=>l,"getAgencyCode",()=>c,"getRole",()=>i,"getSession",()=>n,"getUserId",()=>s,"setSession",()=>o]);let t="anchat-auth";function n(){try{let e=window.localStorage.getItem(t);return e?JSON.parse(e):null}catch(e){return null}}function o(e){window.localStorage.setItem(t,JSON.stringify(e))}function r(){window.localStorage.removeItem(t)}function l(){var e,t;return null!=(t=null==(e=n())?void 0:e.accessToken)?t:null}function i(){var e,t;return null!=(t=null==(e=n())?void 0:e.role)?t:null}function c(){var e,t;return null!=(t=null==(e=n())?void 0:e.agencyCode)?t:null}function s(){let e=n();if(null==e?void 0:e.userId)return e.userId;let t=null==e?void 0:e.accessToken;if(!t)return null;try{var o;let[,e]=t.split(".");return null!=(o=JSON.parse(atob(e)).sub)?o:null}catch(e){return null}}},91610,e=>{"use strict";e.s(["ToastProvider",()=>c,"useToast",()=>s],91610);var t=e.i(43476),n=e.i(71645),o=e.i(18566);function r(e){let{toast:r,onClose:l}=e,[i,c]=(0,n.useState)(!1),s=(0,o.useRouter)(),a=(0,o.usePathname)();(0,n.useEffect)(()=>{let e=setTimeout(()=>{c(!0)},100),t=setTimeout(()=>{c(!1),setTimeout(()=>l(r.id),300)},5e3);return()=>{clearTimeout(e),clearTimeout(t)}},[r.id,l]);let u=()=>{if(r.dialogId){let e="/chats/".concat(r.dialogId);a===e?console.log("🔗 Toast clicked: already on target page",r.dialogId,"- just closing toast"):(console.log("🔗 Toast clicked: navigating to dialog",r.dialogId),s.push(e))}c(!1),setTimeout(()=>l(r.id),300)},d={new_message:{bg:"#1e40af",border:"#1d4ed8",icon:"💬",label:"Нове повідомлення"},new_email:{bg:"#0b3a6f",border:"#2563eb",icon:"✉️",label:"Новий лист"},success:{bg:"#065f46",border:"#059669",icon:"✅",label:"Успіх"},error:{bg:"#7f1d1d",border:"#dc2626",icon:"❌",label:"Помилка"},info:{bg:"#1f2937",border:"#374151",icon:"ℹ️",label:"Інфо"}}[r.type];return(0,t.jsx)("div",{className:"\n        fixed top-4 right-4 z-[9999] max-w-sm w-full rounded-lg shadow-2xl border-2\n        transform transition-all duration-300 ease-in-out cursor-pointer\n        ".concat(i?"translate-x-0 opacity-100":"translate-x-full opacity-0","\n      "),style:{zIndex:9999,backgroundColor:d.bg,borderColor:d.border,color:"white",minHeight:"80px",width:"320px",padding:"16px"},onClick:u,children:(0,t.jsxs)("div",{style:{display:"flex",alignItems:"flex-start"},children:[(0,t.jsx)("div",{style:{flexShrink:0,marginRight:"12px"},children:(0,t.jsx)("div",{style:{width:"32px",height:"32px",backgroundColor:d.border,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsx)("span",{style:{fontSize:"14px"},children:d.icon})})}),(0,t.jsx)("div",{style:{flex:1},children:"new_message"===r.type||"new_email"===r.type?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{style:{color:"white",fontSize:"14px",fontWeight:"bold",margin:0,lineHeight:"1.4"},children:[d.icon," ",d.label,"!"]}),(0,t.jsxs)("p",{style:{color:"#e0e7ff",fontSize:"14px",margin:"4px 0 0 0",lineHeight:"1.4"},children:["Від користувача ",r.idUserFrom]}),(0,t.jsxs)("p",{style:{color:"#c7d2fe",fontSize:"12px",margin:"4px 0 0 0",lineHeight:"1.4"},children:[r.dateCreated?new Date(r.dateCreated).toLocaleTimeString():"",r.dialogId&&(a==="/chats/".concat(r.dialogId)?" • Натисніть щоб закрити":" • Натисніть щоб відкрити")]})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("p",{style:{color:"white",fontSize:"14px",fontWeight:"bold",margin:0,lineHeight:"1.4"},children:[d.icon," ",r.title||d.label]}),r.message&&(0,t.jsx)("p",{style:{color:"#e5e7eb",fontSize:"13px",margin:"6px 0 0 0",lineHeight:"1.5"},children:r.message})]})}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),u()},style:{color:"#e0e7ff",marginLeft:"8px"},className:"flex-shrink-0 hover:opacity-80",children:(0,t.jsx)("svg",{style:{width:"16px",height:"16px"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}function l(e){let{toasts:n,onRemoveToast:o}=e;return(0,t.jsx)("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-2",children:n.map((e,n)=>(0,t.jsx)("div",{style:{transform:"translateY(".concat(80*n,"px)")},className:"transition-transform duration-300",children:(0,t.jsx)(r,{toast:e,onClose:o})},e.id))})}let i=(0,n.createContext)(null);function c(e){let{children:o}=e,[r,c]=(0,n.useState)([]),s=(0,n.useCallback)(e=>{let t="toast-".concat(Date.now(),"-").concat(Math.random()),n={...e,id:t};c(e=>[...e,n])},[]),a=(0,n.useCallback)(e=>{c(t=>t.filter(t=>t.id!==e))},[]);return(0,t.jsxs)(i.Provider,{value:{showToast:s,removeToast:a},children:[o,(0,t.jsx)(l,{toasts:r,onRemoveToast:a})]})}function s(){let e=(0,n.useContext)(i);if(!e)throw Error("useToast must be used within a ToastProvider");return e}},63765,e=>{"use strict";e.s(["WebSocketPoolProvider",()=>i,"useWebSocketPool",()=>c]);var t=e.i(43476),n=e.i(71645),o=e.i(96085),r=e.i(63267);let l=(0,n.createContext)(null);function i(e){let{children:i}=e,c=(0,n.useRef)(new Map),s=(0,n.useRef)(new Map),a=(0,n.useRef)(new Map),u=(0,n.useCallback)(e=>{let t=c.current.get(e);if(t)return console.log("🔌 Socket already exists for profile ".concat(e,", reusing")),t;let n=(0,r.getAccessToken)(),l=window.location.origin;if(!n)return console.warn("🔌 No token available for profile ".concat(e)),null;let i=(0,o.io)("".concat(l),{transports:["polling"],upgrade:!1,path:"/socket.io/",auth:{token:n,profileId:e},timeout:1e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});return i.on("connect",()=>{let t=s.current.get(e);t&&i.emit("join",{dialogId:t})}),i.on("disconnect",t=>{console.log("🔌 WebSocket disconnected for profile ".concat(e,":"),t)}),i.on("connect_error",t=>{console.warn("🔌 WebSocket connection error for profile ".concat(e,":"),t.message)}),c.current.set(e,i),i},[]),d=(0,n.useCallback)(e=>{let t=a.current.get(e);t&&(clearTimeout(t),a.current.delete(e));let n=c.current.get(e);return n?n.connected||n.connecting||n.connect():n=u(e),n},[u]),g=(0,n.useCallback)((e,t)=>{let n=d(e);if(!n)return;let o=s.current.get(e);o&&o!==t&&n.emit("leave",{dialogId:o}),n.emit("join",{dialogId:t}),s.current.set(e,t)},[d]),f=(0,n.useCallback)((e,t)=>{let n=c.current.get(e);if(!n)return;n.emit("leave",{dialogId:t}),s.current.delete(e);let o=setTimeout(()=>{p(e)},3e4);a.current.set(e,o)},[]),p=(0,n.useCallback)(e=>{let t=c.current.get(e);if(t){t.disconnect(),c.current.delete(e),s.current.delete(e);let n=a.current.get(e);n&&(clearTimeout(n),a.current.delete(e)),console.log("🔌 Disconnected profile ".concat(e))}},[]),h=(0,n.useCallback)(()=>{console.log("🔌 Disconnecting all WebSocket connections"),a.current.forEach(e=>clearTimeout(e)),a.current.clear(),c.current.forEach((e,t)=>{e.disconnect(),console.log("🔌 Disconnected profile ".concat(t))}),c.current.clear(),s.current.clear()},[]);return n.default.useEffect(()=>()=>{h()},[h]),(0,t.jsx)(l.Provider,{value:{getSocketForProfile:d,joinDialog:g,leaveDialog:f,disconnectProfile:p,disconnectAll:h},children:i})}function c(){let e=(0,n.useContext)(l);if(!e)throw Error("useWebSocketPool must be used within a WebSocketPoolProvider");return e}}]);