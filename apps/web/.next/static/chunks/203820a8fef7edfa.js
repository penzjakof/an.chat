(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93272,e=>{"use strict";e.s(["default",()=>C],93272),e.i(47167);var t=e.i(43476),s=e.i(71645),r=e.i(18566),l=e.i(94108),a=e.i(63267),i=e.i(43453),n=e.i(63765),o=e.i(91610);let c=new Map,d=e=>{let{src:r,duration:l,audioId:a,onPlay:i,onPause:n,onEnded:o,onRegister:c,onUnregister:d}=e,u=(0,s.useRef)(null),[h,m]=(0,s.useState)(!1),[x,g]=(0,s.useState)(0),[p,f]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),y=e=>{let t=Math.floor(e/60),s=Math.floor(e%60);return"".concat(t,":").concat(s.toString().padStart(2,"0"))},b=async()=>{if(u.current)try{h?(u.current.pause(),m(!1),null==n||n()):(f(!0),j(null),await u.current.play(),m(!0),f(!1),null==i||i())}catch(e){f(!1),j("Помилка відтворення аудіо"),console.error("Audio playback error:",e)}};(0,s.useEffect)(()=>{let e=u.current;if(e&&a)return null==c||c(a,e),()=>{null==d||d(a)}},[a,c,d]),(0,s.useEffect)(()=>{let e=u.current;if(!e)return;let t=()=>{g(e.currentTime)},s=()=>{m(!1),g(0),null==o||o()},r=()=>{f(!0)},l=()=>{f(!1),j(null)},a=()=>{f(!1),j("Помилка завантаження аудіо"),m(!1)};return e.addEventListener("timeupdate",t),e.addEventListener("ended",s),e.addEventListener("loadstart",r),e.addEventListener("canplay",l),e.addEventListener("error",a),()=>{e.removeEventListener("timeupdate",t),e.removeEventListener("ended",s),e.removeEventListener("loadstart",r),e.removeEventListener("canplay",l),e.removeEventListener("error",a)}},[o]),(0,s.useEffect)(()=>{m(!1),g(0),j(null)},[r]);let w=l>0?x/l*100:0;return(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("audio",{ref:u,src:r,preload:"metadata"}),(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("button",{onClick:b,disabled:p||!!v,className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center transition-colors ".concat(v?"bg-red-500 cursor-not-allowed":p?"bg-gray-400 cursor-wait":"bg-blue-500 hover:bg-blue-600"," text-white"),title:v||(p?"Завантаження...":h?"Пауза":"Відтворити"),children:v?(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):p?(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):h?(0,t.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):(0,t.jsx)("svg",{className:"w-5 h-5 ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"h-2 bg-gray-200 rounded-full cursor-pointer relative overflow-hidden",onClick:e=>{if(!u.current)return;let t=e.currentTarget.getBoundingClientRect(),s=(e.clientX-t.left)/t.width*l;u.current.currentTime=s,g(s)},children:[(0,t.jsx)("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-100",style:{width:"".concat(w,"%")}}),(0,t.jsx)("div",{className:"absolute top-1/2 w-3 h-3 bg-blue-600 rounded-full transform -translate-y-1/2 -translate-x-1/2 shadow-sm",style:{left:"".concat(w,"%")}})]}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,t.jsx)("span",{children:y(x)}),(0,t.jsx)("span",{children:y(l)})]})]})]}),v&&(0,t.jsx)("div",{className:"mt-2 text-xs text-red-600 text-center",children:v})]})};function u(e){let{profileId:r,isOpen:a,onClose:i,onPhotoSelect:n,maxSelection:o=6,context:c="other",idRegularUser:u,mode:h="send",actionLabel:m,allowAudio:x=!0,allowedPhotoTabs:g,isSpecialPlusAllowed:p=!0,onAttach:f}=e;if(!r||isNaN(parseInt(r)))throw Error("MediaGallery: profileId must be a valid number string");"chat"!==c||u||console.warn('MediaGallery: idRegularUser is required when context is "chat"');let[v,j]=(0,s.useState)([]),[y,b]=(0,s.useState)([]),[w,N]=(0,s.useState)([]),[k,C]=(0,s.useState)([]),[S,L]=(0,s.useState)([]),[M,_]=(0,s.useState)([]),[E,P]=(0,s.useState)(!1),[z,A]=(0,s.useState)(""),[I,B]=(0,s.useState)(""),[W,T]=(0,s.useState)(""),[F,V]=(0,s.useState)(""),[R,D]=(0,s.useState)(!0),[H,U]=(0,s.useState)(!0),[O,G]=(0,s.useState)(!0),[q,J]=(0,s.useState)("attach"===h?"special":"regular"),[K,X]=(0,s.useState)("attach"===h?"special":"regular"),[Y,Z]=(0,s.useState)("photo"),[Q,$]=(0,s.useState)(null),[ee,et]=(0,s.useState)(null),[es,er]=(0,s.useState)(new Map),[el,ea]=(0,s.useState)(new Map),[ei,en]=(0,s.useState)(new Map),[eo,ec]=(0,s.useState)("all"),[ed,eu]=(0,s.useState)(new Set),[eh,em]=(0,s.useState)(new Set),[ex,eg]=(0,s.useState)(new Set),[ep,ef]=(0,s.useState)(new Set),[ev,ej]=(0,s.useState)(null),ey=(0,s.useRef)(new Map),[eb,ew]=(0,s.useState)(0),eN="gallery_unified_photos_".concat(r),ek=(0,s.useCallback)(()=>{try{let e=localStorage.getItem(eN);if(!e)return new Map;let t=JSON.parse(e),s=Date.now(),r=new Map;return Object.entries(t).forEach(e=>{let[t,l]=e;s-l.lastAccessed<=864e5&&r.set(parseInt(t),{...l,lastAccessed:s})}),r}catch(e){return console.warn("Failed to load unified photo cache:",e),new Map}},[eN,864e5]),eC=(0,s.useRef)(null),eS=(0,s.useCallback)(e=>{eC.current&&clearTimeout(eC.current),eC.current=setTimeout(()=>{try{let t=Object.fromEntries(e);localStorage.setItem(eN,JSON.stringify(t))}catch(e){console.warn("Failed to save unified photo cache:",e)}},500)},[eN]);(0,s.useEffect)(()=>()=>{console.log("🧹 MediaGallery unmounting, cleaning up resources..."),eC.current&&(clearTimeout(eC.current),eC.current=null)},[]);let eL=(0,s.useCallback)((e,t)=>{var s,r;return null!=(r=null==(s=e.tags)?void 0:s.some(e=>e.code===t))&&r},[]),eM=(0,s.useCallback)(e=>eL(e,"special")||eL(e,"special_plus"),[eL]),e_=(0,s.useCallback)(e=>eL(e,"special_plus"),[eL]),eE=(0,s.useCallback)(e=>eL(e,"special")&&!eL(e,"special_plus"),[eL]),eP=(0,s.useCallback)(e=>ep.has(e.idPhoto),[ep]),ez=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let s=ek(),l=Date.now(),a=0;return e.forEach(e=>{if(s.has(e.idPhoto)){let t=s.get(e.idPhoto);s.set(e.idPhoto,{...t,lastAccessed:l})}else{let i="regular";t?i="temporary":eM(e)&&(i="special"),s.set(e.idPhoto,{idPhoto:e.idPhoto,idProfile:parseInt(r),idUser:e.idUser,urlPreview:e.urls.urlPreview,urlOriginal:e.urls.urlOriginal,status:null,category:i,lastAccessed:l,tags:e.tags}),a++}}),a>0&&(eS(s),console.log("📦 Added to unified cache:",a,"new photos, total:",s.size)),s}catch(e){return console.warn("Failed to add photos to unified cache:",e),ek()}},[ek,eS,r,eM]),[eA,eI]=(0,s.useState)(null),eB=(0,s.useCallback)(()=>{if(!eA){let e=ek();return eI(e),e}return eA},[eA,ek]),eW=(0,s.useCallback)(e=>{try{let t=eB(),s=Date.now(),r=0;return e.forEach((e,l)=>{if(t.has(l)){let a=t.get(l);t.set(l,{...a,status:e,lastAccessed:s}),r++}}),r>0&&(eI(new Map(t)),eS(t)),t}catch(e){return console.warn("Failed to update photo statuses in unified cache:",e),eB()}},[eB,eS,eI]),eT=(0,s.useCallback)((e,t,s,r)=>{let l=e;if("chat"===r)switch(t){case"regular":l=e.filter(e=>!eM(e)&&!eP(e));break;case"special":l=e.filter(e=>eE(e));break;case"special_plus":l=e.filter(e=>e_(e));break;case"temporary":l=e.filter(e=>eP(e)&&!eM(e));break;default:l=e}return"all"!==s&&(l=l.filter(e=>{let t=es.get(e.idPhoto);switch(s){case"available":return null==t;case"accessed":return"accessed"===t;case"sent":return"sent"===t;default:return!0}})),l},[eM,eP,es]),eF=(0,s.useCallback)((e,t)=>"all"!==t?e.filter(e=>{let s=el.get(e.idVideo);switch(t){case"available":return null==s;case"accessed":return"accessed"===s;case"sent":return"sent"===s;default:return!0}}):e,[el]),eV=(0,s.useCallback)(e=>Array.from(e.values()).map(e=>({idPhoto:e.idPhoto,idUser:e.idUser,urls:{urlPreview:e.urlPreview,urlOriginal:e.urlOriginal,urlStandard:e.urlPreview},tags:e.tags,comment:"",canDisagree:!1,status:{code:"",description:""},declineReasons:[]})).sort((e,t)=>t.idPhoto-e.idPhoto),[]);(0,s.useEffect)(()=>{J(K),ew(0)},[K]),(0,s.useEffect)(()=>{ew(0)},[eo]),(0,s.useEffect)(()=>{if(a){let e="regular";"attach"===h?!g||g.includes("special")?e="special":g.includes("special_plus")?e="special_plus":g.includes("regular")?e="regular":g.includes("temporary")&&(e="temporary"):e=g&&g.length>0?g[0]:"regular",X(e),J(e);try{let e=localStorage.getItem("gallery_filters_".concat(r));if(e){let t=JSON.parse(e);t.statusFilter&&ec(t.statusFilter)}}catch(e){}}},[a,h,g,r]),(0,s.useEffect)(()=>{if(a){let e=setTimeout(()=>{try{let e={photoType:q,statusFilter:eo};localStorage.setItem("gallery_filters_".concat(r),JSON.stringify(e)),console.log("💾 Filters saved to cache:",e)}catch(e){console.warn("Failed to save filters to cache:",e)}},200);return()=>clearTimeout(e)}},[q,eo,a]);let[eR,eD]=(0,s.useState)(null),eH=(0,s.useRef)(null),eU=(0,s.useRef)(R),eO=(0,s.useRef)(z),eG=(0,s.useRef)(I),eq=(0,s.useRef)(null);(0,s.useEffect)(()=>{eU.current=R,eO.current=z,eG.current=I},[R,z,I]);let eJ=(0,s.useCallback)(async(e,t)=>{if(0===e.length)return;let s=e.filter(e=>!eh.has(e.idVideo));if(0===s.length)return;let a=[];for(let e=0;e<s.length;e+=100)a.push(s.slice(e,e+100));for(let e=0;e<a.length;e++){let s=a[e];try{var i,n;let e=s.map(e=>e.idVideo);em(t=>{let s=new Set(t);return e.forEach(e=>s.add(e)),s});let a=await (0,l.apiPost)("/api/gallery/video-statuses",{idUser:t,idsVideos:e,profileId:parseInt(r)}),o=a.success&&a.data?null!=(n=a.data.videos)?n:null==(i=a.data.data)?void 0:i.videos:void 0;o&&Array.isArray(o)?ea(e=>{let t=new Map(e);return o.forEach(e=>{t.set(e.idVideo,e.status)}),t}):em(e=>{let t=new Set(e);return s.forEach(e=>t.delete(e.idVideo)),t})}catch(e){em(e=>{let t=new Set(e);return s.forEach(e=>t.delete(e.idVideo)),t})}e<a.length-1&&await new Promise(e=>setTimeout(e,100))}},[r,eh]),eK=(0,s.useCallback)(async(e,t)=>{if(0===e.length)return;let s=e.filter(e=>!ed.has(e.idPhoto));if(0===s.length)return void console.log("📊 All photo statuses already requested");console.log("📊 Requesting statuses for ".concat(s.length," photos (").concat(e.length," total, ").concat(e.length-s.length," already requested)"));let a=[];for(let e=0;e<s.length;e+=100)a.push(s.slice(e,e+100));for(let e=0;e<a.length;e++){let s=a[e];try{var i,n;let a=s.map(e=>e.idPhoto);eu(e=>{let t=new Set(e);return a.forEach(e=>t.add(e)),t});let o=await (0,l.apiPost)("/api/gallery/photo-statuses",{idUser:t,idsPhotos:a,profileId:parseInt(r)}),c=o.success&&o.data?null!=(n=o.data.photos)?n:null==(i=o.data.data)?void 0:i.photos:void 0;c&&Array.isArray(c)?er(e=>{let t=new Map(e);return c.forEach(e=>{t.set(e.idPhoto,e.status)}),eW(t),t}):(console.error("❌ Batch ".concat(e+1,": Failed to load photo statuses:"),o.error),eu(e=>{let t=new Set(e);return s.forEach(e=>t.delete(e.idPhoto)),t}))}catch(t){console.error("❌ Batch ".concat(e+1,": Error loading photo statuses:"),t),eu(e=>{let t=new Set(e);return s.forEach(e=>t.delete(e.idPhoto)),t})}e<a.length-1&&await new Promise(e=>setTimeout(e,100))}},[r,ed]),eX=(0,s.useCallback)(async()=>{if(!u||"chat"!==c||0===v.length)return;let e=v.filter(e=>!es.has(e.idPhoto)&&!ed.has(e.idPhoto));e.length>0&&(console.log("🔍 Found ".concat(e.length," photos without statuses, requesting...")),await eK(e,u))},[v,es,ed,u,c,eK]);(0,s.useEffect)(()=>{if(a&&v.length>0&&"chat"===c){let e=setTimeout(()=>{eX()},2e3);return()=>clearTimeout(e)}},[a,v.length,c,eX]);let eY=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!E){P(!0),eD(null);try{let t=e?"":W,s=await (0,l.apiGet)("/api/gallery/".concat(r,"/videos"),{cursor:t,limit:"100",statuses:"approved"});if(s.success&&s.data){let t=s.data;if(e?b(t.videos):b(e=>{let s=new Set(e.map(e=>e.idVideo)),r=t.videos.filter(e=>!s.has(e.idVideo));return[...e,...r].sort((e,t)=>t.idVideo-e.idVideo)}),T(t.cursor),U(t.videos.length>=100),u&&"chat"===c){let s=e?t.videos:t.videos.filter(e=>!new Set(y.map(e=>e.idVideo)).has(e.idVideo));s.length>0&&eJ(s,u)}}else eD("Помилка завантаження відео")}catch(e){eD("Помилка завантаження відео")}finally{P(!1)}}},[r,E,W,y,u,c,eJ]),eZ=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!E){P(!0),eD(null);try{let t=await (0,l.apiGet)("/api/gallery/".concat(r,"/audios"),{cursor:e?"":F,limit:"50"});if(t.success&&t.data){let s=t.data;if(e?L(s.items):L(e=>{let t=new Set(e.map(e=>e.id)),r=s.items.filter(e=>!t.has(e.id));return[...e,...r].sort((e,t)=>t.id-e.id)}),V(s.cursor),G(s.items.length>=50),u&&"chat"===c){let t=e?s.items:s.items.filter(e=>!new Set(S.map(e=>e.id)).has(e.id));t.length>0&&eQ(t,u)}}else eD("Помилка завантаження аудіо")}catch(e){eD("Помилка завантаження аудіо")}finally{P(!1)}}},[r,E,F,S,u,c]),eQ=(0,s.useCallback)(async(e,t)=>{if(0===e.length)return;let s=e.filter(e=>!ex.has(e.id));if(0===s.length)return;let a=[];for(let e=0;e<s.length;e+=100)a.push(s.slice(e,e+100));for(let e=0;e<a.length;e++){let s=a[e];try{var i,n;let e=s.map(e=>e.id);eg(t=>{let s=new Set(t);return e.forEach(e=>s.add(e)),s});let a=await (0,l.apiPost)("/api/gallery/audio-statuses",{idUser:t,idsAudios:e,profileId:parseInt(r)}),o=a.success&&a.data?null!=(n=a.data.audios)?n:null==(i=a.data.data)?void 0:i.audios:void 0;if(o&&Array.isArray(o)){let e=new Map(ei);o.forEach(t=>{[Number(null==t?void 0:t.idAudio),Number(null==t?void 0:t.id),Number(null==t?void 0:t.idGalleryAudio)].filter(e=>Number.isFinite(e)).forEach(s=>e.set(s,t.status))}),en(e),L(t=>t.map(t=>{var s,r;let l=[Number(t.id),Number(t.idAudio),Number(t.idGalleryAudio)].find(t=>Number.isFinite(t)&&e.has(Number(t))),a=void 0!==l?null!=(s=e.get(Number(l)))?s:null:null!=(r=t.statusComputed)?r:null;return{...t,statusComputed:a}}))}else eg(e=>{let t=new Set(e);return s.forEach(e=>t.delete(e.id)),t})}catch(e){eg(e=>{let t=new Set(e);return s.forEach(e=>t.delete(e.id)),t})}e<a.length-1&&await new Promise(e=>setTimeout(e,100))}},[r,ex]),e$=(0,s.useCallback)(async()=>{if(E)return;let e=ek();if(e.size>0){let t=eV(e);console.log("📦 Showing cached photos first:",t.length),j(t);let s=new Set,r=new Map;e.forEach((e,t)=>{"temporary"===e.category&&s.add(t),e.status&&r.set(t,e.status)}),ef(s),er(r),u&&"chat"===c&&await eK(t,u)}P(!0),eD(null);try{let e=[],t="",s="",a=!0,i=!0,n=!0;for(;(a||i)&&e.length<500;){let o=[];a&&o.push((0,l.apiGet)("/api/gallery/".concat(r,"/photos"),{cursor:t,limit:"100",statuses:"approved,approved_by_ai"})),i&&(console.log("📸 Requesting temporary photos with cursor:",s),o.push((0,l.apiGet)("/api/gallery/".concat(r,"/photos"),{cursor:s,limit:"100",isTemporary:"true"})));let d=await Promise.all(o),h=null,m=null;a&&i?[h,m]=d:a?[h]=d:i&&([m]=d);let x=[],g=h;if(h&&g.success){let e=g.data;console.log("📸 Regular photos batch:",e.photos.length),x.push(...e.photos),t=e.cursor,a=e.photos.length>=100}else h&&(a=!1);let p=m;if(m&&p.success){let e=p.data;console.log("📸 Temporary photos batch:",e.photos.length,e.photos.map(e=>e.idPhoto)),x.push(...e.photos),ef(t=>{let s=new Set(t);return e.photos.forEach(e=>s.add(e.idPhoto)),s}),s=e.cursor,i=e.photos.length>=100}else m&&(i=!1);let f=new Set(e.map(e=>e.idPhoto)),v=x.filter(e=>!f.has(e.idPhoto));e.push(...v);let y=e.sort((e,t)=>t.idPhoto-e.idPhoto);if(j(y),v.length>0){let e=v.filter(e=>!ep.has(e.idPhoto)),t=v.filter(e=>ep.has(e.idPhoto));e.length>0&&ez(e,!1),t.length>0&&ez(t,!0)}console.log("📸 Current total photos:",y.length),n?(P(!1),n=!1,u&&"chat"===c&&y.length>0&&eK(y,u)):u&&"chat"===c&&v.length>0&&eK(v,u)}let o=(a||i)&&e.length>=500;D(o),A(t),B(s),console.log("📸 Initial photos loaded:",e.length),console.log("📸 Has more photos:",o);let d=e.filter(e=>eM(e)).length,h=e.filter(e=>eP(e)).length,m=e.filter(e=>!eM(e)&&!eP(e)).length;console.log("📸 Temporary photo IDs:",Array.from(ep)),console.log("📊 Initial photo distribution:",{total:e.length,regular:m,special:d,temporary:h,hasMore:o})}catch(e){console.error("❌ Error loading initial photos:",e),eD("Помилка завантаження фото"),P(!1)}},[r,E,c,u,eM,eP,eK]),e0=(0,s.useCallback)(async()=>{if(!E&&R){P(!0),console.log("📸 Loading more photos via scroll...");try{let e=[],t=!!z,s=!!I;if(t&&e.push((0,l.apiGet)("/api/gallery/".concat(r,"/photos"),{cursor:z,limit:"100",statuses:"approved,approved_by_ai"})),s&&e.push((0,l.apiGet)("/api/gallery/".concat(r,"/photos"),{cursor:I,limit:"100",isTemporary:"true"})),0===e.length){D(!1),P(!1);return}let a=await Promise.all(e),i=null,n=null;t&&s?[i,n]=a:t?[i]=a:s&&([n]=a);let o=[],d=z,h=I,m=i;if(i&&m.success){let e=m.data;console.log("📸 More regular photos:",e.photos.length),o.push(...e.photos),d=e.cursor,t=e.photos.length>=100}else i&&(t=!1,d="");let x=n;if(n&&x.success){let e=x.data;console.log("📸 More temporary photos:",e.photos.length),o.push(...e.photos),ef(t=>{let s=new Set(t);return e.photos.forEach(e=>s.add(e.idPhoto)),s}),h=e.cursor,s=e.photos.length>=100}else n&&(s=!1,h="");j(e=>{let t=new Set(e.map(e=>e.idPhoto)),s=o.filter(e=>!t.has(e.idPhoto)),r=[...e,...s].sort((e,t)=>t.idPhoto-e.idPhoto);if(s.length>0){let e=s.filter(e=>!ep.has(e.idPhoto)),t=s.filter(e=>ep.has(e.idPhoto));e.length>0&&ez(e,!1),t.length>0&&ez(t,!0)}return u&&"chat"===c&&s.length>0&&eK(s,u),r}),A(d),B(h),D(t||s),console.log("📸 More photos loaded. HasMore:",t||s)}catch(e){console.error("❌ Error loading more photos:",e),eD("Помилка завантаження додаткових фото")}finally{P(!1)}}},[r,E,R,z,I,c,u,eK]);(0,s.useEffect)(()=>{eq.current=e0},[e0]);let e1=(0,s.useCallback)(()=>{let e=eH.current;if(!e||E)return;let{scrollTop:t,scrollHeight:s,clientHeight:r}=e;(t+r)/s>.8&&("photo"===Y&&R?(console.log("🔄 Scroll threshold reached! Loading more photos..."),e0()):"video"===Y&&H?(console.log("🔄 Scroll threshold reached! Loading more videos..."),eY(!1)):"audio"===Y&&O&&(console.log("🔄 Scroll threshold reached! Loading more audios..."),eZ(!1)))},[E,R,H,O,Y,e0,eY,eZ]);(0,s.useEffect)(()=>{let e=eH.current;if(e)return e.addEventListener("scroll",e1),()=>{e.removeEventListener("scroll",e1)}},[e1]),(0,s.useEffect)(()=>{if(!a||E||!R)return;let e=setTimeout(()=>{let e=eT(v,q,eo,c);console.log("🔍 Auto-load check:",{photoType:q,statusFilter:eo,currentFilteredCount:e.length,minThreshold:15,hasMore:R,loading:E}),e.length<15&&R&&!E&&(console.log("🚀 Auto-loading more photos - current filter has only",e.length,"photos"),e0())},1e3);return()=>clearTimeout(e)},[a,v.length,q,eo,c,R,E,eT,e0]);let e2=(0,s.useMemo)(()=>eT(v,q,eo,c),[v,q,eo,c,eT]),e4=(0,s.useMemo)(()=>eF(y,eo),[y,eo,eF]),e5=(0,s.useCallback)((e,t)=>"available"===t&&0===ei.size?e:"all"!==t?e.filter(e=>{var s,r;if(void 0!==e.statusComputed)switch(t){case"available":return null===e.statusComputed||void 0===e.statusComputed;case"accessed":return"accessed"===e.statusComputed;case"sent":return"sent"===e.statusComputed||"accessed"===e.statusComputed}let l=e.id,a=e.idAudio,i=e.idGalleryAudio,n=null!=(r=null!=(s=void 0!==l?ei.get(Number(l)):void 0)?s:void 0!==a?ei.get(Number(a)):void 0)?r:void 0!==i?ei.get(Number(i)):void 0,o="accessed"===e.status||"sent"===e.status?e.status:null,c=void 0===n?o:n;switch(t){case"available":return null==c;case"accessed":return"accessed"===c;case"sent":return"sent"===c||"accessed"===c;default:return!0}}):e,[ei]),e3=(0,s.useCallback)(async()=>{if(!u||"chat"!==c||0===S.length)return;let e=S.filter(e=>!ei.has(e.id)&&!ex.has(e.id));e.length>0&&await eQ(e,u)},[S,ei,ex,u,c,eQ]);(0,s.useEffect)(()=>{if(a&&S.length>0&&"chat"===c){let e=setTimeout(()=>{e3()},2e3);return()=>clearTimeout(e)}},[a,S.length,c,e3]);let e6=(0,s.useMemo)(()=>e5(S,eo),[S,eo,e5]);(0,s.useEffect)(()=>{a?"photo"===Y?(j([]),A(""),B(""),D(!0),eD(null),ew(0),er(new Map),eu(new Set),ef(new Set),e$()):"video"===Y?(b([]),T(""),U(!0),ea(new Map),em(new Set),eD(null),eY(!0)):"audio"===Y&&(L([]),V(""),G(!0),_([]),en(new Map),eg(new Set),eD(null),eZ(!0)):(eD(null),P(!1))},[a,r,Y]);let e8=async()=>{if(0!==w.length)if(u&&"chat"===c){try{n(w)}catch(e){}try{i()}catch(e){}P(!0);try{if((await (0,l.apiPost)("/api/gallery/send-photos",{idsGalleryPhotos:w.map(e=>e.idPhoto),idRegularUser:u,profileId:parseInt(r)})).success){N([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(r),clientId:u,kind:"photos"}}))}catch(e){}}else eD("Помилка відправки фото")}catch(e){eD("Помилка відправки фото")}finally{P(!1)}}else n(w),i()},e7=async()=>{if(0!==k.length)if(u&&"chat"===c){P(!0);try{if((await (0,l.apiPost)("/api/gallery/send-videos",{idsGalleryVideos:k.map(e=>e.idVideo),idRegularUser:u,profileId:parseInt(r)})).success){i(),C([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(r),clientId:u,kind:"videos"}}))}catch(e){}}else eD("Помилка відправки відео")}catch(e){eD("Помилка відправки відео")}finally{P(!1)}}else eD("Відправка відео підтримується тільки в чаті")},e9=async()=>{if(0!==M.length)if(u&&"chat"===c){P(!0);try{if((await (0,l.apiPost)("/api/gallery/send-audios",{idsGalleryAudios:M.map(e=>e.id),idRegularUser:u,profileId:parseInt(r)})).success){i(),_([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(r),clientId:u,kind:"audios"}}))}catch(e){}}else eD("Помилка відправки аудіо")}catch(e){eD("Помилка відправки аудіо")}finally{P(!1)}}else eD("Відправка аудіо підтримується тільки в чаті")},te=()=>{},tt=()=>{ej(null)},ts=(e,t)=>{ey.current.set(e,t)},tr=e=>{ey.current.delete(e)},tl=(0,s.useMemo)(()=>new Set(w.map(e=>e.idPhoto)),[w]),ta=(0,s.useCallback)(e=>tl.has(e.idPhoto),[tl]),ti=(0,s.useCallback)(e=>{if("attach"===h){if(g&&g.length>0){let t=g.includes("regular")&&!eM(e)&&!eP(e),s=g.includes("temporary")&&eP(e)&&!eM(e),r=g.includes("special")&&eE(e),l=g.includes("special_plus")&&e_(e);return t||s||r||l}return!eM(e)}return"chat"!==c||!eM(e)},[h,g,c,eM,eE,e_,eP]),tn=(0,s.useCallback)(e=>{let t=Math.floor(e/60);return"".concat(t,":").concat((e%60).toString().padStart(2,"0"))},[]),to=(0,s.useMemo)(()=>new Set(k.map(e=>e.idVideo)),[k]),tc=(0,s.useCallback)(e=>to.has(e.idVideo),[to]),td=(0,s.useCallback)(e=>M.some(t=>t.id===e.id),[M]);return a?(0,t.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-4xl h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,t.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[(0,t.jsx)("button",{onClick:()=>Z("photo"),className:"px-4 py-2 text-sm font-medium rounded-md transition-colors ".concat("photo"===Y?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Фото"}),(0,t.jsx)("button",{onClick:()=>Z("video"),className:"px-4 py-2 text-sm font-medium rounded-md transition-colors ".concat("video"===Y?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Відео"}),("attach"!==h||x)&&(0,t.jsx)("button",{onClick:()=>Z("audio"),className:"px-4 py-2 text-sm font-medium rounded-md transition-colors ".concat("audio"===Y?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Аудіо"}),"attach"===h&&!x&&(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-400",children:"(у режимі прикріплення аудіо приховано)"})]}),(0,t.jsx)("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 p-2",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"border-t-2 transition-colors duration-300 ".concat(E||"photo"===Y&&e2.length<15&&R||"video"===Y&&y.length<15&&H?"border-blue-500":"border-gray-200"),style:{animation:E||"photo"===Y&&e2.length<15&&R||"video"===Y&&y.length<15&&H?"pulse 0.8s ease-in-out infinite alternate":"none"}}),(0,t.jsx)("div",{className:"flex-1 flex min-h-0",children:"photo"===Y?(0,t.jsxs)("div",{className:"flex-1 p-3 flex flex-col min-h-0",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:"chat"===c?(0,t.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[(!g||g.includes("regular"))&&(0,t.jsx)("button",{onClick:()=>J("regular"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors ".concat("regular"===q?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:"Звичайні"}),(!g||g.includes("special"))&&(0,t.jsxs)("button",{onClick:()=>J("special"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("special"===q?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})}),(0,t.jsx)("span",{children:"Special"})]}),(!g||g.includes("special_plus"))&&(0,t.jsxs)("button",{onClick:()=>J("special_plus"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("special_plus"===q?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),title:"Special+",children:[(0,t.jsxs)("span",{className:"relative inline-flex items-center justify-center w-4 h-4",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})}),(0,t.jsx)("span",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 rounded-full bg-white text-pink-600 text-[9px] font-extrabold leading-none flex items-center justify-center border border-pink-500",children:"+"})]}),(0,t.jsx)("span",{children:"Special+"})]}),(!g||g.includes("temporary"))&&(0,t.jsxs)("button",{onClick:()=>J("temporary"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("temporary"===q?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V5z"})}),(0,t.jsx)("span",{children:"Тимчасові"})]})]}):(0,t.jsx)("h3",{className:"font-medium",children:"All photos"})}),eR&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,t.jsx)("p",{className:"text-red-600",children:eR})}),(0,t.jsx)("div",{ref:eH,className:"overflow-y-auto flex-1 p-2 custom-scroll",children:(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2",style:{gridAutoRows:"minmax(0, max-content)"},children:[e2.map(e=>{let s=eM(e),r=e_(e),l=eE(e);eP(e);let a=ti(e),i="chat"===c&&s&&"attach"!==h;return(0,t.jsxs)("div",{className:"group relative aspect-square rounded-lg overflow-hidden border-2 transition-all ".concat(a?ta(e)?"cursor-pointer border-blue-500 ring-2 ring-blue-200":"cursor-pointer border-gray-200 hover:border-gray-300":"cursor-not-allowed border-gray-300"),onClick:()=>{ti(e)&&N(t=>t.some(t=>t.idPhoto===e.idPhoto)?t.filter(t=>t.idPhoto!==e.idPhoto):t.length>=o?t:[...t,e])},children:[(0,t.jsx)("img",{src:e.urls.urlPreview,alt:"Photo ".concat(e.idPhoto),className:"w-full h-full object-cover ".concat(i?"grayscale opacity-60":""),loading:"lazy"}),(l||r)&&(0,t.jsxs)("div",{className:"absolute top-1 left-1 w-6 h-6 bg-pink-500 rounded-full flex items-center justify-center shadow-sm relative",children:[(0,t.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})}),r&&(0,t.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 rounded-full bg-white text-pink-600 flex items-center justify-center text-[10px] font-extrabold leading-none",children:"+"})]}),ta(e)&&(0,t.jsx)("div",{className:"absolute top-1 right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(()=>{let s=es.get(e.idPhoto);return s?(0,t.jsx)("div",{className:"absolute bottom-1 left-1 w-5 h-5 rounded-full flex items-center justify-center ".concat("accessed"===s?"bg-green-500":"sent"===s?"bg-yellow-500":"bg-black bg-opacity-60"),children:"accessed"===s?(0,t.jsxs)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):"sent"===s?(0,t.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}):null}):null})(),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),$(e)},className:"absolute bottom-1 right-1 w-12 h-12 bg-black bg-opacity-60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-opacity-80",title:"Переглянути в повному розмірі",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]},e.idPhoto)}),!E&&!R&&e2.length>0&&(0,t.jsxs)("div",{className:"col-span-5 flex flex-col items-center py-6 text-gray-500",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-sm font-medium mb-1",children:"Це всі фото"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Більше фото поки що немає"})]})]})}),"chat"===c&&0===e2.length&&(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:E||R?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-4 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Шукаємо фото..."}),(0,t.jsx)("p",{className:"text-sm text-center",children:"Завантажуємо фото з сервера"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"regular"===q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає звичайних фото"}),(0,t.jsxs)("p",{className:"text-sm text-center",children:["Всі фото в цьому профілі мають спеціальний статус.",(0,t.jsx)("br",{}),'Перейдіть до розділу "Special" або "Тимчасові" щоб їх переглянути.']})]}),"special"===q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає особливих фото"}),(0,t.jsx)("p",{className:"text-sm text-center",children:'В цьому профілі немає фото з тегами "special".'})]}),"temporary"===q&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає тимчасових фото"}),(0,t.jsx)("p",{className:"text-sm text-center",children:"В цьому профілі немає тимчасових фото."})]})]})})]}):"video"===Y?(0,t.jsxs)("div",{className:"flex-1 p-3 flex flex-col min-h-0",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("h3",{className:"font-medium",children:"Відео"})}),"chat"===c&&u&&(0,t.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1 mb-3",children:[(0,t.jsxs)("button",{onClick:()=>ec("all"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("all"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),(0,t.jsx)("span",{children:"Усі"})]}),(0,t.jsxs)("button",{onClick:()=>ec("available"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("available"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:"Доступні"})]}),(0,t.jsxs)("button",{onClick:()=>ec("accessed"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("accessed"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,t.jsx)("span",{children:"Переглянуті"})]}),(0,t.jsxs)("button",{onClick:()=>ec("sent"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("sent"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),(0,t.jsx)("span",{children:"Відправлені"})]})]}),eR&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,t.jsx)("p",{className:"text-red-600",children:eR})}),(0,t.jsx)("div",{ref:eH,className:"overflow-y-auto flex-1 p-2 custom-scroll",children:(0,t.jsxs)("div",{className:"grid grid-cols-5 gap-2",style:{gridAutoRows:"minmax(0, max-content)"},children:[e4.map(e=>(0,t.jsxs)("div",{className:"group relative aspect-square rounded-lg overflow-hidden border-2 transition-all ".concat(tc(e)?"cursor-pointer border-blue-500 ring-2 ring-blue-200":"cursor-pointer border-gray-200 hover:border-gray-300"),onClick:()=>{C(t=>t.some(t=>t.idVideo===e.idVideo)?t.filter(t=>t.idVideo!==e.idVideo):t.length>=o?t:[...t,e])},children:[(0,t.jsx)("img",{src:e.urls.urlThumbnail,alt:"Video ".concat(e.idVideo),className:"w-full h-full object-cover",loading:"lazy"}),(0,t.jsx)("div",{className:"absolute bottom-1 right-1 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded",children:tn(e.duration)}),(()=>{let s=el.get(e.idVideo);return s?(0,t.jsx)("div",{className:"absolute top-1 left-1 w-5 h-5 rounded-full flex items-center justify-center ".concat("accessed"===s?"bg-green-500":"sent"===s?"bg-yellow-500":"bg-black bg-opacity-60"),children:"accessed"===s?(0,t.jsxs)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):"sent"===s?(0,t.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}):null}):null})(),tc(e)&&(0,t.jsx)("div",{className:"absolute top-1 right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),et(e)},className:"absolute bottom-1 left-1 w-12 h-12 bg-black bg-opacity-60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-opacity-80",title:"Переглянути відео",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]},e.idVideo)),!E&&!H&&y.length>0&&(0,t.jsxs)("div",{className:"col-span-5 flex flex-col items-center py-6 text-gray-500",children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-sm font-medium mb-1",children:"Це всі відео"}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"Більше відео поки що немає"})]})]})}),0===e4.length&&(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:E||H?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-4 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Шукаємо відео..."}),(0,t.jsx)("p",{className:"text-sm text-center",children:"Завантажуємо відео з сервера"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає відео"}),(0,t.jsx)("p",{className:"text-sm text-center",children:"В цьому профілі поки що немає відео"})]})})]}):(0,t.jsxs)("div",{className:"flex-1 p-3 flex flex-col min-h-0",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)("h3",{className:"font-medium",children:"Аудіо"})}),"chat"===c&&u&&(0,t.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1 mb-3",children:[(0,t.jsxs)("button",{onClick:()=>ec("all"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("all"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),(0,t.jsx)("span",{children:"Усі"})]}),(0,t.jsxs)("button",{onClick:()=>ec("available"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("available"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{children:"Доступні"})]}),(0,t.jsxs)("button",{onClick:()=>ec("accessed"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("accessed"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,t.jsx)("span",{children:"Переглянуті"})]}),(0,t.jsxs)("button",{onClick:()=>ec("sent"),className:"px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ".concat("sent"===eo?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),(0,t.jsx)("span",{children:"Відправлені"})]})]}),eR&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,t.jsx)("p",{className:"text-red-600",children:eR})}),(0,t.jsxs)("div",{ref:eH,className:"overflow-y-auto flex-1 p-2 custom-scroll",children:[(0,t.jsx)("div",{className:"space-y-2",children:e6.map(e=>(0,t.jsx)("div",{className:"group relative p-3 rounded-lg border-2 transition-all cursor-pointer ".concat(td(e)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),onClick:()=>{_(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):t.length<o?[...t,e]:t)},children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.title}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:new Date(e.dateCreated).toLocaleDateString()})]})]}),(0,t.jsx)("div",{className:"w-full",onClick:e=>e.stopPropagation(),children:(0,t.jsx)(d,{src:e.urls.mp3,title:e.title,duration:e.duration,audioId:e.id,onPlay:()=>(e=>{if(ev&&ev.id!==e.id){let e=ey.current.get(ev.id);e&&!e.paused&&e.pause()}ej(e)})(e),onPause:te,onEnded:tt,onRegister:ts,onUnregister:tr})}),(()=>{let s=ei.get(e.id);return s?(0,t.jsx)("div",{className:"absolute top-2 left-2 w-4 h-4 rounded-full flex items-center justify-center ".concat("accessed"===s?"bg-green-500":"sent"===s?"bg-yellow-500":"bg-black bg-opacity-60"),children:"accessed"===s?(0,t.jsxs)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):"sent"===s?(0,t.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}):null}):null})(),td(e)&&(0,t.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})},e.id))}),0===e6.length&&(0,t.jsx)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:E||O?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-4 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Завантаження аудіо..."})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,t.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає аудіо"}),(0,t.jsx)("p",{className:"text-sm text-center",children:"Аудіо файли не знайдені або не відповідають фільтру"})]})}),!E&&!O&&S.length>0&&(0,t.jsx)("div",{className:"text-center py-4 text-gray-500 text-sm",children:"Всі аудіо завантажені"})]})]})}),("photo"===Y||"video"===Y||"audio"===Y)&&(0,t.jsxs)("div",{className:"border-t p-3 flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"photo"===Y?"".concat(w.length," of ").concat(o," selected"):"video"===Y?"".concat(k.length," of ").concat(Math.min(o,e4.length)," selected"):"".concat(M.length," of ").concat(Math.min(o,e6.length)," selected")}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)("button",{onClick:i,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Cancel"}),"attach"===h&&f?(0,t.jsx)("button",{onClick:()=>f({photos:w,videos:k}),disabled:0===w.length&&0===k.length||E,className:"px-6 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2 ".concat((w.length>0||k.length>0)&&!E?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:(0,t.jsx)("span",{children:m||"Прикріпити"})}):(0,t.jsxs)("button",{onClick:"photo"===Y?e8:"video"===Y?e7:e9,disabled:("photo"===Y?0===w.length:"video"===Y?0===k.length:0===M.length)||E,className:"px-6 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2 ".concat(("photo"===Y?w.length>0:"video"===Y?k.length>0:M.length>0)&&!E?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"),children:[E&&(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,t.jsx)("span",{children:E?"Sending...":"Send →"})]})]})]})]}),Q&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:()=>$(null),children:(0,t.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",children:[(0,t.jsx)("img",{src:Q.urls.urlOriginal,alt:"Photo ".concat(Q.idPhoto),className:"max-w-full max-h-full object-contain rounded-lg cursor-pointer",onClick:()=>$(null),onError:e=>{e.target.src=Q.urls.urlStandard}}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),$(null)},className:"absolute top-4 right-4 w-10 h-10 bg-black bg-opacity-60 rounded-full flex items-center justify-center text-white hover:bg-opacity-80 transition-all",title:"Закрити",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),ee&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:()=>et(null),children:(0,t.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",children:[(0,t.jsx)("video",{src:ee.urls.urlMp4Hd,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain rounded-lg",onError:e=>{e.target.src=ee.urls.urlMp4Sd}}),(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),et(null)},className:"absolute top-4 right-4 w-10 h-10 bg-black bg-opacity-60 rounded-full flex items-center justify-center text-white hover:bg-opacity-80 transition-all",title:"Закрити",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}):null}function h(e){let{isOpen:r,src:l,isLoading:a=!1,onClose:i}=e;return((0,s.useEffect)(()=>{if(!r)return;let e=e=>{"Escape"===e.key&&i()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r,i]),r)?(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:i,children:(0,t.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",onClick:e=>e.stopPropagation(),children:[a?(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-white/40 border-t-white rounded-full animate-spin"}):l&&(0,t.jsx)("img",{src:l,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg cursor-pointer",onClick:i}),(0,t.jsx)("button",{onClick:i,className:"absolute top-4 right-4 w-10 h-10 bg-black bg-opacity-60 rounded-full flex items-center justify-center text-white hover:bg-opacity-80 transition-all",title:"Закрити",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}):null}var m=s;class x extends m.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("🎭 Lottie Error Boundary caught an error:",e,t),this.props.onError&&this.props.onError(e,t),console.error("🎭 Lottie Error Details:"),console.error("- Error message:",e.message),console.error("- Error stack:",e.stack),console.error("- Component stack:",t.componentStack)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-purple-100 rounded-md",children:(0,t.jsxs)("div",{className:"text-center p-2",children:[(0,t.jsx)("div",{className:"text-2xl mb-1",children:"🎭"}),(0,t.jsx)("div",{className:"text-xs text-gray-600 font-medium",children:"Помилка анімації"}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Lottie"})]})}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}let g=["😀","😂","❤️","👍","👎","👋","🙌","👏","🙏","🤝","😊","😍","🥰","😘","😉","😎","🤔","😮","😢","😭","😤","😡","🥺","😴","🤗","🤭","🤫","🤥","🤑","🤐","💖","💕","💯","🔥","⭐","✨","💫","🌟","🎉","🎊","🍎","🍊","🍋","🍌","🍉","🍇","🍓","🫐","🍈","🍒","🌹","🌷","🌺","🌸","🌼","🌻","🌷","🌹","🥀","🌱","🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","👨","👩","👧","👦","👶","👵","👴","🧑","👨‍💻","👩‍💻","💼","📱","💻","⌨️","🖥️","🖨️","📺","📷","🎥","🎵","⚽","🏀","🏈","⚾","🎾","🏐","🏉","🥏","🎱","🪀","🚗","🚕","🚙","🚌","🚎","🏎️","🚓","🚑","🚒","🚐","✈️","🚀","🚁","🛳️","⛵","🛶","🚤","🛥️","🛩️","🛸"],p=e=>{let{onEmojiSelect:r,onClose:l,isOpen:a,className:i=""}=e,n=(0,s.useRef)(null);return((0,s.useEffect)(()=>{let e=e=>{n.current&&!n.current.contains(e.target)&&l()};return a&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[a,l]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&l()};return a&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[a,l]),a)?(0,t.jsx)("div",{ref:n,className:"absolute z-50 bg-white border border-gray-300 rounded-lg shadow-xl ".concat(i),style:{bottom:"100%",right:0,marginBottom:"8px",width:"fit-content",minWidth:"220px",maxWidth:"240px"},children:(0,t.jsxs)("div",{className:"p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-gray-200",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Виберіть емодзі"}),(0,t.jsx)("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"max-h-96 overflow-y-auto custom-scroll",children:(0,t.jsx)("div",{className:"grid gap-2 p-1",style:{display:"grid",gridTemplateColumns:"repeat(5, 36px)",gridAutoRows:"36px"},children:g.map((e,s)=>(0,t.jsx)("button",{onClick:()=>{r(e)},className:"flex items-center justify-center hover:bg-gray-100 rounded transition-colors text-2xl leading-none",title:"Додати ".concat(e),style:{fontSize:"1.44em",width:"36px !important",height:"36px !important",minWidth:"36px !important",minHeight:"36px !important",maxWidth:"36px !important",maxHeight:"36px !important"},children:e},s))})}),(0,t.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:(0,t.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Натисніть на емодзі для додавання або Escape для закриття"})})]})}):null},f=s.default.memo(e=>{let{images:s,isFromProfile:r,onImageClick:l}=e;return(0,t.jsxs)("div",{className:r?"border-t pt-3 border-blue-400":"border-t pt-3 border-gray-200",children:[(0,t.jsx)("h4",{className:r?"text-sm font-medium mb-2 text-white":"text-sm font-medium mb-2 text-gray-900",children:"📎 Вкладення:"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map(e=>{let s=e.url_thumbnail||e.url_original,r=e.url_original||e.url_thumbnail;return(0,t.jsxs)("div",{className:"relative inline-block w-20 h-20 border border-gray-200 rounded overflow-hidden",children:[(0,t.jsx)("img",{src:s,alt:"Attachment ".concat(e.id),className:"w-full h-full object-cover cursor-pointer hover:opacity-80 transition-opacity",style:{display:"block"},onClick:()=>l(r,"Attachment ".concat(e.id)),onError:e=>{let t=e.target;t.style.display="none",t.onerror=null}}),e.is_paid&&(0,t.jsx)("div",{className:"absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center",children:(0,t.jsxs)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,t.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,t.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})})]},e.id)})})]})});function v(e){let{isOpen:r,onClose:a,profileId:i,clientId:n,correspondenceId:c,lettersLeft:d}=e,{showToast:h}=(0,o.useToast)(),[m,x]=(0,s.useState)([]),[g,v]=(0,s.useState)(!1),[j,y]=(0,s.useState)(!1),[b,w]=(0,s.useState)(1),[N,k]=(0,s.useState)(!0),[C,S]=(0,s.useState)(null),[L,M]=(0,s.useState)(0),[_,E]=(0,s.useState)(!0),P=(0,s.useRef)(null),z=(0,s.useRef)(1),[A,I]=(0,s.useState)(""),[B,W]=(0,s.useState)(!1),[T,F]=(0,s.useState)(!1),[V,R]=(0,s.useState)([]),[D,H]=(0,s.useState)([]),[U,O]=(0,s.useState)([]),G=(0,s.useMemo)(()=>{let e=new Set(U||[]),t=["regular","temporary"];return e.has("special")||t.push("special"),e.has("special_plus")||t.push("special_plus"),t},[U]);(0,s.useEffect)(()=>{(async()=>{try{if(!r||!i||!n)return;let e=await (0,l.apiPost)("/api/chats/tt-forbidden-tags",{profileId:parseInt(i),idInterlocutor:parseInt(n)});e.success&&Array.isArray(e.tags)?O(e.tags):O([])}catch(e){O([]),h({title:"Помилка заборонених категорій",message:(null==e?void 0:e.message)||"Не вдалося отримати обмеження категорій",type:"error"})}})()},[r,i,n]);let q=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!g&&c){v(!0);try{var s,r;let a=await (0,l.apiPost)("/api/tt/emails-history",{page:e,limit:10,id_correspondence:c,id_interlocutor:n,id_user:i,without_translation:!1});if(a.success&&(null==(r=a.data)||null==(s=r.data)?void 0:s.history)){let s=a.data.data.history.sort((e,t)=>new Date(e.date_created).getTime()-new Date(t.date_created).getTime());t?(x(e=>{let t=new Set(e.map(e=>e.id)),r=s.filter(e=>!t.has(e.id)),l=s.length-r.length;return l>0&&console.log("📧 EmailHistory: Відфільтровано ".concat(l," дублікатів")),[...r,...e]}),M(e=>{let t=new Set(m.map(e=>e.id)),r=s.filter(e=>!t.has(e.id)).length;return e+r})):(x(s),M(0),E(!0)),k(10===s.length),z.current=e,w(e)}}catch(e){console.error("Помилка завантаження листів:",e)}finally{v(!1)}}},[c,n,i]),J=(0,s.useCallback)(async()=>{if(!j&&N&&!g){y(!0);try{var e,t;let s=z.current,r=s+1;console.log("📧 EmailHistory: Завантажуємо сторінку ".concat(r," (поточна: ").concat(s,")"));let a=await (0,l.apiPost)("/api/tt/emails-history",{page:r,limit:10,id_correspondence:c,id_interlocutor:n,id_user:i,without_translation:!1});if(a.success&&(null==(t=a.data)||null==(e=t.data)?void 0:e.history)){let e=a.data.data.history.sort((e,t)=>new Date(e.date_created).getTime()-new Date(t.date_created).getTime());e.length>0?(x(t=>{let s=new Set(t.map(e=>e.id)),r=e.filter(e=>!s.has(e.id)),l=e.length-r.length;return l>0&&console.log("📧 EmailHistory: Відфільтровано ".concat(l," дублікатів при пагінації")),[...r,...t]}),M(t=>{let s=new Set(m.map(e=>e.id)),r=e.filter(e=>!s.has(e.id)).length;return t+r}),z.current=r,w(r),k(10===e.length),console.log("✅ EmailHistory: Успішно завантажено сторінку ".concat(r))):(k(!1),console.log("📧 EmailHistory: Більше листів немає"))}}catch(e){console.error("Помилка завантаження старіших листів:",e)}finally{y(!1)}}},[c,n,i]),K=(0,s.useCallback)(e=>{let{scrollTop:t}=e.currentTarget;0!==t||!N||j||g||J()},[]);return((0,s.useLayoutEffect)(()=>{if(L>0&&P.current){let e=P.current,t=e.querySelectorAll("[data-email-id]");if(t.length>L){let s=t[L];s&&(e.scrollTop=s.offsetTop-100)}M(0)}},[m,L]),(0,s.useEffect)(()=>{r&&c&&(x([]),w(1),k(!0),M(0),E(!0),q(1,!1))},[r,c]),(0,s.useEffect)(()=>{if(m.length>0&&P.current&&_){let e=P.current;setTimeout(()=>{e.scrollTop=e.scrollHeight,E(!1)},100)}},[m,_]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(C?S(null):a())};if(r)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r,C,a]),r)?(0,t.jsxs)(s.default.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"📧 Історія листування"}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{ref:P,className:"flex-1 overflow-y-auto p-4 custom-scroll",onScroll:K,children:[j&&(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),(0,t.jsx)("span",{className:"ml-2 text-gray-600",children:"Завантаження старіших листів..."})]}),0!==m.length||g?(0,t.jsx)("div",{className:"space-y-4 px-4",children:m.map(e=>{var s;let r=e.id_user_from===i;return(0,t.jsx)("div",{"data-email-id":e.id,className:r?"flex justify-end":"flex justify-start",children:(0,t.jsxs)("div",{className:r?"max-w-[80%] p-4 shadow-sm bg-blue-500 text-white rounded-l-lg rounded-tr-lg":"max-w-[80%] p-4 shadow-sm bg-gray-100 text-gray-900 rounded-r-lg rounded-tl-lg",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:r?"font-medium mb-1 text-white":"font-medium mb-1 text-gray-900",children:e.title||"Без теми"}),(0,t.jsxs)("div",{className:r?"flex items-center space-x-4 text-sm text-blue-100":"flex items-center space-x-4 text-sm text-gray-600",children:[(0,t.jsxs)("span",{children:["Від: ",e.id_user_from]}),(0,t.jsxs)("span",{children:["До: ",e.id_user_to]}),(0,t.jsx)("span",{children:(e=>{try{return new Date(e).toLocaleString("uk-UA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){return e}})(e.date_created)}),e.is_paid&&(0,t.jsx)("span",{className:r?"px-2 py-1 rounded text-xs bg-blue-600 text-blue-100":"px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:"💰 Платний"})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("span",{className:"read"===e.status?r?"px-2 py-1 rounded text-xs bg-blue-600 text-blue-100":"px-2 py-1 rounded text-xs bg-green-100 text-green-800":r?"px-2 py-1 rounded text-xs bg-blue-600 text-blue-100":"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"read"===e.status?"Прочитано":"Непрочитано"})})]}),(0,t.jsx)("div",{className:r?"mb-3 prose prose-sm max-w-none prose-invert":"mb-3 prose prose-sm max-w-none text-gray-800",dangerouslySetInnerHTML:{__html:e.content}}),(null==(s=e.attachments)?void 0:s.images)&&e.attachments.images.length>0&&(0,t.jsx)(f,{images:e.attachments.images,isFromProfile:r,onImageClick:(e,t)=>S({url:e,alt:t})})]})},e.id)})}):(0,t.jsx)("div",{className:"text-center text-gray-500 py-8",children:"📭 Немає листів в цій кореспонденції"}),g&&(0,t.jsxs)("div",{className:"text-center py-4",children:[(0,t.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),(0,t.jsx)("span",{className:"ml-2 text-gray-600",children:"Завантаження..."})]}),!j&&!N&&m.length>10&&(0,t.jsx)("div",{className:"text-center py-4",children:(0,t.jsx)("span",{className:"text-gray-500 text-sm",children:"📄 Більше листів немає"})})]}),"number"==typeof d&&d>0&&(0,t.jsxs)("div",{className:"border-t p-3",children:[(V.length>0||D.length>0)&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mb-2",children:[V.map(e=>(0,t.jsxs)("div",{className:"relative w-14 h-14 rounded-md overflow-hidden border border-gray-200",children:[(0,t.jsx)("img",{src:e.urls.urlPreview,alt:"Фото ".concat(e.idPhoto),className:"w-full h-full object-cover"}),(0,t.jsx)("button",{onClick:()=>R(t=>t.filter(t=>t.idPhoto!==e.idPhoto)),className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати фото",children:"✕"})]},"p-".concat(e.idPhoto))),D.map(e=>(0,t.jsxs)("div",{className:"relative w-14 h-14 rounded-md overflow-hidden border border-gray-200",children:[(0,t.jsx)("img",{src:e.urls.urlThumbnail,alt:"Відео ".concat(e.idVideo),className:"w-full h-full object-cover"}),(0,t.jsx)("span",{className:"absolute bottom-0 right-0 m-0.5 text-[10px] px-1 py-0.5 rounded bg-black/60 text-white",children:"▶"}),(0,t.jsx)("button",{onClick:()=>H(t=>t.filter(t=>t.idVideo!==e.idVideo)),className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати відео",children:"✕"})]},"v-".concat(e.idVideo)))]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>W(!0),className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Прикріпити медіа",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none",placeholder:"Напишіть лист... (300–3000 символів)",value:A,onChange:e=>I(e.target.value),rows:3,maxLength:3e3}),(0,t.jsxs)("div",{className:"absolute right-2 top-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>F(!T),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",title:"Додати емодзі",children:"😀"}),(0,t.jsx)(p,{isOpen:T,onEmojiSelect:e=>{I(t=>t+e)},onClose:()=>F(!1)})]}),(0,t.jsxs)("div",{className:"text-xs mt-1 flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"".concat(A.trim().length<300||A.trim().length>3e3?"text-red-600":"text-gray-500"),children:["Символів: ",A.trim().length,"/3000"]}),(0,t.jsx)("span",{className:"text-gray-400",children:"Мінімум 300"})]})]}),(0,t.jsx)("button",{onClick:async()=>{let e=A.trim();if(e.length<300||e.length>3e3)return;let t=V.slice(0,10).map(e=>e.idPhoto),s=D.slice(0,10).map(e=>e.idVideo);try{let r=await (0,l.apiPost)("/api/chats/send-letter",{profileId:parseInt(i),idUserTo:parseInt(n),content:e,photoIds:t,videoIds:s});if(r.success){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\n/g,"<br/>"),s=V.slice(0,10).map(e=>({id:"p-".concat(e.idPhoto),url_thumbnail:e.urls.urlPreview,url_original:e.urls.urlOriginal,is_paid:!1,display_attributes:[]})),r={id:"temp-".concat(Date.now()),id_user_from:i,id_user_to:n,title:"",content:t,date_created:new Date().toISOString(),status:"unread",attachments:s.length?{images:s}:void 0,is_paid:!1};x(e=>[...e,r]),setTimeout(()=>{let e=P.current;e&&(e.scrollTop=e.scrollHeight)},0),I(""),R([]),H([]),h({title:"Лист надіслано",message:"Ваш лист успішно відправлено",type:"success"});try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(i),clientId:parseInt(n),kind:"email"}}))}catch(e){}}else console.error("❌ Send letter failed:",r.error),h({title:"Помилка відправки",message:r.error||"Невідома помилка",type:"error"})}catch(e){console.error("❌ Send letter error:",e),h({title:"Помилка відправки",message:(null==e?void 0:e.message)||"Невідома помилка",type:"error"})}},disabled:A.trim().length<300||A.trim().length>3e3,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors disabled:bg-gray-300",children:"Надіслати"})]})]})]})}),C&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:()=>S(null),children:(0,t.jsxs)("div",{className:"relative max-w-full max-h-full p-4",children:[(0,t.jsx)("img",{src:C.url,alt:C.alt,className:"max-w-full max-h-full object-contain",onClick:e=>e.stopPropagation()}),(0,t.jsx)("button",{onClick:()=>S(null),className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",children:(0,t.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,t.jsx)(u,{profileId:i,isOpen:B,onClose:()=>W(!1),onPhotoSelect:()=>{},maxSelection:10,context:"chat",idRegularUser:parseInt(n),mode:"attach",actionLabel:"Прикріпити",allowAudio:!1,allowedPhotoTabs:G,isSpecialPlusAllowed:!U.includes("special_plus"),onAttach:e=>{let{photos:t,videos:s}=e;R(t),H(s),W(!1)}})]}):null}function j(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class y{setTimeout(e,t){let s=setTimeout(()=>{this.timeouts.delete(s),e()},t);return this.timeouts.add(s),s}setInterval(e,t){let s=setInterval(e,t);return this.intervals.add(s),s}addEventListener(e,t,s,r){e.addEventListener(t,s,r),this.eventListeners.push({element:e,event:t,handler:s,options:r})}createAbortController(){let e=new AbortController;return this.abortControllers.add(e),e}addCleanup(e){this.cleanupFunctions.add(e)}clearTimeout(e){this.timeouts.has(e)&&(clearTimeout(e),this.timeouts.delete(e))}clearInterval(e){this.intervals.has(e)&&(clearInterval(e),this.intervals.delete(e))}cleanup(){console.log("🧹 ComponentResourceManager: Cleaning up all resources..."),this.timeouts.forEach(e=>{try{clearTimeout(e)}catch(e){console.warn("Error clearing timeout:",e)}}),this.timeouts.clear(),this.intervals.forEach(e=>{try{clearInterval(e)}catch(e){console.warn("Error clearing interval:",e)}}),this.intervals.clear(),this.eventListeners.forEach(e=>{let{element:t,event:s,handler:r,options:l}=e;try{t.removeEventListener(s,r,l)}catch(e){console.warn("Error removing event listener:",e)}}),this.eventListeners.length=0,this.abortControllers.forEach(e=>{try{e.signal.aborted||e.abort()}catch(e){console.warn("Error aborting controller:",e)}}),this.abortControllers.clear(),this.cleanupFunctions.forEach(e=>{try{e()}catch(e){console.warn("Error in custom cleanup function:",e)}}),this.cleanupFunctions.clear(),console.log("✅ ComponentResourceManager: All resources cleaned up")}getStats(){return{timeouts:this.timeouts.size,intervals:this.intervals.size,eventListeners:this.eventListeners.length,abortControllers:this.abortControllers.size,cleanupFunctions:this.cleanupFunctions.size}}constructor(){j(this,"timeouts",new Set),j(this,"intervals",new Set),j(this,"eventListeners",[]),j(this,"abortControllers",new Set),j(this,"cleanupFunctions",new Set)}}async function b(t,s){try{let{apiPost:r}=await e.A(3646),l=await r("/api/chats/tt-restrictions",{profileId:t,idInterlocutor:s});return{hasExclusivePosts:l.hasExclusivePosts||!1,categories:l.categories||[],categoryCounts:l.categoryCounts,tier:l.tier,success:!1!==l.success,error:l.error}}catch(e){return console.error("❌ Error checking dialog restrictions:",e),{hasExclusivePosts:!1,categories:[],success:!1,error:e instanceof Error?e.message:"Unknown error"}}}function w(e){let r,a,i,{isOpen:n,onClose:o,profileId:c,clientId:d}=e,[u,h]=(0,s.useState)(!0),[m,x]=(0,s.useState)(null),[g,p]=(0,s.useState)(null),[f,v]=(0,s.useState)(null),[j,y]=(0,s.useState)(),[b,w]=(0,s.useState)(),[N,k]=(0,s.useState)(),[C,S]=(0,s.useState)([]),[L,M]=(0,s.useState)([]),[_,E]=(0,s.useState)(null),[P,z]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(!n)return;let e=!1;return(async()=>{h(!0),x(null);try{var t;let s=await (0,l.apiGet)("/profiles/".concat(c,"/client/").concat(d,"/public")),r=(null==(t=s.profile)?void 0:t.personal)?s.profile:void 0;r&&!e&&(p(r.personal||null),v(r.preferences||null),y(r.is_online),w(r.last_visit),k(r.date_created));let a=await (0,l.apiPost)("/profiles/".concat(c,"/client/").concat(d,"/photos"),{}),i=(null==a?void 0:a.data)||a,n=((null==i?void 0:i.public)||[]).filter(e=>!e.is_hidden),o=((null==i?void 0:i.private)||[]).filter(e=>!e.is_hidden);if(!e){S(n),M(o);let e=[...n,...o].find(e=>1===e.isMain||1===e.is_main);E(e||null)}}catch(t){e||x((null==t?void 0:t.message)||"Помилка завантаження профілю")}finally{e||h(!1)}})(),()=>{e=!0}},[n,c,d]);let A=(0,s.useMemo)(()=>C,[C]),I=(0,s.useMemo)(()=>L,[L]);if(!n)return null;let B=e=>{try{let t=new Date(e),s=t.getMonth()+1,r=t.getDate();for(let e of[{name:"Козоріг",start:[12,22],end:[1,19],icon:"♑"},{name:"Водолій",start:[1,20],end:[2,18],icon:"♒"},{name:"Риби",start:[2,19],end:[3,20],icon:"♓"},{name:"Овен",start:[3,21],end:[4,19],icon:"♈"},{name:"Телець",start:[4,20],end:[5,20],icon:"♉"},{name:"Близнюки",start:[5,21],end:[6,20],icon:"♊"},{name:"Рак",start:[6,21],end:[7,22],icon:"♋"},{name:"Лев",start:[7,23],end:[8,22],icon:"♌"},{name:"Діва",start:[8,23],end:[9,22],icon:"♍"},{name:"Терези",start:[9,23],end:[10,22],icon:"♎"},{name:"Скорпіон",start:[10,23],end:[11,21],icon:"♏"},{name:"Стрілець",start:[11,22],end:[12,21],icon:"♐"}]){let[t,l]=e.start,[a,i]=e.end;if(s===t&&r>=l||s===a&&r<=i||s>t&&s<a||12===s&&1===t||1===s&&12===a)return e}return{name:"Невідомий",icon:"❓"}}catch(e){return{name:"Невідомий",icon:"❓"}}},W=e=>{let{label:s,value:r}=e;if(null==r||""===r||Array.isArray(r)&&0===r.length)return null;let l=(e=>{let t=document.createElement("textarea");return t.innerHTML=e,t.value})(Array.isArray(r)?r.join(", "):String(r));return(0,t.jsxs)("div",{className:"flex text-sm",children:[(0,t.jsx)("div",{className:"w-[120px] text-gray-500 text-right",children:s}),(0,t.jsx)("div",{className:"flex-1 text-gray-900 ml-2",children:l})]})};return(0,t.jsxs)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:o}),(0,t.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scroll",children:[u?(0,t.jsx)("div",{className:"p-6 text-sm text-gray-500",children:"Завантаження…"}):m?(0,t.jsx)("div",{className:"p-6 text-sm text-red-600",children:m}):(0,t.jsxs)("div",{className:"p-6 grid grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[_&&(0,t.jsx)("div",{className:"w-[350px] h-[400px]",children:(0,t.jsx)("img",{src:_.url_standart||_.url_xxl||_.url_xl||_.url_large||_.url_medium||_.url_small||_.url_xs||(null==g?void 0:g.avatar_xl)||"",alt:"main",className:"w-full h-full object-cover rounded-lg cursor-zoom-in",onClick:()=>z(_.url_original||"")})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-1",children:[A.map(e=>(0,t.jsx)("img",{src:e.url_xl||e.url_large||e.url_medium||e.url_small||e.url_xs||"",alt:"pub-".concat(e.id),className:"w-[80px] h-[80px] object-cover rounded cursor-zoom-in",onClick:()=>z(e.url_original||"")},e.id)),I.map(e=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:e.url_xl||e.url_large||e.url_medium||e.url_small||e.url_xs||"",alt:"priv-".concat(e.id),className:"w-[80px] h-[80px] object-cover rounded cursor-zoom-in hover:opacity-80 transition-opacity",onClick:()=>z(e.url_original||"")}),(0,t.jsx)("div",{className:"absolute bottom-1 right-1 bg-black/60 text-white text-xs px-1 py-0.5 rounded",children:"Приватне"})]},e.id))]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(null==g?void 0:g.gender)&&(0,t.jsx)("div",{className:"flex-shrink-0",children:"male"===g.gender?(0,t.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}):"female"===g.gender?(0,t.jsx)("svg",{className:"w-6 h-6 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}):(0,t.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,t.jsx)("div",{className:"text-xl font-bold text-gray-900",children:(null==g?void 0:g.name)?"".concat(g.name).concat((null==g?void 0:g.age)?", ".concat(g.age):""):"User ".concat(d)}),(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(j?"bg-green-500":"bg-gray-400")}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:j?"онлайн":(e=>{if(!e)return"офлайн";try{let t=new Date,s=new Date(e),r=t.getTime()-s.getTime(),l=Math.floor(r/6e4),a=Math.floor(r/36e5),i=Math.floor(r/864e5),n=Math.floor(i/7);if(l<60){if(l<1)return"щойно";if(1===l)return"хвилину тому";if(l<5)return"".concat(l," хвилини тому");return"".concat(l," хвилин тому")}if(a<24){if(1===a)return"годину тому";if(a<5)return"".concat(a," години тому");return"".concat(a," годин тому")}if(i<7){if(1===i)return"день тому";return"".concat(i," дні тому")}if(1===n)return"тиждень тому";if(n<4)return"".concat(n," тижні тому");return"місяць тому"}catch(e){return"офлайн"}})(b)})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[((null==g?void 0:g.country)||(null==g?void 0:g.city))&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:[null==g?void 0:g.country,null==g?void 0:g.city].filter(Boolean).join(", ")})]}),(null==g?void 0:g.date_birth)&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.date_birth})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("span",{className:"text-base",children:B(g.date_birth).icon}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:B(g.date_birth).name})]})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:(()=>{let e=(e=>{if(!e||"string"!=typeof e)return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:"Невідомо",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})};switch(e.toLowerCase()){case"real_love":return{iconColor:"text-red-600",textColor:"text-red-600",displayName:"Любов",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})})};case"friendship":return{iconColor:"text-blue-600",textColor:"text-blue-600",displayName:"Дружба",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"})})};case"hot_talks":return{iconColor:"text-pink-600",textColor:"text-pink-600",displayName:"Інтим",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})})};default:return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:e,icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})}}})(null==g?void 0:g.mood);return(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("div",{className:"w-4 h-4 flex items-center justify-center ".concat(e.iconColor),children:e.icon}),(0,t.jsx)("span",{className:"text-xs font-medium ".concat(e.textColor),children:e.displayName})]})})()})]}),(0,t.jsx)("div",{className:"mt-6 mb-3",children:(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"Я шукаю"})}),((null==f?void 0:f.gender)||(null==f?void 0:f.age_from)||(null==f?void 0:f.age_to)||(null==g?void 0:g.goal)||(null==f?void 0:f.pref_personality_type))&&(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[((null==f?void 0:f.gender)||(null==f?void 0:f.age_from)||(null==f?void 0:f.age_to))&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(null==f?void 0:f.gender)==="male"?(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}):(null==f?void 0:f.gender)==="female"?(0,t.jsx)("svg",{className:"w-4 h-4 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}):(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:(null==f?void 0:f.age_from)&&(null==f?void 0:f.age_to)?"".concat(f.age_from,"-").concat(f.age_to):(null==f?void 0:f.age_from)?"від ".concat(f.age_from):(null==f?void 0:f.age_to)?"до ".concat(f.age_to):"Будь-який вік"})]}),(null==g?void 0:g.goal)&&Array.isArray(g.goal)&&g.goal.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.goal})]}),(null==f?void 0:f.pref_personality_type)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:f.pref_personality_type})]})]})}),((null==g?void 0:g.traits)&&(Array.isArray(g.traits)&&g.traits.length>0||"string"==typeof g.traits&&g.traits.trim())||(null==g?void 0:g.hobbies)&&(Array.isArray(g.hobbies)&&g.hobbies.length>0||"string"==typeof g.hobbies&&g.hobbies.trim())||(null==g?void 0:g.movie_genres)&&Array.isArray(g.movie_genres)&&g.movie_genres.length>0||(null==g?void 0:g.music_genres)&&Array.isArray(g.music_genres)&&g.music_genres.length>0||(null==g?void 0:g.religion))&&(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Риси та захоплення"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(r=[],Array.isArray(null==g?void 0:g.traits)?r=g.traits:"string"==typeof(null==g?void 0:g.traits)&&(r=g.traits.split(",").map(e=>e.trim()).filter(e=>e)),r.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-blue-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"trait-".concat(s)))),(a=[],Array.isArray(null==g?void 0:g.hobbies)?a=g.hobbies:"string"==typeof(null==g?void 0:g.hobbies)&&(a=g.hobbies.split(",").map(e=>e.trim()).filter(e=>e)),a.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l.707.707A1 1 0 0012.414 11H15m-3 7.5A9.5 9.5 0 1121.5 12 9.5 9.5 0 0112 2.5z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"hobby-".concat(s)))),(null==g?void 0:g.movie_genres)&&Array.isArray(g.movie_genres)&&g.movie_genres.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-purple-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"movie-".concat(s))),(null==g?void 0:g.music_genres)&&Array.isArray(g.music_genres)&&g.music_genres.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-orange-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"music-".concat(s))),(null==g?void 0:g.religion)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-violet-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.religion})]})]})]}),((null==g?void 0:g.education)||(null==g?void 0:g.occupation)||(null==g?void 0:g.field_of_work)||(null==g?void 0:g.language)||(null==g?void 0:g.level_of_english)||(null==g?void 0:g.other_langs)||(null==g?void 0:g.other_languages))&&(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Освіта та зайнятість"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(null==g?void 0:g.education)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-indigo-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsxs)("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 14l9-5-9-5-9 5 9 5z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"})]}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.education})]}),(null==g?void 0:g.occupation)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-teal-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-teal-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m8 0V8a2 2 0 01-2 2H8a2 2 0 01-2-2V6m8 0H8"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.occupation})]}),(null==g?void 0:g.field_of_work)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-cyan-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.field_of_work})]}),(null==g?void 0:g.language)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-emerald-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.language})]}),(null==g?void 0:g.level_of_english)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-amber-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.level_of_english})]}),(i=[],(null==g?void 0:g.other_langs)&&"string"==typeof g.other_langs?i=g.other_langs.split(",").map(e=>e.trim()).filter(e=>e):(null==g?void 0:g.other_languages)&&"string"==typeof g.other_languages?i=g.other_languages.split(",").map(e=>e.trim()).filter(e=>e):Array.isArray(null==g?void 0:g.other_languages)&&(i=g.other_languages),i.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-rose-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-rose-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-9 0V1m10 3V1m0 3l1 1v16a2 2 0 01-2 2H6a2 2 0 01-2-2V5l1-1z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"other-lang-".concat(s))))]})]}),((null==g?void 0:g.marital_status)||(null==g?void 0:g.count_children)!==void 0&&(null==g?void 0:g.count_children)>=0)&&(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Сім'я"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(null==g?void 0:g.marital_status)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.marital_status})]}),(null==g?void 0:g.count_children)!==void 0&&(null==g?void 0:g.count_children)>=0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-lime-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-lime-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:0===g.count_children?"Немає дітей":"".concat(g.count_children," ").concat(1===g.count_children?"дитина":g.count_children<5?"дитини":"дітей")})]})]})]}),(()=>{let e=(null==g?void 0:g.drinking)&&0!==parseFloat(String(g.drinking)),s=(null==g?void 0:g.height)&&0!==parseFloat(String(g.height)),r=(null==g?void 0:g.smoking)&&0!==parseFloat(String(g.smoking)),l=(null==g?void 0:g.weight)&&0!==parseFloat(String(g.weight));return e||s||r||l?(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Звички та зовнішність"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(()=>{let e=null==g?void 0:g.drinking;return 0!==(e?parseFloat(String(e)):0)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-amber-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:["Алкоголь: ",e]})]})})(),(()=>{let e=null==g?void 0:g.height;return 0!==(e?parseFloat(String(e)):0)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-cyan-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7l-2-2-2 2m0 0l-2 2 2 2m0-2V21M8 7h8M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-2"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[e," см"]})]})})(),(()=>{let e=null==g?void 0:g.smoking;return 0!==(e?parseFloat(String(e)):0)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:["Куріння: ",e]})]})})(),(()=>{let e=null==g?void 0:g.weight;return 0!==(e?parseFloat(String(e)):0)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-pink-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M6 7l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M9 8l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M12 9l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[e," кг"]})]})})()]})]}):null})(),(null==g?void 0:g.description)&&(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Опис"}),(0,t.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed",children:(()=>{var e=String(g.description);let t=document.createElement("textarea");return t.innerHTML=e,t.value})()})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)(W,{label:"Волосся",value:null==g?void 0:g.color_hair}),(0,t.jsx)(W,{label:"Очі",value:null==g?void 0:g.color_eye}),(0,t.jsx)(W,{label:"Статура",value:null==g?void 0:g.body_type}),(0,t.jsx)(W,{label:"Шукаю",value:null==g?void 0:g.looking_for})]}),(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)(W,{label:"Створено",value:N})})]})]}),P&&(0,t.jsxs)("div",{className:"fixed inset-0 z-[80] flex items-center justify-center",onClick:()=>z(null),children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/80"}),(0,t.jsx)("img",{src:P,alt:"full",className:"relative max-w-[95vw] max-h-[95vh] object-contain rounded"})]})]})]})}let N=e=>{let{label:s,value:r}=e;return r&&""!==String(r).trim()?(0,t.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-600",children:s}),(0,t.jsx)("span",{className:"text-sm text-gray-900",children:r})]}):null},k=e=>{let{isOpen:r,onClose:a,profileId:i}=e,[n,o]=(0,s.useState)(null),[c,d]=(0,s.useState)(!1),[u,h]=(0,s.useState)(null);(0,s.useEffect)(()=>{r&&i&&m()},[r,i]);let m=async()=>{d(!0),h(null);try{let e=await (0,l.apiGet)("/profiles/".concat(i,"/profile-data"));e.profileData?o(e.profileData):h("Не вдалося завантажити дані профілю")}catch(e){h(e.message||"Сталася помилка при завантаженні")}finally{d(!1)}},x=null==n?void 0:n.personal,g=null==n?void 0:n.preferences,p=(0,s.useMemo)(()=>{if(!(null==x?void 0:x.date_birth))return null;try{return new Date(x.date_birth).toLocaleDateString("uk-UA",{day:"numeric",month:"long",year:"numeric"})}catch(e){return null}},[null==x?void 0:x.date_birth]);return r?(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto custom-scroll",children:[(0,t.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Мій публічний профіль"}),(0,t.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"px-6 py-4",children:[c&&(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),u&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,t.jsx)("p",{className:"text-red-700",children:u})}),n&&x&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:x.avatar_xl?(0,t.jsx)("img",{src:x.avatar_xl,alt:x.name||"Avatar",className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:x.name}),x.age&&(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:[x.age," років"]}),(x.city||x.country)&&(0,t.jsx)("p",{className:"text-sm text-gray-600",children:[x.city,x.country].filter(Boolean).join(", ")})]})]}),(()=>{let e=(null==x?void 0:x.drinking)?parseFloat(String(x.drinking)):0,s=(null==x?void 0:x.height)&&0!==parseFloat(String(x.height)),r=(null==x?void 0:x.smoking)?parseFloat(String(x.smoking)):0,l=(null==x?void 0:x.weight)&&0!==parseFloat(String(x.weight)),a=(null==x?void 0:x.color_hair)&&""!==String(x.color_hair).trim(),i=(null==x?void 0:x.body_type)&&""!==String(x.body_type).trim(),n=(null==x?void 0:x.color_eye)&&""!==String(x.color_eye).trim(),o=(null==x?void 0:x.goal)&&Array.isArray(x.goal)&&x.goal.length>0;return 1===e||2===e||3===e||4===e||s||1===r||2===r||3===r||l||a||i||n||o?(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Звички та зовнішність"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(()=>{let e=(null==x?void 0:x.drinking)?parseFloat(String(x.drinking)):0,s="";return 1===e?s="Ніколи":2===e?s="За компанію":3===e?s="Іноді":4===e&&(s="Часто"),s&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-amber-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsxs)("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",role:"img","aria-label":"Cocktail icon",children:[(0,t.jsx)("path",{d:"M4 4h16l-8 9-8-9Z"}),(0,t.jsx)("path",{d:"M12 13v6"}),(0,t.jsx)("path",{d:"M7 21h10"}),(0,t.jsx)("path",{d:"M8.5 6.5l7 4"}),(0,t.jsx)("circle",{cx:"15.5",cy:"9",r:"1.4",fill:"currentColor",stroke:"none"})]}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:s})]})})(),(()=>{let e=(null==x?void 0:x.smoking)?parseFloat(String(x.smoking)):0,s="";return 1===e?s="Ніколи":2===e?s="За компанію":3===e&&(s="Так"),s&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsxs)("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 64 64",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round",role:"img","aria-label":"Cigarette icon",children:[(0,t.jsx)("rect",{x:"8",y:"28",width:"36",height:"8",rx:"1.5"}),(0,t.jsx)("line",{x1:"14",y1:"28",x2:"14",y2:"36"}),(0,t.jsx)("line",{x1:"22",y1:"28",x2:"22",y2:"36"}),(0,t.jsx)("rect",{x:"44",y:"28",width:"8",height:"8",rx:"1.5",fill:"currentColor",stroke:"none"}),(0,t.jsx)("path",{d:"M56 20c-4 6 4 8 0 14",stroke:"currentColor"})]}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:s})]})})(),(()=>{let e=null==x?void 0:x.color_hair;return e&&""!==String(e).trim()&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-purple-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2zM8 14v4m8-4v4m-4-4v4"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]})})(),(()=>{let e=null==x?void 0:x.body_type;return e&&""!==String(e).trim()&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-indigo-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]})})(),(()=>{let e=null==x?void 0:x.color_eye;return e&&""!==String(e).trim()&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-teal-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsxs)("svg",{className:"w-4 h-4 text-teal-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]})})(),(()=>{let e=null==x?void 0:x.height;return 0!==(e?parseFloat(String(e)):0)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-cyan-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7l-2-2-2 2m0 0l-2 2 2 2m0-2V21M8 7h8M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-2"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[e," см"]})]})})(),(()=>{let e=null==x?void 0:x.weight;return 0!==(e?parseFloat(String(e)):0)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-pink-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M6 7l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M9 8l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M12 9l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1"})}),(0,t.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[e," кг"]})]})})(),(null==x?void 0:x.goal)&&Array.isArray(x.goal)&&x.goal.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-purple-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"goal-".concat(s))),(null==g?void 0:g.pref_personality_type)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:g.pref_personality_type})]})]})]}):null})(),(()=>{let e=(null==x?void 0:x.traits)&&(Array.isArray(x.traits)&&x.traits.length>0||"string"==typeof x.traits&&x.traits.trim()),s=(null==x?void 0:x.hobbies)&&(Array.isArray(x.hobbies)&&x.hobbies.length>0||"string"==typeof x.hobbies&&x.hobbies.trim()),r=null==x?void 0:x.religion;return e||s||r?(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Риси та захоплення"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(()=>{let e=[];return Array.isArray(null==x?void 0:x.traits)?e=x.traits:"string"==typeof(null==x?void 0:x.traits)&&x.traits&&(e=x.traits.split(",").map(e=>e.trim()).filter(e=>e)),e.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-blue-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"trait-".concat(s)))})(),(()=>{let e=[];return Array.isArray(null==x?void 0:x.hobbies)?e=x.hobbies:"string"==typeof(null==x?void 0:x.hobbies)&&x.hobbies&&(e=x.hobbies.split(",").map(e=>e.trim()).filter(e=>e)),e.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l.707.707A1 1 0 0012.414 11H15m-3 7.5A9.5 9.5 0 1121.5 12 9.5 9.5 0 0112 2.5z"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:e})]},"hobby-".concat(s)))})(),(null==x?void 0:x.religion)&&(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-violet-50 px-2 py-1 rounded-full w-fit",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),(0,t.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:x.religion})]})]})]}):null})(),(null==x?void 0:x.description)&&(0,t.jsxs)("div",{className:"mt-6 mb-4",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Про мене"}),(0,t.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed",children:(e=>{let t=document.createElement("textarea");return t.innerHTML=e,t.value})(String(x.description))})]}),(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)(N,{label:"Шукаю",value:null==x?void 0:x.looking_for})}),(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)(N,{label:"Створено",value:p})})]})]})]})}):null};function C(){var e,d,m,g,f,j,N;let C=(0,r.useRouter)(),S=(0,r.useSearchParams)(),L=(0,r.useParams)().dialogId,M=(0,s.useRef)();M.current||(M.current=new y),(0,s.useEffect)(()=>{let e=M.current;return()=>{e.cleanup()}},[]),M.current;let[_,E]=(0,s.useState)([]),[P,z]=(0,s.useState)(""),[A,I]=(0,s.useState)(null),[B,W]=(0,s.useState)(null),[T,F]=(0,s.useState)(null),[V,R]=(0,s.useState)(!0),[D,H]=(0,s.useState)(!0),[U,O]=(0,s.useState)(!1),[G,q]=(0,s.useState)(!0),[J,K]=(0,s.useState)(null),[X,Y]=(0,s.useState)(null),[Z,Q]=(0,s.useState)(null),[$,ee]=(0,s.useState)(!1),[et,es]=(0,s.useState)(!1),[er,el]=(0,s.useState)(null),[ea,ei]=(0,s.useState)(!1),en=(0,s.useRef)(null),eo=(0,s.useRef)(null),ec=(0,s.useRef)(null),ed=(0,s.useRef)(0),eu=(0,s.useRef)(null),eh=(0,s.useRef)(null),em=(0,s.useRef)(!0),[ex,eg]=(0,s.useState)(!1),[ep,ef]=(0,s.useState)(!1),[ev,ej]=(0,s.useState)(!1),[ey,eb]=(0,s.useState)(!1),[ew,eN]=(0,s.useState)(!1),[ek,eC]=(0,s.useState)([]),[eS,eL]=(0,s.useState)(!1),[eM,e_]=(0,s.useState)(0),eE=(0,s.useRef)(null),[eP,ez]=(0,s.useState)(null),[eA,eI]=(0,s.useState)(!1),[eB,eW]=(0,s.useState)(!1),[eT,eF]=(0,s.useState)([]),[eV,eR]=(0,s.useState)(!1),[eD,eH]=(0,s.useState)(""),[eU,eO]=(0,s.useState)(!0),[eG,eq]=(0,s.useState)(!1),[eJ,eK]=(0,s.useState)(!1),[eX,eY]=(0,s.useState)(!1),[eZ,eQ]=(0,s.useState)(!1);(0,s.useEffect)(()=>{try{let e=null==S?void 0:S.get("openEmailHistory"),t=null==S?void 0:S.get("corrId");"1"===e&&(eb(!0),t&&t!==L&&(window.__emailCorrOverride=t))}catch(e){}},[S,L]);let[e$,e0]=(0,s.useState)(null),[e1,e2]=(0,s.useState)(!1),e4=(0,s.useRef)(!1),e5=(0,s.useRef)(null),[e3,e6]=(0,s.useState)(null),[e8,e7]=(0,s.useState)(!1),[e9,te]=(0,s.useState)(""),[tt,ts]=(0,s.useState)(!1),[tr,tl]=(0,s.useState)(!1),[ta,ti]=(0,s.useState)([]),[tn,to]=(0,s.useState)(void 0),[tc,td]=(0,s.useState)(!1),[tu,th]=(0,s.useState)(""),[tm,tx]=(0,s.useState)([]),[tg,tp]=(0,s.useState)([]),[tf,tv]=(0,s.useState)([]),[tj,ty]=(0,s.useState)([]);(0,s.useEffect)(()=>(window.activeLottieInstances||(window.activeLottieInstances=new Map),()=>{tb()}),[]);let tb=(0,s.useCallback)(()=>{console.log("🧹 Cleaning up Lottie animations..."),window.activeLottieInstances&&(window.activeLottieInstances.forEach((e,t)=>{try{e&&"function"==typeof e.destroy&&(e.destroy(),console.log("✅ Destroyed Lottie animation: ".concat(t))),e&&"function"==typeof e.removeEventListener&&(e.removeEventListener("data_ready"),e.removeEventListener("error"),e.removeEventListener("complete"))}catch(e){console.warn("⚠️ Error destroying Lottie animation ".concat(t,":"),e)}}),window.activeLottieInstances.clear()),"undefined"!=typeof document&&document.querySelectorAll("[data-lottie-url]").forEach(e=>{e instanceof HTMLElement&&(e.innerHTML="")})},[]),tw=(0,s.useCallback)(()=>{if(console.log("🧹 Cleaning up active requests..."),e5.current)try{e5.current.abort(),console.log("✅ Cancelled active gift loading request")}catch(e){console.warn("⚠️ Error aborting request:",e)}finally{e5.current=null,e4.current=!1}eR(!1),O(!1),H(!1)},[]),tN=async(e,t)=>{try{console.log("🎭 Loading Lottie for gift:",t.name,t.animationSrc),window.lottie||await new Promise((e,t)=>{let s=document.createElement("script");s.src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js",s.onload=()=>{console.log("✅ Lottie library loaded"),e()},s.onerror=()=>{console.error("❌ Failed to load Lottie library"),t(Error("Failed to load Lottie"))},document.head.appendChild(s)});let s=await fetch(t.animationSrc);if(!s.ok)throw Error("Failed to fetch Lottie data: "+s.status);let r=await s.json();console.log("🎭 Lottie data loaded for:",t.name),e.innerHTML="";let l=window.lottie.loadAnimation({container:e,animationData:r,renderer:"svg",loop:!0,autoplay:!0,rendererSettings:{preserveAspectRatio:"xMidYMid meet"}}),a=t.id+"-"+Date.now();window.activeLottieInstances&&window.activeLottieInstances.set(a,l),l.addEventListener("data_ready",()=>{console.log("✅ Lottie animation loaded and playing for:",t.name)}),l.addEventListener("error",s=>{console.error("❌ Lottie animation error for:",t.name,s),tk(e,t)})}catch(s){console.error("❌ Failed to load Lottie for:",t.name,s),tk(e,t)}},tk=(e,t)=>{let s=t.animationSrc.replace(".json",".png"),r=new Image;r.onload=()=>{e.innerHTML='<img src="'+s+'" class="w-full h-full object-cover" alt="Static version" />'},r.onerror=()=>{e.innerHTML='<div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-purple-100"><div class="text-center"><div class="text-2xl mb-1">🎭</div><div class="text-xs text-gray-600">Lottie анімація</div></div></div>'},r.src=s},tC=(0,s.useRef)(null),[tS,tL]=L.split("-").map(Number);console.log("🔢 Dialog parsing:",{dialogId:L,idProfile:tS,idRegularUser:tL}),(0,s.useEffect)(()=>{if(!(0,a.getSession)())return void C.replace("/login");em.current=!0,ed.current=0,eu.current&&(clearTimeout(eu.current),eu.current=null),eh.current&&(clearTimeout(eh.current),eh.current=null),(async()=>{try{let[s,r]=L.split("-"),a=parseInt(s),i=parseInt(r);if(Number.isFinite(a)&&Number.isFinite(i)){var e,t;let s=await (0,l.apiPost)("/api/chats/connections",{profileId:a,idsInterlocutor:[i]}),r=!!(null==s||null==(t=s.data)||null==(e=t[0])?void 0:e.blockedByInterlocutor);"function"==typeof eN&&eN(r)}}catch(e){}tM()})(),t_(),tE()},[L,C]),(0,s.useEffect)(()=>{(null==B?void 0:B.id)&&!eA&&!eP&&tz()},[null==B?void 0:B.id,eA,eP]);let tM=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];try{e?(R(!0),E([]),K(null),q(!0)):O(!0);let t=new URLSearchParams;J&&!e&&t.set("cursor",J.toString());let s="/api/chats/dialogs/".concat(encodeURIComponent(L),"/messages").concat(t.toString()?"?"+t.toString():""),r=await (0,l.apiGet)(s),a=(r.messages||[]).sort((e,t)=>new Date(e.dateCreated).getTime()-new Date(t.dateCreated).getTime());if(e)E(a),a.length>0&&K(a[0].id);else{let e=new Set(_.map(e=>e.id)),t=a.filter(t=>!e.has(t.id));if(console.log("📄 Pagination: loaded ".concat(a.length," messages, ").concat(t.length," new, ").concat(a.length-t.length," duplicates filtered")),0===t.length?(console.log("⏹️ No new messages after filtering, stopping pagination"),q(!1)):E(e=>[...t,...e]),a.length>0){let e=a[0].id;K(t=>t!==e?e:t)}}if(e)q(!1!==r.hasMore&&a.length>0);else{let e=new Set(_.map(e=>e.id)),t=a.filter(t=>!e.has(t.id)),s=t.length>0;console.log("📊 Pagination check: received ".concat(a.length,", new ").concat(t.length,", hasMore=").concat(r.hasMore)),q(!1!==r.hasMore&&s)}}catch(t){console.error("Failed to load messages:",t),e&&E([])}finally{e?(R(!1),em.current=!0):(O(!1),eh.current=setTimeout(()=>{em.current=!0,console.log("✅ Pagination unlocked, can load more")},100))}},t_=async()=>{try{H(!0);let s=await (0,l.apiGet)("/api/chats/profiles?ids=".concat(tL));s.profiles&&s.profiles.length>0&&I(s.profiles[0]);let r=(await (0,l.apiGet)("/profiles/my")).find(e=>e.profileId===tS.toString());if(r){var e,t;W(r);let s=await (0,l.apiGet)("/profiles/".concat(r.id,"/profile-data"));(null==(t=s.profileData)||null==(e=t.personal)?void 0:e.avatar_large)&&F(s.profileData.personal.avatar_large)}}catch(e){console.error("Failed to load user/profile data:",e)}finally{H(!1)}},tE=async()=>{try{ee(!0);let e=localStorage.getItem("messagesLeft_".concat(L));e&&!isNaN(parseInt(e))?Y(parseInt(e)):(console.warn("No valid messagesLeft found in localStorage for ".concat(L)),Y(0));let t=await (0,l.apiGet)("/api/chats/dialogs/".concat(encodeURIComponent(L),"/restrictions"));if("number"==typeof t.lettersLeft?Q(t.lettersLeft):(console.warn("Invalid lettersLeft response:",t),Q(0)),tL&&tS){let e=await b(tS,tL);!function(e,t){let s=new Date().toLocaleTimeString();if(!t.success){console.log("🚫 [".concat(s,"] TalkTimes Restrictions Check FAILED for user ").concat(e,":")),console.log("   Error: ".concat(t.error));return}console.log("✅ [".concat(s,"] TalkTimes Restrictions Check SUCCESS for user ").concat(e,":")),console.log("   🎪 Exclusive Posts: ".concat(t.hasExclusivePosts?"⚡ ENABLED":"❌ DISABLED")),console.log("   📋 Categories: [".concat(t.categories.join(", "),"]")),t.hasExclusivePosts&&console.log("   🎯 This dialog supports EXCLUSIVE POSTS! Lightning icon will be shown.")}(tL,e),e.success?(tl(e.hasExclusivePosts),ti(e.categories),to(e.tier)):(tl(!1),ti([]),to(void 0))}}catch(e){console.error("Failed to load restrictions:",e),null===X&&Y(0),Q(0),tl(!1),ti([]),to(void 0)}finally{ee(!1)}},tP=async e=>{try{console.log("🎯 loadPostDetails called:",{idPost:e,dialogId:L,idProfile:tS,idRegularUser:tL}),e2(!0);let t=await (0,l.apiPost)("/api/chats/tt-post-details",{idPost:e,idProfile:tS,idInterlocutor:tL});console.log("📤 API request:",{idPost:e,idProfile:tS,idInterlocutor:tL}),t.success&&t.data?(e0(t.data),eQ(!0)):(console.error("Failed to load post details:",t.error),console.error("Не вдалося завантажити інформацію про пост"))}catch(e){console.error("Error loading post details:",e),console.error("Помилка при завантаженні поста")}finally{e2(!1)}},tz=async()=>{if(eA)return void console.log("🎁 Skipping loadGiftLimits - already loading");try{eI(!0),console.log("🎁 Loading gift limits for dialog:",L,"client:",tL);let e=await (0,l.apiPost)("/profiles/".concat(null==B?void 0:B.id,"/gift-limits"),{clientId:tL});e.success&&e.data?(console.log("✅ Gift limits loaded:",e.data),ez(e.data)):(console.warn("Failed to load gift limits:",e.error),ez(null))}catch(e){console.error("Failed to load gift limits:",e),ez(null)}finally{eI(!1)}},tA=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(e4.current)return void console.log("🎁 Skipping loadGifts - already loading");e5.current&&e5.current.abort(),e5.current=new AbortController;try{e4.current=!0,e?(eR(!0),eF([]),eH(""),eO(!0)):eR(!0),console.log("🎁 Loading gifts for client:",tL,"cursor:",eD),console.log("🎭 Mock mode:","disabled");let t=await (0,l.apiPost)("/profiles/".concat(null==B?void 0:B.id,"/gift-list"),{clientId:tL,cursor:e?"":eD,limit:30},{signal:e5.current.signal});t.success&&t.data?(console.log("✅ Gifts loaded:",t.data.items.length,"items"),t.data.items.slice(0,3).forEach((e,t)=>{var s,r,l;let a=e.imageSrc||e.animationSrc,i=!!e.animationSrc,n=(null==(s=e.animationSrc)?void 0:s.endsWith(".json"))?"JSON/Lottie":(null==(r=e.animationSrc)?void 0:r.endsWith(".gif"))||(null==(l=e.animationSrc)?void 0:l.includes("gif"))?"GIF":e.animationSrc?"Other":"Static";console.log("🎁 Gift ".concat(t+1,": ").concat(e.name).concat(i?" (".concat(n,")"):"",", src: ").concat(a)),console.log("🎁 Final URL for ".concat(e.name,":"),a.startsWith("http")||a.startsWith("//")?a.startsWith("//")?"https:".concat(a):a:"https://talkytimes.com".concat(a))}),e?eF(t.data.items):eF(e=>[...e,...t.data.items]),eH(t.data.cursor),eO(30===t.data.items.length)):(console.warn("Failed to load gifts:",t.error),eF([]),eO(!1))}catch(e){"AbortError"!==e.name?(console.error("❌ Failed to load gifts:",e),eF([]),eO(!1)):console.log("🎁 Gift loading was cancelled")}finally{eR(!1),e4.current=!1,e5.current=null}},tI=async()=>{try{let e=Date.now();if(tC.current&&tC.current.profileId===tS.toString()&&e-tC.current.timestamp<18e5){console.log("📋 Using cached stickers (age:",Math.round((e-tC.current.timestamp)/1e3),"seconds)"),eC(tC.current.data);return}eL(!0),console.log("📥 Loading stickers from server...");let t=await (0,l.apiPost)("/api/chats/stickers",{idInterlocutor:tL});t.categories&&Array.isArray(t.categories)?(eC(t.categories),tC.current={data:t.categories,timestamp:e,profileId:tS.toString()},console.log("✅ Loaded ".concat(t.categories.length," sticker categories and cached them"))):(console.warn("Invalid stickers response:",t),eC([]))}catch(e){console.error("Failed to load stickers:",e),tC.current=null,eC([])}finally{eL(!1)}},tB=async()=>{G&&!U&&!V&&J&&em.current&&(em.current=!1,console.log("🔄 Loading more messages with cursor: ".concat(J)),await tM(!1))};async function tW(){if(P.trim()){await (0,l.apiPost)("/api/chats/dialogs/".concat(encodeURIComponent(L),"/text"),{text:P}),z("");try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:tS,clientId:tL,kind:"text"}}))}catch(e){}}}(0,s.useEffect)(()=>((0,a.getAccessToken)(),window.location.origin,()=>{eu.current&&clearTimeout(eu.current),eh.current&&clearTimeout(eh.current)}),[L,tS,tL]),(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(ev&&ej(!1),eB&&eW(!1),e8&&e7(!1),ey&&eb(!1))};return(ev||eB||e8||ey)&&document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[ev,eB,e8,ey]),(0,s.useEffect)(()=>{eB||e8||(tb(),tw())},[eB,e8]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{ec.current&&(ec.current.focus(),tT(ec.current))},100);return()=>clearTimeout(e)},[]),(0,s.useEffect)(()=>()=>{console.log("🧹 Component unmounting, cleaning up all resources..."),eu.current&&(clearTimeout(eu.current),eu.current=null),eh.current&&(clearTimeout(eh.current),eh.current=null),tb(),tw(),window.removeEventListener("beforeunload",tb),window.removeEventListener("unload",tb)},[]),function(e){let{profileId:t,dialogId:r,onMessage:l,onUserOnlineStatus:a,onDialogLimitChanged:i}=e,{getSocketForProfile:d,joinDialog:u,leaveDialog:h}=(0,n.useWebSocketPool)(),{showToast:m}=(0,o.useToast)(),[x,g]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(!t||!r)return;let e=setTimeout(()=>{u(t,r)},50);return()=>{clearTimeout(e),h(t,r)}},[t,r,u,h]),(0,s.useEffect)(()=>{t&&g(d(t))},[t,d]),(0,s.useEffect)(()=>{if(!x)return;let e=e=>{null==l||l(e)},s=e=>{null==a||a(e)},r=e=>{null==i||i(e)},n=e=>{var s,r;if((null==(r=e.idUserFrom)||null==(s=r.toString)?void 0:s.call(r))===t)return;let l=e.type||"new_message",a=e.messageId||e.emailId||e.id||e.dialogId||"",i=e.dateCreated||"",n="".concat(l,":").concat(a,":").concat(i),o=Date.now();for(let[e,t]of c)o-t>3e4&&c.delete(e);let d=c.get(n);d&&o-d<=3e4||(c.set(n,o),m({messageId:e.messageId,idUserFrom:e.idUserFrom,idUserTo:e.idUserTo,dateCreated:e.dateCreated,type:"new_email"===l?"new_email":"new_message",dialogId:e.dialogId}))};return x.on("message",e),x.on("user_online_status",s),x.on("message_toast",n),x.on("dialog_limit_changed",r),()=>{x.off("message",e),x.off("user_online_status",s),x.off("message_toast",n),x.off("dialog_limit_changed",r)}},[x,l,a]),null==x||x.connected}({profileId:tS.toString(),dialogId:L,onMessage:e=>{var t,s,r,l;console.log("📨 RTM Pool: Received new message",e);let a={id:Number(e.id)||Date.now(),idUserFrom:Number(e.idUserFrom),idUserTo:Number(e.idUserTo),type:e.type||"text",dateCreated:(()=>{let t=new Date(e.dateCreated||Date.now());return isNaN(t.getTime())?new Date().toISOString():t.toISOString()})(),content:{message:(null==(t=e.content)?void 0:t.message)||(null==(s=e.message)?void 0:s.message)||e.text||"",url:null==(r=e.content)?void 0:r.url,id:null==(l=e.content)?void 0:l.id}};E(e=>{if(e.some(e=>e.id===a.id))return e;if("sticker"===a.type&&a.idUserFrom===tS){let t=e.findIndex(e=>"sticker"===e.type&&e.idUserFrom===tS&&e.idUserTo===tL&&e.content.id===a.content.id&&!0===e.isSending);if(-1!==t){let s=[...e];return s[t]=a,s.sort((e,t)=>new Date(e.dateCreated).getTime()-new Date(t.dateCreated).getTime())}}let t=[...e,a].sort((e,t)=>new Date(e.dateCreated).getTime()-new Date(t.dateCreated).getTime());return a.idUserFrom===tS&&(()=>{if(X&&X>0){let e=X-1;Y(e),localStorage.setItem("messagesLeft_".concat(L),e.toString())}})(),t}),setTimeout(()=>{var e;null==(e=en.current)||e.scrollIntoView({behavior:"smooth"})},100)},onUserOnlineStatus:e=>{console.log("👤 RTM Pool: User online status changed",e),e.userId===tL&&I(t=>t?{...t,is_online:e.isOnline}:null)},onDialogLimitChanged:e=>{if(e.idUser===tS&&e.idInterlocutor===tL){var t;Y(null!=(t=e.limitLeft)?t:X),"number"==typeof e.limitLeft&&localStorage.setItem("messagesLeft_".concat(L),String(e.limitLeft))}}});let tT=e=>{e.style.height="auto";let t=Math.min(e.scrollHeight,120);e.style.height=t+"px"},tF=async e=>{console.log("Selected photos:",e);let t={id:Date.now(),dateCreated:new Date().toISOString(),idUserFrom:tS,idUserTo:tL,type:"photo_batch",content:{photos:e.map(e=>({id:e.idPhoto,url:e.urls.urlPreview}))},isSending:!0};E(e=>[...e,t].sort((e,t)=>new Date(e.dateCreated).getTime()-new Date(t.dateCreated).getTime())),setTimeout(()=>{var e;return null==(e=en.current)?void 0:e.scrollIntoView({behavior:"smooth"})},50),eg(!1)},tV=async e=>{console.log("🎁 Selected gift:",e),console.log("Dialog info:",{idProfile:tS,idRegularUser:tL}),eW(!1),e6(e),te(""),e7(!0)},tR=async()=>{if(e3&&(null==B?void 0:B.id))try{ts(!0),console.log("📤 Sending gift:",{giftId:e3.id,fromProfile:B.id,toClient:tL,message:e9});let e=await (0,l.apiPost)("/profiles/".concat(B.id,"/send-gift"),{clientId:tL,giftId:e3.id,message:e9});if(e.success){console.log("✅ Gift sent successfully:",e.data),console.log('🎁 Подарунок "'.concat(e3.name,'" відправлено!')),e7(!1),e6(null),te(""),tz();try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:tS,clientId:tL,kind:"gift"}}))}catch(e){}}else console.error("❌ Failed to send gift:",e.error),console.error("❌ Помилка відправки: ".concat(e.error||"Невідома помилка"))}catch(e){console.error("❌ Error sending gift:",e),console.error("❌ Помилка відправки: ".concat(e.message||"Невідома помилка"))}finally{ts(!1)}},tD=async e=>{console.log("Selected sticker:",e),console.log("Dialog info:",{idProfile:tS,idRegularUser:tL});let t={id:Date.now(),dateCreated:new Date().toISOString(),idUserFrom:tS,idUserTo:tL,type:"sticker",content:{id:e.id,url:e.url},isSending:!0};E(e=>[...e,t].sort((e,t)=>new Date(e.dateCreated).getTime()-new Date(t.dateCreated).getTime())),setTimeout(()=>{var e;null==(e=en.current)||e.scrollIntoView({behavior:"smooth"})},100),ej(!1);try{let s=await (0,l.apiPost)("/api/chats/send-sticker",{stickerId:e.id,idRegularUser:tL,idProfile:tS});if(s.success){console.log("✅ Successfully sent sticker"),E(e=>e.map(e=>e.id===t.id?{...e,isSending:!1}:e));try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:tS,clientId:tL,kind:"sticker"}}))}catch(e){}}else console.error("Failed to send sticker:",s.error),E(e=>e.map(e=>e.id===t.id?{...e,isSending:!1,error:!0}:e))}catch(s){console.error("Error sending sticker:",s),console.error("Request details:",{stickerId:e.id,idRegularUser:tL,idProfile:tS}),E(e=>e.map(e=>e.id===t.id?{...e,isSending:!1,error:!0}:e))}},tH=async e=>{try{var t,s;es(!0),ei(!0),el(e);let r=await (0,l.apiPost)("/api/chats/photo-original",{profileId:tS.toString(),idRegularUser:tL,previewUrl:e}),a=r&&(r.url||(null==(t=r.data)?void 0:t.url))?r.url||(null==(s=r.data)?void 0:s.url):null;a&&el(a)}catch(e){}finally{ei(!1)}},tU=e=>{let t=new Date(e);if(isNaN(t.getTime()))return"—";let s=t.toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric"}),r=t.toLocaleTimeString("uk-UA",{hour:"2-digit",minute:"2-digit"});return"".concat(s," ").concat(r)},[tO,tG]=(0,s.useState)(!1),[tq,tJ]=(0,s.useState)(!1);return(0,t.jsxs)("div",{className:"flex flex-col h-full",children:[D?(0,t.jsx)(i.ChatHeaderSkeleton,{}):(0,t.jsx)("div",{className:"bg-white border-b border-gray-200 p-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,t.jsx)("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200 cursor-pointer",onClick:()=>tG(!0),children:(null==A||null==(e=A.personal)?void 0:e.avatar_small)?(0,t.jsx)("img",{src:A.personal.avatar_small,alt:A.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-white bg-purple-500 text-sm font-medium",children:(null==A||null==(d=A.name)?void 0:d.charAt(0).toUpperCase())||"U"})}),(null==A?void 0:A.is_online)&&(0,t.jsx)("div",{className:"absolute top-0 left-0 w-3 h-3 bg-green-500 rounded-full border border-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:(null==A?void 0:A.name)||"Користувач ".concat(tL)}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:tL})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:(null==B?void 0:B.displayName)||"Невідомий"}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:tS})]}),(0,t.jsx)("div",{className:"relative flex-shrink-0",children:(0,t.jsx)("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200 cursor-pointer",onClick:()=>tJ(!0),children:T?(0,t.jsx)("img",{src:T,alt:(null==B?void 0:B.displayName)||"Profile",className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-white bg-blue-500 text-sm font-medium",children:(null==B||null==(m=B.displayName)?void 0:m.charAt(0).toUpperCase())||"P"})})})]})]})}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsxs)("div",{className:"absolute top-2 left-4 z-10 flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 bg-white/90 backdrop-blur-sm rounded-full px-2 py-1 shadow-sm border border-gray-200/50",children:[(0,t.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z",clipRule:"evenodd"})})}),$?(0,t.jsx)("div",{className:"w-4 h-3 bg-gray-200 rounded animate-pulse"}):(0,t.jsx)("span",{className:"text-xs font-medium ".concat(0===X?"text-red-600":X&&X<=3?"text-orange-600":"text-green-600"),children:null!=X?X:"—"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 bg-white/90 backdrop-blur-sm rounded-full px-2 py-1 shadow-sm border border-gray-200/50",children:[(0,t.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(0,t.jsxs)("svg",{className:"w-3 h-3 text-purple-600",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,t.jsx)("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),(0,t.jsx)("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]})}),$?(0,t.jsx)("div",{className:"w-4 h-3 bg-gray-200 rounded animate-pulse"}):(0,t.jsx)("span",{className:"text-xs font-medium ".concat(0===Z?"text-red-600":1===Z?"text-orange-600":Z&&Z>=2?"text-green-600":"text-gray-500"),children:null!=Z?Z:"—"})]}),(null==A?void 0:A.personal)&&(()=>{let e=(e=>{if(!e||"string"!=typeof e)return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:"Невідомо",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})};switch(e.toLowerCase()){case"real_love":return{iconColor:"text-red-600",textColor:"text-red-600",displayName:"Любов",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})})};case"friendship":return{iconColor:"text-blue-600",textColor:"text-blue-600",displayName:"Дружба",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"})})};case"hot_talks":return{iconColor:"text-pink-600",textColor:"text-pink-600",displayName:"Інтим",icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})})};default:return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:e,icon:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})}}})(A.personal.mood);return(0,t.jsxs)("div",{className:"flex items-center gap-1 bg-white/90 backdrop-blur-sm rounded-full px-2 py-1 shadow-sm border border-gray-200/50",children:[(0,t.jsx)("div",{className:"w-4 h-4 flex items-center justify-center ".concat(e.iconColor),children:e.icon}),(0,t.jsx)("span",{className:"text-xs font-medium ".concat(e.textColor),children:e.displayName})]})})()]})}),(0,t.jsx)("div",{ref:eo,className:"flex-1 overflow-auto p-4 bg-gray-50 flex flex-col-reverse custom-scroll",onScroll:e=>{let{scrollTop:t}=e.currentTarget;eu.current&&clearTimeout(eu.current);let s=t<ed.current;ed.current=t,t<=20&&s&&G&&!U&&!V&&J&&em.current&&(eu.current=setTimeout(()=>{console.log("🔄 At top! Triggering pagination: scrollTop=".concat(t,", canLoad=").concat(em.current)),tB()},300))},children:V?(0,t.jsxs)("div",{className:"space-y-2 flex flex-col-reverse",children:[(0,t.jsx)(i.MessageSkeleton,{isFromProfile:!1}),(0,t.jsx)(i.MessageSkeleton,{isFromProfile:!0}),(0,t.jsx)(i.MessageSkeleton,{isFromProfile:!1}),(0,t.jsx)(i.MessageSkeleton,{isFromProfile:!0}),(0,t.jsx)(i.MessageSkeleton,{isFromProfile:!1})]}):0===_.length?(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:(0,t.jsx)("p",{children:"Немає повідомлень"})}):(0,t.jsxs)("div",{className:"space-y-2 flex flex-col-reverse",children:[(0,t.jsx)("div",{ref:en}),_.slice().reverse().map((e,s)=>(e=>{var s,r,l,a,i,n,o,c,d,u,h,m;let x=e.idUserFrom===tS;e.idUserFrom;let g=String(null!=(u=e.id)?u:"".concat(e.idUserFrom,"-").concat(e.idUserTo,"-").concat(e.dateCreated||""))+"-".concat(null!=(h=e._idx)?h:0);return"system"===e.type?(0,t.jsx)("div",{className:"flex justify-center mb-4",children:(0,t.jsxs)("div",{className:"text-center text-gray-500 text-sm",children:[(null==(m=e.content)?void 0:m.message)&&(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words",children:e.content.message}),(0,t.jsx)("p",{className:"text-xs mt-1 text-gray-400",children:tU(e.dateCreated)})]})},g):(0,t.jsx)("div",{className:"flex ".concat(x?"justify-end":"justify-start"," mb-4"),children:(0,t.jsxs)("div",{className:"".concat("post"===e.type?"w-[240px]":"virtual_gift"===e.type?"w-40":"max-w-xs lg:max-w-md"," ").concat("photo_batch"===e.type||"photo"===e.type?"px-0 pt-0 pb-1":"virtual_gift"===e.type||"post"===e.type?"p-0":"px-4 py-2"," rounded-lg ").concat("post"===e.type&&(null==(s=e.content)?void 0:s.isPurchased)?"bg-purple-500 text-white":"like_newsfeed_post"===e.type||"wink"===e.type||"likephoto"===e.type?"bg-gray-200 text-gray-800":("reply_newsfeed_post"===e.type||"photo_batch"===e.type||"photo"===e.type||e.type,x?"bg-gray-200 text-gray-800":"bg-purple-500 text-white")," ").concat("post"===e.type?"cursor-pointer hover:opacity-90 transition-opacity":""),onClick:"post"===e.type?()=>{let t=e.content;(null==t?void 0:t.idPost)&&tP(t.idPost)}:void 0,children:[("message"===e.type||"text"===e.type)&&(null==(r=e.content)?void 0:r.message)&&(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:e.content.message}),"likephoto"===e.type&&(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{children:"❤️ Вподобав фото"}),(null==(l=e.content)?void 0:l.url)&&(0,t.jsx)("img",{src:e.content.url,alt:"Photo",className:"mt-2 rounded max-w-full h-auto"})]}),"wink"===e.type&&(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsx)("p",{children:"😉 Підморгнув"})}),"photo"===e.type&&(null==(a=e.content)?void 0:a.url)&&(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsx)("img",{src:e.content.url,alt:"Photo",className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>e.content.url&&tH(e.content.url)})}),"virtual_gift"===e.type&&e.content&&(()=>{let s=e.content;return(0,t.jsxs)("div",{className:"text-sm p-4",children:[s.imageSrc&&(0,t.jsx)("div",{className:"mb-2 -mx-4 -mt-4",children:(0,t.jsx)("img",{src:s.imageSrc,alt:"Virtual gift ".concat(s.id||""),className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>s.imageSrc&&tH(s.imageSrc)})}),(0,t.jsx)("div",{className:"inline-block text-xs px-2 py-1 rounded mb-2 ".concat(x?"bg-pink-600 text-white":"bg-pink-500 text-white"),children:"Віртуальний подарунок"}),s.message&&(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words italic text-black",children:s.message})]})})(),"photo_batch"===e.type&&(null==(n=e.content)||null==(i=n.photos)?void 0:i.length)>0&&(()=>{var s;let r=(null==(s=e.content)?void 0:s.photos)||[];if(1===r.length){let s=r[0];return(0,t.jsx)("div",{className:"text-sm",children:(0,t.jsx)("img",{src:s.url,alt:"Photo ".concat(s.id||0),className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>tH(s.url)},"".concat(e.id,"-").concat(s.id||0))})}let l=r.length>=5?3:2;return(0,t.jsx)("div",{className:"grid gap-0 text-sm ".concat(3===l?"grid-cols-3":"grid-cols-2"),children:r.map((s,r)=>(0,t.jsx)("img",{src:s.url,alt:"Photo ".concat(s.id||r),className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>tH(s.url)},"".concat(e.id,"-").concat(s.id||r)))})})(),"sticker"===e.type&&(null==(o=e.content)?void 0:o.url)&&(0,t.jsxs)("div",{className:"text-sm relative",children:[(0,t.jsx)("img",{src:e.content.url,alt:"Sticker ".concat(e.content.id||""),className:"max-w-[124px] max-h-[124px] object-contain rounded-md ".concat(e.isSending?"opacity-70":e.error?"opacity-50":"")}),e.isSending&&(0,t.jsx)("div",{className:"absolute -bottom-1 -right-1",children:(0,t.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"})})}),e.error&&(0,t.jsx)("div",{className:"absolute -bottom-1 -right-1",children:(0,t.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded-full flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})})]}),"like_newsfeed_post"===e.type&&e.content&&(()=>{let s=e.content,r=s.photos||[],l=r.length>0;return(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{className:"mb-2",children:"❤️ Уподобав ваш пост"}),l&&r.length>0&&(0,t.jsx)("div",{className:"mb-2",children:1===r.length?(0,t.jsx)("img",{src:r[0].url,alt:"Post photo",className:"rounded w-32 h-32 object-cover cursor-zoom-in",onClick:()=>tH(r[0].url)}):(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[r.slice(0,4).map((s,r)=>(0,t.jsx)("img",{src:s.url,alt:"Post photo ".concat(r+1),className:"rounded w-16 h-16 object-cover cursor-zoom-in",onClick:()=>tH(s.url)},"".concat(e.id,"-photo-").concat(r))),r.length>4&&(0,t.jsxs)("div",{className:"w-16 h-16 bg-gray-300 rounded flex items-center justify-center text-xs text-gray-600",children:["+",r.length-4]})]})}),s.text&&(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words italic text-sm opacity-75",children:s.text})]})})(),"reply_newsfeed_post"===e.type&&e.content&&(()=>{let s=e.content,r=s.photos||[],l=r.length>0;return(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{className:"text-xs mb-2 ".concat(x?"text-gray-500":"text-white"),children:"Відповів на пост"}),(s.text||l)&&(0,t.jsx)("div",{className:"mb-3 p-3 bg-gray-100 rounded-lg border-l-4 border-blue-500",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[l&&r.length>0&&(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("img",{src:r[0].url,alt:"Post preview",className:"rounded w-16 h-16 object-cover cursor-zoom-in",onClick:()=>tH(r[0].url)})}),s.text&&(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words text-sm italic text-gray-700",children:s.text})})]})}),s.replyText&&(0,t.jsx)("p",{className:"whitespace-pre-wrap break-words text-sm font-medium",children:s.replyText})]})})(),"post"===e.type&&e.content&&(()=>{let s=e.content,r=s.photos||[],l=r.length>0;return(0,t.jsxs)("div",{className:"text-sm p-4",children:[l&&(0,t.jsxs)("div",{className:"flex -mx-4 -mt-4 mb-2 overflow-hidden rounded-t-lg",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("div",{className:"relative w-40 h-40",children:[(0,t.jsx)("img",{src:r[0].url,alt:"Post photo 1",className:"w-full h-full object-cover"}),(0,t.jsx)("div",{className:"absolute top-2 left-2 text-xs px-2 py-1 rounded ".concat(s.isPurchased?"bg-purple-500 text-white":"bg-black/70 text-white"),children:s.isPurchased?"Переглянуто":"Не відкрито"})]})}),r.length>1&&(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"relative w-20 h-20",children:(0,t.jsx)("img",{src:r[1].url,alt:"Post photo 2",className:"w-full h-full object-cover"})}),r.length>2&&(0,t.jsxs)("div",{className:"relative w-20 h-20",children:[(0,t.jsx)("img",{src:r[2].url,alt:"Post photo 3",className:"w-full h-full object-cover"}),r.length>3&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,t.jsxs)("span",{className:"text-white font-bold text-sm",children:["+",r.length-3]})})]})]})]}),s.textPreview&&(0,t.jsx)("p",{className:"mt-2 whitespace-pre-wrap break-words",children:s.textPreview}),!l&&(0,t.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:s.idPost&&"Post ID: ".concat(s.idPost)})]})})(),!["message","text","likephoto","photo","photo_batch","sticker","system","post","virtual_gift","like_newsfeed_post","wink","reply_newsfeed_post"].includes(e.type)&&(0,t.jsxs)("div",{className:"text-sm italic text-gray-500",children:["Тип повідомлення: ",e.type,(null==(c=e.content)?void 0:c.message)&&(0,t.jsx)("p",{className:"mt-1",children:e.content.message})]}),(0,t.jsx)("p",{className:"text-xs mt-1 ml-2 ".concat("post"===e.type&&(null==(d=e.content)?void 0:d.isPurchased)||("photo_batch"===e.type||"photo"===e.type||"virtual_gift"===e.type)&&!x?"text-white":"like_newsfeed_post"===e.type||"wink"===e.type||"likephoto"===e.type?"text-gray-500":(e.type,x?"text-gray-500":"text-purple-200")),children:tU(e.dateCreated)})]})},g)})({...e,_idx:s})),U&&(0,t.jsx)("div",{className:"flex justify-center py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[(0,t.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-gray-300 border-t-purple-500 rounded-full"}),"Завантаження старіших повідомлень..."]})})]})}),(0,t.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:ew?(0,t.jsx)("div",{className:"text-center text-red-600 font-medium",children:"Вас було заблоковано"}):(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsx)("button",{onClick:()=>eg(!0),className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Прикріпити медіа",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,t.jsx)("button",{onClick:()=>eb(!0),className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Історія листування",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,t.jsx)("button",{onClick:()=>{ej(!0),e_(0),0===ek.length&&tI()},className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Вибрати стікер",children:(0,t.jsxs)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,t.jsx)("circle",{cx:"9",cy:"9",r:"1"}),(0,t.jsx)("circle",{cx:"15",cy:"9",r:"1"}),(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 14c1 1 3 1 5 0"})]})}),eP&&(eP.limit>0||eP.canSendWithoutLimit)&&(0,t.jsxs)("button",{onClick:()=>{eW(!0),0===eT.length&&tA()},className:"flex-shrink-0 p-2 text-pink-500 hover:text-pink-700 hover:bg-pink-50 rounded-lg transition-colors relative",title:"Віртуальні подарунки (".concat(eP.canSendWithoutLimit?"без ліміту":"".concat(eP.limit," залишилось"),")"),children:[(0,t.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),!eP.canSendWithoutLimit&&eP.limit>0&&(0,t.jsx)("span",{className:"absolute -top-1 -right-1 bg-pink-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",children:eP.limit>99?"99+":eP.limit})]}),tr&&(0,t.jsxs)("button",{onClick:()=>td(!0),className:"flex-shrink-0 p-2 rounded-lg transition-colors relative ".concat("specialplus"===tn?"text-red-600 hover:text-red-700":"text-yellow-500 hover:text-yellow-600"),title:"".concat("specialplus"===tn?"⚡ SpecialPlus":"⚡ Special"," — Категорії: ").concat(ta.join(", ")),children:[(0,t.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-lg opacity-20 animate-pulse ".concat("specialplus"===tn?"bg-red-500":"bg-yellow-400")}),"specialplus"===tn&&(0,t.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-white text-red-600 flex items-center justify-center text-[10px] font-extrabold leading-none",children:"+"})]}),(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsxs)("div",{className:"absolute top-0 right-2 text-xs z-10 ".concat(P.length>250?"text-red-500":P.length>200?"text-yellow-500":"text-gray-400"),children:[P.length,"/300"]}),(0,t.jsx)("textarea",{ref:ec,className:"w-full border border-gray-300 rounded-lg px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none overflow-hidden",placeholder:"Напишіть повідомлення...",value:P,onChange:e=>{z(e.target.value),tT(e.target)},onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&tW(),maxLength:300,rows:1,style:{minHeight:"48px",maxHeight:"120px"}}),(0,t.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>eq(!eG),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",title:"Додати емодзі",children:"😀"}),(0,t.jsx)(p,{isOpen:eG,onEmojiSelect:e=>{z(t=>t+e)},onClose:()=>eq(!1)})]})]}),(0,t.jsx)("button",{className:"bg-purple-500 hover:bg-purple-600 text-white w-10 h-10 rounded-lg transition-colors flex items-center justify-center",onClick:tW,title:"Надіслати повідомлення",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})}),(0,t.jsx)(u,{profileId:tS.toString(),isOpen:ex,onClose:()=>eg(!1),onPhotoSelect:tF,maxSelection:6,context:"chat",idRegularUser:tL,mode:"send",allowAudio:!0}),(0,t.jsx)(u,{profileId:tS.toString(),isOpen:ep,onClose:()=>ef(!1),onPhotoSelect:()=>{},maxSelection:6,context:"chat",idRegularUser:tL,mode:"attach",actionLabel:"Прикріпити",allowAudio:!1,allowedPhotoTabs:"specialplus"===tn?["special","special_plus"]:["special"],isSpecialPlusAllowed:"specialplus"===tn,onAttach:e=>{let{photos:t,videos:s}=e;tx(t.map(e=>e.idPhoto)),tp(s.map(e=>e.idVideo)),tv(t.map(e=>({idPhoto:e.idPhoto,url:e.urls.urlPreview}))),ty(s.map(e=>({idVideo:e.idVideo,url:e.urls.urlThumbnail}))),ef(!1)}}),(0,t.jsx)(v,{isOpen:ey,onClose:()=>eb(!1),profileId:tS.toString(),clientId:tL.toString(),correspondenceId:window.__emailCorrOverride||L,lettersLeft:Z}),tc&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl p-4 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Ексклюзивний пост"}),(0,t.jsx)("button",{onClick:()=>td(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("label",{className:"block text-sm text-gray-600 mb-1",children:["Текст (мінімум ",100," символів)"]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("textarea",{value:tu,onChange:e=>th(e.target.value),rows:4,className:"w-full border rounded-md p-2 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Введіть текст посту..."}),(0,t.jsxs)("div",{className:"absolute right-2 top-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>eK(!eJ),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",title:"Додати емодзі",children:"😀"}),(0,t.jsx)(p,{isOpen:eJ,onEmojiSelect:e=>{th(t=>t+e)},onClose:()=>eK(!1)})]})]}),(0,t.jsxs)("div",{className:"".concat(tu.length<100?"text-red-600":"text-gray-500"," text-sm mt-1"),children:["Залишилось: ",Math.max(0,100-tu.length)]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Прикріплені медіа"}),(0,t.jsx)("button",{onClick:()=>ef(!0),className:"px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 text-sm",children:"Додати з галереї"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[tf.map(e=>(0,t.jsxs)("div",{className:"relative w-16 h-16 rounded-md overflow-hidden border border-gray-200",children:[(0,t.jsx)("img",{src:e.url,alt:"Фото ".concat(e.idPhoto),className:"w-full h-full object-cover"}),(0,t.jsx)("button",{onClick:()=>{tx(t=>t.filter(t=>t!==e.idPhoto)),tv(t=>t.filter(t=>t.idPhoto!==e.idPhoto))},className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати фото",children:"✕"})]},"p-".concat(e.idPhoto))),tj.map(e=>(0,t.jsxs)("div",{className:"relative w-16 h-16 rounded-md overflow-hidden border border-gray-200",children:[(0,t.jsx)("img",{src:e.url,alt:"Відео ".concat(e.idVideo),className:"w-full h-full object-cover"}),(0,t.jsx)("span",{className:"absolute bottom-0 right-0 m-0.5 text-[10px] px-1 py-0.5 rounded bg-black/60 text-white",children:"▶"}),(0,t.jsx)("button",{onClick:()=>{tp(t=>t.filter(t=>t!==e.idVideo)),ty(t=>t.filter(t=>t.idVideo!==e.idVideo))},className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати відео",children:"✕"})]},"v-".concat(e.idVideo))),0===tm.length&&0===tg.length&&(0,t.jsx)("div",{className:"text-sm text-gray-400",children:"Нічого не прикріплено"})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"Правила: максимум 1 відео або 1 відео + будь-яка кількість фото, або ≥4 фото без відео. Special+ фото дозволені лише для tier=SpecialPlus."}),(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsx)("button",{onClick:()=>td(!1),className:"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200",children:"Скасувати"}),(0,t.jsx)("button",{onClick:async()=>{if(!(tu.length<100)){if(tg.length>0){if(tg.length>1)return}else if(tm.length>0&&tm.length<4)return;try{if((await (0,l.apiPost)("/api/chats/tt-send-post",{profileId:tS,idRegularUser:tL,idsGalleryPhotos:tm,idsGalleryVideos:tg,text:tu})).success){td(!1),th(""),tx([]),tp([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:tS,clientId:tL,kind:"post"}}))}catch(e){}}}catch(e){}}},disabled:tu.length<100||0===tg.length&&(0===tm.length||tm.length<4)||tg.length>1,className:"px-4 py-2 rounded-md bg-purple-600 text-white disabled:bg-gray-300",children:"Відправити"})]})]})]})}),ev&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:e=>{e.target===e.currentTarget&&ej(!1)},children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[85vh] overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Виберіть стікер"}),(0,t.jsx)("button",{onClick:()=>ej(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"flex h-[70vh]",children:eS?(0,t.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,t.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-gray-300 border-t-purple-500 rounded-full"}),"Завантаження стікерів..."]})}):0===ek.length?(0,t.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Не вдалося завантажити стікери"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-20 bg-gray-50 border-r border-gray-200 overflow-y-auto custom-scroll",children:(0,t.jsx)("div",{className:"p-2 space-y-2",children:ek.map((e,s)=>(0,t.jsx)("div",{onClick:()=>(e=>{e_(e);let t=document.getElementById("sticker-category-".concat(e));if(t&&eE.current){let e=eE.current,s=t.offsetTop,r=e.clientHeight,l=t.clientHeight;e.scrollTo({top:Math.max(0,s-r/2+l/2),behavior:"smooth"})}})(s),className:"cursor-pointer rounded-lg transition-all duration-200 p-1 m-1 ".concat(eM===s?"bg-purple-200 ring-2 ring-purple-400":"hover:bg-gray-200"),title:e.name,children:e.stickers.length>0&&(0,t.jsx)("img",{src:e.stickers[0].url,alt:e.name,className:"w-11 h-11 mx-auto object-cover rounded-md hover:scale-150 transition-transform",loading:"lazy"})},s))})}),(0,t.jsx)("div",{ref:eE,className:"flex-1 overflow-y-auto custom-scroll",children:(0,t.jsx)("div",{className:"p-3",children:ek.map((e,s)=>(0,t.jsx)("div",{id:"sticker-category-".concat(s),className:"mb-6 last:mb-0",children:(0,t.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 2xl:grid-cols-12 gap-3",children:e.stickers.map(e=>(0,t.jsx)("button",{onClick:()=>tD(e),className:"w-24 h-24 overflow-hidden hover:scale-150 transition-transform",title:"Стікер ".concat(e.id),children:(0,t.jsx)("img",{src:e.url,alt:"Sticker ".concat(e.id),className:"w-full h-full object-cover rounded-md",loading:"lazy"})},e.id))})},s))})})]})})]})}),eB&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Віртуальні подарунки"}),(0,t.jsx)("button",{onClick:()=>eW(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 custom-scroll",children:eV&&0===eT.length?(0,t.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,t.jsx)("div",{className:"text-gray-500",children:"Завантаження..."})}):0===eT.length?(0,t.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,t.jsx)("div",{className:"text-gray-500",children:"Немає доступних подарунків"})}):(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:eT.map(e=>(0,t.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:border-pink-300 transition-colors cursor-pointer",onClick:()=>tV(e),title:"".concat(e.name," - ").concat(e.cost," монет").concat(e.animationSrc?" (анімований)":""),children:[(0,t.jsx)("div",{className:"relative w-full aspect-square mb-2 bg-gray-100 rounded-md overflow-hidden",children:e.imageSrc||e.animationSrc?(0,t.jsxs)(t.Fragment,{children:[e.animationSrc&&e.animationSrc.endsWith(".json")?(0,t.jsxs)(x,{onError:(t,s)=>{console.error('🎭 Lottie error for gift "'.concat(e.name,'":'),t)},children:[(0,t.jsx)("div",{className:"w-full h-full","data-lottie-url":e.animationSrc,style:{background:"linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-3xl mb-2 animate-pulse",children:"💖"}),(0,t.jsx)("div",{className:"text-xs text-gray-600 font-medium",children:"Завантаження анімації..."}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Lottie"})]})}),(0,t.jsx)("div",{ref:t=>{t&&e.animationSrc&&!t.hasAttribute("data-lottie-loaded")&&(t.setAttribute("data-lottie-loaded","true"),t.setAttribute("data-gift-id",e.id.toString()),t.setAttribute("data-animation-src",e.animationSrc),setTimeout(()=>{tN(t,e)},100))},className:"w-full h-full","data-lottie-url":e.animationSrc,style:{background:"linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-3xl mb-2 animate-pulse",children:"💖"}),(0,t.jsx)("div",{className:"text-xs text-gray-600 font-medium",children:"Завантаження анімації..."}),(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Lottie"})]})}),(0,t.jsxs)("div",{className:"absolute top-1 right-1 bg-pink-500 text-white text-xs px-1 py-0.5 rounded flex items-center gap-0.5",children:["🎭",(0,t.jsx)("span",{className:"text-xs",children:"Lottie"})]})]}):e.animationSrc&&(e.animationSrc.endsWith(".gif")||e.animationSrc.includes("gif"))?(0,t.jsx)("img",{src:e.animationSrc.startsWith("http")||e.animationSrc.startsWith("//")?e.animationSrc.startsWith("//")?"https:".concat(e.animationSrc):e.animationSrc:"https://talkytimes.com".concat(e.animationSrc),alt:e.name,className:"w-full h-full object-cover",loading:"lazy",onError:t=>{console.error("GIF failed for ".concat(e.name,":"),t.target.src);let s=t.target;s.src="https://picsum.photos/64/64?random=".concat(e.id),s.onerror=null}}):(0,t.jsx)("img",{src:(e.imageSrc||e.animationSrc).startsWith("http")||(e.imageSrc||e.animationSrc).startsWith("//")?(e.imageSrc||e.animationSrc).startsWith("//")?"https:".concat(e.imageSrc||e.animationSrc):e.imageSrc||e.animationSrc:"https://talkytimes.com".concat(e.imageSrc||e.animationSrc),alt:e.name,className:"w-full h-full object-cover",loading:"lazy",onError:t=>{let s=t.target;e.animationSrc?s.src=e.animationSrc.replace(".json",".gif"):s.src="https://picsum.photos/64/64?random=".concat(e.id),s.onerror=null}}),e.animationSrc&&(0,t.jsxs)("div",{className:"absolute top-1 right-1 bg-pink-500 text-white text-xs px-1 py-0.5 rounded flex items-center gap-0.5",children:[e.animationSrc.endsWith(".json")?"🎭":"🎬",(0,t.jsx)("span",{className:"text-xs",children:e.animationSrc.endsWith(".json")?"JSON":e.animationSrc.endsWith(".gif")||e.animationSrc.includes("gif")?"GIF":"🎬"})]})]}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})}),(0,t.jsxs)("h4",{className:"text-xs font-medium text-gray-900 text-center mb-1 truncate flex items-center justify-center gap-1",children:[e.name,e.animationSrc&&(0,t.jsx)("span",{className:"text-pink-500 text-xs",title:e.animationSrc.endsWith(".json")?"Lottie анімація (JSON)":e.animationSrc.endsWith(".gif")||e.animationSrc.includes("gif")?"GIF анімація":"Анімований подарунок",children:e.animationSrc.endsWith(".json")?"🎭":"🎬"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1 text-xs text-pink-600 font-medium",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),e.cost]})]},e.id))})})]})}),e8&&e3&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Надіслати подарунок"}),(0,t.jsx)("button",{onClick:()=>e7(!1),className:"text-gray-400 hover:text-gray-600 p-1",disabled:tt,children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4 p-3 bg-pink-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"relative w-12 h-12 bg-gray-100 rounded-md overflow-hidden flex-shrink-0",children:[e3.imageSrc||e3.animationSrc?e3.animationSrc&&e3.animationSrc.endsWith(".json")?(0,t.jsx)(x,{onError:(e,t)=>{console.error('🎭 Lottie error in message modal for gift "'.concat(e3.name,'":'),e)},children:(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-purple-100",children:(0,t.jsx)("span",{className:"text-lg",children:"🎭"})})}):(0,t.jsx)("img",{src:(e3.imageSrc||e3.animationSrc).startsWith("http")||(e3.imageSrc||e3.animationSrc).startsWith("//")?(e3.imageSrc||e3.animationSrc).startsWith("//")?"https:".concat(e3.imageSrc||e3.animationSrc):e3.imageSrc||e3.animationSrc:"https://talkytimes.com".concat(e3.imageSrc||e3.animationSrc),alt:e3.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),e3.animationSrc&&(0,t.jsx)("div",{className:"absolute top-0 right-0 bg-pink-500 text-white text-xs px-1 py-0.5 rounded",children:"🎬"})]}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 truncate",children:e3.name}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm text-pink-600",children:[(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),e3.cost]})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{htmlFor:"gift-message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Особисте повідомлення (не обов'язково)"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("textarea",{id:"gift-message",value:e9,onChange:e=>te(e.target.value),placeholder:"Напишіть тепле повідомлення до подарунку...",className:"w-full px-3 py-2 pr-12 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 resize-none",rows:3,maxLength:200,disabled:tt}),(0,t.jsxs)("div",{className:"absolute right-2 top-2",children:[(0,t.jsx)("button",{type:"button",onClick:()=>eY(!eX),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors disabled:opacity-50",title:"Додати емодзі",disabled:tt,children:"😀"}),(0,t.jsx)(p,{isOpen:eX,onEmojiSelect:e=>{te(t=>t+e)},onClose:()=>eY(!1)})]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[e9.length,"/200"]})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:()=>e7(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:tt,children:"Відмінити"}),(0,t.jsx)("button",{onClick:tR,disabled:tt,className:"flex-1 px-4 py-2 bg-pink-500 hover:bg-pink-600 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:tt?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Надсилаю..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"Надіслати"]})})]})]})]})}),(0,t.jsx)(h,{isOpen:et,src:er,isLoading:ea,onClose:()=>es(!1)}),(null==B?void 0:B.id)&&(0,t.jsx)(w,{isOpen:tO,onClose:()=>tG(!1),profileId:B.id,clientId:tL}),(null==B?void 0:B.id)&&(0,t.jsx)(k,{isOpen:tq,onClose:()=>tJ(!1),profileId:B.id}),eZ&&e$&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Пост"}),(0,t.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(e$.isPurchased?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e$.isPurchased?"Переглянуто":"Не відкрито"})]}),(0,t.jsx)("button",{onClick:()=>eQ(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:(0,t.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 custom-scroll",children:[e$.dateSent&&(0,t.jsxs)("div",{className:"mb-4 text-sm text-gray-600",children:[(0,t.jsx)("strong",{children:"Дата відправки:"})," ",new Date(e$.dateSent).toLocaleString("uk-UA")]}),e$.text&&(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:e$.text})}),((null==(g=e$.photos)?void 0:g.length)>0||(null==(f=e$.videos)?void 0:f.length)>0)&&(0,t.jsxs)("div",{className:"space-y-4",children:[(null==(j=e$.photos)?void 0:j.length)>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Фото (",e$.photos.length,")"]}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:e$.photos.map((e,s)=>(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("img",{src:e.url,alt:"Photo ".concat(s+1),className:"w-full h-32 object-cover rounded-lg cursor-zoom-in hover:opacity-90 transition-opacity",onClick:()=>tH(e.url)})},e.id||s))})]}),(null==(N=e$.videos)?void 0:N.length)>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Відео (",e$.videos.length,")"]}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:e$.videos.map((e,s)=>(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("video",{src:e.url,className:"w-full h-32 object-cover rounded-lg",controls:!0})},e.id||s))})]})]}),e$.price&&(0,t.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Вартість:"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("svg",{className:"w-4 h-4 text-yellow-500",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,t.jsx)("span",{className:"font-medium",children:e$.price}),e$.priceWithDiscount&&e$.priceWithDiscount!==e$.price&&(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-1",children:["(",e$.priceWithDiscount,")"]})]})]}),e$.discountPercent>0&&(0,t.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:["Знижка: ",e$.discountPercent,"%"]})]})]})]})})]})}}]);