{"version":3,"sources":["turbopack:///[project]/apps/web/src/app/login/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useRouter } from 'next/navigation';\nimport { useState } from 'react';\nimport { setSession, type StoredSession } from '@/lib/session';\n\ntype JWTPayload = {\n\trule?: never;\n\trole?: 'OWNER' | 'OPERATOR';\n\tagencyCode?: string;\n\toperatorCode?: string;\n\tsub?: string;\n};\n\nfunction parseJwt(token: string): JWTPayload | unknown {\n\ttry {\n\t\tconst [, payload] = token.split('.');\n\t\treturn JSON.parse(atob(payload)) as JWTPayload;\n\t} catch {\n\t\treturn {} as const;\n\t}\n}\n\nexport default function LoginPage() {\n\tconst router = useRouter();\n\tconst [username, setUsername] = useState('');\n\tconst [password, setPassword] = useState('');\n\tconst [error, setError] = useState<string | null>(null);\n\n\tasync function submit(e: React.FormEvent) {\n\t\te.preventDefault();\n\t\tsetError(null);\n\t\ttry {\n\t\t\tconst base = typeof window !== 'undefined' ? window.location.origin : (process.env.NEXT_PUBLIC_API_URL ?? 'http://localhost:4000');\n\t\t\tconst res = await fetch(base + '/api/auth/login', {\n\t\t\t\tmethod: 'POST',\n\t\t\t\theaders: { 'content-type': 'application/json' },\n\t\t\t\tbody: JSON.stringify({ username, password }),\n\t\t\t});\n\t\t\tif (!res.ok) throw new Error('Невірні дані');\n\t\t\tconst { accessToken } = (await res.json()) as { accessToken: string };\n\t\t\tconst payload = parseJwt(accessToken) as JWTPayload;\n\t\t\tconst role: 'OWNER' | 'OPERATOR' = payload.role === 'OWNER' ? 'OWNER' : 'OPERATOR';\n\t\t\tconst s: StoredSession = { accessToken, agencyCode: payload.agencyCode ?? '', role, operatorCode: payload.operatorCode, userId: payload.sub };\n\t\t\tsetSession(s);\n\t\t\trouter.push(s.role === 'OWNER' ? '/owner' : '/dashboard');\n\t\t} catch (err) {\n\t\t\tsetError(err instanceof Error ? err.message : 'Помилка входу');\n\t\t}\n\t}\n\n\treturn (\n\t\t<div className=\"max-w-sm mx-auto p-6 space-y-4\">\n\t\t\t<h1 className=\"text-xl font-semibold\">Вхід</h1>\n\t\t\t<form onSubmit={submit} className=\"space-y-3\">\n\t\t\t\t<label className=\"block\">\n\t\t\t\t\t<span className=\"text-sm\">Username</span>\n\t\t\t\t\t<input className=\"border rounded px-2 py-1 w-full\" value={username} onChange={(e) => setUsername(e.target.value)} />\n\t\t\t\t</label>\n\t\t\t\t<label className=\"block\">\n\t\t\t\t\t<span className=\"text-sm\">Пароль</span>\n\t\t\t\t\t<input type=\"password\" className=\"border rounded px-2 py-1 w-full\" value={password} onChange={(e) => setPassword(e.target.value)} />\n\t\t\t\t</label>\n\t\t\t\t{error && <div className=\"text-red-600 text-sm\">{error}</div>}\n\t\t\t\t<button className=\"bg-primary text-white px-3 py-1 rounded w-full\" type=\"submit\">Увійти</button>\n\t\t\t</form>\n\t\t</div>\n\t);\n}\n"],"names":[],"mappings":"8EAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAmBe,SAAS,IACvB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAElD,eAAe,EAAO,CAAkB,EACvC,EAAE,cAAc,GAChB,EAAS,MACT,GAAI,CACH,IAAM,EAAiE,KAA1D,GAAkE,GAAG,CAAC,mBAAmB,EAAI,UAA7D,cACvC,EAAM,MAAM,MAAM,EAAO,kBAAmB,CACjD,OAAQ,OACR,QAAS,CAAE,eAAgB,kBAAmB,EAC9C,KAAM,KAAK,SAAS,CAAC,CAAE,oBAAU,CAAS,EAC3C,GACA,GAAI,CAAC,EAAI,EAAE,CAAE,MAAM,AAAI,MAAM,gBAC7B,GAAM,aAAE,CAAW,CAAE,CAAI,MAAM,EAAI,IAAI,GACjC,EA3BT,AA2BmB,SA3BV,AAAS,CAAa,EAC9B,GAAI,CACH,GAAM,EAAG,EAAQ,CAAG,EAAM,KAAK,CAAC,KAChC,OAAO,KAAK,KAAK,CAAC,KAAK,GACxB,CAAE,KAAM,CACP,MAAO,CAAC,CACT,CACD,EAoB4B,GACnB,EAA6B,AAAiB,YAAT,IAAI,CAAe,QAAU,WAClE,EAAmB,aAAE,EAAa,WAAY,EAAQ,UAAU,EAAI,QAAI,EAAM,aAAc,EAAQ,YAAY,CAAE,OAAQ,EAAQ,GAAG,AAAC,EAC5I,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,GACX,EAAO,IAAI,CAAY,UAAX,EAAE,IAAI,CAAe,SAAW,aAC7C,CAAE,MAAO,EAAK,CACb,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,gBAC/C,CACD,CAEA,MACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CACd,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iCAAwB,SACtC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SAAU,EAAQ,UAAU,sBACjC,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,kBAChB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,mBAAU,aAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,kCAAkC,MAAO,EAAU,SAAU,AAAC,GAAM,EAAY,EAAE,MAAM,CAAC,KAAK,OAEhH,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,kBAChB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,mBAAU,WAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,KAAK,WAAW,UAAU,kCAAkC,MAAO,EAAU,SAAU,AAAC,GAAM,EAAY,EAAE,MAAM,CAAC,KAAK,OAE/H,GAAS,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gCAAwB,IACjD,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,iDAAiD,KAAK,kBAAS,gBAIrF"}