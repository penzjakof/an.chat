{"version":3,"sources":["turbopack:///[project]/apps/web/src/app/chats/layout.tsx","turbopack:///[project]/apps/web/src/components/ProfileAuthenticator.tsx","turbopack:///[project]/apps/web/src/components/CustomSelect.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useState, useRef } from 'react';\nimport Link from 'next/link';\nimport { usePathname, useRouter } from 'next/navigation';\nimport { io } from 'socket.io-client';\nimport { apiGet, apiPost } from '@/lib/api';\nimport { getSession, getAccessToken, clearSession, getUserId } from '@/lib/session';\nimport { ProfileAuthenticator } from '@/components/ProfileAuthenticator';\nimport { DialogSkeleton } from '@/components/SkeletonLoader';\nimport { CustomSelect } from '@/components/CustomSelect';\nimport { useToast } from '@/contexts/ToastContext';\n\ntype ChatDialog = {\n\tidUser: number;\n\tidInterlocutor: number;\n\tlastMessage?: {\n\t\tcontent?: {\n\t\t\tmessage?: string;\n\t\t};\n\t};\n\tdateUpdated?: string;\n\tmessagesLeft?: number;\n\t[key: string]: unknown;\n};\n\ntype UserProfile = {\n\tid: number;\n\tid_user: number;\n\tname: string;\n\tpersonal: {\n\t\tavatar_small: string;\n\t\tavatar_large: string;\n\t\tavatar_xl: string;\n\t\tage: number;\n\t};\n\tis_online: boolean;\n\tlast_visit: string;\n};\n\ntype SourceProfile = {\n\tid: string;\n\tdisplayName: string | null;\n\tprovider: string;\n\tprofileId: string | null;\n};\n\ntype ChatsResponse = {\n\tdialogs: ChatDialog[];\n\tcursor: string;\n\tprofiles: Record<number, UserProfile>;\n\tsourceProfiles: SourceProfile[];\n};\n\nexport default function ChatsLayout({\n\tchildren,\n}: {\n\tchildren: React.ReactNode;\n}) {\n\tconst router = useRouter();\n\tconst pathname = usePathname();\n\tconst { showToast } = useToast();\n\tconst [dialogs, setDialogs] = useState<ChatDialog[]>([]);\n\tconst [profiles, setProfiles] = useState<Record<number, UserProfile>>({});\n\tconst [sourceProfiles, setSourceProfiles] = useState<SourceProfile[]>([]);\n\tconst [profileAvatars, setProfileAvatars] = useState<Record<string, string>>({});\n\tconst [isLoadingDialogs, setIsLoadingDialogs] = useState(true);\n\tconst [isLoadingMoreDialogs, setIsLoadingMoreDialogs] = useState(false);\n\tconst [hasMoreDialogs, setHasMoreDialogs] = useState(true);\n\tconst [dialogsCursor, setDialogsCursor] = useState<string>('');\n\tconst [filters, setFilters] = useState<{ status: string; onlineOnly: boolean }>({\n\t\tstatus: 'unanswered',\n\t\tonlineOnly: false\n\t});\n\tconst [active, setActive] = useState<boolean>(true);\n\n\t// –ê–∫—Ç—É–∞–ª—å–Ω–∏–π —Å—Ç–∞–Ω —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ —É ref –¥–ª—è –¥–æ—Å—Ç—É–ø—É –≤ –∫–æ–ª–±–µ–∫–∞—Ö —Å–æ–∫–µ—Ç–∞/—ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤\n\tconst filtersRef = useRef(filters);\n\tuseEffect(() => { filtersRef.current = filters; }, [filters]);\n\n\t// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—ó –∑–º—ñ–Ω–∏: —è–∫—â–æ –Ω–µ–º–∞—î ‚Äì —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ /dashboard\n\tuseEffect(() => {\n\t\t(async () => {\n\t\t\tconst s = getSession();\n\t\t\tif (!s) {\n\t\t\t\trouter.replace('/login');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\ttry {\n\t\t\t\tconst data = await apiGet<{ active: boolean }>('/api/shifts/is-active');\n\t\t\t\tif (!data?.active) {\n\t\t\t\t\trouter.replace('/dashboard');\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// —è–∫—â–æ –±–µ–∫ –≤—ñ–¥–¥–∞—î 401/403, apiGet —Å–∞–º —Ä–µ–¥—ñ—Ä–µ–∫—Ç–Ω–µ\n\t\t\t}\n\t\t})();\n\t}, [router]);\n\n\t// –°—Ç–∞–Ω –¥–ª—è –ø–æ—à—É–∫—É –¥—ñ–∞–ª–æ–≥—ñ–≤\n\tconst [showSearchForm, setShowSearchForm] = useState(false);\n\tconst [searchProfileId, setSearchProfileId] = useState('');\n\tconst [searchClientId, setSearchClientId] = useState('');\n\tconst [searchResult, setSearchResult] = useState<ChatDialog | null>(null);\n\tconst [isSearching, setIsSearching] = useState(false);\n\n\t// –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π dialogId –∑ URL\n\tconst currentDialogId = pathname.includes('/chats/') && pathname !== '/chats' \n\t\t? pathname.split('/chats/')[1] \n\t\t: null;\n\n\t// –§—É–Ω–∫—Ü—ñ—è –ø–æ—à—É–∫—É –¥—ñ–∞–ª–æ–≥—É –∑–∞ –ø–∞—Ä–æ—é –ø—Ä–æ—Ñ—ñ–ª—å-–∫–ª—ñ—î–Ω—Ç\n\tconst searchDialog = async () => {\n\t\tif (!searchProfileId || !searchClientId) {\n\t\t\talert('–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å –ø—Ä–æ—Ñ—ñ–ª—å —Ç–∞ –≤–≤–µ–¥—ñ—Ç—å –Ü–î –∫–ª—ñ—î–Ω—Ç–∞');\n\t\t\treturn;\n\t\t}\n\n\t\tconst s = getSession();\n\t\tif (!s) {\n\t\t\trouter.replace('/login');\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tsetIsSearching(true);\n\t\t\t\n\t\t\t// –ë—É–¥—É—î–º–æ URL –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ—à—É–∫—É\n\t\t\tconst params = new URLSearchParams();\n\t\t\tparams.set('profileId', searchProfileId);\n\t\t\tparams.set('clientId', searchClientId);\n\t\t\t\n\t\t\tconst response = await apiGet<{ dialog?: ChatDialog; profiles?: Record<number, UserProfile> }>(`/api/chats/search-dialog?${params.toString()}`);\n\t\t\t\n\t\t\tif (response && response.dialog) {\n\t\t\t\tsetSearchResult(response.dialog);\n\t\t\t\t// –¢–∞–∫–æ–∂ –æ–Ω–æ–≤–ª—é—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—ñ —è–∫—â–æ —î\n\t\t\t\tif (response.profiles) {\n\t\t\t\t\tsetProfiles(prev => ({ ...prev, ...response.profiles }));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsetSearchResult(null);\n\t\t\t\talert('–î—ñ–∞–ª–æ–≥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to search dialog:', error);\n\t\t\talert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –ø–æ—à—É–∫—É –¥—ñ–∞–ª–æ–≥—É');\n\t\t\tsetSearchResult(null);\n\t\t} finally {\n\t\t\tsetIsSearching(false);\n\t\t}\n\t};\n\n\t// –§—É–Ω–∫—Ü—ñ—è –æ—á–∏—â–µ–Ω–Ω—è –ø–æ—à—É–∫—É\n\tconst clearSearch = () => {\n\t\tsetSearchResult(null);\n\t\tsetSearchProfileId('');\n\t\tsetSearchClientId('');\n\t\tsetShowSearchForm(false);\n\t};\n\n\t// –§—É–Ω–∫—Ü—ñ—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ –ø–æ—à—É–∫—É\n\tconst toggleSearchForm = () => {\n\t\tif (showSearchForm) {\n\t\t\t// –Ø–∫—â–æ —Ñ–æ—Ä–º–∞ –≤—ñ–¥–∫—Ä–∏—Ç–∞ - –∑–∞–∫—Ä–∏–≤–∞—î–º–æ —ñ –æ—á–∏—â–∞—î–º–æ\n\t\t\tclearSearch();\n\t\t} else {\n\t\t\t// –Ø–∫—â–æ —Ñ–æ—Ä–º–∞ –∑–∞–∫—Ä–∏—Ç–∞ - –≤—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ\n\t\t\tsetShowSearchForm(true);\n\t\t}\n\t};\n\n\tconst loadDialogs = async (currentFilters: { status: string; onlineOnly: boolean }, isInitial = true) => {\n\t\tconst s = getSession();\n\t\tif (!s) {\n\t\t\trouter.replace('/login');\n\t\t\treturn;\n\t\t}\n\t\t\n\t\ttry {\n\t\t\tif (isInitial) {\n\t\t\t\tsetIsLoadingDialogs(true);\n\t\t\t\tsetDialogs([]);\n\t\t\t\tsetDialogsCursor('');\n\t\t\t\tsetHasMoreDialogs(true);\n\t\t\t} else {\n\t\t\t\tsetIsLoadingMoreDialogs(true);\n\t\t\t}\n\n\t\t\t// –ë—É–¥—É—î–º–æ URL –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤\n\t\t\tconst params = new URLSearchParams();\n\t\t\tif (currentFilters.status !== 'active') {\n\t\t\t\tparams.set('status', currentFilters.status);\n\t\t\t}\n\t\t\tif (currentFilters.onlineOnly) {\n\t\t\t\tparams.set('onlineOnly', 'true');\n\t\t\t}\n\t\t\t// –î–æ–¥–∞—î–º–æ cursor –¥–ª—è –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó\n\t\t\tif (!isInitial && dialogsCursor) {\n\t\t\t\tparams.set('cursor', dialogsCursor);\n\t\t\t}\n\t\t\t\n\t\t\tconst url = `/api/chats/dialogs${params.toString() ? '?' + params.toString() : ''}`;\n\t\t\tconst response = await apiGet<ChatsResponse & { cursor?: string; hasMore?: boolean }>(url);\n\t\t\t\n\t\t\tconsole.log(`üì• Frontend received response:`, {\n\t\t\t\tdialogsCount: response?.dialogs?.length,\n\t\t\t\tcursor: response?.cursor,\n\t\t\t\thasMore: response?.hasMore,\n\t\t\t\tisInitial\n\t\t\t});\n\t\t\t\n\t\t\tif (response && Array.isArray(response.dialogs)) {\n\t\t\t\t// –î–æ–¥–∞—Ç–∫–æ–≤–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –¥–ª—è ¬´–í—Ö—ñ–¥–Ω—ñ¬ª: –≤–∏–∫–ª—é—á–∞—î–º–æ –¥—ñ–∞–ª–æ–≥–∏ –∑ isBlocked/is_blocked=true\n\t\t\t\tconst filterUnanswered = (list: ChatDialog[], profilesMap?: Record<number, any>) => {\n\t\t\t\t\tif (currentFilters.status !== 'unanswered') return list;\n\t\t\t\t\treturn list.filter((d: any) => {\n\t\t\t\t\t\tif (d?.isBlocked === true || d?.is_blocked === true) return false;\n\t\t\t\t\t\tconst p = profilesMap?.[d.idInterlocutor];\n\t\t\t\t\t\tif (p && p.is_blocked === true) return false;\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tconst safeDialogs = filterUnanswered(response.dialogs, response.profiles);\n\t\t\t\tif (isInitial) {\n\t\t\t\t\tsetDialogs(safeDialogs);\n\t\t\t\t\tsetProfiles(response.profiles || {});\n\t\t\t\t\tsetSourceProfiles(response.sourceProfiles || []);\n\n\t\t\t\t\t// –£ –±–µ–∫–≥—Ä–∞—É–Ω–¥—ñ –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ –¥–ª—è –¥—ñ–∞–ª–æ–≥—ñ–≤ (—ñ–º'—è/–∞–≤–∞—Ç–∞—Ä)\n\t\t\t\t\t(async () => {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst currentMap = response.profiles || {};\n\t\t\t\t\t\t\tconst missing: Array<{ ttProfileId: number; clientId: number }> = [];\n\t\t\t\t\t\t\tfor (const d of safeDialogs) {\n\t\t\t\t\t\t\t\tconst cid = (d as any)?.idInterlocutor;\n\t\t\t\t\t\t\t\tconst pid = (d as any)?.idUser;\n\t\t\t\t\t\t\t\tif (typeof cid === 'number' && typeof pid === 'number' && !currentMap[cid]) {\n\t\t\t\t\t\t\t\t\tmissing.push({ ttProfileId: pid, clientId: cid });\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// –û–±–º–µ–∂–∏–º–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤, —â–æ–± –Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —Å–ø–∞–π–∫\n\t\t\t\t\t\t\tfor (const item of missing.slice(0, 25)) {\n\t\t\t\t\t\t\t\tconst internalId = await resolveInternalProfileId(item.ttProfileId);\n\t\t\t\t\t\t\t\tif (internalId) {\n\t\t\t\t\t\t\t\t\tawait ensureClientProfileInState(internalId, item.clientId);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch {}\n\t\t\t\t\t})();\n\t\t\t\t} else {\n\t\t\t\t\t// –î–æ–¥–∞—î–º–æ –Ω–æ–≤—ñ –¥—ñ–∞–ª–æ–≥–∏ –¥–æ –∫—ñ–Ω—Ü—è —Å–ø–∏—Å–∫—É, –≤–∏–∫–ª—é—á–∞—é—á–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏\n\t\t\t\t\tconst existingIds = new Set(dialogs.map(dlg => `${dlg.idUser}-${dlg.idInterlocutor}`));\n\t\t\t\t\tconst newDialogs = safeDialogs.filter(dlg => \n\t\t\t\t\t\t!existingIds.has(`${dlg.idUser}-${dlg.idInterlocutor}`)\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\tconsole.log(`üìÑ Dialogs pagination: loaded ${response.dialogs.length} dialogs, ${newDialogs.length} new`);\n\t\t\t\t\tconsole.log(`üìä Current dialogs count: ${dialogs.length}, existing IDs sample:`, Array.from(existingIds).slice(0, 5));\n\t\t\t\t\tconsole.log(`üìä New dialogs sample:`, newDialogs.slice(0, 3).map(dlg => `${dlg.idUser}-${dlg.idInterlocutor}`));\n\t\t\t\t\t\n\t\t\t\t\t// –Ø–∫—â–æ –Ω–µ–º–∞—î –Ω–æ–≤–∏—Ö –¥—ñ–∞–ª–æ–≥—ñ–≤ - –∑—É–ø–∏–Ω—è—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è\n\t\t\t\t\tif (newDialogs.length === 0) {\n\t\t\t\t\t\tconsole.log(`‚èπÔ∏è No new dialogs after filtering, stopping pagination`);\n\t\t\t\t\t\tsetHasMoreDialogs(false);\n\t\t\t\t\t\treturn; // –í–∏—Ö–æ–¥–∏–º–æ –±–µ–∑ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è cursor\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// –í–∏–¥–∞–ª—è—î–º–æ –∂–æ—Ä—Å—Ç–∫—É –µ–≤—Ä–∏—Å—Ç–∏–∫—É –∑–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é (15)\n\t\t\t\t\t// –ü–æ–∫–ª–∞–¥–∞—î–º–æ—Å—å –ª–∏—à–µ –Ω–∞ server-side hasMore\n\t\t\t\t\t\n\t\t\t\t\t// –û–±–º–µ–∂—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¥—ñ–∞–ª–æ–≥—ñ–≤ (–∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ –±–µ–∑–∫—ñ–Ω–µ—á–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)\n\t\t\t\t\tconst totalAfterAdd = dialogs.length + newDialogs.length;\n\t\t\t\t\tif (totalAfterAdd > 500) {\n\t\t\t\t\t\tconsole.log(`üõë Reached maximum dialogs limit (${totalAfterAdd}), stopping pagination`);\n\t\t\t\t\t\tsetHasMoreDialogs(false);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tsetDialogs(prev => [...prev, ...newDialogs]);\n\t\t\t\t\t// –û–Ω–æ–≤–ª—é—î–º–æ profiles —Ç–∞ sourceProfiles\n\t\t\t\t\tsetProfiles(prev => ({ ...prev, ...(response.profiles || {}) }));\n\t\t\t\t\tsetSourceProfiles(prev => [...prev, ...(response.sourceProfiles || [])]);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// –û–Ω–æ–≤–ª—é—î–º–æ cursor —Ç–∞ hasMore –∑–≥—ñ–¥–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å–µ—Ä–≤–µ—Ä–∞\n\t\t\t\tsetDialogsCursor(response.cursor || '');\n\t\t\t\tsetHasMoreDialogs(Boolean(response.hasMore));\n\t\t\t} else {\n\t\t\t\tif (isInitial) {\n\t\t\t\t\tsetDialogs([]);\n\t\t\t\t\tsetProfiles({});\n\t\t\t\t\tsetSourceProfiles([]);\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to load dialogs:', error);\n\t\t\tif (isInitial) {\n\t\t\t\tsetDialogs([]);\n\t\t\t\tsetProfiles({});\n\t\t\t\tsetSourceProfiles([]);\n\t\t\t}\n\t\t} finally {\n\t\t\tif (isInitial) {\n\t\t\t\tsetIsLoadingDialogs(false);\n\t\t\t} else {\n\t\t\t\tsetIsLoadingMoreDialogs(false);\n\t\t\t}\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tloadDialogs(filters);\n\t\t\n\t\t// Cleanup timeout –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤\n\t\treturn () => {\n\t\t\tif (scrollTimeoutRef.current) {\n\t\t\t\tclearTimeout(scrollTimeoutRef.current);\n\t\t\t}\n\t\t};\n\t}, [router, filters]);\n\n\t// –õ–æ–∫–∞–ª—å–Ω–µ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑—ñ ¬´–í—Ö—ñ–¥–Ω—ñ¬ª –≤—ñ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ (–±—É–¥—å-—è–∫–∏–π —Ç–∏–ø)\n\tuseEffect(() => {\n\t\tconst handler = (e: Event) => {\n\t\t\tconst detail = (e as CustomEvent).detail as { profileId: number; clientId: number; kind?: string } | undefined;\n\t\t\tif (!detail) return;\n\t\t\tif (filtersRef.current?.status !== 'unanswered') return;\n\t\t\tsetDialogs(prev => prev.filter(d => {\n\t\t\t\tconst matchPair = d.idUser === detail.profileId && d.idInterlocutor === detail.clientId;\n\t\t\t\tif (!matchPair) return true;\n\t\t\t\tconst isEmailItem = (d as any).__email === true;\n\t\t\t\t// –Ø–∫—â–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–∏—Å—Ç ‚Äî –≤–∏–¥–∞–ª—è—î–º–æ –¢–Ü–õ–¨–ö–ò email-–∞–π—Ç–µ–º (¬´–ù–æ–≤–∏–π –ª–∏—Å—Ç¬ª), –∑–∞–ª–∏—à–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π –¥—ñ–∞–ª–æ–≥\n\t\t\t\tif (detail.kind === 'email') {\n\t\t\t\t\treturn !isEmailItem; // –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –ª–∏—à–µ email-–∞–π—Ç–µ–º\n\t\t\t\t}\n\t\t\t\t// –î–ª—è —ñ–Ω—à–∏—Ö —Ç–∏–ø—ñ–≤ (—á–∞—Ç) ‚Äî –ø—Ä–∏–±–∏—Ä–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –∑–≤–∏—á–∞–π–Ω–∏–π –¥—ñ–∞–ª–æ–≥, –Ω–µ —á—ñ–ø–∞—î–º–æ email-–∞–π—Ç–µ–º\n\t\t\t\treturn isEmailItem; // –∑–∞–ª–∏—à–∞—î–º–æ email-–∞–π—Ç–µ–º, —è–∫—â–æ –≤—ñ–Ω —î\n\t\t\t}));\n\t\t};\n\t\twindow.addEventListener('dialog:sent', handler as EventListener);\n\t\treturn () => window.removeEventListener('dialog:sent', handler as EventListener);\n\t}, []);\n\n\t// –ê–≤—Ç–æ–æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É ¬´–í—Ö—ñ–¥–Ω—ñ¬ª –∫–æ–∂–Ω—ñ 60 —Å–µ–∫, —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –∞–∫—Ç–∏–≤–Ω–∏–π —Å–∞–º–µ —Ü–µ–π —Ñ—ñ–ª—å—Ç—Ä\n\tuseEffect(() => {\n\t\tif (filters.status !== 'unanswered') return;\n\t\tconst intervalId = setInterval(() => {\n\t\t\t// –í–∏–∫–æ–Ω—É—î–º–æ –ø–æ–≤–Ω–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏\n\t\t\tloadDialogs(filters, true);\n\t\t}, 60000);\n\t\treturn () => clearInterval(intervalId);\n\t}, [filters]);\n\n\t// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–ª—å—à–µ –¥—ñ–∞–ª–æ–≥—ñ–≤\n\tconst loadMoreDialogs = async () => {\n\t\tif (!hasMoreDialogs || isLoadingMoreDialogs || isLoadingDialogs || !dialogsCursor) return;\n\t\tconsole.log(`üîÑ Loading more dialogs with cursor: ${dialogsCursor}`);\n\t\tawait loadDialogs(filters, false);\n\t};\n\n\t// Refs –¥–ª—è debounce\n\tconst scrollTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n\t// –û–±—Ä–æ–±–Ω–∏–∫ —Å–∫—Ä–æ–ª—É –¥–ª—è –ø–∞–≥—ñ–Ω–∞—Ü—ñ—ó –¥—ñ–∞–ª–æ–≥—ñ–≤\n\tconst handleDialogsScroll = (e: React.UIEvent<HTMLDivElement>) => {\n\t\tconst { scrollTop, scrollHeight, clientHeight } = e.currentTarget;\n\t\t\n\t\t// –û—á–∏—â—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π timeout\n\t\tif (scrollTimeoutRef.current) {\n\t\t\tclearTimeout(scrollTimeoutRef.current);\n\t\t}\n\t\t\n\t\t// –Ø–∫—â–æ –¥–æ—Å–∫—Ä–æ–ª–∏–ª–∏ –º–∞–π–∂–µ –¥–æ –Ω–∏–∑—É (–∑–∞–ª–∏—à–∏–ª–æ—Å—å –º–µ–Ω—à–µ 100px)\n\t\tif (\n\t\t\tscrollHeight - scrollTop - clientHeight < 100 &&\n\t\t\thasMoreDialogs &&\n\t\t\t!isLoadingMoreDialogs &&\n\t\t\t!isLoadingDialogs &&\n\t\t\tdialogsCursor\n\t\t) {\n\t\t\tconsole.log(`üîÑ Near bottom! Triggering dialogs pagination`);\n\t\t\t// –î–æ–¥–∞—î–º–æ debounce –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è —Å–ø–∞–º—É\n\t\t\tscrollTimeoutRef.current = setTimeout(() => {\n\t\t\t\tif (hasMoreDialogs && !isLoadingMoreDialogs && !isLoadingDialogs) {\n\t\t\t\t\tloadMoreDialogs();\n\t\t\t\t}\n\t\t\t}, 200);\n\t\t}\n\t};\n\n\t// –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∞–≤–∞—Ç–∞—Ä–∏ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è sourceProfiles\n\tuseEffect(() => {\n\t\tif (sourceProfiles.length > 0) {\n\t\t\tloadProfileAvatars();\n\t\t}\n\t}, [sourceProfiles]);\n\n\t// WebSocket –¥–ª—è RTM –æ–Ω–æ–≤–ª–µ–Ω—å\n\tuseEffect(() => {\n\t\tconst token = getAccessToken();\n\t\tif (!token) return;\n\n\t\tconst base = typeof window !== 'undefined' ? window.location.origin : (process.env.NEXT_PUBLIC_SOCKET_BASE || 'http://localhost:4000');\n\t\tconst socket = io(base, {\n\t\t\ttransports: ['polling'],\n\t\t\tupgrade: false,\n\t\t\tpath: '/socket.io/',\n\t\t\tauth: { token }\n\t\t});\n\n\t\t// –û–±—Ä–æ–±–ª—è—î–º–æ –∑–º—ñ–Ω–∏ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å—É\n\t\tsocket.on('user_online_status', (data: { userId: number; isOnline: boolean }) => {\n\t\t\tconsole.log('üë§ RTM: User online status changed in dialogs list', data);\n\t\t\t\n\t\t\t// –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å —É profiles\n\t\t\tsetProfiles(prev => ({\n\t\t\t\t...prev,\n\t\t\t\t[data.userId]: prev[data.userId] ? {\n\t\t\t\t\t...prev[data.userId],\n\t\t\t\t\tis_online: data.isOnline\n\t\t\t\t} : prev[data.userId]\n\t\t\t}));\n\t\t});\n\n\t\t// –û—Ç—Ä–∏–º—É—î–º–æ toast –ø—Ä–æ –Ω–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∞–±–æ –ª–∏—Å—Ç: –æ–Ω–æ–≤–ª—é—î–º–æ/—Å—Ç–≤–æ—Ä—é—î–º–æ –¥—ñ–∞–ª–æ–≥–∏\n\t\tsocket.on('message_toast', (payload: { messageId: number; idUserFrom: number; idUserTo: number; dateCreated: string; type: string; dialogId: string; correspondenceId?: string; title?: string }) => {\n\t\t\tconsole.log('üçû RTM: Message toast in dialogs list', payload);\n\t\t\tsetDialogs(prev => {\n\t\t\t\t// –ü–∞—Ä—Å–∏–º–æ dialogId —É —Ñ–æ—Ä–º–∞—Ç—ñ `${profileId}-${interlocutorId}` (profileId –∑–∞–≤–∂–¥–∏ –ø–µ—Ä—à–∏–π)\n\t\t\t\tconst parts = (payload.dialogId || '').split('-');\n\t\t\t\tconst profileId = Number(parts[0]);\n\t\t\t\tconst interlocutorId = Number(parts[1]);\n\t\t\t\t\n\t\t\t\t// –§–æ–ª–±–µ–∫: —è–∫—â–æ dialogId –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –Ω–∞–ø—Ä—è–º–æ–∫ –∑ payload\n\t\t\t\tconst pid = !isNaN(profileId) ? profileId : payload.idUserFrom;\n\t\t\t\tconst iid = !isNaN(interlocutorId) ? interlocutorId : payload.idUserTo;\n\n\t\t\t\t// –Ø–∫—â–æ –≤—ñ–¥–∫—Ä–∏—Ç–æ ¬´–í—Ö—ñ–¥–Ω—ñ¬ª —ñ –ø—Ä–∏–π—à–æ–≤ —Ç–æ—Å—Ç –ø—Ä–æ –ù–ê–®–ï –≤–∏—Ö—ñ–¥–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Äî\n\t\t\t\t// –≤–∏–¥–∞–ª—è—î–º–æ –¥—ñ–∞–ª–æ–≥ —ñ–∑ —Å–ø–∏—Å–∫—É ¬´–í—Ö—ñ–¥–Ω—ñ¬ª (–≤—ñ–Ω –±—ñ–ª—å—à–µ –Ω–µ ¬´–±–µ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ¬ª)\n\t\t\t\tif (filtersRef.current?.status === 'unanswered' && payload.type !== 'new_email') {\n\t\t\t\t\tconst isOutgoingFromProfile = payload.idUserFrom === pid;\n\t\t\t\t\tif (isOutgoingFromProfile) {\n\t\t\t\t\t\tconst next = prev.filter(d => !(d.idUser === pid && d.idInterlocutor === iid));\n\t\t\t\t\t\tif (next.length !== prev.length) {\n\t\t\t\t\t\t\treturn next;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// –Ø–∫—â–æ —Ü–µ email (–∞–±–æ —î correspondenceId) ‚Äî –ó–ê–í–ñ–î–ê –¥–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –∞–π—Ç–µ–º\n\t\t\t\tif (payload.type === 'new_email' || payload.correspondenceId) {\n\t\t\t\t\tconst emailDialog: ChatDialog = {\n\t\t\t\t\t\tidUser: pid,\n\t\t\t\t\t\tidInterlocutor: iid,\n\t\t\t\t\t\tdateUpdated: payload.dateCreated,\n\t\t\t\t\t\tlastMessage: { content: { message: payload.title || '–ù–æ–≤–∏–π –ª–∏—Å—Ç' } },\n\t\t\t\t\t\t__email: true,\n\t\t\t\t\t\t__emailBadge: true,\n\t\t\t\t\t\t__correspondenceId: payload.correspondenceId\n\t\t\t\t\t} as any;\n\t\t\t\t\treturn [emailDialog, ...prev];\n\t\t\t\t}\n\t\t\t\t// –î–ª—è —á–∞—Ç-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: —è–∫—â–æ —ñ—Å–Ω—É—î –ù–ï email-–∞–π—Ç–µ–º ‚Äî –æ–Ω–æ–≤–ª—é—î–º–æ –π–æ–≥–æ; —è–∫—â–æ —î –ª–∏—à–µ email-–∞–π—Ç–µ–º ‚Äî —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π\n\t\t\t\tconst matchesDialog = (dlg: ChatDialog) => (dlg.idUser === pid && dlg.idInterlocutor === iid);\n\t\t\t\tconst nonEmailIndex = prev.findIndex(dlg => matchesDialog(dlg) && !(dlg as any).__email);\n\t\t\t\tif (nonEmailIndex !== -1) {\n\t\t\t\t\tconst updatedDialog: ChatDialog = { ...prev[nonEmailIndex], dateUpdated: payload.dateCreated };\n\t\t\t\t\treturn [updatedDialog, ...prev.filter((_, i) => i !== nonEmailIndex)];\n\t\t\t\t}\n\t\t\t\t// –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –∑–≤–∏—á–∞–π–Ω–∏–π –∞–π—Ç–µ–º –¥—ñ–∞–ª–æ–≥—É\n\t\t\t\tconst newDialog: ChatDialog = {\n\t\t\t\t\tidUser: pid,\n\t\t\t\t\tidInterlocutor: iid,\n\t\t\t\t\tdateUpdated: payload.dateCreated,\n\t\t\t\t\tlastMessage: { content: {} }\n\t\t\t\t};\n\t\t\t\treturn [newDialog, ...prev];\n\t\t\t});\n\t\t\t\n\t\t\t// –ü—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ–º'—è —Ç–∞ –∞–≤–∞—Ç–∞—Ä –∫–ª—ñ—î–Ω—Ç–∞ –≤ —Å–ø–∏—Å–æ–∫, —è–∫—â–æ —ó—Ö —â–µ –Ω–µ–º–∞—î (–∑ —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–º –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ profile.id)\n\t\t\t(async () => {\n\t\t\t\tconst parts = (payload.dialogId || '').split('-');\n\t\t\t\tconst ttPidNum = Number(parts[0]);\n\t\t\t\tconst iidNum = Number(parts[1]);\n\t\t\t\tconst internalProfileId = !isNaN(ttPidNum) ? await resolveInternalProfileId(ttPidNum) : null;\n\t\t\t\t// –Ø–∫—â–æ –ø—Ä–æ—Ñ—ñ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π (–≤–∏–¥–∞–ª–µ–Ω–∏–π/–Ω–µ –≤ –¥–æ—Å—Ç—É–ø—ñ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞) ‚Äî –Ω–µ –¥–æ–≥—Ä—É–∂–∞—î–º–æ, –∑–∞–ª–∏—à–∞—î–º–æ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä\n\t\t\t\tif (!internalProfileId) return;\n\t\t\t\tif (internalProfileId && !isNaN(iidNum)) {\n\t\t\t\t\tawait ensureClientProfileInState(internalProfileId, iidNum);\n\t\t\t\t}\n\t\t\t})();\n\t\t});\n\n\t\t// –û–±—Ä–æ–±–ª—è—î–º–æ –Ω–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –¥—ñ–∞–ª–æ–≥—ñ–≤\n\t\tsocket.on('message', (payload: any) => {\n\t\t\tconsole.log('üì® RTM: New message in dialogs list', payload);\n\t\t\tsetDialogs(prev => {\n\t\t\t\t// –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø–∞—Ä—É idUser/idInterlocutor –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞–ø—Ä—è–º–∫—É\n\t\t\t\tconst pid = payload.idUserFrom;\n\t\t\t\tconst iid = payload.idUserTo;\n\t\t\t\tconst matches = (d: ChatDialog) => (\n\t\t\t\t\t(d.idUser === pid && d.idInterlocutor === iid) || (d.idUser === iid && d.idInterlocutor === pid)\n\t\t\t\t);\n\n\t\t\t\t// –Ø–∫—â–æ –∞–∫—Ç–∏–≤–Ω–∏–π —Ñ—ñ–ª—å—Ç—Ä ¬´–í—Ö—ñ–¥–Ω—ñ¬ª —ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ–π—à–ª–æ –í–Ü–î –ø—Ä–æ—Ñ—ñ–ª—è –¥–ª—è —Ü—å–æ–≥–æ –¥—ñ–∞–ª–æ–≥—É ‚Äî\n\t\t\t\t// –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –¥—ñ–∞–ª–æ–≥ –∑—ñ —Å–ø–∏—Å–∫—É (–≤—ñ–Ω –±—ñ–ª—å—à–µ –Ω–µ ¬´–±–µ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ¬ª)\n\t\t\t\tif (filtersRef.current?.status === 'unanswered') {\n\t\t\t\t\tconst hasDialogFromProfile = prev.some(d => d.idUser === pid && d.idInterlocutor === iid);\n\t\t\t\t\tif (hasDialogFromProfile) {\n\t\t\t\t\t\treturn prev.filter(d => !(d.idUser === pid && d.idInterlocutor === iid));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst nonEmailIndex = prev.findIndex(d => matches(d) && !(d as any).__email);\n\t\t\t\tif (nonEmailIndex !== -1) {\n\t\t\t\t\tconst updated: ChatDialog = {\n\t\t\t\t\t\t...prev[nonEmailIndex],\n\t\t\t\t\t\tlastMessage: { content: payload.content },\n\t\t\t\t\t\tdateUpdated: payload.dateCreated\n\t\t\t\t\t};\n\t\t\t\t\treturn [updated, ...prev.filter((_, i) => i !== nonEmailIndex)];\n\t\t\t\t}\n\t\t\t\t// –Ø–∫—â–æ —î —Ç—ñ–ª—å–∫–∏ email-–∞–π—Ç–µ–º, —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–∏–π –∑–≤–∏—á–∞–π–Ω–∏–π –∞–π—Ç–µ–º\n\t\t\t\tconst emailIndex = prev.findIndex(d => matches(d) && (d as any).__email);\n\t\t\t\tif (emailIndex !== -1) {\n\t\t\t\t\tconst newDialog: ChatDialog = {\n\t\t\t\t\t\tidUser: pid,\n\t\t\t\t\t\tidInterlocutor: iid,\n\t\t\t\t\t\tdateUpdated: payload.dateCreated,\n\t\t\t\t\t\tlastMessage: { content: payload.content }\n\t\t\t\t\t};\n\t\t\t\t\treturn [newDialog, ...prev];\n\t\t\t\t}\n\t\t\t\t// –Ü–Ω–∞–∫—à–µ –ø—Ä–æ—Å—Ç–æ –¥–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π –∑–≤–∏—á–∞–π–Ω–∏–π –∞–π—Ç–µ–º\n\t\t\t\tconst newDialog: ChatDialog = {\n\t\t\t\t\tidUser: pid,\n\t\t\t\t\tidInterlocutor: iid,\n\t\t\t\t\tdateUpdated: payload.dateCreated,\n\t\t\t\t\tlastMessage: { content: payload.content }\n\t\t\t\t};\n\t\t\t\treturn [newDialog, ...prev];\n\t\t\t});\n\t\t});\n\n\t\t// –°–ª—É—Ö–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∑–º—ñ–Ω–∏ ‚Äî —Ä–µ–¥—ñ—Ä–µ–∫—Ç–∏–º–æ –Ω–∞ –¥–∞—à–±–æ—Ä–¥\n\t\tsocket.on('shift_ended', (payload: { operatorId?: string }) => {\n\t\t\tconst uid = getUserId();\n\t\t\tif (uid && payload?.operatorId && uid === payload.operatorId) {\n\t\t\t\trouter.replace('/dashboard');\n\t\t\t}\n\t\t});\n\n\t\treturn () => {\n\t\t\tsocket.off('shift_ended');\n\t\t\tsocket.off('message_toast');\n\t\t\tsocket.disconnect();\n\t\t};\n\t}, []);\n\n\t// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é –∑–∞ idUser (profileId)\n\tconst getSourceProfileByIdUser = (idUser: number) => {\n\t\treturn sourceProfiles.find(p => p.profileId === idUser.toString());\n\t};\n\t\n\t// –ú–∞–ø—ñ–Ω–≥ TT profileId (idUser) -> –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π profile.id\n\tconst getInternalProfileIdByTT = (ttProfileId: number): string | null => {\n\t\tconst found = sourceProfiles.find(p => p.profileId === String(ttProfileId));\n\t\treturn found?.id || null;\n\t};\n\t\n\t// –†–µ–∑–æ–ª–≤–µ—Ä –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ profile.id –∑–∞ TT profileId –∑ fallback –Ω–∞ /profiles/my\n\tconst resolveInternalProfileId = async (ttProfileId: number): Promise<string | null> => {\n\t\tconst fromLocal = getInternalProfileIdByTT(ttProfileId);\n\t\tif (fromLocal) return fromLocal;\n\t\ttry {\n\t\t\tconst list = await apiGet<Array<{ id: string; profileId: string | null }>>('/profiles/my');\n\t\t\tconst match = Array.isArray(list) ? list.find((p) => p.profileId === String(ttProfileId)) : null;\n\t\t\treturn match?.id || null;\n\t\t} catch {\n\t\t\treturn null;\n\t\t}\n\t};\n\n\t// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é –∫–ª—ñ—î–Ω—Ç–∞ –¥–ª—è –ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ —ñ–º–µ–Ω—ñ —Ç–∞ –∞–≤–∞—Ç–∞—Ä—É –≤ —Å–ø–∏—Å–∫—É –¥—ñ–∞–ª–æ–≥—ñ–≤\n\tconst ensureClientProfileInState = async (profileId: string, clientId: number) => {\n\t\tif (profiles[clientId]) return;\n\t\ttry {\n\t\t\tconst resp = await apiGet<{ success?: boolean; profile?: any }>(`/profiles/${profileId}/client/${clientId}/public`);\n\t\t\tconst personal = resp?.profile?.personal;\n\t\t\tlet avatarSmall = personal?.avatar_small || personal?.avatar_large || personal?.avatar_xl || '';\n\t\t\tlet avatarLarge = personal?.avatar_large || personal?.avatar_xl || personal?.avatar_small || '';\n\t\t\tlet avatarXL = personal?.avatar_xl || personal?.avatar_large || personal?.avatar_small || '';\n\t\t\t// –Ø–∫—â–æ –∞–≤–∞—Ç–∞—Ä –≤—ñ–¥—Å—É—Ç–Ω—ñ–π —É –ø—É–±–ª—ñ—á–Ω–æ–º—É –ø—Ä–æ—Ñ—ñ–ª—ñ ‚Äî –ø—Ä–æ–±—É—î–º–æ —Ñ–æ—Ç–∫–∏\n\t\t\tif (!avatarSmall) {\n\t\t\t\ttry {\n\t\t\t\t\tconst photos = await apiPost<any>(`/profiles/${profileId}/client/${clientId}/photos`, {});\n\t\t\t\t\tconst data = photos?.data || photos;\n\t\t\t\t\tconst allPhotos = [\n\t\t\t\t\t\t...(Array.isArray(data?.public) ? data.public : []),\n\t\t\t\t\t\t...(Array.isArray(data?.private) ? data.private : [])\n\t\t\t\t\t];\n\t\t\t\t\tconst main = allPhotos.find((x: any) => x?.isMain === 1 || x?.is_main === 1) || allPhotos[0];\n\t\t\t\t\tif (main) {\n\t\t\t\t\t\tavatarSmall = main.url_small || main.url_medium || main.url_large || main.url_xl || main.url_xs || '';\n\t\t\t\t\t\tavatarLarge = main.url_large || main.url_xl || main.url_medium || main.url_small || '';\n\t\t\t\t\t\tavatarXL = main.url_xl || main.url_large || main.url_medium || main.url_small || '';\n\t\t\t\t\t}\n\t\t\t\t} catch {}\n\t\t\t}\n\t\t\tif (personal || avatarSmall) {\n\t\t\t\tsetProfiles(prev => ({\n\t\t\t\t\t...prev,\n\t\t\t\t\t[clientId]: {\n\t\t\t\t\t\tid: clientId,\n\t\t\t\t\t\tid_user: clientId,\n\t\t\t\t\t\tname: (personal?.name ? personal.name : `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${clientId}`),\n\t\t\t\t\t\tpersonal: {\n\t\t\t\t\t\t\tavatar_small: avatarSmall,\n\t\t\t\t\t\t\tavatar_large: avatarLarge,\n\t\t\t\t\t\t\tavatar_xl: avatarXL,\n\t\t\t\t\t\t\tage: typeof personal?.age === 'number' ? personal!.age : (personal?.age ? parseInt(String(personal.age)) || 0 : 0)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tis_online: Boolean(resp?.profile?.is_online),\n\t\t\t\t\t\tlast_visit: resp?.profile?.last_visit || ''\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t} catch {}\n\t};\n\n\t// –ö–µ—à—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –ø—Ä–æ—Ñ—ñ–ª—é –≤ localStorage\n\tconst PROFILE_CACHE_TTL = 24 * 60 * 60 * 1000; // 24 –≥–æ–¥–∏–Ω–∏\n\n\tconst getCachedProfileData = (profileId: string) => {\n\t\ttry {\n\t\t\tconst cached = localStorage.getItem(`tt_profile_${profileId}`);\n\t\t\tif (cached) {\n\t\t\t\tconst data = JSON.parse(cached);\n\t\t\t\tif (Date.now() - data.timestamp < PROFILE_CACHE_TTL) {\n\t\t\t\t\treturn data.profileData;\n\t\t\t\t}\n\t\t\t\t// –í–∏–¥–∞–ª—è—î–º–æ –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π –∫–µ—à\n\t\t\t\tlocalStorage.removeItem(`tt_profile_${profileId}`);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.warn('Error reading profile cache:', error);\n\t\t}\n\t\treturn null;\n\t};\n\n\tconst setCachedProfileData = (profileId: string, profileData: any) => {\n\t\ttry {\n\t\t\tlocalStorage.setItem(`tt_profile_${profileId}`, JSON.stringify({\n\t\t\t\tprofileData,\n\t\t\t\ttimestamp: Date.now()\n\t\t\t}));\n\t\t} catch (error) {\n\t\t\tconsole.warn('Error saving profile cache:', error);\n\t\t}\n\t};\n\n\t// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞–≤–∞—Ç–∞—Ä—ñ–≤ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤\n\tconst loadProfileAvatars = async () => {\n\t\tconst avatarsToLoad: Record<string, string> = {};\n\t\t\n\t\tfor (const sourceProfile of sourceProfiles) {\n\t\t\tif (!sourceProfile.id) continue;\n\t\t\t\n\t\t\t// –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–µ—à\n\t\t\tconst cached = getCachedProfileData(sourceProfile.id);\n\t\t\tif (cached && cached.personal?.avatar_large) {\n\t\t\t\tavatarsToLoad[sourceProfile.id] = cached.personal.avatar_large;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\t// –Ø–∫—â–æ –Ω–µ–º–∞—î –≤ –∫–µ—à—ñ, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ API\n\t\t\ttry {\n\t\t\t\tconst response = await apiGet<{ success: boolean; profileData?: any; error?: string }>(`/profiles/${sourceProfile.id}/profile-data`);\n\t\t\t\tif (response.success && response.profileData?.personal?.avatar_large) {\n\t\t\t\t\tavatarsToLoad[sourceProfile.id] = response.profileData.personal.avatar_large;\n\t\t\t\t\tsetCachedProfileData(sourceProfile.id, response.profileData);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.warn(`Failed to load profile data for ${sourceProfile.id}:`, error);\n\t\t\t}\n\t\t}\n\t\t\n\t\tsetProfileAvatars(avatarsToLoad);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<ProfileAuthenticator />\n\t\t\t<div className=\"flex flex-col h-screen\">\n\t\t\t\t{/* –•–µ–¥–µ—Ä */}\n\t\t\t\t<header className=\"h-12 bg-white border-b border-gray-200 flex items-center px-4 gap-4 flex-shrink-0\">\n\t\t\t\t\t{/* –ù–∞–∑–≤–∞ –¥–æ–¥–∞—Ç–∫—É */}\n\t\t\t\t\t<div className=\"font-bold text-xl text-[#680098] mr-4\">\n\t\t\t\t\t\tAnChat\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<button\n\t\t\t\t\t\tonClick={() => router.push('/dashboard')}\n\t\t\t\t\t\tclassName=\"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100\"\n\t\t\t\t\t\ttitle=\"–ù–∞ –¥–∞—à–±–æ—Ä–¥\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5 text-gray-700\">\n\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span className=\"text-[14px] text-gray-500\">–î–∞—à–±–æ—Ä–¥</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tonClick={() => router.push('/chats')}\n\t\t\t\t\t\tclassName={`flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100 ${\n\t\t\t\t\t\t\tpathname.includes('/chats') ? 'bg-blue-50 text-blue-700' : ''\n\t\t\t\t\t\t}`}\n\t\t\t\t\t\ttitle=\"–ß–∞—Ç–∏\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className={`w-5 h-5 ${\n\t\t\t\t\t\t\tpathname.includes('/chats') ? 'text-blue-600' : 'text-gray-700'\n\t\t\t\t\t\t}`}>\n\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span className={`text-[14px] ${\n\t\t\t\t\t\t\tpathname.includes('/chats') ? 'text-blue-700 font-medium' : 'text-gray-500'\n\t\t\t\t\t\t}`}>–ß–∞—Ç–∏</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button\n\t\t\t\t\t\tonClick={() => router.push('/settings')}\n\t\t\t\t\t\tclassName={`flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100 ${\n\t\t\t\t\t\t\tpathname.includes('/settings') ? 'bg-blue-50 text-blue-700' : ''\n\t\t\t\t\t\t}`}\n\t\t\t\t\t\ttitle=\"–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className={`w-5 h-5 ${\n\t\t\t\t\t\t\tpathname.includes('/settings') ? 'text-blue-600' : 'text-gray-700'\n\t\t\t\t\t\t}`}>\n\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.165.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.108 1.204.165.397.506.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.108 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.939-1.11.939h-1.094c-.55 0-1.019-.397-1.11-.94l-.148-.893c-.071-.425-.383-.763-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.939-.56-.939-1.109v-1.094c0-.55.397-1.019.94-1.11l.894-.149c.424-.07.763-.383.929-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z\" />\n\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span className={`text-[14px] ${\n\t\t\t\t\t\t\tpathname.includes('/settings') ? 'text-blue-700 font-medium' : 'text-gray-500'\n\t\t\t\t\t\t}`}>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<div className=\"ml-auto flex items-center gap-4\">\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={async () => {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tawait apiPost('/api/shifts/end', {});\n\t\t\t\t\t\t\t\t\tshowToast({ messageId: '', type: 'info', message: '–ó–º—ñ–Ω—É –∑–∞–≤–µ—Ä—à–µ–Ω–æ' } as any);\n\t\t\t\t\t\t\t\t\trouter.replace('/dashboard');\n\t\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\t\tshowToast({ messageId: '', type: 'error', message: '–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –∑–º—ñ–Ω—É' } as any);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"group flex items-center gap-2 px-3 py-2 rounded hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\ttitle=\"–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –∑–º—ñ–Ω—É\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" strokeWidth={1.5} className=\"w-5 h-5 text-gray-700 group-hover:text-red-600 group-hover:fill-red-600 transition-all border border-gray-400 rounded group-hover:border-red-600\" fill=\"none\">\n\t\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z\" />\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t<span className=\"text-[14px] text-gray-500 group-hover:text-red-500 transition-colors\">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={() => { clearSession(); router.replace('/login'); }}\n\t\t\t\t\t\t\tclassName=\"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100\"\n\t\t\t\t\t\t\ttitle=\"–í–∏–π—Ç–∏\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" strokeWidth={1.5} stroke=\"currentColor\" className=\"w-5 h-5 text-gray-700\">\n\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75\" />\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<span className=\"text-[14px] text-gray-500\">–í–∏–π—Ç–∏</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</header>\n\t\t\t\t{/* –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç */}\n\t\t\t\t<div className=\"flex flex-1 overflow-hidden\">\n\t\t\t\t\t{/* –õ—ñ–≤–∞ –ø–∞–Ω–µ–ª—å - —Å–ø–∏—Å–æ–∫ –¥—ñ–∞–ª–æ–≥—ñ–≤ (–∑–∞–≤–∂–¥–∏ –≤–∏–¥–∏–º–∏–π) */}\n\t\t\t\t\t<div className=\"w-[320px] bg-white border-r border-gray-200 flex flex-col\">\n\t\t\t\t\t\t{/* –§—ñ–ª—å—Ç—Ä–∏ –¥—ñ–∞–ª–æ–≥—ñ–≤ */}\n\t\t\t\t\t\t<div className=\"p-4 border-b border-gray-200\">\n\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t<CustomSelect\n\t\t\t\t\t\t\t\tvalue={filters.status}\n\t\t\t\t\t\t\t\tonChange={(value) => setFilters({ ...filters, status: value })}\n\t\t\t\t\t\t\t\toptions={[\n\t\t\t\t\t\t\t\t\t{ value: \"active\", label: \"–ê–∫—Ç–∏–≤–Ω—ñ\" },\n\t\t\t\t\t\t\t\t\t{ value: \"unanswered\", label: \"–í—Ö—ñ–¥–Ω—ñ\" },\n\t\t\t\t\t\t\t\t\t{ value: \"bookmarked\", label: \"–ó–±–µ—Ä–µ–∂–µ–Ω—ñ\" },\n\t\t\t\t\t\t\t\t\t{ value: \"all\", label: \"–£—Å—ñ –¥—ñ–∞–ª–æ–≥–∏\" }\n\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\tclassName=\"flex-1\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t{/* –ö–Ω–æ–ø–∫–∞ –æ–Ω–ª–∞–π–Ω —Ñ—ñ–ª—å—Ç—Ä–∞ */}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={() => setFilters({ ...filters, onlineOnly: !filters.onlineOnly })}\n\t\t\t\t\t\t\t\tclassName={`w-3 h-3 rounded-full border-2 transition-colors ${\n\t\t\t\t\t\t\t\t\tfilters.onlineOnly \n\t\t\t\t\t\t\t\t\t\t? 'bg-green-500 border-green-500' \n\t\t\t\t\t\t\t\t\t\t: 'bg-gray-200 border-gray-300 hover:border-gray-400'\n\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\ttitle={filters.onlineOnly ? '–ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –≤—Å—ñ—Ö' : '–¢—ñ–ª—å–∫–∏ –æ–Ω–ª–∞–π–Ω'}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t{/* –ö–Ω–æ–ø–∫–∞ –ø–æ—à—É–∫—É –¥—ñ–∞–ª–æ–≥—É */}\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={toggleSearchForm}\n\t\t\t\t\t\t\t\tclassName={`p-2 rounded-md border transition-colors ${\n\t\t\t\t\t\t\t\t\tshowSearchForm \n\t\t\t\t\t\t\t\t\t\t? 'bg-purple-50 border-purple-300 text-purple-600' \n\t\t\t\t\t\t\t\t\t\t: 'bg-gray-50 border-gray-300 text-gray-600 hover:bg-gray-100'\n\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\ttitle={showSearchForm ? '–ó–∞–∫—Ä–∏—Ç–∏ –ø–æ—à—É–∫' : '–ü–æ—à—É–∫ –¥—ñ–∞–ª–æ–≥—É'}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t\n\t\t\t\t\t{/* –§–æ—Ä–º–∞ –ø–æ—à—É–∫—É –¥—ñ–∞–ª–æ–≥—É */}\n\t\t\t\t\t{showSearchForm && (\n\t\t\t\t\t\t<div className=\"p-4 border-b border-gray-200 bg-gray-50\">\n\t\t\t\t\t\t\t<div className=\"space-y-3\">\n\t\t\t\t\t\t\t\t{/* –í–∏–ø–∞–¥–∞—é—á–∏–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ */}\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<CustomSelect\n\t\t\t\t\t\t\t\t\t\tvalue={searchProfileId}\n\t\t\t\t\t\t\t\t\t\tonChange={(value) => setSearchProfileId(value)}\n\t\t\t\t\t\t\t\t\t\toptions={[\n\t\t\t\t\t\t\t\t\t\t\t{ value: \"\", label: \"–Ü–î –ø—Ä–æ—Ñ—ñ–ª—é\" },\n\t\t\t\t\t\t\t\t\t\t\t...sourceProfiles.map((profile) => ({\n\t\t\t\t\t\t\t\t\t\t\t\tvalue: profile.profileId || '',\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: `${profile.displayName || profile.profileId} (${profile.profileId})`\n\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t{/* –Ü–Ω–ø—É—Ç –¥–ª—è –Ü–î –∫–ª—ñ—î–Ω—Ç–∞ */}\n\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\t\t\t\tvalue={searchClientId}\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setSearchClientId(e.target.value)}\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"–Ü–î –ö–ª—ñ—î–Ω—Ç–∞\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t{/* –ö–Ω–æ–ø–∫–∏ */}\n\t\t\t\t\t\t\t\t<div className=\"flex gap-2\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tonClick={searchDialog}\n\t\t\t\t\t\t\t\t\t\tdisabled={isSearching}\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex-1 px-3 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{isSearching ? '–ü–æ—à—É–∫...' : '–ó–Ω–∞–π—Ç–∏ –¥—ñ–∞–ª–æ–≥'}\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t{searchResult && (\n\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\tonClick={clearSearch}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-3 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t–û—á–∏—Å—Ç–∏—Ç–∏\n\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t\t\n\t\t\t\t\t{/* –°–ø–∏—Å–æ–∫ –¥—ñ–∞–ª–æ–≥—ñ–≤ */}\n\t\t\t\t\t<div className=\"flex-1 overflow-y-auto custom-scroll\" onScroll={searchResult ? undefined : handleDialogsScroll}>\n\t\t\t\t\t\t{searchResult ? (\n\t\t\t\t\t\t\t// –ü–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—à—É–∫—É\n\t\t\t\t\t\t\t<ul className=\"divide-y divide-gray-100\">\n\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\tconst dlg = searchResult;\n\t\t\t\t\t\t\t\t\tconst dialogId = `${dlg.idUser}-${dlg.idInterlocutor}`;\n\t\t\t\t\t\t\t\t\tconst isActive = currentDialogId === dialogId;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t// –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É\n\t\t\t\t\t\t\t\t\tconst formatTime = (dateString: string) => {\n\t\t\t\t\t\t\t\t\t\tif (!dateString) return '';\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tconst date = new Date(dateString);\n\t\t\t\t\t\t\t\t\t\tconst now = new Date();\n\t\t\t\t\t\t\t\t\t\tconst diffMs = now.getTime() - date.getTime();\n\t\t\t\t\t\t\t\t\t\tconst diffMinutes = Math.floor(diffMs / (1000 * 60));\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t// –Ø–∫—â–æ –º–µ–Ω—à–µ 15 —Ö–≤–∏–ª–∏–Ω —Ç–æ–º—É - –ø–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —á–∞—Å\n\t\t\t\t\t\t\t\t\t\tif (diffMinutes < 15) {\n\t\t\t\t\t\t\t\t\t\t\tif (diffMinutes < 1) return '—â–æ–π–Ω–æ';\n\t\t\t\t\t\t\t\t\t\t\treturn `${diffMinutes} —Ö–≤`;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t// –Ü–Ω–∞–∫—à–µ –ø–æ–∫–∞–∑—É—î–º–æ –¥–∞—Ç—É —Ç–∞ —á–∞—Å\n\t\t\t\t\t\t\t\t\t\tconst day = date.getDate().toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\tconst month = (date.getMonth() + 1).toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\tconst hours = date.getHours().toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\tconst minutes = date.getMinutes().toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\treturn `${day}.${month} ${hours}:${minutes}`;\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\tconst timeDisplay = formatTime(dlg.dateUpdated || '');\n\t\t\t\t\t\t\t\t\tconst userProfile = profiles[dlg.idInterlocutor];\n\t\t\t\t\t\t\t\t\tconst userName = userProfile?.name || `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${dlg.idInterlocutor}`;\n\t\t\t\t\t\t\t\t\tconst avatarUrl = userProfile?.personal?.avatar_small;\n\t\t\t\t\t\t\t\t\tconst sourceProfile = getSourceProfileByIdUser(dlg.idUser);\n\t\t\t\t\t\t\t\t\tconst profileAvatar = sourceProfile ? profileAvatars[sourceProfile.id] : null;\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<li key={dialogId}>\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\thref={`/chats/${dialogId}`}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`block px-4 py-3 hover:bg-gray-50 transition-colors ${\n\t\t\t\t\t\t\t\t\t\t\t\t\tisActive ? 'bg-purple-50 border-r-2 border-purple-500' : ''\n\t\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// –ó–±–µ—Ä—ñ–≥–∞—î–º–æ messagesLeft –≤ localStorage –¥–ª—è –¥–æ—Å—Ç—É–ø—É –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –¥—ñ–∞–ª–æ–≥—É\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof dlg.messagesLeft === 'number') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocalStorage.setItem(`messagesLeft_${dialogId}`, dlg.messagesLeft.toString());\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –ê–≤–∞—Ç–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –æ–Ω–ª–∞–π–Ω —Ç–∞ –ø—Ä–æ—Ñ—ñ–ª—å–Ω–∏–º –∞–≤–∞—Ç–∞—Ä–æ–º */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-11 h-11 bg-gray-300 rounded-full overflow-hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{avatarUrl ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src={avatarUrl} alt={userName} className=\"w-full h-full object-cover\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-full h-full flex items-center justify-center text-gray-500 text-lg font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{userName.charAt(0).toUpperCase()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{userProfile?.is_online && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"absolute -top-0 -left-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white\"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –ê–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ—ñ–ª—é –≤ –ø—Ä–∞–≤–æ–º—É –Ω–∏–∂–Ω—å–æ–º—É –∫—É—Ç—ñ */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{profileAvatar && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"absolute -bottom-0 -right-0 w-6 h-6 bg-white rounded-full border border-gray-200 overflow-hidden\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src={profileAvatar} alt=\"Profile\" className=\"w-full h-full object-cover\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥—ñ–∞–ª–æ–≥ */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm font-medium text-gray-900 truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{userName}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-gray-500 ml-2 flex-shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{timeDisplay}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-gray-500 mt-1 truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{sourceProfile?.displayName || `–ü—Ä–æ—Ñ—ñ–ª—å ${dlg.idUser}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{dlg.lastMessage?.content?.message && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-gray-600 mt-1 truncate\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{dlg.lastMessage.content.message}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t) : isLoadingDialogs ? (\n\t\t\t\t\t\t\t<div className=\"divide-y divide-gray-100\">\n\t\t\t\t\t\t\t\t{/* –ü–æ–∫–∞–∑—É—î–º–æ –∫—ñ–ª—å–∫–∞ skeleton –¥—ñ–∞–ª–æ–≥—ñ–≤ */}\n\t\t\t\t\t\t\t\t<DialogSkeleton />\n\t\t\t\t\t\t\t\t<DialogSkeleton />\n\t\t\t\t\t\t\t\t<DialogSkeleton />\n\t\t\t\t\t\t\t\t<DialogSkeleton />\n\t\t\t\t\t\t\t\t<DialogSkeleton />\n\t\t\t\t\t\t\t\t<DialogSkeleton />\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t) : dialogs.length === 0 ? (\n\t\t\t\t\t\t\t<div className=\"text-gray-500 text-center py-8 text-sm\">–ù–µ–º–∞—î –¥—ñ–∞–ª–æ–≥—ñ–≤</div>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<ul className=\"divide-y divide-gray-100\">\n\t\t\t\t\t\t\t\t\t{dialogs.map((dlg, index) => {\n\t\t\t\t\t\t\t\t\t\tconst dialogId = `${dlg.idUser}-${dlg.idInterlocutor}`;\n\t\t\t\t\t\t\t\t\t\tconst isActive = currentDialogId === dialogId;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t// –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —á–∞—Å—É\n\t\t\t\t\t\t\t\t\t\tconst formatTime = (dateString: string) => {\n\t\t\t\t\t\t\t\t\t\t\tif (!dateString) return '';\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\tconst date = new Date(dateString);\n\t\t\t\t\t\t\t\t\t\t\tconst now = new Date();\n\t\t\t\t\t\t\t\t\t\t\tconst diffMs = now.getTime() - date.getTime();\n\t\t\t\t\t\t\t\t\t\t\tconst diffMinutes = Math.floor(diffMs / (1000 * 60));\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t// –Ø–∫—â–æ –º–µ–Ω—à–µ 15 —Ö–≤–∏–ª–∏–Ω —Ç–æ–º—É - –ø–æ–∫–∞–∑—É—î–º–æ –≤—ñ–¥–Ω–æ—Å–Ω–∏–π —á–∞—Å\n\t\t\t\t\t\t\t\t\t\t\tif (diffMinutes < 15) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (diffMinutes < 1) return '—â–æ–π–Ω–æ';\n\t\t\t\t\t\t\t\t\t\t\t\treturn `${diffMinutes} —Ö–≤`;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t// –Ü–Ω–∞–∫—à–µ –ø–æ–∫–∞–∑—É—î–º–æ –¥–∞—Ç—É —Ç–∞ —á–∞—Å\n\t\t\t\t\t\t\t\t\t\t\tconst day = date.getDate().toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\t\tconst month = (date.getMonth() + 1).toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\t\tconst hours = date.getHours().toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\t\tconst minutes = date.getMinutes().toString().padStart(2, '0');\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\treturn `${day}.${month} ${hours}:${minutes}`;\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\tconst timeDisplay = formatTime(dlg.dateUpdated || '');\n\t\t\t\t\t\t\t\t\t\tconst userProfile = profiles[dlg.idInterlocutor];\n\t\t\t\t\t\t\t\t\t\tconst userName = userProfile?.name || `–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á ${dlg.idInterlocutor}`;\n\t\t\t\t\t\t\t\t\t\tconst avatarUrl = userProfile?.personal?.avatar_small;\n\t\t\t\t\t\t\t\t\t\tconst sourceProfile = getSourceProfileByIdUser(dlg.idUser);\n\t\t\t\t\t\t\t\t\t\tconst profileName = sourceProfile?.displayName || '–ù–µ–≤—ñ–¥–æ–º–∏–π –ø—Ä–æ—Ñ—ñ–ª—å';\n\t\t\t\t\t\t\t\t\t\tconst profileAvatarUrl = sourceProfile?.id ? profileAvatars[sourceProfile.id] : null;\n\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t<li key={`${dlg.idUser}-${dlg.idInterlocutor}-${index}`}>\n\t\t\t\t\t\t\t\t\t\t\t\t<Link \n\t\t\t\t\t\t\t\t\t\t\t\t\thref={((dlg as any).__email && (dlg as any).__correspondenceId)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? `/chats/${encodeURIComponent(dialogId)}?openEmailHistory=1&corrId=${encodeURIComponent(String((dlg as any).__correspondenceId))}`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: `/chats/${encodeURIComponent(dialogId)}`} \n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`block p-3 transition-colors ${\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisActive \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'bg-purple-50 border-r-2 border-purple-500' \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'hover:bg-gray-50'\n\t\t\t\t\t\t\t\t\t\t\t\t\t}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// –ó–±–µ—Ä—ñ–≥–∞—î–º–æ messagesLeft –≤ localStorage –¥–ª—è –¥–æ—Å—Ç—É–ø—É –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –¥—ñ–∞–ª–æ–≥—É\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof dlg.messagesLeft === 'number') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlocalStorage.setItem(`messagesLeft_${dialogId}`, dlg.messagesLeft.toString());\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –ê–≤–∞—Ç–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –æ–Ω–ª–∞–π–Ω */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"relative flex-shrink-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-11 h-11 rounded-full overflow-hidden bg-gray-200\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{avatarUrl ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={avatarUrl} \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={userName}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-full object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonError={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Fallback —è–∫—â–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–ª–æ—Å—è\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst target = e.target as HTMLImageElement;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget.style.display = 'none';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget.nextElementSibling?.classList.remove('hidden');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={`w-full h-full flex items-center justify-center text-white bg-purple-500 text-sm font-medium ${avatarUrl ? 'hidden' : ''}`}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{userName.charAt(0).toUpperCase()}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω –ø–æ–∑–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{userProfile?.is_online && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"absolute top-0 left-0 w-3 h-3 bg-green-500 rounded-full border border-white\"></div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –ê–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ—ñ–ª—é –≤ –ø—Ä–∞–≤–æ–º—É –Ω–∏–∂–Ω—å–æ–º—É –∫—É—Ç—ñ */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{profileAvatarUrl && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"absolute -bottom-1 -right-1 w-6 h-6 rounded-full overflow-hidden bg-white border border-gray-300\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={profileAvatarUrl}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={profileName}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-full object-cover\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonError={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∞–≤–∞—Ç–∞—Ä –ø—Ä–æ—Ñ—ñ–ª—é —è–∫—â–æ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst target = e.target as HTMLImageElement;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttarget.parentElement!.style.display = 'none';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –¥—ñ–∞–ª–æ–≥ */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between items-start\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={`font-medium text-sm truncate ${\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisActive ? 'text-purple-900' : 'text-gray-900'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}`}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{userName}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className={`text-xs truncate mt-0.5 ${\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisActive ? 'text-purple-600' : 'text-gray-500'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}`}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{profileName}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-col items-end justify-between gap-1 ml-2 flex-shrink-0 min-h-[2rem]\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className={`text-xs ${isActive ? 'text-purple-500' : 'text-gray-400'}`}>{timeDisplay}</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{(dlg as any).__emailBadge && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center gap-1 text-[11px] text-blue-600 font-bold\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<svg className=\"w-3 h-3\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t–ù–æ–≤–∏–π –ª–∏—Å—Ç\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t{/* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±—ñ–ª—å—à–µ –¥—ñ–∞–ª–æ–≥—ñ–≤ –≤–Ω–∏–∑—É */}\n\t\t\t\t\t\t\t\t{isLoadingMoreDialogs && (\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-center py-4 border-t border-gray-100\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-gray-500 text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"animate-spin w-4 h-4 border-2 border-gray-300 border-t-purple-500 rounded-full\"></div>\n\t\t\t\t\t\t\t\t\t\t\t–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥—ñ–∞–ª–æ–≥—ñ–≤...\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t\t{/* –ü—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å - –∫–æ–Ω—Ç–µ–Ω—Ç —á–∞—Ç—É */}\n\t\t\t\t\t<div className=\"flex-1 bg-gray-50 overflow-hidden\">\n\t\t\t\t\t\t{children}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n}\n","\"use client\";\n\nimport { useEffect, useState } from 'react';\nimport { apiGet, apiPost } from '@/lib/api';\nimport { getSession } from '@/lib/session';\n\ntype Profile = {\n\tid: string;\n\tcredentialLogin: string;\n\tdisplayName: string;\n\tprofileId?: string;\n};\n\ntype AuthStatus = {\n\tprofileId: string;\n\tstatus: 'authenticating' | 'authenticated' | 'failed' | 'no-session';\n\tmessage?: string;\n};\n\n// –í—ñ–¥–æ–º—ñ –ø–∞—Ä–æ–ª—ñ –¥–ª—è –ø—Ä–æ—Ñ—ñ–ª—ñ–≤ (—Ç–∏–º—á–∞—Å–æ–≤–æ –¥–ª—è –¥–µ–º–æ)\nconst KNOWN_PASSWORDS: Record<string, string> = {\n\t'aoshlatyyy@gmail.com': 'aoshlatyyy',\n\t'aaallonnno44ka03@gmail.com': 'aaallonnno44ka03'\n};\n\n// –ì–ª–æ–±–∞–ª—å–Ω–∏–π –∫–µ—à –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä–Ω–∏—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å\nlet profilesCache: Profile[] | null = null;\nlet authStatusesCache: Record<string, AuthStatus> | null = null;\nlet lastCheckTime = 0;\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 —Ö–≤–∏–ª–∏–Ω\n\nexport function ProfileAuthenticator() {\n\tconst [profiles, setProfiles] = useState<Profile[]>([]);\n\tconst [authStatuses, setAuthStatuses] = useState<Record<string, AuthStatus>>({});\n\tconst [isVisible, setIsVisible] = useState(false);\n\tconst [isAuthenticating, setIsAuthenticating] = useState(false);\n\n\tuseEffect(() => {\n\t\t// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–µ—à –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º\n\t\tconst now = Date.now();\n\t\tif (profilesCache && authStatusesCache && (now - lastCheckTime) < CACHE_DURATION) {\n\t\t\tconsole.log('üìã Using cached profiles');\n\t\t\tsetProfiles(profilesCache);\n\t\t\tsetAuthStatuses(authStatusesCache);\n\t\t\t\n\t\t\t// –ü–æ–∫–∞–∑—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –Ω–µ–∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ\n\t\t\tconst needsAuth = Object.values(authStatusesCache).some(status => \n\t\t\t\tstatus.status === 'failed'\n\t\t\t);\n\t\t\tsetIsVisible(needsAuth);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tloadProfilesAndAuthenticate();\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, []);\n\n\tconst loadProfilesAndAuthenticate = async () => {\n\t\ttry {\n\t\t\t// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞–ª–æ–≥—ñ–Ω–∏–≤—Å—è\n\t\t\tconst session = getSession();\n\t\t\tif (!session) {\n\t\t\t\tconsole.log('User not logged in, skipping profile authentication');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// –û—Ç—Ä–∏–º—É—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞\n\t\t\tconsole.log('üîç Loading user profiles...');\n\t\t\tconst userProfiles = await apiGet<Profile[]>('/profiles/my');\n\t\t\tconsole.log('‚úÖ Loaded profiles:', userProfiles.length);\n\t\t\tsetProfiles(userProfiles);\n\n\t\t\t// –ë–∞—Ç—á–æ–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—ñ–≤, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ 429\n\t\t\tconst statuses: Record<string, AuthStatus> = {};\n\t\t\tlet needsAuth = false;\n\t\t\tconst ids = userProfiles.map(p => p.id);\n\t\t\ttry {\n\t\t\t\tconst res = await apiPost<{ results: Record<string, { authenticated: boolean; message: string }> }>(\n\t\t\t\t\t'/profiles/session/status/batch',\n\t\t\t\t\t{ ids }\n\t\t\t\t);\n\t\t\t\tfor (const profile of userProfiles) {\n\t\t\t\t\tconst r = res.results?.[profile.id];\n\t\t\t\t\tif (!profile.profileId) {\n\t\t\t\t\t\tstatuses[profile.id] = { profileId: profile.id, status: 'no-session', message: '–ü—Ä–æ—Ñ—ñ–ª—å –Ω–µ –º–∞—î profileId' };\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tif (r?.authenticated) {\n\t\t\t\t\t\tstatuses[profile.id] = { profileId: profile.id, status: 'authenticated', message: r.message || '–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ' };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstatuses[profile.id] = { profileId: profile.id, status: 'failed', message: r?.message || '–ü–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è' };\n\t\t\t\t\t\tneedsAuth = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\tfor (const profile of userProfiles) {\n\t\t\t\t\tstatuses[profile.id] = { profileId: profile.id, status: 'failed', message: '–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å–µ—Å—ñ—ó' };\n\t\t\t\t}\n\t\t\t\tneedsAuth = true;\n\t\t\t}\n\n\t\t\tsetAuthStatuses(statuses);\n\t\t\t\n\t\t\t// –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ –∫–µ—à\n\t\t\tprofilesCache = userProfiles;\n\t\t\tauthStatusesCache = statuses;\n\t\t\tlastCheckTime = Date.now();\n\t\t\t\n\t\t\t// –ü–æ–∫–∞–∑—É—î–º–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è\n\t\t\tif (needsAuth) {\n\t\t\t\tsetIsVisible(true);\n\t\t\t\t// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î–º–æ –ø—Ä–æ—Ñ—ñ–ª—ñ –∑ –≤—ñ–¥–æ–º–∏–º–∏ –ø–∞—Ä–æ–ª—è–º–∏\n\t\t\t\tawait autoAuthenticateKnownProfiles(userProfiles, statuses);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.error('Failed to load profiles:', error);\n\t\t\t// –ü–æ–∫–∞–∑—É—î–º–æ –±—ñ–ª—å—à –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–æ–º–∏–ª–∫—É\n\t\t\tif (error instanceof Error) {\n\t\t\t\tconsole.error('Error details:', error.message);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst autoAuthenticateKnownProfiles = async (userProfiles: Profile[], statuses: Record<string, AuthStatus>) => {\n\t\tsetIsAuthenticating(true);\n\t\t\n\t\tfor (const profile of userProfiles) {\n\t\t\tconst status = statuses[profile.id];\n\t\t\tif (status?.status === 'failed' && profile.credentialLogin) {\n\t\t\t\tconst knownPassword = KNOWN_PASSWORDS[profile.credentialLogin];\n\t\t\t\tif (knownPassword) {\n\t\t\t\t\tawait authenticateProfile(profile.id, knownPassword);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tsetIsAuthenticating(false);\n\t};\n\n\tconst authenticateProfile = async (profileId: string, password: string) => {\n\t\tsetAuthStatuses(prev => ({\n\t\t\t...prev,\n\t\t\t[profileId]: { ...prev[profileId], status: 'authenticating', message: '–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è...' }\n\t\t}));\n\n\t\ttry {\n\t\t\tawait apiPost(`/profiles/${profileId}/authenticate`, { password });\n\t\t\tconst newStatuses = {\n\t\t\t\t...authStatuses,\n\t\t\t\t[profileId]: { ...authStatuses[profileId], status: 'authenticated' as const, message: '–£—Å–ø—ñ—à–Ω–æ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ' }\n\t\t\t};\n\t\t\tsetAuthStatuses(newStatuses);\n\t\t\t\n\t\t\t// –û–Ω–æ–≤–ª—é—î–º–æ –∫–µ—à\n\t\t\tauthStatusesCache = newStatuses;\n\t\t\t\n\t\t\t// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—Å—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst currentStatuses = authStatuses;\n\t\t\t\tconst allAuthenticated = Object.values(currentStatuses).every(status => \n\t\t\t\t\tstatus.status === 'authenticated' || status.status === 'no-session'\n\t\t\t\t);\n\t\t\t\t\n\t\t\t\tif (allAuthenticated) {\n\t\t\t\t\tsetIsVisible(false);\n\t\t\t\t\t// –ù–ï –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É - —Ü–µ –≤–∏–∫–ª–∏–∫–∞—î –ø–æ–≤—Ç–æ—Ä–Ω—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è\n\t\t\t\t\tconsole.log('‚úÖ –í—Å—ñ –ø—Ä–æ—Ñ—ñ–ª—ñ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ');\n\t\t\t\t}\n\t\t\t}, 1000);\n\t\t} catch {\n\t\t\tsetAuthStatuses(prev => ({\n\t\t\t\t...prev,\n\t\t\t\t[profileId]: { ...prev[profileId], status: 'failed', message: '–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó' }\n\t\t\t}));\n\t\t}\n\t};\n\n\tif (!isVisible) return null;\n\n\tconst needsAuthProfiles = profiles.filter(p => \n\t\tauthStatuses[p.id]?.status === 'failed' || authStatuses[p.id]?.status === 'authenticating'\n\t);\n\n\tif (needsAuthProfiles.length === 0) return null;\n\n\treturn (\n\t\t<div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n\t\t\t<div className=\"bg-white rounded-lg p-6 max-w-md w-full mx-4\">\n\t\t\t\t<h2 className=\"text-xl font-bold mb-4\">–ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—ñ–≤</h2>\n\t\t\t\t{isAuthenticating ? (\n\t\t\t\t\t<p className=\"text-blue-600 mb-4\">\n\t\t\t\t\t\tüîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø—Ä–æ—Ñ—ñ–ª—ñ–≤...\n\t\t\t\t\t</p>\n\t\t\t\t) : (\n\t\t\t\t\t<p className=\"text-gray-600 mb-4\">\n\t\t\t\t\t\t–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥—ñ–∞–ª–æ–≥—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—ñ TalkyTimes:\n\t\t\t\t\t</p>\n\t\t\t\t)}\n\t\t\t\t\n\t\t\t\t<div className=\"space-y-4\">\n\t\t\t\t\t{needsAuthProfiles.map(profile => {\n\t\t\t\t\t\tconst status = authStatuses[profile.id];\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<div key={profile.id} className=\"border rounded p-3\">\n\t\t\t\t\t\t\t\t<div className=\"font-medium\">{profile.displayName}</div>\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-gray-600\">{profile.credentialLogin}</div>\n\t\t\t\t\t\t\t\t<div className=\"text-xs text-gray-500 mt-1\">\n\t\t\t\t\t\t\t\t\t–°—Ç–∞—Ç—É—Å: {status?.message || '–ù–µ–≤—ñ–¥–æ–º–æ'}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t{status?.status === 'failed' && (\n\t\t\t\t\t\t\t\t\t<div className=\"mt-2\">\n\t\t\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\t\t\ttype=\"password\"\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"–ü–∞—Ä–æ–ª—å TalkyTimes\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"border rounded px-2 py-1 w-full text-sm\"\n\t\t\t\t\t\t\t\t\t\t\tonKeyDown={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'Enter') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst password = (e.target as HTMLInputElement).value;\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (password) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tauthenticateProfile(profile.id, password);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t{status?.status === 'authenticating' && (\n\t\t\t\t\t\t\t\t\t<div className=\"mt-2 text-sm text-blue-600\">\n\t\t\t\t\t\t\t\t\t\tüîÑ –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è...\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t{status?.status === 'authenticated' && (\n\t\t\t\t\t\t\t\t\t<div className=\"mt-2 text-sm text-green-600\">\n\t\t\t\t\t\t\t\t\t\t‚úÖ –£—Å–ø—ñ—à–Ω–æ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div className=\"mt-4 flex gap-2\">\n\t\t\t\t\t{!isAuthenticating && (\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={() => autoAuthenticateKnownProfiles(profiles, authStatuses)}\n\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tüîÑ –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ\n\t\t\t\t\t\t</button>\n\t\t\t\t\t)}\n\t\t\t\t\t<button\n\t\t\t\t\t\tonClick={() => setIsVisible(false)}\n\t\t\t\t\t\tclassName=\"px-4 py-2 text-sm text-gray-500 hover:text-gray-700 border rounded\"\n\t\t\t\t\t>\n\t\t\t\t\t\t–ü—Ä–æ–ø—É—Å—Ç–∏—Ç–∏\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n","\"use client\";\n\nimport React, { useState, useRef, useEffect } from 'react';\n\ninterface SelectOption {\n  value: string;\n  label: string;\n}\n\ninterface CustomSelectProps {\n  value: string;\n  onChange: (value: string) => void;\n  options: SelectOption[];\n  placeholder?: string;\n  className?: string;\n  disabled?: boolean;\n}\n\nexport const CustomSelect: React.FC<CustomSelectProps> = ({\n  value,\n  onChange,\n  options,\n  placeholder = \"–í–∏–±–µ—Ä—ñ—Ç—å –≤–∞—Ä—ñ–∞–Ω—Ç\",\n  className = \"\",\n  disabled = false,\n}) => {\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedLabel, setSelectedLabel] = useState<string>(\"\");\n  const selectRef = useRef<HTMLDivElement>(null);\n\n  // Update selected label when value or options change\n  useEffect(() => {\n    const selectedOption = options.find(option => option.value === value);\n    setSelectedLabel(selectedOption ? selectedOption.label : placeholder);\n  }, [value, options, placeholder]);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (selectRef.current && !selectRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleSelect = (optionValue: string) => {\n    onChange(optionValue);\n    setIsOpen(false);\n  };\n\n  const toggleDropdown = () => {\n    if (!disabled) {\n      setIsOpen(!isOpen);\n    }\n  };\n\n  return (\n    <div ref={selectRef} className={`relative ${className}`}>\n      {/* Trigger button */}\n      <button\n        type=\"button\"\n        onClick={toggleDropdown}\n        disabled={disabled}\n        className={`\n          w-full px-3 py-2 text-left bg-white border border-gray-300 rounded-md\n          hover:border-gray-400 focus:border-purple-500 focus:outline-none focus:ring-1 focus:ring-purple-500\n          disabled:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed\n          transition-colors duration-200 flex items-center justify-between\n        `}\n      >\n        <span className={selectedLabel === placeholder ? \"text-gray-500\" : \"text-gray-900\"}>\n          {selectedLabel}\n        </span>\n        <svg\n          className={`w-4 h-4 text-gray-400 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`}\n          fill=\"none\"\n          stroke=\"currentColor\"\n          viewBox=\"0 0 24 24\"\n        >\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n        </svg>\n      </button>\n\n      {/* Dropdown */}\n      {isOpen && (\n        <div className=\"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto custom-scroll\">\n          {options.map((option) => (\n            <button\n              key={option.value}\n              onClick={() => handleSelect(option.value)}\n              className={`\n                w-full px-3 py-2 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none\n                transition-colors duration-150\n                ${option.value === value ? 'bg-purple-50 text-purple-700 font-medium' : 'text-gray-900'}\n              `}\n            >\n              {option.label}\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}