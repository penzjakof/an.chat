module.exports=[24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},39107,a=>{"use strict";function b(){return null}function c(a){}function d(){}function e(){return b()?.accessToken??null}function f(){return b()?.role??null}function g(){return b()?.agencyCode??null}function h(){let a=b();if(a?.userId)return a.userId;let c=a?.accessToken;if(!c)return null;try{let[,a]=c.split(".");return JSON.parse(atob(a)).sub??null}catch{return null}}a.s(["clearSession",()=>d,"getAccessToken",()=>e,"getAgencyCode",()=>g,"getRole",()=>f,"getSession",()=>b,"getUserId",()=>h,"setSession",()=>c])},85749,a=>{"use strict";a.s(["ToastProvider",()=>h,"useToast",()=>i],85749);var b=a.i(87924),c=a.i(72131),d=a.i(50944);function e({toast:a,onClose:e}){let[f,g]=(0,c.useState)(!1),h=(0,d.useRouter)(),i=(0,d.usePathname)();(0,c.useEffect)(()=>{let b=setTimeout(()=>{g(!0)},100),c=setTimeout(()=>{g(!1),setTimeout(()=>e(a.id),300)},5e3);return()=>{clearTimeout(b),clearTimeout(c)}},[a.id,e]);let j=()=>{if(a.dialogId){let b=`/chats/${a.dialogId}`;i===b?console.log("🔗 Toast clicked: already on target page",a.dialogId,"- just closing toast"):(console.log("🔗 Toast clicked: navigating to dialog",a.dialogId),h.push(b))}g(!1),setTimeout(()=>e(a.id),300)},k={new_message:{bg:"#1e40af",border:"#1d4ed8",icon:"💬",label:"Нове повідомлення"},new_email:{bg:"#0b3a6f",border:"#2563eb",icon:"✉️",label:"Новий лист"},success:{bg:"#065f46",border:"#059669",icon:"✅",label:"Успіх"},error:{bg:"#7f1d1d",border:"#dc2626",icon:"❌",label:"Помилка"},info:{bg:"#1f2937",border:"#374151",icon:"ℹ️",label:"Інфо"}}[a.type];return(0,b.jsx)("div",{className:`
        fixed top-4 right-4 z-[9999] max-w-sm w-full rounded-lg shadow-2xl border-2
        transform transition-all duration-300 ease-in-out cursor-pointer
        ${f?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,style:{zIndex:9999,backgroundColor:k.bg,borderColor:k.border,color:"white",minHeight:"80px",width:"320px",padding:"16px"},onClick:j,children:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"flex-start"},children:[(0,b.jsx)("div",{style:{flexShrink:0,marginRight:"12px"},children:(0,b.jsx)("div",{style:{width:"32px",height:"32px",backgroundColor:k.border,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsx)("span",{style:{fontSize:"14px"},children:k.icon})})}),(0,b.jsx)("div",{style:{flex:1},children:"new_message"===a.type||"new_email"===a.type?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("p",{style:{color:"white",fontSize:"14px",fontWeight:"bold",margin:0,lineHeight:"1.4"},children:[k.icon," ",k.label,"!"]}),(0,b.jsxs)("p",{style:{color:"#e0e7ff",fontSize:"14px",margin:"4px 0 0 0",lineHeight:"1.4"},children:["Від користувача ",a.idUserFrom]}),(0,b.jsxs)("p",{style:{color:"#c7d2fe",fontSize:"12px",margin:"4px 0 0 0",lineHeight:"1.4"},children:[a.dateCreated?new Date(a.dateCreated).toLocaleTimeString():"",a.dialogId&&(i===`/chats/${a.dialogId}`?" • Натисніть щоб закрити":" • Натисніть щоб відкрити")]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("p",{style:{color:"white",fontSize:"14px",fontWeight:"bold",margin:0,lineHeight:"1.4"},children:[k.icon," ",a.title||k.label]}),a.message&&(0,b.jsx)("p",{style:{color:"#e5e7eb",fontSize:"13px",margin:"6px 0 0 0",lineHeight:"1.5"},children:a.message})]})}),(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),j()},style:{color:"#e0e7ff",marginLeft:"8px"},className:"flex-shrink-0 hover:opacity-80",children:(0,b.jsx)("svg",{style:{width:"16px",height:"16px"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})}function f({toasts:a,onRemoveToast:c}){return(0,b.jsx)("div",{className:"fixed top-0 right-0 z-50 p-4 space-y-2",children:a.map((a,d)=>(0,b.jsx)("div",{style:{transform:`translateY(${80*d}px)`},className:"transition-transform duration-300",children:(0,b.jsx)(e,{toast:a,onClose:c})},a.id))})}let g=(0,c.createContext)(null);function h({children:a}){let[d,e]=(0,c.useState)([]),h=(0,c.useCallback)(a=>{let b=`toast-${Date.now()}-${Math.random()}`,c={...a,id:b};e(a=>[...a,c])},[]),i=(0,c.useCallback)(a=>{e(b=>b.filter(b=>b.id!==a))},[]);return(0,b.jsxs)(g.Provider,{value:{showToast:h,removeToast:i},children:[a,(0,b.jsx)(f,{toasts:d,onRemoveToast:i})]})}function i(){let a=(0,c.useContext)(g);if(!a)throw Error("useToast must be used within a ToastProvider");return a}},20924,a=>{"use strict";a.s(["WebSocketPoolProvider",()=>g,"useWebSocketPool",()=>h]);var b=a.i(87924),c=a.i(72131),d=a.i(83915),e=a.i(39107);let f=(0,c.createContext)(null);function g({children:a}){let g=(0,c.useRef)(new Map),h=(0,c.useRef)(new Map),i=(0,c.useRef)(new Map),j=(0,c.useCallback)(a=>{let b=g.current.get(a);if(b)return console.log(`🔌 Socket already exists for profile ${a}, reusing`),b;let c=(0,e.getAccessToken)(),f=process.env.NEXT_PUBLIC_SOCKET_BASE||"http://localhost:4000";if(!c)return console.warn(`🔌 No token available for profile ${a}`),null;let i=(0,d.io)(`${f}`,{transports:["polling"],upgrade:!1,path:"/socket.io/",auth:{token:c,profileId:a},timeout:1e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});return i.on("connect",()=>{let b=h.current.get(a);b&&i.emit("join",{dialogId:b})}),i.on("disconnect",b=>{console.log(`🔌 WebSocket disconnected for profile ${a}:`,b)}),i.on("connect_error",b=>{console.warn(`🔌 WebSocket connection error for profile ${a}:`,b.message)}),g.current.set(a,i),i},[]),k=(0,c.useCallback)(a=>{let b=i.current.get(a);b&&(clearTimeout(b),i.current.delete(a));let c=g.current.get(a);return c?c.connected||c.connecting||c.connect():c=j(a),c},[j]),l=(0,c.useCallback)((a,b)=>{let c=k(a);if(!c)return;let d=h.current.get(a);d&&d!==b&&c.emit("leave",{dialogId:d}),c.emit("join",{dialogId:b}),h.current.set(a,b)},[k]),m=(0,c.useCallback)((a,b)=>{let c=g.current.get(a);if(!c)return;c.emit("leave",{dialogId:b}),h.current.delete(a);let d=setTimeout(()=>{n(a)},3e4);i.current.set(a,d)},[]),n=(0,c.useCallback)(a=>{let b=g.current.get(a);if(b){b.disconnect(),g.current.delete(a),h.current.delete(a);let c=i.current.get(a);c&&(clearTimeout(c),i.current.delete(a)),console.log(`🔌 Disconnected profile ${a}`)}},[]),o=(0,c.useCallback)(()=>{console.log("🔌 Disconnecting all WebSocket connections"),i.current.forEach(a=>clearTimeout(a)),i.current.clear(),g.current.forEach((a,b)=>{a.disconnect(),console.log(`🔌 Disconnected profile ${b}`)}),g.current.clear(),h.current.clear()},[]);return c.default.useEffect(()=>()=>{o()},[o]),(0,b.jsx)(f.Provider,{value:{getSocketForProfile:k,joinDialog:l,leaveDialog:m,disconnectProfile:n,disconnectAll:o},children:a})}function h(){let a=(0,c.useContext)(f);if(!a)throw Error("useWebSocketPool must be used within a WebSocketPoolProvider");return a}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fd822d4f._.js.map