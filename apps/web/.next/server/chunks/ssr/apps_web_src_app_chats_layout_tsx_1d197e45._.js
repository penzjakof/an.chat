module.exports=[31714,a=>{"use strict";a.s(["default",()=>q],31714);var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(50944),f=a.i(83915),g=a.i(69844),h=a.i(39107);let i={"aoshlatyyy@gmail.com":"aoshlatyyy","aaallonnno44ka03@gmail.com":"aaallonnno44ka03"},j=null,k=null,l=0;function m(){let[a,d]=(0,c.useState)([]),[e,f]=(0,c.useState)({}),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let a=Date.now();if(j&&k&&a-l<3e5){console.log("📋 Using cached profiles"),d(j),f(k),n(Object.values(k).some(a=>"failed"===a.status));return}q()},[]);let q=async()=>{try{if(!(0,h.getSession)())return void console.log("User not logged in, skipping profile authentication");console.log("🔍 Loading user profiles...");let a=await (0,g.apiGet)("/profiles/my");console.log("✅ Loaded profiles:",a.length),d(a);let b={},c=!1,e=a.map(a=>a.id);try{let d=await (0,g.apiPost)("/profiles/session/status/batch",{ids:e});for(let e of a){let a=d.results?.[e.id];if(!e.profileId){b[e.id]={profileId:e.id,status:"no-session",message:"Профіль не має profileId"};continue}a?.authenticated?b[e.id]={profileId:e.id,status:"authenticated",message:a.message||"Автентифіковано"}:(b[e.id]={profileId:e.id,status:"failed",message:a?.message||"Потрібна автентифікація"},c=!0)}}catch{for(let c of a)b[c.id]={profileId:c.id,status:"failed",message:"Помилка перевірки сесії"};c=!0}f(b),j=a,k=b,l=Date.now(),c&&(n(!0),await r(a,b))}catch(a){console.error("Failed to load profiles:",a),a instanceof Error&&console.error("Error details:",a.message)}},r=async(a,b)=>{for(let c of(p(!0),a)){let a=b[c.id];if(a?.status==="failed"&&c.credentialLogin){let a=i[c.credentialLogin];a&&await s(c.id,a)}}p(!1)},s=async(a,b)=>{f(b=>({...b,[a]:{...b[a],status:"authenticating",message:"Автентифікація..."}}));try{await (0,g.apiPost)(`/profiles/${a}/authenticate`,{password:b});let c={...e,[a]:{...e[a],status:"authenticated",message:"Успішно автентифіковано"}};f(c),k=c,setTimeout(()=>{Object.values(e).every(a=>"authenticated"===a.status||"no-session"===a.status)&&(n(!1),console.log("✅ Всі профілі автентифіковані"))},1e3)}catch{f(b=>({...b,[a]:{...b[a],status:"failed",message:"Помилка автентифікації"}}))}};if(!m)return null;let t=a.filter(a=>e[a.id]?.status==="failed"||e[a.id]?.status==="authenticating");return 0===t.length?null:(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Автентифікація профілів"}),o?(0,b.jsx)("p",{className:"text-blue-600 mb-4",children:"🔄 Автоматична автентифікація профілів..."}):(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Для отримання діалогів потрібно автентифікувати профілі TalkyTimes:"}),(0,b.jsx)("div",{className:"space-y-4",children:t.map(a=>{let c=e[a.id];return(0,b.jsxs)("div",{className:"border rounded p-3",children:[(0,b.jsx)("div",{className:"font-medium",children:a.displayName}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:a.credentialLogin}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Статус: ",c?.message||"Невідомо"]}),c?.status==="failed"&&(0,b.jsx)("div",{className:"mt-2",children:(0,b.jsx)("input",{type:"password",placeholder:"Пароль TalkyTimes",className:"border rounded px-2 py-1 w-full text-sm",onKeyDown:b=>{if("Enter"===b.key){let c=b.target.value;c&&s(a.id,c)}}})}),c?.status==="authenticating"&&(0,b.jsx)("div",{className:"mt-2 text-sm text-blue-600",children:"🔄 Автентифікація..."}),c?.status==="authenticated"&&(0,b.jsx)("div",{className:"mt-2 text-sm text-green-600",children:"✅ Успішно автентифіковано"})]},a.id)})}),(0,b.jsxs)("div",{className:"mt-4 flex gap-2",children:[!o&&(0,b.jsx)("button",{onClick:()=>r(a,e),className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 text-sm",children:"🔄 Автентифікувати автоматично"}),(0,b.jsx)("button",{onClick:()=>n(!1),className:"px-4 py-2 text-sm text-gray-500 hover:text-gray-700 border rounded",children:"Пропустити"})]})]})})}var n=a.i(46614);let o=({value:a,onChange:d,options:e,placeholder:f="Виберіть варіант",className:g="",disabled:h=!1})=>{let[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(""),m=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let b=e.find(b=>b.value===a);l(b?b.label:f)},[a,e,f]),(0,c.useEffect)(()=>{let a=a=>{m.current&&!m.current.contains(a.target)&&j(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),(0,b.jsxs)("div",{ref:m,className:`relative ${g}`,children:[(0,b.jsxs)("button",{type:"button",onClick:()=>{h||j(!i)},disabled:h,className:`
          w-full px-3 py-2 text-left bg-white border border-gray-300 rounded-md
          hover:border-gray-400 focus:border-purple-500 focus:outline-none focus:ring-1 focus:ring-purple-500
          disabled:bg-gray-50 disabled:text-gray-400 disabled:cursor-not-allowed
          transition-colors duration-200 flex items-center justify-between
        `,children:[(0,b.jsx)("span",{className:k===f?"text-gray-500":"text-gray-900",children:k}),(0,b.jsx)("svg",{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),i&&(0,b.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto custom-scroll",children:e.map(c=>(0,b.jsx)("button",{onClick:()=>{d(c.value),j(!1)},className:`
                w-full px-3 py-2 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none
                transition-colors duration-150
                ${c.value===a?"bg-purple-50 text-purple-700 font-medium":"text-gray-900"}
              `,children:c.label},c.value))})]})};var p=a.i(85749);function q({children:a}){let i=(0,e.useRouter)(),j=(0,e.usePathname)(),{showToast:k}=(0,p.useToast)(),[l,q]=(0,c.useState)([]),[r,s]=(0,c.useState)({}),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)({}),[x,y]=(0,c.useState)(!0),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!0),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)({status:"unanswered",onlineOnly:!1}),[H,I]=(0,c.useState)(!0),J=(0,c.useRef)(F);(0,c.useEffect)(()=>{J.current=F},[F]),(0,c.useEffect)(()=>{(async()=>{if(!(0,h.getSession)())return i.replace("/login");try{let a=await (0,g.apiGet)("/api/shifts/is-active");a?.active||i.replace("/dashboard")}catch{}})()},[i]);let[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(!1),U=j.includes("/chats/")&&"/chats"!==j?j.split("/chats/")[1]:null,V=async()=>{if(!M||!O)return void alert("Будь ласка, оберіть профіль та введіть ІД клієнта");if(!(0,h.getSession)())return void i.replace("/login");try{T(!0);let a=new URLSearchParams;a.set("profileId",M),a.set("clientId",O);let b=await (0,g.apiGet)(`/api/chats/search-dialog?${a.toString()}`);b&&b.dialog?(R(b.dialog),b.profiles&&s(a=>({...a,...b.profiles}))):(R(null),alert("Діалог не знайдено"))}catch(a){console.error("Failed to search dialog:",a),alert("Помилка при пошуку діалогу"),R(null)}finally{T(!1)}},W=()=>{R(null),N(""),P(""),L(!1)},X=async(a,b=!0)=>{if(!(0,h.getSession)())return void i.replace("/login");try{b?(y(!0),q([]),E(""),C(!0)):A(!0);let e=new URLSearchParams;"active"!==a.status&&e.set("status",a.status),a.onlineOnly&&e.set("onlineOnly","true"),!b&&D&&e.set("cursor",D);let f=`/api/chats/dialogs${e.toString()?"?"+e.toString():""}`,h=await (0,g.apiGet)(f);if(console.log(`📥 Frontend received response:`,{dialogsCount:h?.dialogs?.length,cursor:h?.cursor,hasMore:h?.hasMore,isInitial:b}),h&&Array.isArray(h.dialogs)){var c,d;let e=(c=h.dialogs,d=h.profiles,"unanswered"!==a.status?c:c.filter(a=>{if(a?.isBlocked===!0||a?.is_blocked===!0)return!1;let b=d?.[a.idInterlocutor];return!b||!0!==b.is_blocked}));if(b)q(e),s(h.profiles||{}),u(h.sourceProfiles||[]),(async()=>{try{let a=h.profiles||{},b=[];for(let c of e){let d=c?.idInterlocutor,e=c?.idUser;"number"!=typeof d||"number"!=typeof e||a[d]||b.push({ttProfileId:e,clientId:d})}for(let a of b.slice(0,25)){let b=await _(a.ttProfileId);b&&await aa(b,a.clientId)}}catch{}})();else{let a=new Set(l.map(a=>`${a.idUser}-${a.idInterlocutor}`)),b=e.filter(b=>!a.has(`${b.idUser}-${b.idInterlocutor}`));if(console.log(`📄 Dialogs pagination: loaded ${h.dialogs.length} dialogs, ${b.length} new`),console.log(`📊 Current dialogs count: ${l.length}, existing IDs sample:`,Array.from(a).slice(0,5)),console.log(`📊 New dialogs sample:`,b.slice(0,3).map(a=>`${a.idUser}-${a.idInterlocutor}`)),0===b.length){console.log(`⏹️ No new dialogs after filtering, stopping pagination`),C(!1);return}let c=l.length+b.length;c>500&&(console.log(`🛑 Reached maximum dialogs limit (${c}), stopping pagination`),C(!1)),q(a=>[...a,...b]),s(a=>({...a,...h.profiles||{}})),u(a=>[...a,...h.sourceProfiles||[]])}E(h.cursor||""),C(!!h.hasMore)}else b&&(q([]),s({}),u([]))}catch(a){console.error("Failed to load dialogs:",a),b&&(q([]),s({}),u([]))}finally{b?y(!1):A(!1)}};(0,c.useEffect)(()=>(X(F),()=>{Z.current&&clearTimeout(Z.current)}),[i,F]),(0,c.useEffect)(()=>{let a=a=>{let b=a.detail;b&&J.current?.status==="unanswered"&&q(a=>a.filter(a=>{if(a.idUser!==b.profileId||a.idInterlocutor!==b.clientId)return!0;let c=!0===a.__email;return"email"===b.kind?!c:c}))};return window.addEventListener("dialog:sent",a),()=>window.removeEventListener("dialog:sent",a)},[]),(0,c.useEffect)(()=>{if("unanswered"!==F.status)return;let a=setInterval(()=>{X(F,!0)},6e4);return()=>clearInterval(a)},[F]);let Y=async()=>{B&&!z&&!x&&D&&(console.log(`🔄 Loading more dialogs with cursor: ${D}`),await X(F,!1))},Z=(0,c.useRef)(null);(0,c.useEffect)(()=>{t.length>0&&ad()},[t]),(0,c.useEffect)(()=>{let a=(0,h.getAccessToken)();if(!a)return;let b=process.env.NEXT_PUBLIC_SOCKET_BASE||"http://localhost:4000",c=(0,f.io)(b,{transports:["polling"],upgrade:!1,path:"/socket.io/",auth:{token:a}});return c.on("user_online_status",a=>{console.log("👤 RTM: User online status changed in dialogs list",a),s(b=>({...b,[a.userId]:b[a.userId]?{...b[a.userId],is_online:a.isOnline}:b[a.userId]}))}),c.on("message_toast",a=>{console.log("🍞 RTM: Message toast in dialogs list",a),q(b=>{let c=(a.dialogId||"").split("-"),d=Number(c[0]),e=Number(c[1]),f=isNaN(d)?a.idUserFrom:d,g=isNaN(e)?a.idUserTo:e;if(J.current?.status==="unanswered"&&"new_email"!==a.type&&a.idUserFrom===f){let a=b.filter(a=>a.idUser!==f||a.idInterlocutor!==g);if(a.length!==b.length)return a}if("new_email"===a.type||a.correspondenceId)return[{idUser:f,idInterlocutor:g,dateUpdated:a.dateCreated,lastMessage:{content:{message:a.title||"Новий лист"}},__email:!0,__emailBadge:!0,__correspondenceId:a.correspondenceId},...b];let h=b.findIndex(a=>a.idUser===f&&a.idInterlocutor===g&&!a.__email);return -1!==h?[{...b[h],dateUpdated:a.dateCreated},...b.filter((a,b)=>b!==h)]:[{idUser:f,idInterlocutor:g,dateUpdated:a.dateCreated,lastMessage:{content:{}}},...b]}),(async()=>{let b=(a.dialogId||"").split("-"),c=Number(b[0]),d=Number(b[1]),e=isNaN(c)?null:await _(c);e&&e&&!isNaN(d)&&await aa(e,d)})()}),c.on("message",a=>{console.log("📨 RTM: New message in dialogs list",a),q(b=>{let c=a.idUserFrom,d=a.idUserTo,e=a=>a.idUser===c&&a.idInterlocutor===d||a.idUser===d&&a.idInterlocutor===c;if(J.current?.status==="unanswered"&&b.some(a=>a.idUser===c&&a.idInterlocutor===d))return b.filter(a=>a.idUser!==c||a.idInterlocutor!==d);let f=b.findIndex(a=>e(a)&&!a.__email);return -1!==f?[{...b[f],lastMessage:{content:a.content},dateUpdated:a.dateCreated},...b.filter((a,b)=>b!==f)]:(b.findIndex(a=>e(a)&&a.__email),[{idUser:c,idInterlocutor:d,dateUpdated:a.dateCreated,lastMessage:{content:a.content}},...b])})}),c.on("shift_ended",a=>{let b=(0,h.getUserId)();b&&a?.operatorId&&b===a.operatorId&&i.replace("/dashboard")}),()=>{c.off("shift_ended"),c.off("message_toast"),c.disconnect()}},[]);let $=a=>t.find(b=>b.profileId===a.toString()),_=async a=>{let b=(a=>{let b=t.find(b=>b.profileId===String(a));return b?.id||null})(a);if(b)return b;try{let b=await (0,g.apiGet)("/profiles/my"),c=Array.isArray(b)?b.find(b=>b.profileId===String(a)):null;return c?.id||null}catch{return null}},aa=async(a,b)=>{if(!r[b])try{let c=await (0,g.apiGet)(`/profiles/${a}/client/${b}/public`),d=c?.profile?.personal,e=d?.avatar_small||d?.avatar_large||d?.avatar_xl||"",f=d?.avatar_large||d?.avatar_xl||d?.avatar_small||"",h=d?.avatar_xl||d?.avatar_large||d?.avatar_small||"";if(!e)try{let c=await (0,g.apiPost)(`/profiles/${a}/client/${b}/photos`,{}),d=c?.data||c,i=[...Array.isArray(d?.public)?d.public:[],...Array.isArray(d?.private)?d.private:[]],j=i.find(a=>a?.isMain===1||a?.is_main===1)||i[0];j&&(e=j.url_small||j.url_medium||j.url_large||j.url_xl||j.url_xs||"",f=j.url_large||j.url_xl||j.url_medium||j.url_small||"",h=j.url_xl||j.url_large||j.url_medium||j.url_small||"")}catch{}(d||e)&&s(a=>({...a,[b]:{id:b,id_user:b,name:d?.name?d.name:`Користувач ${b}`,personal:{avatar_small:e,avatar_large:f,avatar_xl:h,age:"number"==typeof d?.age?d.age:d?.age&&parseInt(String(d.age))||0},is_online:!!c?.profile?.is_online,last_visit:c?.profile?.last_visit||""}}))}catch{}},ab=a=>{try{let b=localStorage.getItem(`tt_profile_${a}`);if(b){let c=JSON.parse(b);if(Date.now()-c.timestamp<864e5)return c.profileData;localStorage.removeItem(`tt_profile_${a}`)}}catch(a){console.warn("Error reading profile cache:",a)}return null},ac=(a,b)=>{try{localStorage.setItem(`tt_profile_${a}`,JSON.stringify({profileData:b,timestamp:Date.now()}))}catch(a){console.warn("Error saving profile cache:",a)}},ad=async()=>{let a={};for(let b of t){if(!b.id)continue;let c=ab(b.id);if(c&&c.personal?.avatar_large){a[b.id]=c.personal.avatar_large;continue}try{let c=await (0,g.apiGet)(`/profiles/${b.id}/profile-data`);c.success&&c.profileData?.personal?.avatar_large&&(a[b.id]=c.profileData.personal.avatar_large,ac(b.id,c.profileData))}catch(a){console.warn(`Failed to load profile data for ${b.id}:`,a)}}w(a)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m,{}),(0,b.jsxs)("div",{className:"flex flex-col h-screen",children:[(0,b.jsxs)("header",{className:"h-12 bg-white border-b border-gray-200 flex items-center px-4 gap-4 flex-shrink-0",children:[(0,b.jsx)("div",{className:"font-bold text-xl text-[#680098] mr-4",children:"AnChat"}),(0,b.jsxs)("button",{onClick:()=>i.push("/dashboard"),className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100",title:"На дашборд",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-700",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5"})}),(0,b.jsx)("span",{className:"text-[14px] text-gray-500",children:"Дашборд"})]}),(0,b.jsxs)("button",{onClick:()=>i.push("/chats"),className:`flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100 ${j.includes("/chats")?"bg-blue-50 text-blue-700":""}`,title:"Чати",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${j.includes("/chats")?"text-blue-600":"text-gray-700"}`,children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25Z"})}),(0,b.jsx)("span",{className:`text-[14px] ${j.includes("/chats")?"text-blue-700 font-medium":"text-gray-500"}`,children:"Чати"})]}),(0,b.jsxs)("button",{onClick:()=>i.push("/settings"),className:`flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100 ${j.includes("/settings")?"bg-blue-50 text-blue-700":""}`,title:"Налаштування",children:[(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${j.includes("/settings")?"text-blue-600":"text-gray-700"}`,children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.165.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.108 1.204.165.397.506.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.108 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.939-1.11.939h-1.094c-.55 0-1.019-.397-1.11-.94l-.148-.893c-.071-.425-.383-.763-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.939-.56-.939-1.109v-1.094c0-.55.397-1.019.94-1.11l.894-.149c.424-.07.763-.383.929-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,b.jsx)("span",{className:`text-[14px] ${j.includes("/settings")?"text-blue-700 font-medium":"text-gray-500"}`,children:"Налаштування"})]}),(0,b.jsxs)("div",{className:"ml-auto flex items-center gap-4",children:[(0,b.jsxs)("button",{onClick:async()=>{try{await (0,g.apiPost)("/api/shifts/end",{}),k({messageId:"",type:"info",message:"Зміну завершено"}),i.replace("/dashboard")}catch{k({messageId:"",type:"error",message:"Не вдалося завершити зміну"})}},className:"group flex items-center gap-2 px-3 py-2 rounded hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed",title:"Завершити зміну",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",strokeWidth:1.5,className:"w-5 h-5 text-gray-700 group-hover:text-red-600 group-hover:fill-red-600 transition-all border border-gray-400 rounded group-hover:border-red-600",fill:"none",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"})}),(0,b.jsx)("span",{className:"text-[14px] text-gray-500 group-hover:text-red-500 transition-colors",children:"Завершити"})]}),(0,b.jsxs)("button",{onClick:()=>{(0,h.clearSession)(),i.replace("/login")},className:"flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100",title:"Вийти",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5 text-gray-700",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})}),(0,b.jsx)("span",{className:"text-[14px] text-gray-500",children:"Вийти"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,b.jsxs)("div",{className:"w-[320px] bg-white border-r border-gray-200 flex flex-col",children:[(0,b.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(o,{value:F.status,onChange:a=>G({...F,status:a}),options:[{value:"active",label:"Активні"},{value:"unanswered",label:"Вхідні"},{value:"bookmarked",label:"Збережені"},{value:"all",label:"Усі діалоги"}],className:"flex-1"}),(0,b.jsx)("button",{onClick:()=>G({...F,onlineOnly:!F.onlineOnly}),className:`w-3 h-3 rounded-full border-2 transition-colors ${F.onlineOnly?"bg-green-500 border-green-500":"bg-gray-200 border-gray-300 hover:border-gray-400"}`,title:F.onlineOnly?"Показувати всіх":"Тільки онлайн"}),(0,b.jsx)("button",{onClick:()=>{K?W():L(!0)},className:`p-2 rounded-md border transition-colors ${K?"bg-purple-50 border-purple-300 text-purple-600":"bg-gray-50 border-gray-300 text-gray-600 hover:bg-gray-100"}`,title:K?"Закрити пошук":"Пошук діалогу",children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),K&&(0,b.jsx)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{children:(0,b.jsx)(o,{value:M,onChange:a=>N(a),options:[{value:"",label:"ІД профілю"},...t.map(a=>({value:a.profileId||"",label:`${a.displayName||a.profileId} (${a.profileId})`}))],className:"w-full"})}),(0,b.jsx)("div",{children:(0,b.jsx)("input",{type:"text",value:O,onChange:a=>P(a.target.value),placeholder:"ІД Клієнта",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("button",{onClick:V,disabled:S,className:"flex-1 px-3 py-2 bg-purple-600 text-white text-sm font-medium rounded-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Пошук...":"Знайти діалог"}),Q&&(0,b.jsx)("button",{onClick:W,className:"px-3 py-2 bg-gray-600 text-white text-sm font-medium rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:"Очистити"})]})]})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto custom-scroll",onScroll:Q?void 0:a=>{let{scrollTop:b,scrollHeight:c,clientHeight:d}=a.currentTarget;Z.current&&clearTimeout(Z.current),c-b-d<100&&B&&!z&&!x&&D&&(console.log(`🔄 Near bottom! Triggering dialogs pagination`),Z.current=setTimeout(()=>{!B||z||x||Y()},200))},children:Q?(0,b.jsx)("ul",{className:"divide-y divide-gray-100",children:(()=>{let a=`${Q.idUser}-${Q.idInterlocutor}`,c=U===a,e=(a=>{if(!a)return"";let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/6e4);if(c<15)return c<1?"щойно":`${c} хв`;let d=b.getDate().toString().padStart(2,"0"),e=(b.getMonth()+1).toString().padStart(2,"0"),f=b.getHours().toString().padStart(2,"0"),g=b.getMinutes().toString().padStart(2,"0");return`${d}.${e} ${f}:${g}`})(Q.dateUpdated||""),f=r[Q.idInterlocutor],g=f?.name||`Користувач ${Q.idInterlocutor}`,h=f?.personal?.avatar_small,i=$(Q.idUser),j=i?v[i.id]:null;return(0,b.jsx)("li",{children:(0,b.jsx)(d.default,{href:`/chats/${a}`,className:`block px-4 py-3 hover:bg-gray-50 transition-colors ${c?"bg-purple-50 border-r-2 border-purple-500":""}`,onClick:()=>{"number"==typeof Q.messagesLeft&&localStorage.setItem(`messagesLeft_${a}`,Q.messagesLeft.toString())},children:(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"w-11 h-11 bg-gray-300 rounded-full overflow-hidden",children:h?(0,b.jsx)("img",{src:h,alt:g,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-500 text-lg font-medium",children:g.charAt(0).toUpperCase()})}),f?.is_online&&(0,b.jsx)("div",{className:"absolute -top-0 -left-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white"}),j&&(0,b.jsx)("div",{className:"absolute -bottom-0 -right-0 w-6 h-6 bg-white rounded-full border border-gray-200 overflow-hidden",children:(0,b.jsx)("img",{src:j,alt:"Profile",className:"w-full h-full object-cover"})})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-900 truncate",children:g}),(0,b.jsx)("div",{className:"text-xs text-gray-500 ml-2 flex-shrink-0",children:e})]}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1 truncate",children:i?.displayName||`Профіль ${Q.idUser}`}),Q.lastMessage?.content?.message&&(0,b.jsx)("div",{className:"text-sm text-gray-600 mt-1 truncate",children:Q.lastMessage.content.message})]})]})})},a)})()}):x?(0,b.jsxs)("div",{className:"divide-y divide-gray-100",children:[(0,b.jsx)(n.DialogSkeleton,{}),(0,b.jsx)(n.DialogSkeleton,{}),(0,b.jsx)(n.DialogSkeleton,{}),(0,b.jsx)(n.DialogSkeleton,{}),(0,b.jsx)(n.DialogSkeleton,{}),(0,b.jsx)(n.DialogSkeleton,{})]}):0===l.length?(0,b.jsx)("div",{className:"text-gray-500 text-center py-8 text-sm",children:"Немає діалогів"}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("ul",{className:"divide-y divide-gray-100",children:l.map((a,c)=>{let e=`${a.idUser}-${a.idInterlocutor}`,f=U===e,g=(a=>{if(!a)return"";let b=new Date(a),c=Math.floor((new Date().getTime()-b.getTime())/6e4);if(c<15)return c<1?"щойно":`${c} хв`;let d=b.getDate().toString().padStart(2,"0"),e=(b.getMonth()+1).toString().padStart(2,"0"),f=b.getHours().toString().padStart(2,"0"),g=b.getMinutes().toString().padStart(2,"0");return`${d}.${e} ${f}:${g}`})(a.dateUpdated||""),h=r[a.idInterlocutor],i=h?.name||`Користувач ${a.idInterlocutor}`,j=h?.personal?.avatar_small,k=$(a.idUser),l=k?.displayName||"Невідомий профіль",m=k?.id?v[k.id]:null;return(0,b.jsx)("li",{children:(0,b.jsx)(d.default,{href:a.__email&&a.__correspondenceId?`/chats/${encodeURIComponent(e)}?openEmailHistory=1&corrId=${encodeURIComponent(String(a.__correspondenceId))}`:`/chats/${encodeURIComponent(e)}`,className:`block p-3 transition-colors ${f?"bg-purple-50 border-r-2 border-purple-500":"hover:bg-gray-50"}`,onClick:()=>{"number"==typeof a.messagesLeft&&localStorage.setItem(`messagesLeft_${e}`,a.messagesLeft.toString())},children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,b.jsxs)("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200",children:[j?(0,b.jsx)("img",{src:j,alt:i,className:"w-full h-full object-cover",onError:a=>{let b=a.target;b.style.display="none",b.nextElementSibling?.classList.remove("hidden")}}):null,(0,b.jsx)("div",{className:`w-full h-full flex items-center justify-center text-white bg-purple-500 text-sm font-medium ${j?"hidden":""}`,children:i.charAt(0).toUpperCase()})]}),h?.is_online&&(0,b.jsx)("div",{className:"absolute top-0 left-0 w-3 h-3 bg-green-500 rounded-full border border-white"}),m&&(0,b.jsx)("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 rounded-full overflow-hidden bg-white border border-gray-300",children:(0,b.jsx)("img",{src:m,alt:l,className:"w-full h-full object-cover",onError:a=>{a.target.parentElement.style.display="none"}})})]}),(0,b.jsx)("div",{className:"flex-1 min-w-0",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("div",{className:`font-medium text-sm truncate ${f?"text-purple-900":"text-gray-900"}`,children:i}),(0,b.jsx)("div",{className:`text-xs truncate mt-0.5 ${f?"text-purple-600":"text-gray-500"}`,children:l})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end justify-between gap-1 ml-2 flex-shrink-0 min-h-[2rem]",children:[(0,b.jsx)("span",{className:`text-xs ${f?"text-purple-500":"text-gray-400"}`,children:g}),a.__emailBadge&&(0,b.jsxs)("span",{className:"flex items-center gap-1 text-[11px] text-blue-600 font-bold",children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"Новий лист"]})]})]})})]})})},`${a.idUser}-${a.idInterlocutor}-${c}`)})}),z&&(0,b.jsx)("div",{className:"flex justify-center py-4 border-t border-gray-100",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[(0,b.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-gray-300 border-t-purple-500 rounded-full"}),"Завантаження діалогів..."]})})]})})]}),(0,b.jsx)("div",{className:"flex-1 bg-gray-50 overflow-hidden",children:a})]})]})]})}}];

//# sourceMappingURL=apps_web_src_app_chats_layout_tsx_1d197e45._.js.map