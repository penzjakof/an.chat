module.exports=[92550,a=>{"use strict";a.s(["default",()=>y],92550);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(69844),f=a.i(39107),g=a.i(46614),h=a.i(20924),i=a.i(85749);let j=new Map,k=({src:a,duration:d,audioId:e,onPlay:f,onPause:g,onEnded:h,onRegister:i,onUnregister:j})=>{let k=(0,c.useRef)(null),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(0),[p,q]=(0,c.useState)(!1),[r,s]=(0,c.useState)(null),t=a=>{let b=Math.floor(a/60),c=Math.floor(a%60);return`${b}:${c.toString().padStart(2,"0")}`},u=async()=>{if(k.current)try{l?(k.current.pause(),m(!1),g?.()):(q(!0),s(null),await k.current.play(),m(!0),q(!1),f?.())}catch(a){q(!1),s("Помилка відтворення аудіо"),console.error("Audio playback error:",a)}};(0,c.useEffect)(()=>{let a=k.current;if(a&&e)return i?.(e,a),()=>{j?.(e)}},[e,i,j]),(0,c.useEffect)(()=>{let a=k.current;if(!a)return;let b=()=>{o(a.currentTime)},c=()=>{m(!1),o(0),h?.()},d=()=>{q(!0)},e=()=>{q(!1),s(null)},f=()=>{q(!1),s("Помилка завантаження аудіо"),m(!1)};return a.addEventListener("timeupdate",b),a.addEventListener("ended",c),a.addEventListener("loadstart",d),a.addEventListener("canplay",e),a.addEventListener("error",f),()=>{a.removeEventListener("timeupdate",b),a.removeEventListener("ended",c),a.removeEventListener("loadstart",d),a.removeEventListener("canplay",e),a.removeEventListener("error",f)}},[h]),(0,c.useEffect)(()=>{m(!1),o(0),s(null)},[a]);let v=d>0?n/d*100:0;return(0,b.jsxs)("div",{className:"w-full",children:[(0,b.jsx)("audio",{ref:k,src:a,preload:"metadata"}),(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("button",{onClick:u,disabled:p||!!r,className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center transition-colors ${r?"bg-red-500 cursor-not-allowed":p?"bg-gray-400 cursor-wait":"bg-blue-500 hover:bg-blue-600"} text-white`,title:r||(p?"Завантаження...":l?"Пауза":"Відтворити"),children:r?(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):p?(0,b.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):l?(0,b.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"})}):(0,b.jsx)("svg",{className:"w-5 h-5 ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M8 5v14l11-7z"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"h-2 bg-gray-200 rounded-full cursor-pointer relative overflow-hidden",onClick:a=>{if(!k.current)return;let b=a.currentTarget.getBoundingClientRect(),c=(a.clientX-b.left)/b.width*d;k.current.currentTime=c,o(c)},children:[(0,b.jsx)("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-100",style:{width:`${v}%`}}),(0,b.jsx)("div",{className:"absolute top-1/2 w-3 h-3 bg-blue-600 rounded-full transform -translate-y-1/2 -translate-x-1/2 shadow-sm",style:{left:`${v}%`}})]}),(0,b.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[(0,b.jsx)("span",{children:t(n)}),(0,b.jsx)("span",{children:t(d)})]})]})]}),r&&(0,b.jsx)("div",{className:"mt-2 text-xs text-red-600 text-center",children:r})]})};function l({profileId:a,isOpen:d,onClose:f,onPhotoSelect:g,maxSelection:h=6,context:i="other",idRegularUser:j,mode:l="send",actionLabel:m,allowAudio:n=!0,allowedPhotoTabs:o,isSpecialPlusAllowed:p=!0,onAttach:q}){if(!a||isNaN(parseInt(a)))throw Error("MediaGallery: profileId must be a valid number string");"chat"!==i||j||console.warn('MediaGallery: idRegularUser is required when context is "chat"');let[r,s]=(0,c.useState)([]),[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(!0),[P,Q]=(0,c.useState)(!0),[R,S]=(0,c.useState)(!0),[T,U]=(0,c.useState)("attach"===l?"special":"regular"),[V,W]=(0,c.useState)("attach"===l?"special":"regular"),[X,Y]=(0,c.useState)("photo"),[Z,$]=(0,c.useState)(null),[_,aa]=(0,c.useState)(null),[ab,ac]=(0,c.useState)(new Map),[ad,ae]=(0,c.useState)(new Map),[af,ag]=(0,c.useState)(new Map),[ah,ai]=(0,c.useState)("all"),[aj,ak]=(0,c.useState)(new Set),[al,am]=(0,c.useState)(new Set),[an,ao]=(0,c.useState)(new Set),[ap,aq]=(0,c.useState)(new Set),[ar,as]=(0,c.useState)(null),at=(0,c.useRef)(new Map),[au,av]=(0,c.useState)(0),aw=`gallery_unified_photos_${a}`,ax=(0,c.useCallback)(()=>{try{let a=localStorage.getItem(aw);if(!a)return new Map;let b=JSON.parse(a),c=Date.now(),d=new Map;return Object.entries(b).forEach(([a,b])=>{c-b.lastAccessed<=864e5&&d.set(parseInt(a),{...b,lastAccessed:c})}),d}catch(a){return console.warn("Failed to load unified photo cache:",a),new Map}},[aw,864e5]),ay=(0,c.useRef)(null),az=(0,c.useCallback)(a=>{ay.current&&clearTimeout(ay.current),ay.current=setTimeout(()=>{try{let b=Object.fromEntries(a);localStorage.setItem(aw,JSON.stringify(b))}catch(a){console.warn("Failed to save unified photo cache:",a)}},500)},[aw]);(0,c.useEffect)(()=>()=>{console.log("🧹 MediaGallery unmounting, cleaning up resources..."),ay.current&&(clearTimeout(ay.current),ay.current=null)},[]);let aA=(0,c.useCallback)((a,b)=>a.tags?.some(a=>a.code===b)??!1,[]),aB=(0,c.useCallback)(a=>aA(a,"special")||aA(a,"special_plus"),[aA]),aC=(0,c.useCallback)(a=>aA(a,"special_plus"),[aA]),aD=(0,c.useCallback)(a=>aA(a,"special")&&!aA(a,"special_plus"),[aA]),aE=(0,c.useCallback)(a=>ap.has(a.idPhoto),[ap]),aF=(0,c.useCallback)((b,c=!1)=>{try{let d=ax(),e=Date.now(),f=0;return b.forEach(b=>{if(d.has(b.idPhoto)){let a=d.get(b.idPhoto);d.set(b.idPhoto,{...a,lastAccessed:e})}else{let g="regular";c?g="temporary":aB(b)&&(g="special"),d.set(b.idPhoto,{idPhoto:b.idPhoto,idProfile:parseInt(a),idUser:b.idUser,urlPreview:b.urls.urlPreview,urlOriginal:b.urls.urlOriginal,status:null,category:g,lastAccessed:e,tags:b.tags}),f++}}),f>0&&(az(d),console.log("📦 Added to unified cache:",f,"new photos, total:",d.size)),d}catch(a){return console.warn("Failed to add photos to unified cache:",a),ax()}},[ax,az,a,aB]),[aG,aH]=(0,c.useState)(null),aI=(0,c.useCallback)(()=>{if(!aG){let a=ax();return aH(a),a}return aG},[aG,ax]),aJ=(0,c.useCallback)(a=>{try{let b=aI(),c=Date.now(),d=0;return a.forEach((a,e)=>{if(b.has(e)){let f=b.get(e);b.set(e,{...f,status:a,lastAccessed:c}),d++}}),d>0&&(aH(new Map(b)),az(b)),b}catch(a){return console.warn("Failed to update photo statuses in unified cache:",a),aI()}},[aI,az,aH]),aK=(0,c.useCallback)((a,b,c,d)=>{let e=a;if("chat"===d)switch(b){case"regular":e=a.filter(a=>!aB(a)&&!aE(a));break;case"special":e=a.filter(a=>aD(a));break;case"special_plus":e=a.filter(a=>aC(a));break;case"temporary":e=a.filter(a=>aE(a)&&!aB(a));break;default:e=a}return"all"!==c&&(e=e.filter(a=>{let b=ab.get(a.idPhoto);switch(c){case"available":return null==b;case"accessed":return"accessed"===b;case"sent":return"sent"===b;default:return!0}})),e},[aB,aE,ab]),aL=(0,c.useCallback)((a,b)=>"all"!==b?a.filter(a=>{let c=ad.get(a.idVideo);switch(b){case"available":return null==c;case"accessed":return"accessed"===c;case"sent":return"sent"===c;default:return!0}}):a,[ad]),aM=(0,c.useCallback)(a=>Array.from(a.values()).map(a=>({idPhoto:a.idPhoto,idUser:a.idUser,urls:{urlPreview:a.urlPreview,urlOriginal:a.urlOriginal,urlStandard:a.urlPreview},tags:a.tags,comment:"",canDisagree:!1,status:{code:"",description:""},declineReasons:[]})).sort((a,b)=>b.idPhoto-a.idPhoto),[]);(0,c.useEffect)(()=>{U(V),av(0)},[V]),(0,c.useEffect)(()=>{av(0)},[ah]),(0,c.useEffect)(()=>{if(d){let b="regular";"attach"===l?!o||o.includes("special")?b="special":o.includes("special_plus")?b="special_plus":o.includes("regular")?b="regular":o.includes("temporary")&&(b="temporary"):b=o&&o.length>0?o[0]:"regular",W(b),U(b);try{let b=localStorage.getItem(`gallery_filters_${a}`);if(b){let a=JSON.parse(b);a.statusFilter&&ai(a.statusFilter)}}catch(a){}}},[d,l,o,a]),(0,c.useEffect)(()=>{if(d){let b=setTimeout(()=>{try{let b={photoType:T,statusFilter:ah};localStorage.setItem(`gallery_filters_${a}`,JSON.stringify(b)),console.log("💾 Filters saved to cache:",b)}catch(a){console.warn("Failed to save filters to cache:",a)}},200);return()=>clearTimeout(b)}},[T,ah,d]);let[aN,aO]=(0,c.useState)(null),aP=(0,c.useRef)(null),aQ=(0,c.useRef)(N),aR=(0,c.useRef)(F),aS=(0,c.useRef)(H),aT=(0,c.useRef)(null);(0,c.useEffect)(()=>{aQ.current=N,aR.current=F,aS.current=H},[N,F,H]);let aU=(0,c.useCallback)(async(b,c)=>{if(0===b.length)return;let d=b.filter(a=>!al.has(a.idVideo));if(0===d.length)return;let f=[];for(let a=0;a<d.length;a+=100)f.push(d.slice(a,a+100));for(let b=0;b<f.length;b++){let d=f[b];try{let b=d.map(a=>a.idVideo);am(a=>{let c=new Set(a);return b.forEach(a=>c.add(a)),c});let f=await (0,e.apiPost)("/api/gallery/video-statuses",{idUser:c,idsVideos:b,profileId:parseInt(a)}),g=f.success&&f.data?f.data.videos??f.data.data?.videos:void 0;g&&Array.isArray(g)?ae(a=>{let b=new Map(a);return g.forEach(a=>{b.set(a.idVideo,a.status)}),b}):am(a=>{let b=new Set(a);return d.forEach(a=>b.delete(a.idVideo)),b})}catch(a){am(a=>{let b=new Set(a);return d.forEach(a=>b.delete(a.idVideo)),b})}b<f.length-1&&await new Promise(a=>setTimeout(a,100))}},[a,al]),aV=(0,c.useCallback)(async(b,c)=>{if(0===b.length)return;let d=b.filter(a=>!aj.has(a.idPhoto));if(0===d.length)return void console.log("📊 All photo statuses already requested");console.log(`📊 Requesting statuses for ${d.length} photos (${b.length} total, ${b.length-d.length} already requested)`);let f=[];for(let a=0;a<d.length;a+=100)f.push(d.slice(a,a+100));for(let b=0;b<f.length;b++){let d=f[b];try{let f=d.map(a=>a.idPhoto);ak(a=>{let b=new Set(a);return f.forEach(a=>b.add(a)),b});let g=await (0,e.apiPost)("/api/gallery/photo-statuses",{idUser:c,idsPhotos:f,profileId:parseInt(a)}),h=g.success&&g.data?g.data.photos??g.data.data?.photos:void 0;h&&Array.isArray(h)?ac(a=>{let b=new Map(a);return h.forEach(a=>{b.set(a.idPhoto,a.status)}),aJ(b),b}):(console.error(`❌ Batch ${b+1}: Failed to load photo statuses:`,g.error),ak(a=>{let b=new Set(a);return d.forEach(a=>b.delete(a.idPhoto)),b}))}catch(a){console.error(`❌ Batch ${b+1}: Error loading photo statuses:`,a),ak(a=>{let b=new Set(a);return d.forEach(a=>b.delete(a.idPhoto)),b})}b<f.length-1&&await new Promise(a=>setTimeout(a,100))}},[a,aj]),aW=(0,c.useCallback)(async()=>{if(!j||"chat"!==i||0===r.length)return;let a=r.filter(a=>!ab.has(a.idPhoto)&&!aj.has(a.idPhoto));a.length>0&&(console.log(`🔍 Found ${a.length} photos without statuses, requesting...`),await aV(a,j))},[r,ab,aj,j,i,aV]);(0,c.useEffect)(()=>{if(d&&r.length>0&&"chat"===i){let a=setTimeout(()=>{aW()},2e3);return()=>clearTimeout(a)}},[d,r.length,i,aW]);let aX=(0,c.useCallback)(async(b=!1)=>{if(!D){E(!0),aO(null);try{let c=b?"":J,d=await (0,e.apiGet)(`/api/gallery/${a}/videos`,{cursor:c,limit:"100",statuses:"approved"});if(d.success&&d.data){let a=d.data;if(b?u(a.videos):u(b=>{let c=new Set(b.map(a=>a.idVideo)),d=a.videos.filter(a=>!c.has(a.idVideo));return[...b,...d].sort((a,b)=>b.idVideo-a.idVideo)}),K(a.cursor),Q(a.videos.length>=100),j&&"chat"===i){let c=b?a.videos:a.videos.filter(a=>!new Set(t.map(a=>a.idVideo)).has(a.idVideo));c.length>0&&aU(c,j)}}else aO("Помилка завантаження відео")}catch(a){aO("Помилка завантаження відео")}finally{E(!1)}}},[a,D,J,t,j,i,aU]),aY=(0,c.useCallback)(async(b=!1)=>{if(!D){E(!0),aO(null);try{let c=await (0,e.apiGet)(`/api/gallery/${a}/audios`,{cursor:b?"":L,limit:"50"});if(c.success&&c.data){let a=c.data;if(b?A(a.items):A(b=>{let c=new Set(b.map(a=>a.id)),d=a.items.filter(a=>!c.has(a.id));return[...b,...d].sort((a,b)=>b.id-a.id)}),M(a.cursor),S(a.items.length>=50),j&&"chat"===i){let c=b?a.items:a.items.filter(a=>!new Set(z.map(a=>a.id)).has(a.id));c.length>0&&aZ(c,j)}}else aO("Помилка завантаження аудіо")}catch(a){aO("Помилка завантаження аудіо")}finally{E(!1)}}},[a,D,L,z,j,i]),aZ=(0,c.useCallback)(async(b,c)=>{if(0===b.length)return;let d=b.filter(a=>!an.has(a.id));if(0===d.length)return;let f=[];for(let a=0;a<d.length;a+=100)f.push(d.slice(a,a+100));for(let b=0;b<f.length;b++){let d=f[b];try{let b=d.map(a=>a.id);ao(a=>{let c=new Set(a);return b.forEach(a=>c.add(a)),c});let f=await (0,e.apiPost)("/api/gallery/audio-statuses",{idUser:c,idsAudios:b,profileId:parseInt(a)}),g=f.success&&f.data?f.data.audios??f.data.data?.audios:void 0;if(g&&Array.isArray(g)){let a=new Map(af);g.forEach(b=>{[Number(b?.idAudio),Number(b?.id),Number(b?.idGalleryAudio)].filter(a=>Number.isFinite(a)).forEach(c=>a.set(c,b.status))}),ag(a),A(b=>b.map(b=>{let c=[Number(b.id),Number(b.idAudio),Number(b.idGalleryAudio)].find(b=>Number.isFinite(b)&&a.has(Number(b))),d=void 0!==c?a.get(Number(c))??null:b.statusComputed??null;return{...b,statusComputed:d}}))}else ao(a=>{let b=new Set(a);return d.forEach(a=>b.delete(a.id)),b})}catch(a){ao(a=>{let b=new Set(a);return d.forEach(a=>b.delete(a.id)),b})}b<f.length-1&&await new Promise(a=>setTimeout(a,100))}},[a,an]),a$=(0,c.useCallback)(async()=>{if(D)return;let b=ax();if(b.size>0){let a=aM(b);console.log("📦 Showing cached photos first:",a.length),s(a);let c=new Set,d=new Map;b.forEach((a,b)=>{"temporary"===a.category&&c.add(b),a.status&&d.set(b,a.status)}),aq(c),ac(d),j&&"chat"===i&&await aV(a,j)}E(!0),aO(null);try{let b=[],c="",d="",f=!0,g=!0,h=!0;for(;(f||g)&&b.length<500;){let k=[];f&&k.push((0,e.apiGet)(`/api/gallery/${a}/photos`,{cursor:c,limit:"100",statuses:"approved,approved_by_ai"})),g&&(console.log("📸 Requesting temporary photos with cursor:",d),k.push((0,e.apiGet)(`/api/gallery/${a}/photos`,{cursor:d,limit:"100",isTemporary:"true"})));let l=await Promise.all(k),m=null,n=null;f&&g?[m,n]=l:f?[m]=l:g&&([n]=l);let o=[],p=m;if(m&&p.success){let a=p.data;console.log("📸 Regular photos batch:",a.photos.length),o.push(...a.photos),c=a.cursor,f=a.photos.length>=100}else m&&(f=!1);let q=n;if(n&&q.success){let a=q.data;console.log("📸 Temporary photos batch:",a.photos.length,a.photos.map(a=>a.idPhoto)),o.push(...a.photos),aq(b=>{let c=new Set(b);return a.photos.forEach(a=>c.add(a.idPhoto)),c}),d=a.cursor,g=a.photos.length>=100}else n&&(g=!1);let r=new Set(b.map(a=>a.idPhoto)),t=o.filter(a=>!r.has(a.idPhoto));b.push(...t);let u=b.sort((a,b)=>b.idPhoto-a.idPhoto);if(s(u),t.length>0){let a=t.filter(a=>!ap.has(a.idPhoto)),b=t.filter(a=>ap.has(a.idPhoto));a.length>0&&aF(a,!1),b.length>0&&aF(b,!0)}console.log("📸 Current total photos:",u.length),h?(E(!1),h=!1,j&&"chat"===i&&u.length>0&&aV(u,j)):j&&"chat"===i&&t.length>0&&aV(t,j)}let k=(f||g)&&b.length>=500;O(k),G(c),I(d),console.log("📸 Initial photos loaded:",b.length),console.log("📸 Has more photos:",k);let l=b.filter(a=>aB(a)).length,m=b.filter(a=>aE(a)).length,n=b.filter(a=>!aB(a)&&!aE(a)).length;console.log("📸 Temporary photo IDs:",Array.from(ap)),console.log("📊 Initial photo distribution:",{total:b.length,regular:n,special:l,temporary:m,hasMore:k})}catch(a){console.error("❌ Error loading initial photos:",a),aO("Помилка завантаження фото"),E(!1)}},[a,D,i,j,aB,aE,aV]),a_=(0,c.useCallback)(async()=>{if(!D&&N){E(!0),console.log("📸 Loading more photos via scroll...");try{let b=[],c=!!F,d=!!H;if(c&&b.push((0,e.apiGet)(`/api/gallery/${a}/photos`,{cursor:F,limit:"100",statuses:"approved,approved_by_ai"})),d&&b.push((0,e.apiGet)(`/api/gallery/${a}/photos`,{cursor:H,limit:"100",isTemporary:"true"})),0===b.length){O(!1),E(!1);return}let f=await Promise.all(b),g=null,h=null;c&&d?[g,h]=f:c?[g]=f:d&&([h]=f);let k=[],l=F,m=H,n=g;if(g&&n.success){let a=n.data;console.log("📸 More regular photos:",a.photos.length),k.push(...a.photos),l=a.cursor,c=a.photos.length>=100}else g&&(c=!1,l="");let o=h;if(h&&o.success){let a=o.data;console.log("📸 More temporary photos:",a.photos.length),k.push(...a.photos),aq(b=>{let c=new Set(b);return a.photos.forEach(a=>c.add(a.idPhoto)),c}),m=a.cursor,d=a.photos.length>=100}else h&&(d=!1,m="");s(a=>{let b=new Set(a.map(a=>a.idPhoto)),c=k.filter(a=>!b.has(a.idPhoto)),d=[...a,...c].sort((a,b)=>b.idPhoto-a.idPhoto);if(c.length>0){let a=c.filter(a=>!ap.has(a.idPhoto)),b=c.filter(a=>ap.has(a.idPhoto));a.length>0&&aF(a,!1),b.length>0&&aF(b,!0)}return j&&"chat"===i&&c.length>0&&aV(c,j),d}),G(l),I(m),O(c||d),console.log("📸 More photos loaded. HasMore:",c||d)}catch(a){console.error("❌ Error loading more photos:",a),aO("Помилка завантаження додаткових фото")}finally{E(!1)}}},[a,D,N,F,H,i,j,aV]);(0,c.useEffect)(()=>{aT.current=a_},[a_]);let a0=(0,c.useCallback)(()=>{let a=aP.current;if(!a||D)return;let{scrollTop:b,scrollHeight:c,clientHeight:d}=a;(b+d)/c>.8&&("photo"===X&&N?(console.log("🔄 Scroll threshold reached! Loading more photos..."),a_()):"video"===X&&P?(console.log("🔄 Scroll threshold reached! Loading more videos..."),aX(!1)):"audio"===X&&R&&(console.log("🔄 Scroll threshold reached! Loading more audios..."),aY(!1)))},[D,N,P,R,X,a_,aX,aY]);(0,c.useEffect)(()=>{let a=aP.current;if(a)return a.addEventListener("scroll",a0),()=>{a.removeEventListener("scroll",a0)}},[a0]),(0,c.useEffect)(()=>{if(!d||D||!N)return;let a=setTimeout(()=>{let a=aK(r,T,ah,i);console.log("🔍 Auto-load check:",{photoType:T,statusFilter:ah,currentFilteredCount:a.length,minThreshold:15,hasMore:N,loading:D}),a.length<15&&N&&!D&&(console.log("🚀 Auto-loading more photos - current filter has only",a.length,"photos"),a_())},1e3);return()=>clearTimeout(a)},[d,r.length,T,ah,i,N,D,aK,a_]);let a1=(0,c.useMemo)(()=>aK(r,T,ah,i),[r,T,ah,i,aK]),a2=(0,c.useMemo)(()=>aL(t,ah),[t,ah,aL]),a3=(0,c.useCallback)((a,b)=>"available"===b&&0===af.size?a:"all"!==b?a.filter(a=>{if(void 0!==a.statusComputed)switch(b){case"available":return null===a.statusComputed||void 0===a.statusComputed;case"accessed":return"accessed"===a.statusComputed;case"sent":return"sent"===a.statusComputed||"accessed"===a.statusComputed}let c=a.id,d=a.idAudio,e=a.idGalleryAudio,f=(void 0!==c?af.get(Number(c)):void 0)??(void 0!==d?af.get(Number(d)):void 0)??(void 0!==e?af.get(Number(e)):void 0),g="accessed"===a.status||"sent"===a.status?a.status:null,h=void 0===f?g:f;switch(b){case"available":return null==h;case"accessed":return"accessed"===h;case"sent":return"sent"===h||"accessed"===h;default:return!0}}):a,[af]),a4=(0,c.useCallback)(async()=>{if(!j||"chat"!==i||0===z.length)return;let a=z.filter(a=>!af.has(a.id)&&!an.has(a.id));a.length>0&&await aZ(a,j)},[z,af,an,j,i,aZ]);(0,c.useEffect)(()=>{if(d&&z.length>0&&"chat"===i){let a=setTimeout(()=>{a4()},2e3);return()=>clearTimeout(a)}},[d,z.length,i,a4]);let a5=(0,c.useMemo)(()=>a3(z,ah),[z,ah,a3]);(0,c.useEffect)(()=>{d?"photo"===X?(s([]),G(""),I(""),O(!0),aO(null),av(0),ac(new Map),ak(new Set),aq(new Set),a$()):"video"===X?(u([]),K(""),Q(!0),ae(new Map),am(new Set),aO(null),aX(!0)):"audio"===X&&(A([]),M(""),S(!0),C([]),ag(new Map),ao(new Set),aO(null),aY(!0)):(aO(null),E(!1))},[d,a,X]);let a6=async()=>{if(0!==v.length)if(j&&"chat"===i){try{g(v)}catch{}try{f()}catch{}E(!0);try{if((await (0,e.apiPost)("/api/gallery/send-photos",{idsGalleryPhotos:v.map(a=>a.idPhoto),idRegularUser:j,profileId:parseInt(a)})).success){w([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(a),clientId:j,kind:"photos"}}))}catch{}}else aO("Помилка відправки фото")}catch{aO("Помилка відправки фото")}finally{E(!1)}}else g(v),f()},a7=async()=>{if(0!==x.length)if(j&&"chat"===i){E(!0);try{if((await (0,e.apiPost)("/api/gallery/send-videos",{idsGalleryVideos:x.map(a=>a.idVideo),idRegularUser:j,profileId:parseInt(a)})).success){f(),y([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(a),clientId:j,kind:"videos"}}))}catch{}}else aO("Помилка відправки відео")}catch{aO("Помилка відправки відео")}finally{E(!1)}}else aO("Відправка відео підтримується тільки в чаті")},a8=async()=>{if(0!==B.length)if(j&&"chat"===i){E(!0);try{if((await (0,e.apiPost)("/api/gallery/send-audios",{idsGalleryAudios:B.map(a=>a.id),idRegularUser:j,profileId:parseInt(a)})).success){f(),C([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(a),clientId:j,kind:"audios"}}))}catch{}}else aO("Помилка відправки аудіо")}catch{aO("Помилка відправки аудіо")}finally{E(!1)}}else aO("Відправка аудіо підтримується тільки в чаті")},a9=()=>{},ba=()=>{as(null)},bb=(a,b)=>{at.current.set(a,b)},bc=a=>{at.current.delete(a)},bd=(0,c.useMemo)(()=>new Set(v.map(a=>a.idPhoto)),[v]),be=(0,c.useCallback)(a=>bd.has(a.idPhoto),[bd]),bf=(0,c.useCallback)(a=>{if("attach"===l){if(o&&o.length>0){let b=o.includes("regular")&&!aB(a)&&!aE(a),c=o.includes("temporary")&&aE(a)&&!aB(a),d=o.includes("special")&&aD(a),e=o.includes("special_plus")&&aC(a);return b||c||d||e}return!aB(a)}return"chat"!==i||!aB(a)},[l,o,i,aB,aD,aC,aE]),bg=(0,c.useCallback)(a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`},[]),bh=(0,c.useMemo)(()=>new Set(x.map(a=>a.idVideo)),[x]),bi=(0,c.useCallback)(a=>bh.has(a.idVideo),[bh]),bj=(0,c.useCallback)(a=>B.some(b=>b.id===a.id),[B]);return d?(0,b.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]",children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-4xl h-[80vh] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,b.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[(0,b.jsx)("button",{onClick:()=>Y("photo"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"photo"===X?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Фото"}),(0,b.jsx)("button",{onClick:()=>Y("video"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"video"===X?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Відео"}),("attach"!==l||n)&&(0,b.jsx)("button",{onClick:()=>Y("audio"),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"audio"===X?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Аудіо"}),"attach"===l&&!n&&(0,b.jsx)("span",{className:"ml-2 text-xs text-gray-400",children:"(у режимі прикріплення аудіо приховано)"})]}),(0,b.jsx)("button",{onClick:f,className:"text-gray-500 hover:text-gray-700 p-2",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsx)("div",{className:`border-t-2 transition-colors duration-300 ${D||"photo"===X&&a1.length<15&&N||"video"===X&&t.length<15&&P?"border-blue-500":"border-gray-200"}`,style:{animation:D||"photo"===X&&a1.length<15&&N||"video"===X&&t.length<15&&P?"pulse 0.8s ease-in-out infinite alternate":"none"}}),(0,b.jsx)("div",{className:"flex-1 flex min-h-0",children:"photo"===X?(0,b.jsxs)("div",{className:"flex-1 p-3 flex flex-col min-h-0",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:"chat"===i?(0,b.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1",children:[(!o||o.includes("regular"))&&(0,b.jsx)("button",{onClick:()=>U("regular"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${"regular"===T?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Звичайні"}),(!o||o.includes("special"))&&(0,b.jsxs)("button",{onClick:()=>U("special"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"special"===T?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})}),(0,b.jsx)("span",{children:"Special"})]}),(!o||o.includes("special_plus"))&&(0,b.jsxs)("button",{onClick:()=>U("special_plus"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"special_plus"===T?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,title:"Special+",children:[(0,b.jsxs)("span",{className:"relative inline-flex items-center justify-center w-4 h-4",children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})}),(0,b.jsx)("span",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 rounded-full bg-white text-pink-600 text-[9px] font-extrabold leading-none flex items-center justify-center border border-pink-500",children:"+"})]}),(0,b.jsx)("span",{children:"Special+"})]}),(!o||o.includes("temporary"))&&(0,b.jsxs)("button",{onClick:()=>U("temporary"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"temporary"===T?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V5z"})}),(0,b.jsx)("span",{children:"Тимчасові"})]})]}):(0,b.jsx)("h3",{className:"font-medium",children:"All photos"})}),aN&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,b.jsx)("p",{className:"text-red-600",children:aN})}),(0,b.jsx)("div",{ref:aP,className:"overflow-y-auto flex-1 p-2 custom-scroll",children:(0,b.jsxs)("div",{className:"grid grid-cols-5 gap-2",style:{gridAutoRows:"minmax(0, max-content)"},children:[a1.map(a=>{let c=aB(a),d=aC(a),e=aD(a);aE(a);let f=bf(a),g="chat"===i&&c&&"attach"!==l;return(0,b.jsxs)("div",{className:`group relative aspect-square rounded-lg overflow-hidden border-2 transition-all ${!f?"cursor-not-allowed border-gray-300":be(a)?"cursor-pointer border-blue-500 ring-2 ring-blue-200":"cursor-pointer border-gray-200 hover:border-gray-300"}`,onClick:()=>{bf(a)&&w(b=>b.some(b=>b.idPhoto===a.idPhoto)?b.filter(b=>b.idPhoto!==a.idPhoto):b.length>=h?b:[...b,a])},children:[(0,b.jsx)("img",{src:a.urls.urlPreview,alt:`Photo ${a.idPhoto}`,className:`w-full h-full object-cover ${g?"grayscale opacity-60":""}`,loading:"lazy"}),(e||d)&&(0,b.jsxs)("div",{className:"absolute top-1 left-1 w-6 h-6 bg-pink-500 rounded-full flex items-center justify-center shadow-sm relative",children:[(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})}),d&&(0,b.jsx)("div",{className:"absolute -top-0.5 -right-0.5 w-3 h-3 rounded-full bg-white text-pink-600 flex items-center justify-center text-[10px] font-extrabold leading-none",children:"+"})]}),be(a)&&(0,b.jsx)("div",{className:"absolute top-1 right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(()=>{let c=ab.get(a.idPhoto);return c?(0,b.jsx)("div",{className:`absolute bottom-1 left-1 w-5 h-5 rounded-full flex items-center justify-center ${"accessed"===c?"bg-green-500":"sent"===c?"bg-yellow-500":"bg-black bg-opacity-60"}`,children:"accessed"===c?(0,b.jsxs)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):"sent"===c?(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}):null}):null})(),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),$(a)},className:"absolute bottom-1 right-1 w-12 h-12 bg-black bg-opacity-60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-opacity-80",title:"Переглянути в повному розмірі",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]},a.idPhoto)}),!D&&!N&&a1.length>0&&(0,b.jsxs)("div",{className:"col-span-5 flex flex-col items-center py-6 text-gray-500",children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,b.jsx)("p",{className:"text-sm font-medium mb-1",children:"Це всі фото"}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Більше фото поки що немає"})]})]})}),"chat"===i&&0===a1.length&&(0,b.jsx)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:D||N?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-4 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Шукаємо фото..."}),(0,b.jsx)("p",{className:"text-sm text-center",children:"Завантажуємо фото з сервера"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v14a2 2 0 002 2z"})}),"regular"===T&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає звичайних фото"}),(0,b.jsxs)("p",{className:"text-sm text-center",children:["Всі фото в цьому профілі мають спеціальний статус.",(0,b.jsx)("br",{}),'Перейдіть до розділу "Special" або "Тимчасові" щоб їх переглянути.']})]}),"special"===T&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає особливих фото"}),(0,b.jsx)("p",{className:"text-sm text-center",children:'В цьому профілі немає фото з тегами "special".'})]}),"temporary"===T&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає тимчасових фото"}),(0,b.jsx)("p",{className:"text-sm text-center",children:"В цьому профілі немає тимчасових фото."})]})]})})]}):"video"===X?(0,b.jsxs)("div",{className:"flex-1 p-3 flex flex-col min-h-0",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)("h3",{className:"font-medium",children:"Відео"})}),"chat"===i&&j&&(0,b.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1 mb-3",children:[(0,b.jsxs)("button",{onClick:()=>ai("all"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"all"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),(0,b.jsx)("span",{children:"Усі"})]}),(0,b.jsxs)("button",{onClick:()=>ai("available"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"available"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,b.jsx)("span",{children:"Доступні"})]}),(0,b.jsxs)("button",{onClick:()=>ai("accessed"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"accessed"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,b.jsx)("span",{children:"Переглянуті"})]}),(0,b.jsxs)("button",{onClick:()=>ai("sent"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"sent"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),(0,b.jsx)("span",{children:"Відправлені"})]})]}),aN&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,b.jsx)("p",{className:"text-red-600",children:aN})}),(0,b.jsx)("div",{ref:aP,className:"overflow-y-auto flex-1 p-2 custom-scroll",children:(0,b.jsxs)("div",{className:"grid grid-cols-5 gap-2",style:{gridAutoRows:"minmax(0, max-content)"},children:[a2.map(a=>(0,b.jsxs)("div",{className:`group relative aspect-square rounded-lg overflow-hidden border-2 transition-all ${bi(a)?"cursor-pointer border-blue-500 ring-2 ring-blue-200":"cursor-pointer border-gray-200 hover:border-gray-300"}`,onClick:()=>{y(b=>b.some(b=>b.idVideo===a.idVideo)?b.filter(b=>b.idVideo!==a.idVideo):b.length>=h?b:[...b,a])},children:[(0,b.jsx)("img",{src:a.urls.urlThumbnail,alt:`Video ${a.idVideo}`,className:"w-full h-full object-cover",loading:"lazy"}),(0,b.jsx)("div",{className:"absolute bottom-1 right-1 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded",children:bg(a.duration)}),(()=>{let c=ad.get(a.idVideo);return c?(0,b.jsx)("div",{className:`absolute top-1 left-1 w-5 h-5 rounded-full flex items-center justify-center ${"accessed"===c?"bg-green-500":"sent"===c?"bg-yellow-500":"bg-black bg-opacity-60"}`,children:"accessed"===c?(0,b.jsxs)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):"sent"===c?(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}):null}):null})(),bi(a)&&(0,b.jsx)("div",{className:"absolute top-1 right-1 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("button",{onClick:b=>{b.stopPropagation(),aa(a)},className:"absolute bottom-1 left-1 w-12 h-12 bg-black bg-opacity-60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200 hover:bg-opacity-80",title:"Переглянути відео",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]},a.idVideo)),!D&&!P&&t.length>0&&(0,b.jsxs)("div",{className:"col-span-5 flex flex-col items-center py-6 text-gray-500",children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-2 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,b.jsx)("p",{className:"text-sm font-medium mb-1",children:"Це всі відео"}),(0,b.jsx)("p",{className:"text-xs text-gray-400",children:"Більше відео поки що немає"})]})]})}),0===a2.length&&(0,b.jsx)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:D||P?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-4 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Шукаємо відео..."}),(0,b.jsx)("p",{className:"text-sm text-center",children:"Завантажуємо відео з сервера"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає відео"}),(0,b.jsx)("p",{className:"text-sm text-center",children:"В цьому профілі поки що немає відео"})]})})]}):(0,b.jsxs)("div",{className:"flex-1 p-3 flex flex-col min-h-0",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)("h3",{className:"font-medium",children:"Аудіо"})}),"chat"===i&&j&&(0,b.jsxs)("div",{className:"flex space-x-1 bg-gray-100 rounded-lg p-1 mb-3",children:[(0,b.jsxs)("button",{onClick:()=>ai("all"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"all"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),(0,b.jsx)("span",{children:"Усі"})]}),(0,b.jsxs)("button",{onClick:()=>ai("available"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"available"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,b.jsx)("span",{children:"Доступні"})]}),(0,b.jsxs)("button",{onClick:()=>ai("accessed"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"accessed"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsxs)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,b.jsx)("span",{children:"Переглянуті"})]}),(0,b.jsxs)("button",{onClick:()=>ai("sent"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center space-x-1 ${"sent"===ah?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),(0,b.jsx)("span",{children:"Відправлені"})]})]}),aN&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,b.jsx)("p",{className:"text-red-600",children:aN})}),(0,b.jsxs)("div",{ref:aP,className:"overflow-y-auto flex-1 p-2 custom-scroll",children:[(0,b.jsx)("div",{className:"space-y-2",children:a5.map(a=>(0,b.jsx)("div",{className:`group relative p-3 rounded-lg border-2 transition-all cursor-pointer ${bj(a)?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,onClick:()=>{C(b=>b.some(b=>b.id===a.id)?b.filter(b=>b.id!==a.id):b.length<h?[...b,a]:b)},children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.title}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:new Date(a.dateCreated).toLocaleDateString()})]})]}),(0,b.jsx)("div",{className:"w-full",onClick:a=>a.stopPropagation(),children:(0,b.jsx)(k,{src:a.urls.mp3,title:a.title,duration:a.duration,audioId:a.id,onPlay:()=>(a=>{if(ar&&ar.id!==a.id){let a=at.current.get(ar.id);a&&!a.paused&&a.pause()}as(a)})(a),onPause:a9,onEnded:ba,onRegister:bb,onUnregister:bc})}),(()=>{let c=af.get(a.id);return c?(0,b.jsx)("div",{className:`absolute top-2 left-2 w-4 h-4 rounded-full flex items-center justify-center ${"accessed"===c?"bg-green-500":"sent"===c?"bg-yellow-500":"bg-black bg-opacity-60"}`,children:"accessed"===c?(0,b.jsxs)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):"sent"===c?(0,b.jsx)("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}):null}):null})(),bj(a)&&(0,b.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})},a.id))}),0===a5.length&&(0,b.jsx)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-500",children:D||R?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-4 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Завантаження аудіо..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-12 h-12 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Немає аудіо"}),(0,b.jsx)("p",{className:"text-sm text-center",children:"Аудіо файли не знайдені або не відповідають фільтру"})]})}),!D&&!R&&z.length>0&&(0,b.jsx)("div",{className:"text-center py-4 text-gray-500 text-sm",children:"Всі аудіо завантажені"})]})]})}),("photo"===X||"video"===X||"audio"===X)&&(0,b.jsxs)("div",{className:"border-t p-3 flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"photo"===X?`${v.length} of ${h} selected`:"video"===X?`${x.length} of ${Math.min(h,a2.length)} selected`:`${B.length} of ${Math.min(h,a5.length)} selected`}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("button",{onClick:f,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Cancel"}),"attach"===l&&q?(0,b.jsx)("button",{onClick:()=>q({photos:v,videos:x}),disabled:0===v.length&&0===x.length||D,className:`px-6 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2 ${(v.length>0||x.length>0)&&!D?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:(0,b.jsx)("span",{children:m||"Прикріпити"})}):(0,b.jsxs)("button",{onClick:"photo"===X?a6:"video"===X?a7:a8,disabled:("photo"===X?0===v.length:"video"===X?0===x.length:0===B.length)||D,className:`px-6 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2 ${("photo"===X?v.length>0:"video"===X?x.length>0:B.length>0)&&!D?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,children:[D&&(0,b.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,b.jsx)("span",{children:D?"Sending...":"Send →"})]})]})]})]}),Z&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:()=>$(null),children:(0,b.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",children:[(0,b.jsx)("img",{src:Z.urls.urlOriginal,alt:`Photo ${Z.idPhoto}`,className:"max-w-full max-h-full object-contain rounded-lg cursor-pointer",onClick:()=>$(null),onError:a=>{a.target.src=Z.urls.urlStandard}}),(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),$(null)},className:"absolute top-4 right-4 w-10 h-10 bg-black bg-opacity-60 rounded-full flex items-center justify-center text-white hover:bg-opacity-80 transition-all",title:"Закрити",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),_&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:()=>aa(null),children:(0,b.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",children:[(0,b.jsx)("video",{src:_.urls.urlMp4Hd,controls:!0,autoPlay:!0,className:"max-w-full max-h-full object-contain rounded-lg",onError:a=>{a.target.src=_.urls.urlMp4Sd}}),(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),aa(null)},className:"absolute top-4 right-4 w-10 h-10 bg-black bg-opacity-60 rounded-full flex items-center justify-center text-white hover:bg-opacity-80 transition-all",title:"Закрити",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]}):null}function m({isOpen:a,src:d,isLoading:e=!1,onClose:f}){return((0,c.useEffect)(()=>{if(!a)return;let b=a=>{"Escape"===a.key&&f()};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[a,f]),a)?(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-[60]",onClick:f,children:(0,b.jsxs)("div",{className:"relative max-w-[90vw] max-h-[90vh] flex items-center justify-center",onClick:a=>a.stopPropagation(),children:[e?(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-white/40 border-t-white rounded-full animate-spin"}):d&&(0,b.jsx)("img",{src:d,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg cursor-pointer",onClick:f}),(0,b.jsx)("button",{onClick:f,className:"absolute top-4 right-4 w-10 h-10 bg-black bg-opacity-60 rounded-full flex items-center justify-center text-white hover:bg-opacity-80 transition-all",title:"Закрити",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}):null}var n=c;class o extends n.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,b){console.error("🎭 Lottie Error Boundary caught an error:",a,b),this.props.onError&&this.props.onError(a,b),console.error("🎭 Lottie Error Details:"),console.error("- Error message:",a.message),console.error("- Error stack:",a.stack),console.error("- Component stack:",b.componentStack)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-purple-100 rounded-md",children:(0,b.jsxs)("div",{className:"text-center p-2",children:[(0,b.jsx)("div",{className:"text-2xl mb-1",children:"🎭"}),(0,b.jsx)("div",{className:"text-xs text-gray-600 font-medium",children:"Помилка анімації"}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Lottie"})]})}):this.props.children}}let p=["😀","😂","❤️","👍","👎","👋","🙌","👏","🙏","🤝","😊","😍","🥰","😘","😉","😎","🤔","😮","😢","😭","😤","😡","🥺","😴","🤗","🤭","🤫","🤥","🤑","🤐","💖","💕","💯","🔥","⭐","✨","💫","🌟","🎉","🎊","🍎","🍊","🍋","🍌","🍉","🍇","🍓","🫐","🍈","🍒","🌹","🌷","🌺","🌸","🌼","🌻","🌷","🌹","🥀","🌱","🐶","🐱","🐭","🐹","🐰","🦊","🐻","🐼","🐨","🐯","👨","👩","👧","👦","👶","👵","👴","🧑","👨‍💻","👩‍💻","💼","📱","💻","⌨️","🖥️","🖨️","📺","📷","🎥","🎵","⚽","🏀","🏈","⚾","🎾","🏐","🏉","🥏","🎱","🪀","🚗","🚕","🚙","🚌","🚎","🏎️","🚓","🚑","🚒","🚐","✈️","🚀","🚁","🛳️","⛵","🛶","🚤","🛥️","🛩️","🛸"],q=({onEmojiSelect:a,onClose:d,isOpen:e,className:f=""})=>{let g=(0,c.useRef)(null);return((0,c.useEffect)(()=>{let a=a=>{g.current&&!g.current.contains(a.target)&&d()};return e&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[e,d]),(0,c.useEffect)(()=>{let a=a=>{"Escape"===a.key&&d()};return e&&document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[e,d]),e)?(0,b.jsx)("div",{ref:g,className:`absolute z-50 bg-white border border-gray-300 rounded-lg shadow-xl ${f}`,style:{bottom:"100%",right:0,marginBottom:"8px",width:"fit-content",minWidth:"220px",maxWidth:"240px"},children:(0,b.jsxs)("div",{className:"p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3 pb-2 border-b border-gray-200",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Виберіть емодзі"}),(0,b.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsx)("div",{className:"max-h-96 overflow-y-auto custom-scroll",children:(0,b.jsx)("div",{className:"grid gap-2 p-1",style:{display:"grid",gridTemplateColumns:"repeat(5, 36px)",gridAutoRows:"36px"},children:p.map((c,d)=>(0,b.jsx)("button",{onClick:()=>{a(c)},className:"flex items-center justify-center hover:bg-gray-100 rounded transition-colors text-2xl leading-none",title:`Додати ${c}`,style:{fontSize:"1.44em",width:"36px !important",height:"36px !important",minWidth:"36px !important",minHeight:"36px !important",maxWidth:"36px !important",maxHeight:"36px !important"},children:c},d))})}),(0,b.jsx)("div",{className:"mt-2 pt-2 border-t border-gray-200",children:(0,b.jsx)("p",{className:"text-xs text-gray-500 text-center",children:"Натисніть на емодзі для додавання або Escape для закриття"})})]})}):null},r=c.default.memo(({images:a,isFromProfile:c,onImageClick:d})=>(0,b.jsxs)("div",{className:c?"border-t pt-3 border-blue-400":"border-t pt-3 border-gray-200",children:[(0,b.jsx)("h4",{className:c?"text-sm font-medium mb-2 text-white":"text-sm font-medium mb-2 text-gray-900",children:"📎 Вкладення:"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:a.map(a=>{let c=a.url_thumbnail||a.url_original,e=a.url_original||a.url_thumbnail;return(0,b.jsxs)("div",{className:"relative inline-block w-20 h-20 border border-gray-200 rounded overflow-hidden",children:[(0,b.jsx)("img",{src:c,alt:`Attachment ${a.id}`,className:"w-full h-full object-cover cursor-pointer hover:opacity-80 transition-opacity",style:{display:"block"},onClick:()=>d(e,`Attachment ${a.id}`),onError:a=>{let b=a.target;b.style.display="none",b.onerror=null}}),a.is_paid&&(0,b.jsx)("div",{className:"absolute top-1 right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center",children:(0,b.jsxs)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,b.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),(0,b.jsx)("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]})})]},a.id)})})]}));function s({isOpen:a,onClose:d,profileId:f,clientId:g,correspondenceId:h,lettersLeft:j}){let{showToast:k}=(0,i.useToast)(),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(1),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(0),[C,D]=(0,c.useState)(!0),E=(0,c.useRef)(null),F=(0,c.useRef)(1),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)([]),[O,P]=(0,c.useState)([]),[Q,R]=(0,c.useState)([]),S=(0,c.useMemo)(()=>{let a=new Set(Q||[]),b=["regular","temporary"];return a.has("special")||b.push("special"),a.has("special_plus")||b.push("special_plus"),b},[Q]);(0,c.useEffect)(()=>{(async()=>{try{if(!a||!f||!g)return;let b=await (0,e.apiPost)("/api/chats/tt-forbidden-tags",{profileId:parseInt(f),idInterlocutor:parseInt(g)});b.success&&Array.isArray(b.tags)?R(b.tags):R([])}catch(a){R([]),k({title:"Помилка заборонених категорій",message:a?.message||"Не вдалося отримати обмеження категорій",type:"error"})}})()},[a,f,g]);let T=(0,c.useCallback)(async(a=1,b=!1)=>{if(!o&&h){p(!0);try{let c=await (0,e.apiPost)("/api/tt/emails-history",{page:a,limit:10,id_correspondence:h,id_interlocutor:g,id_user:f,without_translation:!1});if(c.success&&c.data?.data?.history){let d=c.data.data.history.sort((a,b)=>new Date(a.date_created).getTime()-new Date(b.date_created).getTime());b?(n(a=>{let b=new Set(a.map(a=>a.id)),c=d.filter(a=>!b.has(a.id)),e=d.length-c.length;return e>0&&console.log(`📧 EmailHistory: Відфільтровано ${e} дублікатів`),[...c,...a]}),B(a=>{let b=new Set(m.map(a=>a.id)),c=d.filter(a=>!b.has(a.id)).length;return a+c})):(n(d),B(0),D(!0)),x(10===d.length),F.current=a,v(a)}}catch(a){console.error("Помилка завантаження листів:",a)}finally{p(!1)}}},[h,g,f]),U=(0,c.useCallback)(async()=>{if(!s&&w&&!o){t(!0);try{let a=F.current,b=a+1;console.log(`📧 EmailHistory: Завантажуємо сторінку ${b} (поточна: ${a})`);let c=await (0,e.apiPost)("/api/tt/emails-history",{page:b,limit:10,id_correspondence:h,id_interlocutor:g,id_user:f,without_translation:!1});if(c.success&&c.data?.data?.history){let a=c.data.data.history.sort((a,b)=>new Date(a.date_created).getTime()-new Date(b.date_created).getTime());a.length>0?(n(b=>{let c=new Set(b.map(a=>a.id)),d=a.filter(a=>!c.has(a.id)),e=a.length-d.length;return e>0&&console.log(`📧 EmailHistory: Відфільтровано ${e} дублікатів при пагінації`),[...d,...b]}),B(b=>{let c=new Set(m.map(a=>a.id)),d=a.filter(a=>!c.has(a.id)).length;return b+d}),F.current=b,v(b),x(10===a.length),console.log(`✅ EmailHistory: Успішно завантажено сторінку ${b}`)):(x(!1),console.log(`📧 EmailHistory: Більше листів немає`))}}catch(a){console.error("Помилка завантаження старіших листів:",a)}finally{t(!1)}}},[h,g,f]),V=(0,c.useCallback)(a=>{let{scrollTop:b}=a.currentTarget;0!==b||!w||s||o||U()},[]);return((0,c.useLayoutEffect)(()=>{if(A>0&&E.current){let a=E.current,b=a.querySelectorAll("[data-email-id]");if(b.length>A){let c=b[A];c&&(a.scrollTop=c.offsetTop-100)}B(0)}},[m,A]),(0,c.useEffect)(()=>{a&&h&&(n([]),v(1),x(!0),B(0),D(!0),T(1,!1))},[a,h]),(0,c.useEffect)(()=>{if(m.length>0&&E.current&&C){let a=E.current;setTimeout(()=>{a.scrollTop=a.scrollHeight,D(!1)},100)}},[m,C]),(0,c.useEffect)(()=>{let b=a=>{"Escape"===a.key&&(y?z(null):d())};if(a)return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[a,y,d]),a)?(0,b.jsxs)(c.default.Fragment,{children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[80vh] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"📧 Історія листування"}),(0,b.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)("div",{ref:E,className:"flex-1 overflow-y-auto p-4 custom-scroll",onScroll:V,children:[s&&(0,b.jsxs)("div",{className:"text-center py-4",children:[(0,b.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),(0,b.jsx)("span",{className:"ml-2 text-gray-600",children:"Завантаження старіших листів..."})]}),0!==m.length||o?(0,b.jsx)("div",{className:"space-y-4 px-4",children:m.map(a=>{let c=a.id_user_from===f;return(0,b.jsx)("div",{"data-email-id":a.id,className:c?"flex justify-end":"flex justify-start",children:(0,b.jsxs)("div",{className:c?"max-w-[80%] p-4 shadow-sm bg-blue-500 text-white rounded-l-lg rounded-tr-lg":"max-w-[80%] p-4 shadow-sm bg-gray-100 text-gray-900 rounded-r-lg rounded-tl-lg",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:c?"font-medium mb-1 text-white":"font-medium mb-1 text-gray-900",children:a.title||"Без теми"}),(0,b.jsxs)("div",{className:c?"flex items-center space-x-4 text-sm text-blue-100":"flex items-center space-x-4 text-sm text-gray-600",children:[(0,b.jsxs)("span",{children:["Від: ",a.id_user_from]}),(0,b.jsxs)("span",{children:["До: ",a.id_user_to]}),(0,b.jsx)("span",{children:(a=>{try{return new Date(a).toLocaleString("uk-UA",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return a}})(a.date_created)}),a.is_paid&&(0,b.jsx)("span",{className:c?"px-2 py-1 rounded text-xs bg-blue-600 text-blue-100":"px-2 py-1 rounded text-xs bg-yellow-100 text-yellow-800",children:"💰 Платний"})]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsx)("span",{className:"read"===a.status?c?"px-2 py-1 rounded text-xs bg-blue-600 text-blue-100":"px-2 py-1 rounded text-xs bg-green-100 text-green-800":c?"px-2 py-1 rounded text-xs bg-blue-600 text-blue-100":"px-2 py-1 rounded text-xs bg-blue-100 text-blue-800",children:"read"===a.status?"Прочитано":"Непрочитано"})})]}),(0,b.jsx)("div",{className:c?"mb-3 prose prose-sm max-w-none prose-invert":"mb-3 prose prose-sm max-w-none text-gray-800",dangerouslySetInnerHTML:{__html:a.content}}),a.attachments?.images&&a.attachments.images.length>0&&(0,b.jsx)(r,{images:a.attachments.images,isFromProfile:c,onImageClick:(a,b)=>z({url:a,alt:b})})]})},a.id)})}):(0,b.jsx)("div",{className:"text-center text-gray-500 py-8",children:"📭 Немає листів в цій кореспонденції"}),o&&(0,b.jsxs)("div",{className:"text-center py-4",children:[(0,b.jsx)("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),(0,b.jsx)("span",{className:"ml-2 text-gray-600",children:"Завантаження..."})]}),!s&&!w&&m.length>10&&(0,b.jsx)("div",{className:"text-center py-4",children:(0,b.jsx)("span",{className:"text-gray-500 text-sm",children:"📄 Більше листів немає"})})]}),"number"==typeof j&&j>0&&(0,b.jsxs)("div",{className:"border-t p-3",children:[(M.length>0||O.length>0)&&(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 mb-2",children:[M.map(a=>(0,b.jsxs)("div",{className:"relative w-14 h-14 rounded-md overflow-hidden border border-gray-200",children:[(0,b.jsx)("img",{src:a.urls.urlPreview,alt:`Фото ${a.idPhoto}`,className:"w-full h-full object-cover"}),(0,b.jsx)("button",{onClick:()=>N(b=>b.filter(b=>b.idPhoto!==a.idPhoto)),className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати фото",children:"✕"})]},`p-${a.idPhoto}`)),O.map(a=>(0,b.jsxs)("div",{className:"relative w-14 h-14 rounded-md overflow-hidden border border-gray-200",children:[(0,b.jsx)("img",{src:a.urls.urlThumbnail,alt:`Відео ${a.idVideo}`,className:"w-full h-full object-cover"}),(0,b.jsx)("span",{className:"absolute bottom-0 right-0 m-0.5 text-[10px] px-1 py-0.5 rounded bg-black/60 text-white",children:"▶"}),(0,b.jsx)("button",{onClick:()=>P(b=>b.filter(b=>b.idVideo!==a.idVideo)),className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати відео",children:"✕"})]},`v-${a.idVideo}`))]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{onClick:()=>J(!0),className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Прикріпити медіа",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)("textarea",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none",placeholder:"Напишіть лист... (300–3000 символів)",value:G,onChange:a=>H(a.target.value),rows:3,maxLength:3e3}),(0,b.jsxs)("div",{className:"absolute right-2 top-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>L(!K),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",title:"Додати емодзі",children:"😀"}),(0,b.jsx)(q,{isOpen:K,onEmojiSelect:a=>{H(b=>b+a)},onClose:()=>L(!1)})]}),(0,b.jsxs)("div",{className:"text-xs mt-1 flex items-center justify-between",children:[(0,b.jsxs)("span",{className:`${G.trim().length<300||G.trim().length>3e3?"text-red-600":"text-gray-500"}`,children:["Символів: ",G.trim().length,"/3000"]}),(0,b.jsx)("span",{className:"text-gray-400",children:"Мінімум 300"})]})]}),(0,b.jsx)("button",{onClick:async()=>{let a=G.trim();if(a.length<300||a.length>3e3)return;let b=M.slice(0,10).map(a=>a.idPhoto),c=O.slice(0,10).map(a=>a.idVideo);try{let d=await (0,e.apiPost)("/api/chats/send-letter",{profileId:parseInt(f),idUserTo:parseInt(g),content:a,photoIds:b,videoIds:c});if(d.success){let b=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\n/g,"<br/>"),c=M.slice(0,10).map(a=>({id:`p-${a.idPhoto}`,url_thumbnail:a.urls.urlPreview,url_original:a.urls.urlOriginal,is_paid:!1,display_attributes:[]})),d={id:`temp-${Date.now()}`,id_user_from:f,id_user_to:g,title:"",content:b,date_created:new Date().toISOString(),status:"unread",attachments:c.length?{images:c}:void 0,is_paid:!1};n(a=>[...a,d]),setTimeout(()=>{let a=E.current;a&&(a.scrollTop=a.scrollHeight)},0),H(""),N([]),P([]),k({title:"Лист надіслано",message:"Ваш лист успішно відправлено",type:"success"});try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:parseInt(f),clientId:parseInt(g),kind:"email"}}))}catch{}}else console.error("❌ Send letter failed:",d.error),k({title:"Помилка відправки",message:d.error||"Невідома помилка",type:"error"})}catch(a){console.error("❌ Send letter error:",a),k({title:"Помилка відправки",message:a?.message||"Невідома помилка",type:"error"})}},disabled:G.trim().length<300||G.trim().length>3e3,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors disabled:bg-gray-300",children:"Надіслати"})]})]})]})}),y&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50",onClick:()=>z(null),children:(0,b.jsxs)("div",{className:"relative max-w-full max-h-full p-4",children:[(0,b.jsx)("img",{src:y.url,alt:y.alt,className:"max-w-full max-h-full object-contain",onClick:a=>a.stopPropagation()}),(0,b.jsx)("button",{onClick:()=>z(null),className:"absolute top-4 right-4 text-white hover:text-gray-300 transition-colors",children:(0,b.jsx)("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,b.jsx)(l,{profileId:f,isOpen:I,onClose:()=>J(!1),onPhotoSelect:()=>{},maxSelection:10,context:"chat",idRegularUser:parseInt(g),mode:"attach",actionLabel:"Прикріпити",allowAudio:!1,allowedPhotoTabs:S,isSpecialPlusAllowed:!Q.includes("special_plus"),onAttach:({photos:a,videos:b})=>{N(a),P(b),J(!1)}})]}):null}class t{timeouts=new Set;intervals=new Set;eventListeners=[];abortControllers=new Set;cleanupFunctions=new Set;setTimeout(a,b){let c=setTimeout(()=>{this.timeouts.delete(c),a()},b);return this.timeouts.add(c),c}setInterval(a,b){let c=setInterval(a,b);return this.intervals.add(c),c}addEventListener(a,b,c,d){a.addEventListener(b,c,d),this.eventListeners.push({element:a,event:b,handler:c,options:d})}createAbortController(){let a=new AbortController;return this.abortControllers.add(a),a}addCleanup(a){this.cleanupFunctions.add(a)}clearTimeout(a){this.timeouts.has(a)&&(clearTimeout(a),this.timeouts.delete(a))}clearInterval(a){this.intervals.has(a)&&(clearInterval(a),this.intervals.delete(a))}cleanup(){console.log("🧹 ComponentResourceManager: Cleaning up all resources..."),this.timeouts.forEach(a=>{try{clearTimeout(a)}catch(a){console.warn("Error clearing timeout:",a)}}),this.timeouts.clear(),this.intervals.forEach(a=>{try{clearInterval(a)}catch(a){console.warn("Error clearing interval:",a)}}),this.intervals.clear(),this.eventListeners.forEach(({element:a,event:b,handler:c,options:d})=>{try{a.removeEventListener(b,c,d)}catch(a){console.warn("Error removing event listener:",a)}}),this.eventListeners.length=0,this.abortControllers.forEach(a=>{try{a.signal.aborted||a.abort()}catch(a){console.warn("Error aborting controller:",a)}}),this.abortControllers.clear(),this.cleanupFunctions.forEach(a=>{try{a()}catch(a){console.warn("Error in custom cleanup function:",a)}}),this.cleanupFunctions.clear(),console.log("✅ ComponentResourceManager: All resources cleaned up")}getStats(){return{timeouts:this.timeouts.size,intervals:this.intervals.size,eventListeners:this.eventListeners.length,abortControllers:this.abortControllers.size,cleanupFunctions:this.cleanupFunctions.size}}}async function u(b,c){try{let{apiPost:d}=await a.A(33732),e=await d("/api/chats/tt-restrictions",{profileId:b,idInterlocutor:c});return{hasExclusivePosts:e.hasExclusivePosts||!1,categories:e.categories||[],categoryCounts:e.categoryCounts,tier:e.tier,success:!1!==e.success,error:e.error}}catch(a){return console.error("❌ Error checking dialog restrictions:",a),{hasExclusivePosts:!1,categories:[],success:!1,error:a instanceof Error?a.message:"Unknown error"}}}function v({isOpen:a,onClose:d,profileId:f,clientId:g}){let h,i,j,[k,l]=(0,c.useState)(!0),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(),[u,v]=(0,c.useState)(),[w,x]=(0,c.useState)(),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(null);(0,c.useEffect)(()=>{if(!a)return;let b=!1;return(async()=>{l(!0),n(null);try{let a=await (0,e.apiGet)(`/profiles/${f}/client/${g}/public`),c=a.profile?.personal?a.profile:void 0;c&&!b&&(p(c.personal||null),r(c.preferences||null),t(c.is_online),v(c.last_visit),x(c.date_created));let d=await (0,e.apiPost)(`/profiles/${f}/client/${g}/photos`,{}),h=d?.data||d,i=(h?.public||[]).filter(a=>!a.is_hidden),j=(h?.private||[]).filter(a=>!a.is_hidden);if(!b){z(i),B(j);let a=[...i,...j].find(a=>1===a.isMain||1===a.is_main);D(a||null)}}catch(a){b||n(a?.message||"Помилка завантаження профілю")}finally{b||l(!1)}})(),()=>{b=!0}},[a,f,g]);let G=(0,c.useMemo)(()=>y,[y]),H=(0,c.useMemo)(()=>A,[A]);if(!a)return null;let I=a=>{try{let b=new Date(a),c=b.getMonth()+1,d=b.getDate();for(let a of[{name:"Козоріг",start:[12,22],end:[1,19],icon:"♑"},{name:"Водолій",start:[1,20],end:[2,18],icon:"♒"},{name:"Риби",start:[2,19],end:[3,20],icon:"♓"},{name:"Овен",start:[3,21],end:[4,19],icon:"♈"},{name:"Телець",start:[4,20],end:[5,20],icon:"♉"},{name:"Близнюки",start:[5,21],end:[6,20],icon:"♊"},{name:"Рак",start:[6,21],end:[7,22],icon:"♋"},{name:"Лев",start:[7,23],end:[8,22],icon:"♌"},{name:"Діва",start:[8,23],end:[9,22],icon:"♍"},{name:"Терези",start:[9,23],end:[10,22],icon:"♎"},{name:"Скорпіон",start:[10,23],end:[11,21],icon:"♏"},{name:"Стрілець",start:[11,22],end:[12,21],icon:"♐"}]){let[b,e]=a.start,[f,g]=a.end;if(c===b&&d>=e||c===f&&d<=g||c>b&&c<f||12===c&&1===b||1===c&&12===f)return a}return{name:"Невідомий",icon:"❓"}}catch{return{name:"Невідомий",icon:"❓"}}},J=({label:a,value:c})=>{if(null==c||""===c||Array.isArray(c)&&0===c.length)return null;let d=(a=>{let b=document.createElement("textarea");return b.innerHTML=a,b.value})(Array.isArray(c)?c.join(", "):String(c));return(0,b.jsxs)("div",{className:"flex text-sm",children:[(0,b.jsx)("div",{className:"w-[120px] text-gray-500 text-right",children:a}),(0,b.jsx)("div",{className:"flex-1 text-gray-900 ml-2",children:d})]})};return(0,b.jsxs)("div",{className:"fixed inset-0 z-[70] flex items-center justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:d}),(0,b.jsxs)("div",{className:"relative bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto custom-scroll",children:[k?(0,b.jsx)("div",{className:"p-6 text-sm text-gray-500",children:"Завантаження…"}):m?(0,b.jsx)("div",{className:"p-6 text-sm text-red-600",children:m}):(0,b.jsxs)("div",{className:"p-6 grid grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[C&&(0,b.jsx)("div",{className:"w-[350px] h-[400px]",children:(0,b.jsx)("img",{src:C.url_standart||C.url_xxl||C.url_xl||C.url_large||C.url_medium||C.url_small||C.url_xs||o?.avatar_xl||"",alt:"main",className:"w-full h-full object-cover rounded-lg cursor-zoom-in",onClick:()=>F(C.url_original||"")})}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[G.map(a=>(0,b.jsx)("img",{src:a.url_xl||a.url_large||a.url_medium||a.url_small||a.url_xs||"",alt:`pub-${a.id}`,className:"w-[80px] h-[80px] object-cover rounded cursor-zoom-in",onClick:()=>F(a.url_original||"")},a.id)),H.map(a=>(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("img",{src:a.url_xl||a.url_large||a.url_medium||a.url_small||a.url_xs||"",alt:`priv-${a.id}`,className:"w-[80px] h-[80px] object-cover rounded cursor-zoom-in hover:opacity-80 transition-opacity",onClick:()=>F(a.url_original||"")}),(0,b.jsx)("div",{className:"absolute bottom-1 right-1 bg-black/60 text-white text-xs px-1 py-0.5 rounded",children:"Приватне"})]},a.id))]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[o?.gender&&(0,b.jsx)("div",{className:"flex-shrink-0",children:"male"===o.gender?(0,b.jsx)("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}):"female"===o.gender?(0,b.jsx)("svg",{className:"w-6 h-6 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}):(0,b.jsx)("svg",{className:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,b.jsx)("div",{className:"text-xl font-bold text-gray-900",children:o?.name?`${o.name}${o?.age?`, ${o.age}`:""}`:`User ${g}`}),(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("div",{className:`w-2 h-2 rounded-full ${s?"bg-green-500":"bg-gray-400"}`}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:s?"онлайн":(a=>{if(!a)return"офлайн";try{let b=new Date,c=new Date(a),d=b.getTime()-c.getTime(),e=Math.floor(d/6e4),f=Math.floor(d/36e5),g=Math.floor(d/864e5),h=Math.floor(g/7);if(e<60){if(e<1)return"щойно";if(1===e)return"хвилину тому";if(e<5)return`${e} хвилини тому`;return`${e} хвилин тому`}if(f<24){if(1===f)return"годину тому";if(f<5)return`${f} години тому`;return`${f} годин тому`}if(g<7){if(1===g)return"день тому";return`${g} дні тому`}if(1===h)return"тиждень тому";if(h<4)return`${h} тижні тому`;return"місяць тому"}catch{return"офлайн"}})(u)})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(o?.country||o?.city)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:[o?.country,o?.city].filter(Boolean).join(", ")})]}),o?.date_birth&&(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.date_birth})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("span",{className:"text-base",children:I(o.date_birth).icon}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:I(o.date_birth).name})]})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:(()=>{let a=(a=>{if(!a||"string"!=typeof a)return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:"Невідомо",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})};switch(a.toLowerCase()){case"real_love":return{iconColor:"text-red-600",textColor:"text-red-600",displayName:"Любов",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})})};case"friendship":return{iconColor:"text-blue-600",textColor:"text-blue-600",displayName:"Дружба",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"})})};case"hot_talks":return{iconColor:"text-pink-600",textColor:"text-pink-600",displayName:"Інтим",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})})};default:return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:a,icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})}}})(o?.mood);return(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("div",{className:`w-4 h-4 flex items-center justify-center ${a.iconColor}`,children:a.icon}),(0,b.jsx)("span",{className:`text-xs font-medium ${a.textColor}`,children:a.displayName})]})})()})]}),(0,b.jsx)("div",{className:"mt-6 mb-3",children:(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"Я шукаю"})}),(q?.gender||q?.age_from||q?.age_to||o?.goal||q?.pref_personality_type)&&(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(q?.gender||q?.age_from||q?.age_to)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[q?.gender==="male"?(0,b.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}):q?.gender==="female"?(0,b.jsx)("svg",{className:"w-4 h-4 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}):(0,b.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:q?.age_from&&q?.age_to?`${q.age_from}-${q.age_to}`:q?.age_from?`від ${q.age_from}`:q?.age_to?`до ${q.age_to}`:"Будь-який вік"})]}),o?.goal&&Array.isArray(o.goal)&&o.goal.length>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.goal})]}),q?.pref_personality_type&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:q.pref_personality_type})]})]})}),(o?.traits&&(Array.isArray(o.traits)&&o.traits.length>0||"string"==typeof o.traits&&o.traits.trim())||o?.hobbies&&(Array.isArray(o.hobbies)&&o.hobbies.length>0||"string"==typeof o.hobbies&&o.hobbies.trim())||o?.movie_genres&&Array.isArray(o.movie_genres)&&o.movie_genres.length>0||o?.music_genres&&Array.isArray(o.music_genres)&&o.music_genres.length>0||o?.religion)&&(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Риси та захоплення"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(h=[],Array.isArray(o?.traits)?h=o.traits:"string"==typeof o?.traits&&(h=o.traits.split(",").map(a=>a.trim()).filter(a=>a)),h.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-blue-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`trait-${c}`))),(i=[],Array.isArray(o?.hobbies)?i=o.hobbies:"string"==typeof o?.hobbies&&(i=o.hobbies.split(",").map(a=>a.trim()).filter(a=>a)),i.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l.707.707A1 1 0 0012.414 11H15m-3 7.5A9.5 9.5 0 1121.5 12 9.5 9.5 0 0112 2.5z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`hobby-${c}`))),o?.movie_genres&&Array.isArray(o.movie_genres)&&o.movie_genres.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-purple-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`movie-${c}`)),o?.music_genres&&Array.isArray(o.music_genres)&&o.music_genres.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-orange-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`music-${c}`)),o?.religion&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-violet-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.religion})]})]})]}),(o?.education||o?.occupation||o?.field_of_work||o?.language||o?.level_of_english||o?.other_langs||o?.other_languages)&&(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Освіта та зайнятість"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[o?.education&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-indigo-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsxs)("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 14l9-5-9-5-9 5 9 5z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"})]}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.education})]}),o?.occupation&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-teal-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-teal-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m8 0V8a2 2 0 01-2 2H8a2 2 0 01-2-2V6m8 0H8"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.occupation})]}),o?.field_of_work&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-cyan-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.field_of_work})]}),o?.language&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-emerald-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.language})]}),o?.level_of_english&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-amber-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.level_of_english})]}),(j=[],o?.other_langs&&"string"==typeof o.other_langs?j=o.other_langs.split(",").map(a=>a.trim()).filter(a=>a):o?.other_languages&&"string"==typeof o.other_languages?j=o.other_languages.split(",").map(a=>a.trim()).filter(a=>a):Array.isArray(o?.other_languages)&&(j=o.other_languages),j.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-rose-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-rose-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2m-9 0h10m-9 0V1m10 3V1m0 3l1 1v16a2 2 0 01-2 2H6a2 2 0 01-2-2V5l1-1z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`other-lang-${c}`)))]})]}),(o?.marital_status||o?.count_children!==void 0&&o?.count_children>=0)&&(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Сім'я"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[o?.marital_status&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.marital_status})]}),o?.count_children!==void 0&&o?.count_children>=0&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-lime-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-lime-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:0===o.count_children?"Немає дітей":`${o.count_children} ${1===o.count_children?"дитина":o.count_children<5?"дитини":"дітей"}`})]})]})]}),(()=>{let a=o?.drinking&&0!==parseFloat(String(o.drinking)),c=o?.height&&0!==parseFloat(String(o.height)),d=o?.smoking&&0!==parseFloat(String(o.smoking)),e=o?.weight&&0!==parseFloat(String(o.weight));return a||c||d||e?(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Звички та зовнішність"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(()=>{let a=o?.drinking;return 0!==(a?parseFloat(String(a)):0)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-amber-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:["Алкоголь: ",a]})]})})(),(()=>{let a=o?.height;return 0!==(a?parseFloat(String(a)):0)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-cyan-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7l-2-2-2 2m0 0l-2 2 2 2m0-2V21M8 7h8M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-2"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[a," см"]})]})})(),(()=>{let a=o?.smoking;return 0!==(a?parseFloat(String(a)):0)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:["Куріння: ",a]})]})})(),(()=>{let a=o?.weight;return 0!==(a?parseFloat(String(a)):0)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-pink-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M6 7l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M9 8l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M12 9l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[a," кг"]})]})})()]})]}):null})(),o?.description&&(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Опис"}),(0,b.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed",children:(()=>{var a=String(o.description);let b=document.createElement("textarea");return b.innerHTML=a,b.value})()})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(J,{label:"Волосся",value:o?.color_hair}),(0,b.jsx)(J,{label:"Очі",value:o?.color_eye}),(0,b.jsx)(J,{label:"Статура",value:o?.body_type}),(0,b.jsx)(J,{label:"Шукаю",value:o?.looking_for})]}),(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)(J,{label:"Створено",value:w})})]})]}),E&&(0,b.jsxs)("div",{className:"fixed inset-0 z-[80] flex items-center justify-center",onClick:()=>F(null),children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/80"}),(0,b.jsx)("img",{src:E,alt:"full",className:"relative max-w-[95vw] max-h-[95vh] object-contain rounded"})]})]})]})}let w=({label:a,value:c})=>c&&""!==String(c).trim()?(0,b.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600",children:a}),(0,b.jsx)("span",{className:"text-sm text-gray-900",children:c})]}):null,x=({isOpen:a,onClose:d,profileId:f})=>{let[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(null);(0,c.useEffect)(()=>{a&&f&&m()},[a,f]);let m=async()=>{j(!0),l(null);try{let a=await (0,e.apiGet)(`/profiles/${f}/profile-data`);a.profileData?h(a.profileData):l("Не вдалося завантажити дані профілю")}catch(a){l(a.message||"Сталася помилка при завантаженні")}finally{j(!1)}},n=g?.personal,o=g?.preferences,p=(0,c.useMemo)(()=>{if(!n?.date_birth)return null;try{return new Date(n.date_birth).toLocaleDateString("uk-UA",{day:"numeric",month:"long",year:"numeric"})}catch{return null}},[n?.date_birth]);return a?(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto custom-scroll",children:[(0,b.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Мій публічний профіль"}),(0,b.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)("div",{className:"px-6 py-4",children:[i&&(0,b.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}),k&&(0,b.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,b.jsx)("p",{className:"text-red-700",children:k})}),g&&n&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full overflow-hidden bg-gray-200 flex-shrink-0",children:n.avatar_xl?(0,b.jsx)("img",{src:n.avatar_xl,alt:n.name||"Avatar",className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full bg-gray-300 flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-8 h-8 text-gray-500",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:n.name}),n.age&&(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:[n.age," років"]}),(n.city||n.country)&&(0,b.jsx)("p",{className:"text-sm text-gray-600",children:[n.city,n.country].filter(Boolean).join(", ")})]})]}),(()=>{let a=n?.drinking?parseFloat(String(n.drinking)):0,c=n?.height&&0!==parseFloat(String(n.height)),d=n?.smoking?parseFloat(String(n.smoking)):0,e=n?.weight&&0!==parseFloat(String(n.weight)),f=n?.color_hair&&""!==String(n.color_hair).trim(),g=n?.body_type&&""!==String(n.body_type).trim(),h=n?.color_eye&&""!==String(n.color_eye).trim(),i=n?.goal&&Array.isArray(n.goal)&&n.goal.length>0;return 1===a||2===a||3===a||4===a||c||1===d||2===d||3===d||e||f||g||h||i?(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Звички та зовнішність"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(()=>{let a=n?.drinking?parseFloat(String(n.drinking)):0,c="";return 1===a?c="Ніколи":2===a?c="За компанію":3===a?c="Іноді":4===a&&(c="Часто"),c&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-amber-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsxs)("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",role:"img","aria-label":"Cocktail icon",children:[(0,b.jsx)("path",{d:"M4 4h16l-8 9-8-9Z"}),(0,b.jsx)("path",{d:"M12 13v6"}),(0,b.jsx)("path",{d:"M7 21h10"}),(0,b.jsx)("path",{d:"M8.5 6.5l7 4"}),(0,b.jsx)("circle",{cx:"15.5",cy:"9",r:"1.4",fill:"currentColor",stroke:"none"})]}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:c})]})})(),(()=>{let a=n?.smoking?parseFloat(String(n.smoking)):0,c="";return 1===a?c="Ніколи":2===a?c="За компанію":3===a&&(c="Так"),c&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsxs)("svg",{className:"w-4 h-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 64 64",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round",role:"img","aria-label":"Cigarette icon",children:[(0,b.jsx)("rect",{x:"8",y:"28",width:"36",height:"8",rx:"1.5"}),(0,b.jsx)("line",{x1:"14",y1:"28",x2:"14",y2:"36"}),(0,b.jsx)("line",{x1:"22",y1:"28",x2:"22",y2:"36"}),(0,b.jsx)("rect",{x:"44",y:"28",width:"8",height:"8",rx:"1.5",fill:"currentColor",stroke:"none"}),(0,b.jsx)("path",{d:"M56 20c-4 6 4 8 0 14",stroke:"currentColor"})]}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:c})]})})(),(()=>{let a=n?.color_hair;return a&&""!==String(a).trim()&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-purple-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2zM8 14v4m8-4v4m-4-4v4"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]})})(),(()=>{let a=n?.body_type;return a&&""!==String(a).trim()&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-indigo-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]})})(),(()=>{let a=n?.color_eye;return a&&""!==String(a).trim()&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-teal-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsxs)("svg",{className:"w-4 h-4 text-teal-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]})})(),(()=>{let a=n?.height;return 0!==(a?parseFloat(String(a)):0)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-cyan-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7l-2-2-2 2m0 0l-2 2 2 2m0-2V21M8 7h8M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-2"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[a," см"]})]})})(),(()=>{let a=n?.weight;return 0!==(a?parseFloat(String(a)):0)&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-pink-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M6 7l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M9 8l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1M12 9l3 1m0 0l-3 9a5.002 5.002 0 006.001 0m-6.001 0l3-9m0 0l3-1m-3 1l-3 1"})}),(0,b.jsxs)("span",{className:"text-sm text-gray-700 font-medium",children:[a," кг"]})]})})(),n?.goal&&Array.isArray(n.goal)&&n.goal.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-purple-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`goal-${c}`)),o?.pref_personality_type&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:o.pref_personality_type})]})]})]}):null})(),(()=>{let a=n?.traits&&(Array.isArray(n.traits)&&n.traits.length>0||"string"==typeof n.traits&&n.traits.trim()),c=n?.hobbies&&(Array.isArray(n.hobbies)&&n.hobbies.length>0||"string"==typeof n.hobbies&&n.hobbies.trim()),d=n?.religion;return a||c||d?(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Риси та захоплення"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(()=>{let a=[];return Array.isArray(n?.traits)?a=n.traits:"string"==typeof n?.traits&&n.traits&&(a=n.traits.split(",").map(a=>a.trim()).filter(a=>a)),a.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-blue-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`trait-${c}`))})(),(()=>{let a=[];return Array.isArray(n?.hobbies)?a=n.hobbies:"string"==typeof n?.hobbies&&n.hobbies&&(a=n.hobbies.split(",").map(a=>a.trim()).filter(a=>a)),a.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-green-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l.707.707A1 1 0 0012.414 11H15m-3 7.5A9.5 9.5 0 1121.5 12 9.5 9.5 0 0112 2.5z"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:a})]},`hobby-${c}`))})(),n?.religion&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-violet-50 px-2 py-1 rounded-full w-fit",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-violet-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})}),(0,b.jsx)("span",{className:"text-sm text-gray-700 font-medium",children:n.religion})]})]})]}):null})(),n?.description&&(0,b.jsxs)("div",{className:"mt-6 mb-4",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Про мене"}),(0,b.jsx)("div",{className:"text-sm text-gray-700 leading-relaxed",children:(a=>{let b=document.createElement("textarea");return b.innerHTML=a,b.value})(String(n.description))})]}),(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)(w,{label:"Шукаю",value:n?.looking_for})}),(0,b.jsx)("div",{className:"space-y-1",children:(0,b.jsx)(w,{label:"Створено",value:p})})]})]})]})}):null};function y(){let a=(0,d.useRouter)(),k=(0,d.useSearchParams)(),n=(0,d.useParams)().dialogId,p=(0,c.useRef)();p.current||(p.current=new t),(0,c.useEffect)(()=>{let a=p.current;return()=>{a.cleanup()}},[]),p.current;let[r,w]=(0,c.useState)([]),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(!0),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(null),[S,T]=(0,c.useState)(null),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(!1),[Y,Z]=(0,c.useState)(null),[$,_]=(0,c.useState)(!1),aa=(0,c.useRef)(null),ab=(0,c.useRef)(null),ac=(0,c.useRef)(null),ad=(0,c.useRef)(0),ae=(0,c.useRef)(null),af=(0,c.useRef)(null),ag=(0,c.useRef)(!0),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)(!1),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)([]),[at,au]=(0,c.useState)(!1),[av,aw]=(0,c.useState)(0),ax=(0,c.useRef)(null),[ay,az]=(0,c.useState)(null),[aA,aB]=(0,c.useState)(!1),[aC,aD]=(0,c.useState)(!1),[aE,aF]=(0,c.useState)([]),[aG,aH]=(0,c.useState)(!1),[aI,aJ]=(0,c.useState)(""),[aK,aL]=(0,c.useState)(!0),[aM,aN]=(0,c.useState)(!1),[aO,aP]=(0,c.useState)(!1),[aQ,aR]=(0,c.useState)(!1),[aS,aT]=(0,c.useState)(!1);(0,c.useEffect)(()=>{try{let a=k?.get("openEmailHistory"),b=k?.get("corrId");"1"===a&&(ao(!0),b&&b!==n&&(window.__emailCorrOverride=b))}catch{}},[k,n]);let[aU,aV]=(0,c.useState)(null),[aW,aX]=(0,c.useState)(!1),aY=(0,c.useRef)(!1),aZ=(0,c.useRef)(null),[a$,a_]=(0,c.useState)(null),[a0,a1]=(0,c.useState)(!1),[a2,a3]=(0,c.useState)(""),[a4,a5]=(0,c.useState)(!1),[a6,a7]=(0,c.useState)(!1),[a8,a9]=(0,c.useState)([]),[ba,bb]=(0,c.useState)(void 0),[bc,bd]=(0,c.useState)(!1),[be,bf]=(0,c.useState)(""),[bg,bh]=(0,c.useState)([]),[bi,bj]=(0,c.useState)([]),[bk,bl]=(0,c.useState)([]),[bm,bn]=(0,c.useState)([]);(0,c.useEffect)(()=>(window.activeLottieInstances||(window.activeLottieInstances=new Map),()=>{bo()}),[]);let bo=(0,c.useCallback)(()=>{console.log("🧹 Cleaning up Lottie animations..."),"undefined"!=typeof document&&document.querySelectorAll("[data-lottie-url]").forEach(a=>{a instanceof HTMLElement&&(a.innerHTML="")})},[]),bp=(0,c.useCallback)(()=>{if(console.log("🧹 Cleaning up active requests..."),aZ.current)try{aZ.current.abort(),console.log("✅ Cancelled active gift loading request")}catch(a){console.warn("⚠️ Error aborting request:",a)}finally{aZ.current=null,aY.current=!1}aH(!1),L(!1),J(!1)},[]),bq=async(a,b)=>{try{console.log("🎭 Loading Lottie for gift:",b.name,b.animationSrc),window.lottie||await new Promise((a,b)=>{let c=document.createElement("script");c.src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js",c.onload=()=>{console.log("✅ Lottie library loaded"),a()},c.onerror=()=>{console.error("❌ Failed to load Lottie library"),b(Error("Failed to load Lottie"))},document.head.appendChild(c)});let c=await fetch(b.animationSrc);if(!c.ok)throw Error("Failed to fetch Lottie data: "+c.status);let d=await c.json();console.log("🎭 Lottie data loaded for:",b.name),a.innerHTML="";let e=window.lottie.loadAnimation({container:a,animationData:d,renderer:"svg",loop:!0,autoplay:!0,rendererSettings:{preserveAspectRatio:"xMidYMid meet"}}),f=b.id+"-"+Date.now();window.activeLottieInstances&&window.activeLottieInstances.set(f,e),e.addEventListener("data_ready",()=>{console.log("✅ Lottie animation loaded and playing for:",b.name)}),e.addEventListener("error",c=>{console.error("❌ Lottie animation error for:",b.name,c),br(a,b)})}catch(c){console.error("❌ Failed to load Lottie for:",b.name,c),br(a,b)}},br=(a,b)=>{let c=b.animationSrc.replace(".json",".png"),d=new Image;d.onload=()=>{a.innerHTML='<img src="'+c+'" class="w-full h-full object-cover" alt="Static version" />'},d.onerror=()=>{a.innerHTML='<div class="w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-purple-100"><div class="text-center"><div class="text-2xl mb-1">🎭</div><div class="text-xs text-gray-600">Lottie анімація</div></div></div>'},d.src=c},bs=(0,c.useRef)(null),[bt,bu]=n.split("-").map(Number);console.log("🔢 Dialog parsing:",{dialogId:n,idProfile:bt,idRegularUser:bu}),(0,c.useEffect)(()=>{if(!(0,f.getSession)())return void a.replace("/login");ag.current=!0,ad.current=0,ae.current&&(clearTimeout(ae.current),ae.current=null),af.current&&(clearTimeout(af.current),af.current=null),(async()=>{try{let[a,b]=n.split("-"),c=parseInt(a),d=parseInt(b);if(Number.isFinite(c)&&Number.isFinite(d)){let a=await (0,e.apiPost)("/api/chats/connections",{profileId:c,idsInterlocutor:[d]}),b=!!a?.data?.[0]?.blockedByInterlocutor;"function"==typeof aq&&aq(b)}}catch{}bv()})(),bw(),bx()},[n,a]),(0,c.useEffect)(()=>{!C?.id||aA||ay||bz()},[C?.id,aA,ay]);let bv=async(a=!0)=>{try{a?(H(!0),w([]),P(null),N(!0)):L(!0);let b=new URLSearchParams;O&&!a&&b.set("cursor",O.toString());let c=`/api/chats/dialogs/${encodeURIComponent(n)}/messages${b.toString()?"?"+b.toString():""}`,d=await (0,e.apiGet)(c),f=(d.messages||[]).sort((a,b)=>new Date(a.dateCreated).getTime()-new Date(b.dateCreated).getTime());if(a)w(f),f.length>0&&P(f[0].id);else{let a=new Set(r.map(a=>a.id)),b=f.filter(b=>!a.has(b.id));if(console.log(`📄 Pagination: loaded ${f.length} messages, ${b.length} new, ${f.length-b.length} duplicates filtered`),0===b.length?(console.log(`⏹️ No new messages after filtering, stopping pagination`),N(!1)):w(a=>[...b,...a]),f.length>0){let a=f[0].id;P(b=>b!==a?a:b)}}if(a)N(!1!==d.hasMore&&f.length>0);else{let a=new Set(r.map(a=>a.id)),b=f.filter(b=>!a.has(b.id)),c=b.length>0;console.log(`📊 Pagination check: received ${f.length}, new ${b.length}, hasMore=${d.hasMore}`),N(!1!==d.hasMore&&c)}}catch(b){console.error("Failed to load messages:",b),a&&w([])}finally{a?(H(!1),ag.current=!0):(L(!1),af.current=setTimeout(()=>{ag.current=!0,console.log(`✅ Pagination unlocked, can load more`)},100))}},bw=async()=>{try{J(!0);let a=await (0,e.apiGet)(`/api/chats/profiles?ids=${bu}`);a.profiles&&a.profiles.length>0&&B(a.profiles[0]);let b=(await (0,e.apiGet)("/profiles/my")).find(a=>a.profileId===bt.toString());if(b){D(b);let a=await (0,e.apiGet)(`/profiles/${b.id}/profile-data`);a.profileData?.personal?.avatar_large&&F(a.profileData.personal.avatar_large)}}catch(a){console.error("Failed to load user/profile data:",a)}finally{J(!1)}},bx=async()=>{try{V(!0);let a=localStorage.getItem(`messagesLeft_${n}`);a&&!isNaN(parseInt(a))?R(parseInt(a)):(console.warn(`No valid messagesLeft found in localStorage for ${n}`),R(0));let b=await (0,e.apiGet)(`/api/chats/dialogs/${encodeURIComponent(n)}/restrictions`);if("number"==typeof b.lettersLeft?T(b.lettersLeft):(console.warn("Invalid lettersLeft response:",b),T(0)),bu&&bt){let a=await u(bt,bu);!function(a,b){let c=new Date().toLocaleTimeString();if(!b.success){console.log(`🚫 [${c}] TalkTimes Restrictions Check FAILED for user ${a}:`),console.log(`   Error: ${b.error}`);return}console.log(`✅ [${c}] TalkTimes Restrictions Check SUCCESS for user ${a}:`),console.log(`   🎪 Exclusive Posts: ${b.hasExclusivePosts?"⚡ ENABLED":"❌ DISABLED"}`),console.log(`   📋 Categories: [${b.categories.join(", ")}]`),b.hasExclusivePosts&&console.log(`   🎯 This dialog supports EXCLUSIVE POSTS! Lightning icon will be shown.`)}(bu,a),a.success?(a7(a.hasExclusivePosts),a9(a.categories),bb(a.tier)):(a7(!1),a9([]),bb(void 0))}}catch(a){console.error("Failed to load restrictions:",a),null===Q&&R(0),T(0),a7(!1),a9([]),bb(void 0)}finally{V(!1)}},by=async a=>{try{console.log("🎯 loadPostDetails called:",{idPost:a,dialogId:n,idProfile:bt,idRegularUser:bu}),aX(!0);let b=await (0,e.apiPost)("/api/chats/tt-post-details",{idPost:a,idProfile:bt,idInterlocutor:bu});console.log("📤 API request:",{idPost:a,idProfile:bt,idInterlocutor:bu}),b.success&&b.data?(aV(b.data),aT(!0)):(console.error("Failed to load post details:",b.error),console.error("Не вдалося завантажити інформацію про пост"))}catch(a){console.error("Error loading post details:",a),console.error("Помилка при завантаженні поста")}finally{aX(!1)}},bz=async()=>{if(aA)return void console.log("🎁 Skipping loadGiftLimits - already loading");try{aB(!0),console.log("🎁 Loading gift limits for dialog:",n,"client:",bu);let a=await (0,e.apiPost)(`/profiles/${C?.id}/gift-limits`,{clientId:bu});a.success&&a.data?(console.log("✅ Gift limits loaded:",a.data),az(a.data)):(console.warn("Failed to load gift limits:",a.error),az(null))}catch(a){console.error("Failed to load gift limits:",a),az(null)}finally{aB(!1)}},bA=async(a=!0)=>{if(aY.current)return void console.log("🎁 Skipping loadGifts - already loading");aZ.current&&aZ.current.abort(),aZ.current=new AbortController;try{aY.current=!0,a?(aH(!0),aF([]),aJ(""),aL(!0)):aH(!0),console.log("🎁 Loading gifts for client:",bu,"cursor:",aI),console.log("🎭 Mock mode:","disabled");let b=await (0,e.apiPost)(`/profiles/${C?.id}/gift-list`,{clientId:bu,cursor:a?"":aI,limit:30},{signal:aZ.current.signal});b.success&&b.data?(console.log("✅ Gifts loaded:",b.data.items.length,"items"),b.data.items.slice(0,3).forEach((a,b)=>{let c=a.imageSrc||a.animationSrc,d=!!a.animationSrc,e=a.animationSrc?.endsWith(".json")?"JSON/Lottie":a.animationSrc?.endsWith(".gif")||a.animationSrc?.includes("gif")?"GIF":a.animationSrc?"Other":"Static";console.log(`🎁 Gift ${b+1}: ${a.name}${d?` (${e})`:""}, src: ${c}`),console.log(`🎁 Final URL for ${a.name}:`,c.startsWith("http")||c.startsWith("//")?c.startsWith("//")?`https:${c}`:c:`https://talkytimes.com${c}`)}),a?aF(b.data.items):aF(a=>[...a,...b.data.items]),aJ(b.data.cursor),aL(30===b.data.items.length)):(console.warn("Failed to load gifts:",b.error),aF([]),aL(!1))}catch(a){"AbortError"!==a.name?(console.error("❌ Failed to load gifts:",a),aF([]),aL(!1)):console.log("🎁 Gift loading was cancelled")}finally{aH(!1),aY.current=!1,aZ.current=null}},bB=async()=>{try{let a=Date.now();if(bs.current&&bs.current.profileId===bt.toString()&&a-bs.current.timestamp<18e5){console.log("📋 Using cached stickers (age:",Math.round((a-bs.current.timestamp)/1e3),"seconds)"),as(bs.current.data);return}au(!0),console.log("📥 Loading stickers from server...");let b=await (0,e.apiPost)("/api/chats/stickers",{idInterlocutor:bu});b.categories&&Array.isArray(b.categories)?(as(b.categories),bs.current={data:b.categories,timestamp:a,profileId:bt.toString()},console.log(`✅ Loaded ${b.categories.length} sticker categories and cached them`)):(console.warn("Invalid stickers response:",b),as([]))}catch(a){console.error("Failed to load stickers:",a),bs.current=null,as([])}finally{au(!1)}},bC=async()=>{M&&!K&&!G&&O&&ag.current&&(ag.current=!1,console.log(`🔄 Loading more messages with cursor: ${O}`),await bv(!1))};async function bD(){if(y.trim()){await (0,e.apiPost)(`/api/chats/dialogs/${encodeURIComponent(n)}/text`,{text:y}),z("");try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:bt,clientId:bu,kind:"text"}}))}catch{}}}(0,c.useEffect)(()=>((0,f.getAccessToken)(),process.env.NEXT_PUBLIC_SOCKET_BASE||process.env.NEXT_PUBLIC_API_URL,()=>{ae.current&&clearTimeout(ae.current),af.current&&clearTimeout(af.current)}),[n,bt,bu]),(0,c.useEffect)(()=>{let a=a=>{"Escape"===a.key&&(al&&am(!1),aC&&aD(!1),a0&&a1(!1),an&&ao(!1))};return(al||aC||a0||an)&&document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}},[al,aC,a0,an]),(0,c.useEffect)(()=>{aC||a0||(bo(),bp())},[aC,a0]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{ac.current&&(ac.current.focus(),bE(ac.current))},100);return()=>clearTimeout(a)},[]),(0,c.useEffect)(()=>()=>{console.log("🧹 Component unmounting, cleaning up all resources..."),ae.current&&(clearTimeout(ae.current),ae.current=null),af.current&&(clearTimeout(af.current),af.current=null),bo(),bp()},[]),function({profileId:a,dialogId:b,onMessage:d,onUserOnlineStatus:e,onDialogLimitChanged:f}){let{getSocketForProfile:g,joinDialog:k,leaveDialog:l}=(0,h.useWebSocketPool)(),{showToast:m}=(0,i.useToast)(),[n,o]=(0,c.useState)(null);(0,c.useEffect)(()=>{if(!a||!b)return;let c=setTimeout(()=>{k(a,b)},50);return()=>{clearTimeout(c),l(a,b)}},[a,b,k,l]),(0,c.useEffect)(()=>{a&&o(g(a))},[a,g]),(0,c.useEffect)(()=>{if(!n)return;let b=a=>{d?.(a)},c=a=>{e?.(a)},g=a=>{f?.(a)},h=b=>{if(b.idUserFrom?.toString?.()===a)return;let c=b.type||"new_message",d=b.messageId||b.emailId||b.id||b.dialogId||"",e=b.dateCreated||"",f=`${c}:${d}:${e}`,g=Date.now();for(let[a,b]of j)g-b>3e4&&j.delete(a);let h=j.get(f);h&&g-h<=3e4||(j.set(f,g),m({messageId:b.messageId,idUserFrom:b.idUserFrom,idUserTo:b.idUserTo,dateCreated:b.dateCreated,type:"new_email"===c?"new_email":"new_message",dialogId:b.dialogId}))};return n.on("message",b),n.on("user_online_status",c),n.on("message_toast",h),n.on("dialog_limit_changed",g),()=>{n.off("message",b),n.off("user_online_status",c),n.off("message_toast",h),n.off("dialog_limit_changed",g)}},[n,d,e]),n?.connected}({profileId:bt.toString(),dialogId:n,onMessage:a=>{console.log("📨 RTM Pool: Received new message",a);let b={id:Number(a.id)||Date.now(),idUserFrom:Number(a.idUserFrom),idUserTo:Number(a.idUserTo),type:a.type||"text",dateCreated:(()=>{let b=new Date(a.dateCreated||Date.now());return isNaN(b.getTime())?new Date().toISOString():b.toISOString()})(),content:{message:a.content?.message||a.message?.message||a.text||"",url:a.content?.url,id:a.content?.id}};w(a=>{if(a.some(a=>a.id===b.id))return a;if("sticker"===b.type&&b.idUserFrom===bt){let c=a.findIndex(a=>"sticker"===a.type&&a.idUserFrom===bt&&a.idUserTo===bu&&a.content.id===b.content.id&&!0===a.isSending);if(-1!==c){let d=[...a];return d[c]=b,d.sort((a,b)=>new Date(a.dateCreated).getTime()-new Date(b.dateCreated).getTime())}}let c=[...a,b].sort((a,b)=>new Date(a.dateCreated).getTime()-new Date(b.dateCreated).getTime());return b.idUserFrom===bt&&(()=>{if(Q&&Q>0){let a=Q-1;R(a),localStorage.setItem(`messagesLeft_${n}`,a.toString())}})(),c}),setTimeout(()=>{aa.current?.scrollIntoView({behavior:"smooth"})},100)},onUserOnlineStatus:a=>{console.log("👤 RTM Pool: User online status changed",a),a.userId===bu&&B(b=>b?{...b,is_online:a.isOnline}:null)},onDialogLimitChanged:a=>{a.idUser===bt&&a.idInterlocutor===bu&&(R(a.limitLeft??Q),"number"==typeof a.limitLeft&&localStorage.setItem(`messagesLeft_${n}`,String(a.limitLeft)))}});let bE=a=>{a.style.height="auto";let b=Math.min(a.scrollHeight,120);a.style.height=b+"px"},bF=async a=>{console.log("Selected photos:",a);let b={id:Date.now(),dateCreated:new Date().toISOString(),idUserFrom:bt,idUserTo:bu,type:"photo_batch",content:{photos:a.map(a=>({id:a.idPhoto,url:a.urls.urlPreview}))},isSending:!0};w(a=>[...a,b].sort((a,b)=>new Date(a.dateCreated).getTime()-new Date(b.dateCreated).getTime())),setTimeout(()=>aa.current?.scrollIntoView({behavior:"smooth"}),50),ai(!1)},bG=async a=>{console.log("🎁 Selected gift:",a),console.log("Dialog info:",{idProfile:bt,idRegularUser:bu}),aD(!1),a_(a),a3(""),a1(!0)},bH=async()=>{if(a$&&C?.id)try{a5(!0),console.log("📤 Sending gift:",{giftId:a$.id,fromProfile:C.id,toClient:bu,message:a2});let a=await (0,e.apiPost)(`/profiles/${C.id}/send-gift`,{clientId:bu,giftId:a$.id,message:a2});if(a.success){console.log("✅ Gift sent successfully:",a.data),console.log(`🎁 Подарунок "${a$.name}" відправлено!`),a1(!1),a_(null),a3(""),bz();try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:bt,clientId:bu,kind:"gift"}}))}catch{}}else console.error("❌ Failed to send gift:",a.error),console.error(`❌ Помилка відправки: ${a.error||"Невідома помилка"}`)}catch(a){console.error("❌ Error sending gift:",a),console.error(`❌ Помилка відправки: ${a.message||"Невідома помилка"}`)}finally{a5(!1)}},bI=async a=>{console.log("Selected sticker:",a),console.log("Dialog info:",{idProfile:bt,idRegularUser:bu});let b={id:Date.now(),dateCreated:new Date().toISOString(),idUserFrom:bt,idUserTo:bu,type:"sticker",content:{id:a.id,url:a.url},isSending:!0};w(a=>[...a,b].sort((a,b)=>new Date(a.dateCreated).getTime()-new Date(b.dateCreated).getTime())),setTimeout(()=>{aa.current?.scrollIntoView({behavior:"smooth"})},100),am(!1);try{let c=await (0,e.apiPost)("/api/chats/send-sticker",{stickerId:a.id,idRegularUser:bu,idProfile:bt});if(c.success){console.log("✅ Successfully sent sticker"),w(a=>a.map(a=>a.id===b.id?{...a,isSending:!1}:a));try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:bt,clientId:bu,kind:"sticker"}}))}catch{}}else console.error("Failed to send sticker:",c.error),w(a=>a.map(a=>a.id===b.id?{...a,isSending:!1,error:!0}:a))}catch(c){console.error("Error sending sticker:",c),console.error("Request details:",{stickerId:a.id,idRegularUser:bu,idProfile:bt}),w(a=>a.map(a=>a.id===b.id?{...a,isSending:!1,error:!0}:a))}},bJ=async a=>{try{X(!0),_(!0),Z(a);let b=await (0,e.apiPost)("/api/chats/photo-original",{profileId:bt.toString(),idRegularUser:bu,previewUrl:a}),c=b&&(b.url||b.data?.url)?b.url||b.data?.url:null;c&&Z(c)}catch(a){}finally{_(!1)}},bK=a=>{let b=new Date(a);if(isNaN(b.getTime()))return"—";let c=b.toLocaleDateString("uk-UA",{day:"2-digit",month:"2-digit",year:"numeric"}),d=b.toLocaleTimeString("uk-UA",{hour:"2-digit",minute:"2-digit"});return`${c} ${d}`},[bL,bM]=(0,c.useState)(!1),[bN,bO]=(0,c.useState)(!1);return(0,b.jsxs)("div",{className:"flex flex-col h-full",children:[I?(0,b.jsx)(g.ChatHeaderSkeleton,{}):(0,b.jsx)("div",{className:"bg-white border-b border-gray-200 p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,b.jsx)("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200 cursor-pointer",onClick:()=>bM(!0),children:A?.personal?.avatar_small?(0,b.jsx)("img",{src:A.personal.avatar_small,alt:A.name,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-white bg-purple-500 text-sm font-medium",children:A?.name?.charAt(0).toUpperCase()||"U"})}),A?.is_online&&(0,b.jsx)("div",{className:"absolute top-0 left-0 w-3 h-3 bg-green-500 rounded-full border border-white"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:A?.name||`Користувач ${bu}`}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:bu})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"font-medium text-gray-900",children:C?.displayName||"Невідомий"}),(0,b.jsx)("div",{className:"text-sm text-gray-500",children:bt})]}),(0,b.jsx)("div",{className:"relative flex-shrink-0",children:(0,b.jsx)("div",{className:"w-11 h-11 rounded-full overflow-hidden bg-gray-200 cursor-pointer",onClick:()=>bO(!0),children:E?(0,b.jsx)("img",{src:E,alt:C?.displayName||"Profile",className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-white bg-blue-500 text-sm font-medium",children:C?.displayName?.charAt(0).toUpperCase()||"P"})})})]})]})}),(0,b.jsx)("div",{className:"relative",children:(0,b.jsxs)("div",{className:"absolute top-2 left-4 z-10 flex items-center gap-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1 bg-white/90 backdrop-blur-sm rounded-full px-2 py-1 shadow-sm border border-gray-200/50",children:[(0,b.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-3 h-3 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z",clipRule:"evenodd"})})}),U?(0,b.jsx)("div",{className:"w-4 h-3 bg-gray-200 rounded animate-pulse"}):(0,b.jsx)("span",{className:`text-xs font-medium ${0===Q?"text-red-600":Q&&Q<=3?"text-orange-600":"text-green-600"}`,children:Q??"—"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1 bg-white/90 backdrop-blur-sm rounded-full px-2 py-1 shadow-sm border border-gray-200/50",children:[(0,b.jsx)("div",{className:"w-4 h-4 flex items-center justify-center",children:(0,b.jsxs)("svg",{className:"w-3 h-3 text-purple-600",fill:"currentColor",viewBox:"0 0 20 20",children:[(0,b.jsx)("path",{d:"M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"}),(0,b.jsx)("path",{d:"M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"})]})}),U?(0,b.jsx)("div",{className:"w-4 h-3 bg-gray-200 rounded animate-pulse"}):(0,b.jsx)("span",{className:`text-xs font-medium ${0===S?"text-red-600":1===S?"text-orange-600":S&&S>=2?"text-green-600":"text-gray-500"}`,children:S??"—"})]}),A?.personal&&(()=>{let a=(a=>{if(!a||"string"!=typeof a)return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:"Невідомо",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})};switch(a.toLowerCase()){case"real_love":return{iconColor:"text-red-600",textColor:"text-red-600",displayName:"Любов",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z",clipRule:"evenodd"})})};case"friendship":return{iconColor:"text-blue-600",textColor:"text-blue-600",displayName:"Дружба",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"})})};case"hot_talks":return{iconColor:"text-pink-600",textColor:"text-pink-600",displayName:"Інтим",icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0112.12 15.12z"})})};default:return{iconColor:"text-gray-600",textColor:"text-gray-600",displayName:a,icon:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})})}}})(A.personal.mood);return(0,b.jsxs)("div",{className:"flex items-center gap-1 bg-white/90 backdrop-blur-sm rounded-full px-2 py-1 shadow-sm border border-gray-200/50",children:[(0,b.jsx)("div",{className:`w-4 h-4 flex items-center justify-center ${a.iconColor}`,children:a.icon}),(0,b.jsx)("span",{className:`text-xs font-medium ${a.textColor}`,children:a.displayName})]})})()]})}),(0,b.jsx)("div",{ref:ab,className:"flex-1 overflow-auto p-4 bg-gray-50 flex flex-col-reverse custom-scroll",onScroll:a=>{let{scrollTop:b}=a.currentTarget;ae.current&&clearTimeout(ae.current);let c=b<ad.current;ad.current=b,b<=20&&c&&M&&!K&&!G&&O&&ag.current&&(ae.current=setTimeout(()=>{console.log(`🔄 At top! Triggering pagination: scrollTop=${b}, canLoad=${ag.current}`),bC()},300))},children:G?(0,b.jsxs)("div",{className:"space-y-2 flex flex-col-reverse",children:[(0,b.jsx)(g.MessageSkeleton,{isFromProfile:!1}),(0,b.jsx)(g.MessageSkeleton,{isFromProfile:!0}),(0,b.jsx)(g.MessageSkeleton,{isFromProfile:!1}),(0,b.jsx)(g.MessageSkeleton,{isFromProfile:!0}),(0,b.jsx)(g.MessageSkeleton,{isFromProfile:!1})]}):0===r.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:(0,b.jsx)("p",{children:"Немає повідомлень"})}):(0,b.jsxs)("div",{className:"space-y-2 flex flex-col-reverse",children:[(0,b.jsx)("div",{ref:aa}),r.slice().reverse().map((a,c)=>(a=>{let c=a.idUserFrom===bt;a.idUserFrom;let d=String(a.id??`${a.idUserFrom}-${a.idUserTo}-${a.dateCreated||""}`)+`-${a._idx??0}`;return"system"===a.type?(0,b.jsx)("div",{className:"flex justify-center mb-4",children:(0,b.jsxs)("div",{className:"text-center text-gray-500 text-sm",children:[a.content?.message&&(0,b.jsx)("p",{className:"whitespace-pre-wrap break-words",children:a.content.message}),(0,b.jsx)("p",{className:"text-xs mt-1 text-gray-400",children:bK(a.dateCreated)})]})},d):(0,b.jsx)("div",{className:`flex ${c?"justify-end":"justify-start"} mb-4`,children:(0,b.jsxs)("div",{className:`${"post"===a.type?"w-[240px]":"virtual_gift"===a.type?"w-40":"max-w-xs lg:max-w-md"} ${"photo_batch"===a.type||"photo"===a.type?"px-0 pt-0 pb-1":"virtual_gift"===a.type||"post"===a.type?"p-0":"px-4 py-2"} rounded-lg ${"post"===a.type&&a.content?.isPurchased?"bg-purple-500 text-white":"like_newsfeed_post"===a.type||"wink"===a.type||"likephoto"===a.type?"bg-gray-200 text-gray-800":("reply_newsfeed_post"===a.type||"photo_batch"===a.type||"photo"===a.type||a.type,c?"bg-gray-200 text-gray-800":"bg-purple-500 text-white")} ${"post"===a.type?"cursor-pointer hover:opacity-90 transition-opacity":""}`,onClick:"post"===a.type?()=>{let b=a.content;b?.idPost&&by(b.idPost)}:void 0,children:[("message"===a.type||"text"===a.type)&&a.content?.message&&(0,b.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:a.content.message}),"likephoto"===a.type&&(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("p",{children:"❤️ Вподобав фото"}),a.content?.url&&(0,b.jsx)("img",{src:a.content.url,alt:"Photo",className:"mt-2 rounded max-w-full h-auto"})]}),"wink"===a.type&&(0,b.jsx)("div",{className:"text-sm",children:(0,b.jsx)("p",{children:"😉 Підморгнув"})}),"photo"===a.type&&a.content?.url&&(0,b.jsx)("div",{className:"text-sm",children:(0,b.jsx)("img",{src:a.content.url,alt:"Photo",className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>a.content.url&&bJ(a.content.url)})}),"virtual_gift"===a.type&&a.content&&(()=>{let d=a.content;return(0,b.jsxs)("div",{className:"text-sm p-4",children:[d.imageSrc&&(0,b.jsx)("div",{className:"mb-2 -mx-4 -mt-4",children:(0,b.jsx)("img",{src:d.imageSrc,alt:`Virtual gift ${d.id||""}`,className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>d.imageSrc&&bJ(d.imageSrc)})}),(0,b.jsx)("div",{className:`inline-block text-xs px-2 py-1 rounded mb-2 ${!c?"bg-pink-500 text-white":"bg-pink-600 text-white"}`,children:"Віртуальний подарунок"}),d.message&&(0,b.jsx)("p",{className:"whitespace-pre-wrap break-words italic text-black",children:d.message})]})})(),"photo_batch"===a.type&&a.content?.photos?.length>0&&(()=>{let c=a.content?.photos||[];if(1===c.length){let d=c[0];return(0,b.jsx)("div",{className:"text-sm",children:(0,b.jsx)("img",{src:d.url,alt:`Photo ${d.id||0}`,className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>bJ(d.url)},`${a.id}-${d.id||0}`)})}let d=c.length>=5?3:2;return(0,b.jsx)("div",{className:`grid gap-0 text-sm ${3===d?"grid-cols-3":"grid-cols-2"}`,children:c.map((c,d)=>(0,b.jsx)("img",{src:c.url,alt:`Photo ${c.id||d}`,className:"rounded w-40 h-40 object-cover cursor-zoom-in",onClick:()=>bJ(c.url)},`${a.id}-${c.id||d}`))})})(),"sticker"===a.type&&a.content?.url&&(0,b.jsxs)("div",{className:"text-sm relative",children:[(0,b.jsx)("img",{src:a.content.url,alt:`Sticker ${a.content.id||""}`,className:`max-w-[124px] max-h-[124px] object-contain rounded-md ${a.isSending?"opacity-70":a.error?"opacity-50":""}`}),a.isSending&&(0,b.jsx)("div",{className:"absolute -bottom-1 -right-1",children:(0,b.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"})})}),a.error&&(0,b.jsx)("div",{className:"absolute -bottom-1 -right-1",children:(0,b.jsx)("div",{className:"w-4 h-4 bg-red-500 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})})]}),"like_newsfeed_post"===a.type&&a.content&&(()=>{let c=a.content,d=c.photos||[],e=d.length>0;return(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("p",{className:"mb-2",children:"❤️ Уподобав ваш пост"}),e&&d.length>0&&(0,b.jsx)("div",{className:"mb-2",children:1===d.length?(0,b.jsx)("img",{src:d[0].url,alt:"Post photo",className:"rounded w-32 h-32 object-cover cursor-zoom-in",onClick:()=>bJ(d[0].url)}):(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[d.slice(0,4).map((c,d)=>(0,b.jsx)("img",{src:c.url,alt:`Post photo ${d+1}`,className:"rounded w-16 h-16 object-cover cursor-zoom-in",onClick:()=>bJ(c.url)},`${a.id}-photo-${d}`)),d.length>4&&(0,b.jsxs)("div",{className:"w-16 h-16 bg-gray-300 rounded flex items-center justify-center text-xs text-gray-600",children:["+",d.length-4]})]})}),c.text&&(0,b.jsx)("p",{className:"whitespace-pre-wrap break-words italic text-sm opacity-75",children:c.text})]})})(),"reply_newsfeed_post"===a.type&&a.content&&(()=>{let d=a.content,e=d.photos||[],f=e.length>0;return(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("p",{className:`text-xs mb-2 ${c?"text-gray-500":"text-white"}`,children:"Відповів на пост"}),(d.text||f)&&(0,b.jsx)("div",{className:"mb-3 p-3 bg-gray-100 rounded-lg border-l-4 border-blue-500",children:(0,b.jsxs)("div",{className:"flex gap-3",children:[f&&e.length>0&&(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("img",{src:e[0].url,alt:"Post preview",className:"rounded w-16 h-16 object-cover cursor-zoom-in",onClick:()=>bJ(e[0].url)})}),d.text&&(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("p",{className:"whitespace-pre-wrap break-words text-sm italic text-gray-700",children:d.text})})]})}),d.replyText&&(0,b.jsx)("p",{className:"whitespace-pre-wrap break-words text-sm font-medium",children:d.replyText})]})})(),"post"===a.type&&a.content&&(()=>{let c=a.content,d=c.photos||[],e=d.length>0;return(0,b.jsxs)("div",{className:"text-sm p-4",children:[e&&(0,b.jsxs)("div",{className:"flex -mx-4 -mt-4 mb-2 overflow-hidden rounded-t-lg",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsxs)("div",{className:"relative w-40 h-40",children:[(0,b.jsx)("img",{src:d[0].url,alt:"Post photo 1",className:"w-full h-full object-cover"}),(0,b.jsx)("div",{className:`absolute top-2 left-2 text-xs px-2 py-1 rounded ${c.isPurchased?"bg-purple-500 text-white":"bg-black/70 text-white"}`,children:c.isPurchased?"Переглянуто":"Не відкрито"})]})}),d.length>1&&(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("div",{className:"relative w-20 h-20",children:(0,b.jsx)("img",{src:d[1].url,alt:"Post photo 2",className:"w-full h-full object-cover"})}),d.length>2&&(0,b.jsxs)("div",{className:"relative w-20 h-20",children:[(0,b.jsx)("img",{src:d[2].url,alt:"Post photo 3",className:"w-full h-full object-cover"}),d.length>3&&(0,b.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,b.jsxs)("span",{className:"text-white font-bold text-sm",children:["+",d.length-3]})})]})]})]}),c.textPreview&&(0,b.jsx)("p",{className:"mt-2 whitespace-pre-wrap break-words",children:c.textPreview}),!e&&(0,b.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:c.idPost&&`Post ID: ${c.idPost}`})]})})(),!["message","text","likephoto","photo","photo_batch","sticker","system","post","virtual_gift","like_newsfeed_post","wink","reply_newsfeed_post"].includes(a.type)&&(0,b.jsxs)("div",{className:"text-sm italic text-gray-500",children:["Тип повідомлення: ",a.type,a.content?.message&&(0,b.jsx)("p",{className:"mt-1",children:a.content.message})]}),(0,b.jsx)("p",{className:`text-xs mt-1 ml-2 ${"post"===a.type&&a.content?.isPurchased||("photo_batch"===a.type||"photo"===a.type||"virtual_gift"===a.type)&&!c?"text-white":"like_newsfeed_post"===a.type||"wink"===a.type||"likephoto"===a.type?"text-gray-500":(a.type,c?"text-gray-500":"text-purple-200")}`,children:bK(a.dateCreated)})]})},d)})({...a,_idx:c})),K&&(0,b.jsx)("div",{className:"flex justify-center py-4",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[(0,b.jsx)("div",{className:"animate-spin w-4 h-4 border-2 border-gray-300 border-t-purple-500 rounded-full"}),"Завантаження старіших повідомлень..."]})})]})}),(0,b.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:ap?(0,b.jsx)("div",{className:"text-center text-red-600 font-medium",children:"Вас було заблоковано"}):(0,b.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,b.jsx)("button",{onClick:()=>ai(!0),className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Прикріпити медіа",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),(0,b.jsx)("button",{onClick:()=>ao(!0),className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Історія листування",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,b.jsx)("button",{onClick:()=>{am(!0),aw(0),0===ar.length&&bB()},className:"flex-shrink-0 p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Вибрати стікер",children:(0,b.jsxs)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,b.jsx)("circle",{cx:"9",cy:"9",r:"1"}),(0,b.jsx)("circle",{cx:"15",cy:"9",r:"1"}),(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 14c1 1 3 1 5 0"})]})}),ay&&(ay.limit>0||ay.canSendWithoutLimit)&&(0,b.jsxs)("button",{onClick:()=>{aD(!0),0===aE.length&&bA()},className:"flex-shrink-0 p-2 text-pink-500 hover:text-pink-700 hover:bg-pink-50 rounded-lg transition-colors relative",title:`Віртуальні подарунки (${ay.canSendWithoutLimit?"без ліміту":`${ay.limit} залишилось`})`,children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})}),!ay.canSendWithoutLimit&&ay.limit>0&&(0,b.jsx)("span",{className:"absolute -top-1 -right-1 bg-pink-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium",children:ay.limit>99?"99+":ay.limit})]}),a6&&(0,b.jsxs)("button",{onClick:()=>bd(!0),className:`flex-shrink-0 p-2 rounded-lg transition-colors relative ${"specialplus"===ba?"text-red-600 hover:text-red-700":"text-yellow-500 hover:text-yellow-600"}`,title:`${"specialplus"===ba?"⚡ SpecialPlus":"⚡ Special"} — Категорії: ${a8.join(", ")}`,children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})}),(0,b.jsx)("div",{className:`absolute inset-0 rounded-lg opacity-20 animate-pulse ${"specialplus"===ba?"bg-red-500":"bg-yellow-400"}`}),"specialplus"===ba&&(0,b.jsx)("div",{className:"absolute -top-1 -right-1 w-4 h-4 rounded-full bg-white text-red-600 flex items-center justify-center text-[10px] font-extrabold leading-none",children:"+"})]}),(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsxs)("div",{className:`absolute top-0 right-2 text-xs z-10 ${y.length>250?"text-red-500":y.length>200?"text-yellow-500":"text-gray-400"}`,children:[y.length,"/300"]}),(0,b.jsx)("textarea",{ref:ac,className:"w-full border border-gray-300 rounded-lg px-4 py-3 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none overflow-hidden",placeholder:"Напишіть повідомлення...",value:y,onChange:a=>{z(a.target.value),bE(a.target)},onKeyPress:a=>"Enter"===a.key&&!a.shiftKey&&bD(),maxLength:300,rows:1,style:{minHeight:"48px",maxHeight:"120px"}}),(0,b.jsxs)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>aN(!aM),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",title:"Додати емодзі",children:"😀"}),(0,b.jsx)(q,{isOpen:aM,onEmojiSelect:a=>{z(b=>b+a)},onClose:()=>aN(!1)})]})]}),(0,b.jsx)("button",{className:"bg-purple-500 hover:bg-purple-600 text-white w-10 h-10 rounded-lg transition-colors flex items-center justify-center",onClick:bD,title:"Надіслати повідомлення",children:(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})}),(0,b.jsx)(l,{profileId:bt.toString(),isOpen:ah,onClose:()=>ai(!1),onPhotoSelect:bF,maxSelection:6,context:"chat",idRegularUser:bu,mode:"send",allowAudio:!0}),(0,b.jsx)(l,{profileId:bt.toString(),isOpen:aj,onClose:()=>ak(!1),onPhotoSelect:()=>{},maxSelection:6,context:"chat",idRegularUser:bu,mode:"attach",actionLabel:"Прикріпити",allowAudio:!1,allowedPhotoTabs:"specialplus"===ba?["special","special_plus"]:["special"],isSpecialPlusAllowed:"specialplus"===ba,onAttach:({photos:a,videos:b})=>{bh(a.map(a=>a.idPhoto)),bj(b.map(a=>a.idVideo)),bl(a.map(a=>({idPhoto:a.idPhoto,url:a.urls.urlPreview}))),bn(b.map(a=>({idVideo:a.idVideo,url:a.urls.urlThumbnail}))),ak(!1)}}),(0,b.jsx)(s,{isOpen:an,onClose:()=>ao(!1),profileId:bt.toString(),clientId:bu.toString(),correspondenceId:n,lettersLeft:S}),bc&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg w-full max-w-2xl p-4 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Ексклюзивний пост"}),(0,b.jsx)("button",{onClick:()=>bd(!1),className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm text-gray-600 mb-1",children:["Текст (мінімум ",100," символів)"]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("textarea",{value:be,onChange:a=>bf(a.target.value),rows:4,className:"w-full border rounded-md p-2 pr-12 focus:outline-none focus:ring-2 focus:ring-purple-500",placeholder:"Введіть текст посту..."}),(0,b.jsxs)("div",{className:"absolute right-2 top-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>aP(!aO),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors",title:"Додати емодзі",children:"😀"}),(0,b.jsx)(q,{isOpen:aO,onEmojiSelect:a=>{bf(b=>b+a)},onClose:()=>aP(!1)})]})]}),(0,b.jsxs)("div",{className:`${be.length<100?"text-red-600":"text-gray-500"} text-sm mt-1`,children:["Залишилось: ",Math.max(0,100-be.length)]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Прикріплені медіа"}),(0,b.jsx)("button",{onClick:()=>ak(!0),className:"px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 text-sm",children:"Додати з галереї"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[bk.map(a=>(0,b.jsxs)("div",{className:"relative w-16 h-16 rounded-md overflow-hidden border border-gray-200",children:[(0,b.jsx)("img",{src:a.url,alt:`Фото ${a.idPhoto}`,className:"w-full h-full object-cover"}),(0,b.jsx)("button",{onClick:()=>{bh(b=>b.filter(b=>b!==a.idPhoto)),bl(b=>b.filter(b=>b.idPhoto!==a.idPhoto))},className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати фото",children:"✕"})]},`p-${a.idPhoto}`)),bm.map(a=>(0,b.jsxs)("div",{className:"relative w-16 h-16 rounded-md overflow-hidden border border-gray-200",children:[(0,b.jsx)("img",{src:a.url,alt:`Відео ${a.idVideo}`,className:"w-full h-full object-cover"}),(0,b.jsx)("span",{className:"absolute bottom-0 right-0 m-0.5 text-[10px] px-1 py-0.5 rounded bg-black/60 text-white",children:"▶"}),(0,b.jsx)("button",{onClick:()=>{bj(b=>b.filter(b=>b!==a.idVideo)),bn(b=>b.filter(b=>b.idVideo!==a.idVideo))},className:"absolute -top-1 -right-1 bg-white/90 border border-gray-300 rounded-full w-5 h-5 text-[10px] flex items-center justify-center shadow",title:"Прибрати відео",children:"✕"})]},`v-${a.idVideo}`)),0===bg.length&&0===bi.length&&(0,b.jsx)("div",{className:"text-sm text-gray-400",children:"Нічого не прикріплено"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,b.jsx)("div",{className:"text-xs text-gray-500",children:"Правила: максимум 1 відео або 1 відео + будь-яка кількість фото, або ≥4 фото без відео. Special+ фото дозволені лише для tier=SpecialPlus."}),(0,b.jsxs)("div",{className:"space-x-2",children:[(0,b.jsx)("button",{onClick:()=>bd(!1),className:"px-4 py-2 rounded-md bg-gray-100 hover:bg-gray-200",children:"Скасувати"}),(0,b.jsx)("button",{onClick:async()=>{if(!(be.length<100)){if(bi.length>0){if(bi.length>1)return}else if(bg.length>0&&bg.length<4)return;try{if((await (0,e.apiPost)("/api/chats/tt-send-post",{profileId:bt,idRegularUser:bu,idsGalleryPhotos:bg,idsGalleryVideos:bi,text:be})).success){bd(!1),bf(""),bh([]),bj([]);try{window.dispatchEvent(new CustomEvent("dialog:sent",{detail:{profileId:bt,clientId:bu,kind:"post"}}))}catch{}}}catch{}}},disabled:be.length<100||0===bi.length&&(0===bg.length||bg.length<4)||bi.length>1,className:"px-4 py-2 rounded-md bg-purple-600 text-white disabled:bg-gray-300",children:"Відправити"})]})]})]})}),al&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:a=>{a.target===a.currentTarget&&am(!1)},children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[85vh] overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-200",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Виберіть стікер"}),(0,b.jsx)("button",{onClick:()=>am(!1),className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsx)("div",{className:"flex h-[70vh]",children:at?(0,b.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,b.jsx)("div",{className:"animate-spin w-6 h-6 border-2 border-gray-300 border-t-purple-500 rounded-full"}),"Завантаження стікерів..."]})}):0===ar.length?(0,b.jsx)("div",{className:"flex items-center justify-center w-full",children:(0,b.jsx)("p",{className:"text-gray-500",children:"Не вдалося завантажити стікери"})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-20 bg-gray-50 border-r border-gray-200 overflow-y-auto custom-scroll",children:(0,b.jsx)("div",{className:"p-2 space-y-2",children:ar.map((a,c)=>(0,b.jsx)("div",{onClick:()=>(a=>{aw(a);let b=document.getElementById(`sticker-category-${a}`);if(b&&ax.current){let a=ax.current,c=b.offsetTop,d=a.clientHeight,e=b.clientHeight;a.scrollTo({top:Math.max(0,c-d/2+e/2),behavior:"smooth"})}})(c),className:`cursor-pointer rounded-lg transition-all duration-200 p-1 m-1 ${av===c?"bg-purple-200 ring-2 ring-purple-400":"hover:bg-gray-200"}`,title:a.name,children:a.stickers.length>0&&(0,b.jsx)("img",{src:a.stickers[0].url,alt:a.name,className:"w-11 h-11 mx-auto object-cover rounded-md hover:scale-150 transition-transform",loading:"lazy"})},c))})}),(0,b.jsx)("div",{ref:ax,className:"flex-1 overflow-y-auto custom-scroll",children:(0,b.jsx)("div",{className:"p-3",children:ar.map((a,c)=>(0,b.jsx)("div",{id:`sticker-category-${c}`,className:"mb-6 last:mb-0",children:(0,b.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 2xl:grid-cols-12 gap-3",children:a.stickers.map(a=>(0,b.jsx)("button",{onClick:()=>bI(a),className:"w-24 h-24 overflow-hidden hover:scale-150 transition-transform",title:`Стікер ${a.id}`,children:(0,b.jsx)("img",{src:a.url,alt:`Sticker ${a.id}`,className:"w-full h-full object-cover rounded-md",loading:"lazy"})},a.id))})},c))})})]})})]})}),aC&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[80vh] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Віртуальні подарунки"}),(0,b.jsx)("button",{onClick:()=>aD(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4 custom-scroll",children:aG&&0===aE.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,b.jsx)("div",{className:"text-gray-500",children:"Завантаження..."})}):0===aE.length?(0,b.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,b.jsx)("div",{className:"text-gray-500",children:"Немає доступних подарунків"})}):(0,b.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3",children:aE.map(a=>(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-3 hover:border-pink-300 transition-colors cursor-pointer",onClick:()=>bG(a),title:`${a.name} - ${a.cost} монет${a.animationSrc?" (анімований)":""}`,children:[(0,b.jsx)("div",{className:"relative w-full aspect-square mb-2 bg-gray-100 rounded-md overflow-hidden",children:a.imageSrc||a.animationSrc?(0,b.jsxs)(b.Fragment,{children:[a.animationSrc&&a.animationSrc.endsWith(".json")?(0,b.jsxs)(o,{onError:(b,c)=>{console.error(`🎭 Lottie error for gift "${a.name}":`,b)},children:[(0,b.jsx)("div",{className:"w-full h-full","data-lottie-url":a.animationSrc,style:{background:"linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-3xl mb-2 animate-pulse",children:"💖"}),(0,b.jsx)("div",{className:"text-xs text-gray-600 font-medium",children:"Завантаження анімації..."}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Lottie"})]})}),(0,b.jsx)("div",{ref:b=>{b&&a.animationSrc&&!b.hasAttribute("data-lottie-loaded")&&(b.setAttribute("data-lottie-loaded","true"),b.setAttribute("data-gift-id",a.id.toString()),b.setAttribute("data-animation-src",a.animationSrc),setTimeout(()=>{bq(b,a)},100))},className:"w-full h-full","data-lottie-url":a.animationSrc,style:{background:"linear-gradient(135deg, #fce7f3 0%, #e9d5ff 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-3xl mb-2 animate-pulse",children:"💖"}),(0,b.jsx)("div",{className:"text-xs text-gray-600 font-medium",children:"Завантаження анімації..."}),(0,b.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:"Lottie"})]})}),(0,b.jsxs)("div",{className:"absolute top-1 right-1 bg-pink-500 text-white text-xs px-1 py-0.5 rounded flex items-center gap-0.5",children:["🎭",(0,b.jsx)("span",{className:"text-xs",children:"Lottie"})]})]}):a.animationSrc&&(a.animationSrc.endsWith(".gif")||a.animationSrc.includes("gif"))?(0,b.jsx)("img",{src:a.animationSrc.startsWith("http")||a.animationSrc.startsWith("//")?a.animationSrc.startsWith("//")?`https:${a.animationSrc}`:a.animationSrc:`https://talkytimes.com${a.animationSrc}`,alt:a.name,className:"w-full h-full object-cover",loading:"lazy",onError:b=>{console.error(`GIF failed for ${a.name}:`,b.target.src);let c=b.target;c.src=`https://picsum.photos/64/64?random=${a.id}`,c.onerror=null}}):(0,b.jsx)("img",{src:(a.imageSrc||a.animationSrc).startsWith("http")||(a.imageSrc||a.animationSrc).startsWith("//")?(a.imageSrc||a.animationSrc).startsWith("//")?`https:${a.imageSrc||a.animationSrc}`:a.imageSrc||a.animationSrc:`https://talkytimes.com${a.imageSrc||a.animationSrc}`,alt:a.name,className:"w-full h-full object-cover",loading:"lazy",onError:b=>{let c=b.target;a.animationSrc?c.src=a.animationSrc.replace(".json",".gif"):c.src=`https://picsum.photos/64/64?random=${a.id}`,c.onerror=null}}),a.animationSrc&&(0,b.jsxs)("div",{className:"absolute top-1 right-1 bg-pink-500 text-white text-xs px-1 py-0.5 rounded flex items-center gap-0.5",children:[a.animationSrc.endsWith(".json")?"🎭":"🎬",(0,b.jsx)("span",{className:"text-xs",children:a.animationSrc.endsWith(".json")?"JSON":a.animationSrc.endsWith(".gif")||a.animationSrc.includes("gif")?"GIF":"🎬"})]})]}):(0,b.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})})}),(0,b.jsxs)("h4",{className:"text-xs font-medium text-gray-900 text-center mb-1 truncate flex items-center justify-center gap-1",children:[a.name,a.animationSrc&&(0,b.jsx)("span",{className:"text-pink-500 text-xs",title:a.animationSrc.endsWith(".json")?"Lottie анімація (JSON)":a.animationSrc.endsWith(".gif")||a.animationSrc.includes("gif")?"GIF анімація":"Анімований подарунок",children:a.animationSrc.endsWith(".json")?"🎭":"🎬"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-center gap-1 text-xs text-pink-600 font-medium",children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),a.cost]})]},a.id))})})]})}),a0&&a$&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Надіслати подарунок"}),(0,b.jsx)("button",{onClick:()=>a1(!1),className:"text-gray-400 hover:text-gray-600 p-1",disabled:a4,children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-4 p-3 bg-pink-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"relative w-12 h-12 bg-gray-100 rounded-md overflow-hidden flex-shrink-0",children:[a$.imageSrc||a$.animationSrc?a$.animationSrc&&a$.animationSrc.endsWith(".json")?(0,b.jsx)(o,{onError:(a,b)=>{console.error(`🎭 Lottie error in message modal for gift "${a$.name}":`,a)},children:(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-pink-100 to-purple-100",children:(0,b.jsx)("span",{className:"text-lg",children:"🎭"})})}):(0,b.jsx)("img",{src:(a$.imageSrc||a$.animationSrc).startsWith("http")||(a$.imageSrc||a$.animationSrc).startsWith("//")?(a$.imageSrc||a$.animationSrc).startsWith("//")?`https:${a$.imageSrc||a$.animationSrc}`:a$.imageSrc||a$.animationSrc:`https://talkytimes.com${a$.imageSrc||a$.animationSrc}`,alt:a$.name,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})})}),a$.animationSrc&&(0,b.jsx)("div",{className:"absolute top-0 right-0 bg-pink-500 text-white text-xs px-1 py-0.5 rounded",children:"🎬"})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900 truncate",children:a$.name}),(0,b.jsxs)("div",{className:"flex items-center gap-1 text-sm text-pink-600",children:[(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),a$.cost]})]})]}),(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{htmlFor:"gift-message",className:"block text-sm font-medium text-gray-700 mb-2",children:"Особисте повідомлення (не обов'язково)"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("textarea",{id:"gift-message",value:a2,onChange:a=>a3(a.target.value),placeholder:"Напишіть тепле повідомлення до подарунку...",className:"w-full px-3 py-2 pr-12 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 resize-none",rows:3,maxLength:200,disabled:a4}),(0,b.jsxs)("div",{className:"absolute right-2 top-2",children:[(0,b.jsx)("button",{type:"button",onClick:()=>aR(!aQ),className:"text-gray-400 hover:text-gray-600 p-1 rounded transition-colors disabled:opacity-50",title:"Додати емодзі",disabled:a4,children:"😀"}),(0,b.jsx)(q,{isOpen:aQ,onEmojiSelect:a=>{a3(b=>b+a)},onClose:()=>aR(!1)})]})]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[a2.length,"/200"]})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{onClick:()=>a1(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:a4,children:"Відмінити"}),(0,b.jsx)("button",{onClick:bH,disabled:a4,className:"flex-1 px-4 py-2 bg-pink-500 hover:bg-pink-600 text-white rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:a4?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Надсилаю..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),"Надіслати"]})})]})]})]})}),(0,b.jsx)(m,{isOpen:W,src:Y,isLoading:$,onClose:()=>X(!1)}),C?.id&&(0,b.jsx)(v,{isOpen:bL,onClose:()=>bM(!1),profileId:C.id,clientId:bu}),C?.id&&(0,b.jsx)(x,{isOpen:bN,onClose:()=>bO(!1),profileId:C.id}),aS&&aU&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Пост"}),(0,b.jsx)("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${aU.isPurchased?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:aU.isPurchased?"Переглянуто":"Не відкрито"})]}),(0,b.jsx)("button",{onClick:()=>aT(!1),className:"text-gray-400 hover:text-gray-600 p-1",children:(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 custom-scroll",children:[aU.dateSent&&(0,b.jsxs)("div",{className:"mb-4 text-sm text-gray-600",children:[(0,b.jsx)("strong",{children:"Дата відправки:"})," ",new Date(aU.dateSent).toLocaleString("uk-UA")]}),aU.text&&(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)("p",{className:"text-gray-800 whitespace-pre-wrap leading-relaxed",children:aU.text})}),(aU.photos?.length>0||aU.videos?.length>0)&&(0,b.jsxs)("div",{className:"space-y-4",children:[aU.photos?.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Фото (",aU.photos.length,")"]}),(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:aU.photos.map((a,c)=>(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("img",{src:a.url,alt:`Photo ${c+1}`,className:"w-full h-32 object-cover rounded-lg cursor-zoom-in hover:opacity-90 transition-opacity",onClick:()=>bJ(a.url)})},a.id||c))})]}),aU.videos?.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:["Відео (",aU.videos.length,")"]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:aU.videos.map((a,c)=>(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("video",{src:a.url,className:"w-full h-32 object-cover rounded-lg",controls:!0})},a.id||c))})]})]}),aU.price&&(0,b.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Вартість:"}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)("svg",{className:"w-4 h-4 text-yellow-500",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})}),(0,b.jsx)("span",{className:"font-medium",children:aU.price}),aU.priceWithDiscount&&aU.priceWithDiscount!==aU.price&&(0,b.jsxs)("span",{className:"text-sm text-gray-500 ml-1",children:["(",aU.priceWithDiscount,")"]})]})]}),aU.discountPercent>0&&(0,b.jsxs)("div",{className:"text-xs text-green-600 mt-1",children:["Знижка: ",aU.discountPercent,"%"]})]})]})]})})]})}}];

//# sourceMappingURL=apps_web_src_app_chats_%5BdialogId%5D_page_tsx_86cd8768._.js.map